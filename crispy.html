<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script type="text/javascript">
//<![CDATA[
var version = {major: 2, minor: 1, revision: 3, date: new Date("Nov 3, 2006"), extensions: {}};
//]]>
</script>
<!--
TiddlyWiki 2.1.3 by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Osmosoft Limited 2004-2006

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the Osmosoft Limited nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
-->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>
<!--}}}-->

<style type="text/css">#contentWrapper {display:none;}</style><div id="SplashScreen" style="border: 3px solid #ccc; display: block; text-align: center; width: 320px; margin: 100px auto; padding: 50px; color:#000; font-size: 28px; font-family:Tahoma; background-color:#eee;"><b>CrispyNotes</b> is loading<blink> ...</blink><br><br><span style="font-size: 14px; color:red;">Requires Javascript.</span></div>
<!--PRE-HEAD-END-->
<title> CrispyNotes - A scratch-pad for miscellaneous scriblings and musings. </title>
<script type="text/javascript">
//<![CDATA[
// ---------------------------------------------------------------------------------
// Configuration repository
// ---------------------------------------------------------------------------------

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animFast: 0.12, // Speed for animations (lower == slower)
	animSlow: 0.01, // Speed for EasterEgg animations
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	displayStartupTime: false // Whether to display startup time
	};

// Messages
config.messages = {
	messageClose: {},
	dates: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	txtBackupFolder: "",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30"
	};
	
// List of notification functions to be called when certain tiddlers are changed or deleted
config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
	];

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
	};

// More messages (rather a legacy layout that shouldn't really be like this)
config.views = {
	wikified: {
		tag: {}
		},
	editor: {
		tagChooser: {}
		}
	};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {}
		},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	newTiddler: {},
	newJournal: {},
	sparkline: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {},
	edit: {},
	tagChooser: {},
	toolbar: {},
	br: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {}
	};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {},
	jump: {}
	};

// Browser detection... In a very few places, there's nothing else for it but to
// know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /Gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
	};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
	};
if(config.browser.isBadSafari)
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
		}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.urlPattern = "[a-z]{3,8}:[^\\s:'\"][^\\s'\"]*(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
												config.textPrimitives.lowerLetter + "+" +
												config.textPrimitives.upperLetter +
												config.textPrimitives.anyLetter + "*)|(?:" +
												config.textPrimitives.upperLetter + "{2,}" +
												config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" + 
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

// ---------------------------------------------------------------------------------
// Shadow tiddlers
// ---------------------------------------------------------------------------------

config.shadowTiddlers = {
	ColorPalette: "Background: #fff\n" + 
				  "Foreground: #000\n" +
				  "PrimaryPale: #8cf\n" +
				  "PrimaryLight: #18f\n" +
				  "PrimaryMid: #04b\n" +
				  "PrimaryDark: #014\n" +
				  "SecondaryPale: #ffc\n" +
				  "SecondaryLight: #fe8\n" +
				  "SecondaryMid: #db4\n" +
				  "SecondaryDark: #841\n" +
				  "TertiaryPale: #eee\n" +
				  "TertiaryLight: #ccc\n" +
				  "TertiaryMid: #999\n" +
				  "TertiaryDark: #666\n" +
				  "Error: #f88\n",
	StyleSheet: "",
	StyleSheetColors: "/*{{{*/\nbody {\n	background: [[ColorPalette::Background]];\n	color: [[ColorPalette::Foreground]];\n}\n\na{\n	color: [[ColorPalette::PrimaryMid]];\n}\n\na:hover{\n	background: [[ColorPalette::PrimaryMid]];\n	color: [[ColorPalette::Background]];\n}\n\na img{\n	border: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	color: [[ColorPalette::SecondaryDark]];\n	background: [[ColorPalette::PrimaryPale]];\n}\n\n.button {\n	color: [[ColorPalette::PrimaryDark]];\n	border: 1px solid [[ColorPalette::Background]];\n}\n\n.button:hover {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::SecondaryLight]];\n	border-color: [[ColorPalette::SecondaryMid]];\n}\n\n.button:active {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::SecondaryMid]];\n	border: 1px solid [[ColorPalette::SecondaryDark]];\n}\n\n.header {\n	background: [[ColorPalette::PrimaryMid]];\n}\n\n.headerShadow {\n	color: [[ColorPalette::Foreground]];\n}\n\n.headerShadow a {\n	font-weight: normal;\n	color: [[ColorPalette::Foreground]];\n}\n\n.headerForeground {\n	color: [[ColorPalette::Background]];\n}\n\n.headerForeground a {\n	font-weight: normal;\n	color: [[ColorPalette::PrimaryPale]];\n}\n\n.tabSelected{\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::TertiaryPale]];\n	border-left: 1px solid [[ColorPalette::TertiaryLight]];\n	border-top: 1px solid [[ColorPalette::TertiaryLight]];\n	border-right: 1px solid [[ColorPalette::TertiaryLight]];\n}\n\n.tabUnselected {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::TertiaryMid]];\n}\n\n.tabContents {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::TertiaryPale]];\n	border: 1px solid [[ColorPalette::TertiaryLight]];\n}\n\n.tabContents .button {\n	 border: 0;}\n\n#sidebar {\n}\n\n#sidebarOptions input {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel {\n	background: [[ColorPalette::PrimaryPale]];\n}\n\n#sidebarOptions .sliderPanel a {\n	border: none;\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel a:hover {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n}\n\n#sidebarOptions .sliderPanel a:active {\n	color: [[ColorPalette::PrimaryMid]];\n	background: [[ColorPalette::Background]];\n}\n\n.wizard {\n	background: [[ColorPalette::SecondaryLight]];\n	border-top: 1px solid [[ColorPalette::SecondaryMid]];\n	border-left: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.wizard h1 {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.wizard h2 {\n	color: [[ColorPalette::Foreground]];\n}\n\n.wizardStep {\n	background: [[ColorPalette::Background]];\n	border-top: 1px solid [[ColorPalette::SecondaryMid]];\n	border-bottom: 1px solid [[ColorPalette::SecondaryMid]];\n	border-left: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.wizard .button {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n	border-top: 1px solid [[ColorPalette::PrimaryLight]];\n	border-right: 1px solid [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n	border-left: 1px solid [[ColorPalette::PrimaryLight]];\n}\n\n.wizard .button:hover {\n	color: [[ColorPalette::PrimaryLight]];\n	background: [[ColorPalette::PrimaryDark]];\n	border-color: [[ColorPalette::PrimaryLight]];\n}\n\n.wizard .button:active {\n	color: [[ColorPalette::Background]];\n	background: [[ColorPalette::PrimaryMid]];\n	border-top: 1px solid [[ColorPalette::PrimaryLight]];\n	border-right: 1px solid [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n	border-left: 1px solid [[ColorPalette::PrimaryLight]];\n}\n\n#messageArea {\n	border: 1px solid [[ColorPalette::SecondaryDark]];\n	background: [[ColorPalette::SecondaryMid]];\n	color: [[ColorPalette::PrimaryDark]];\n}\n\n#messageArea .button {\n	padding: 0.2em 0.2em 0.2em 0.2em;\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::Background]];\n}\n\n.popup {\n	background: [[ColorPalette::PrimaryLight]];\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n.popup hr {\n	color: [[ColorPalette::PrimaryDark]];\n	background: [[ColorPalette::PrimaryDark]];\n	border-bottom: 1px;\n}\n\n.listBreak div{\n	border-bottom: 1px solid [[ColorPalette::PrimaryDark]];\n}\n\n.popup li.disabled {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n.popup li a, .popup li a:visited {\n	color: [[ColorPalette::TertiaryPale]];\n	border: none;\n}\n\n.popup li a:hover {\n	background: [[ColorPalette::PrimaryDark]];\n	color: [[ColorPalette::Background]];\n	border: none;\n}\n\n.tiddler .defaultCommand {\n font-weight: bold;\n}\n\n.shadow .title {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.title {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.subtitle {\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.toolbar {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n.tagging, .tagged {\n	border: 1px solid [[ColorPalette::TertiaryPale]];\n	background-color: [[ColorPalette::TertiaryPale]];\n}\n\n.selected .tagging, .selected .tagged {\n	background-color: [[ColorPalette::TertiaryLight]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.tagging .listTitle, .tagged .listTitle {\n	color: [[ColorPalette::PrimaryDark]];\n}\n\n.tagging .button, .tagged .button {\n		border: none;\n}\n\n.footer {\n	color: [[ColorPalette::TertiaryLight]];\n}\n\n.selected .footer {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n.sparkline {\n	background: [[ColorPalette::PrimaryPale]];\n	border: 0;\n}\n\n.sparktick {\n	background: [[ColorPalette::PrimaryDark]];\n}\n\n.error, .errorButton {\n	color: [[ColorPalette::Foreground]];\n	background: [[ColorPalette::Error]];\n}\n\n.warning {\n	color: [[ColorPalette::Foreground]];\n	background: [[ColorPalette::SecondaryPale]];\n}\n\n.cascade {\n	background: [[ColorPalette::TertiaryPale]];\n	color: [[ColorPalette::TertiaryMid]];\n	border: 1px solid [[ColorPalette::TertiaryMid]];\n}\n\n.imageLink, #displayArea .imageLink {\n	background: transparent;\n}\n\n.viewer .listTitle {list-style-type: none; margin-left: -2em;}\n\n.viewer .button {\n	border: 1px solid [[ColorPalette::SecondaryMid]];\n}\n\n.viewer blockquote {\n	border-left: 3px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer table {\n	border: 2px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer th, thead td {\n	background: [[ColorPalette::SecondaryMid]];\n	border: 1px solid [[ColorPalette::TertiaryDark]];\n	color: [[ColorPalette::Background]];\n}\n\n.viewer td, .viewer tr {\n	border: 1px solid [[ColorPalette::TertiaryDark]];\n}\n\n.viewer pre {\n	border: 1px solid [[ColorPalette::SecondaryLight]];\n	background: [[ColorPalette::SecondaryPale]];\n}\n\n.viewer code {\n	color: [[ColorPalette::SecondaryDark]];\n}\n\n.viewer hr {\n	border: 0;\n	border-top: dashed 1px [[ColorPalette::TertiaryDark]];\n	color: [[ColorPalette::TertiaryDark]];\n}\n\n.highlight, .marked {\n	background: [[ColorPalette::SecondaryLight]];\n}\n\n.editor input {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n}\n\n.editor textarea {\n	border: 1px solid [[ColorPalette::PrimaryMid]];\n	width: 100%;\n}\n\n.editorFooter {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n/*}}}*/",
	StyleSheetLayout: "/*{{{*/\n* html .tiddler {\n    height: 1%;\n}\n\nbody {\n	font-size: .75em;\n	font-family: arial,helvetica;\n	margin: 0;\n	padding: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	font-weight: bold;\n	text-decoration: none;\n	padding-left: 0.4em;\n}\n\nh1 {font-size: 1.35em;}\nh2 {font-size: 1.25em;}\nh3 {font-size: 1.1em;}\nh4 {font-size: 1em;}\nh5 {font-size: .9em;}\n\nhr {\n	height: 1px;\n}\n\na{\n	text-decoration: none;\n}\n\ndt {font-weight: bold;}\n\nol { list-style-type: decimal }\nol ol { list-style-type: lower-alpha }\nol ol ol { list-style-type: lower-roman }\nol ol ol ol { list-style-type: decimal }\nol ol ol ol ol { list-style-type: lower-alpha }\nol ol ol ol ol ol { list-style-type: lower-roman }\nol ol ol ol ol ol ol { list-style-type: decimal }\n\n.txtOptionInput {\n	width: 11em;\n}\n\n#contentWrapper .chkOptionInput {\n	border: 0;\n}\n\n.externalLink {\n	text-decoration: underline;\n}\n\n.indent {margin-left:3em;}\n.outdent {margin-left:3em; text-indent:-3em;}\ncode.escaped {white-space:nowrap;}\n\n.tiddlyLinkExisting {\n	font-weight: bold;\n}\n\n.tiddlyLinkNonExisting {\n	font-style: italic;\n}\n\n/* the 'a' is required for IE, otherwise it renders the whole tiddler a bold */\na.tiddlyLinkNonExisting.shadow {\n	font-weight: bold;\n}\n\n#mainMenu .tiddlyLinkExisting, \n#mainMenu .tiddlyLinkNonExisting,\n#sidebarTabs .tiddlyLinkNonExisting{\n font-weight: normal;\n font-style: normal;\n}\n\n#sidebarTabs .tiddlyLinkExisting {\n font-weight: bold;\n font-style: normal;\n}\n\n.header {\n		position: relative;\n}\n\n.header a:hover {\n	background: transparent;\n}\n\n.headerShadow {\n	position: relative;\n	padding: 4.5em 0em 1em 1em;\n	left: -1px;\n	top: -1px;\n}\n\n.headerForeground {\n	position: absolute;\n	padding: 4.5em 0em 1em 1em;\n	left: 0px;\n	top: 0px;\n}\n\n.siteTitle {\n	font-size: 3em;\n}\n\n.siteSubtitle {\n	font-size: 1.2em;\n}\n\n#mainMenu {\n	position: absolute;\n	left: 0;\n	width: 10em;\n	text-align: right;\n	line-height: 1.6em;\n	padding: 1.5em 0.5em 0.5em 0.5em;\n	font-size: 1.1em;\n}\n\n#sidebar {\n	position: absolute;\n	right: 3px;\n	width: 16em;\n	font-size: .9em;\n}\n\n#sidebarOptions {\n	padding-top: 0.3em;\n}\n\n#sidebarOptions a {\n	margin: 0em 0.2em;\n	padding: 0.2em 0.3em;\n	display: block;\n}\n\n#sidebarOptions input {\n	margin: 0.4em 0.5em;\n}\n\n#sidebarOptions .sliderPanel {\n	margin-left: 1em;\n	padding: 0.5em;\n	font-size: .85em;\n}\n\n#sidebarOptions .sliderPanel a {\n	font-weight: bold;\n	display: inline;\n	padding: 0;\n}\n\n#sidebarOptions .sliderPanel input {\n	margin: 0 0 .3em 0;\n}\n\n#sidebarTabs .tabContents {\n	width: 15em;\n	overflow: hidden;\n}\n\n.wizard {\n	padding: 0.1em 0em 0em 2em;\n}\n\n.wizard h1 {\n	font-size: 2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.4em 0em 0.2em 0em;\n}\n\n.wizard h2 {\n	font-size: 1.2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.2em 0em 0.2em 0em;\n}\n\n.wizardStep {\n	padding: 1em 1em 1em 1em;\n}\n\n.wizard .button {\n	margin: 0.5em 0em 0em 0em;\n	font-size: 1.2em;\n}\n\n#messageArea {\nposition:absolute; top:0; right:0; margin: 0.5em; padding: 0.5em;\n}\n\n*[id='messageArea'] {\nposition:fixed !important; z-index:99;}\n\n.messageToolbar {\ndisplay: block;\ntext-align: right;\n}\n\n#messageArea a{\n	text-decoration: underline;\n}\n\n.popup {\n	font-size: .9em;\n	padding: 0.2em;\n	list-style: none;\n	margin: 0;\n}\n\n.popup hr {\n	display: block;\n	height: 1px;\n	width: auto;\n	padding: 0;\n	margin: 0.2em 0em;\n}\n\n.listBreak {\n	font-size: 1px;\n	line-height: 1px;\n}\n\n.listBreak div {\n	margin: 2px 0;\n}\n\n.popup li.disabled {\n	padding: 0.2em;\n}\n\n.popup li a{\n	display: block;\n	padding: 0.2em;\n}\n\n.tabset {\n	padding: 1em 0em 0em 0.5em;\n}\n\n.tab {\n	margin: 0em 0em 0em 0.25em;\n	padding: 2px;\n}\n\n.tabContents {\n	padding: 0.5em;\n}\n\n.tabContents ul, .tabContents ol {\n	margin: 0;\n	padding: 0;\n}\n\n.txtMainTab .tabContents li {\n	list-style: none;\n}\n\n.tabContents li.listLink {\n	 margin-left: .75em;\n}\n\n#displayArea {\n	margin: 1em 17em 0em 14em;\n}\n\n\n.toolbar {\n	text-align: right;\n	font-size: .9em;\n	visibility: hidden;\n}\n\n.selected .toolbar {\n	visibility: visible;\n}\n\n.tiddler {\n	padding: 1em 1em 0em 1em;\n}\n\n.missing .viewer,.missing .title {\n	font-style: italic;\n}\n\n.title {\n	font-size: 1.6em;\n	font-weight: bold;\n}\n\n.missing .subtitle {\n display: none;\n}\n\n.subtitle {\n	font-size: 1.1em;\n}\n\n.tiddler .button {\n	padding: 0.2em 0.4em;\n}\n\n.tagging {\nmargin: 0.5em 0.5em 0.5em 0;\nfloat: left;\ndisplay: none;\n}\n\n.isTag .tagging {\ndisplay: block;\n}\n\n.tagged {\nmargin: 0.5em;\nfloat: right;\n}\n\n.tagging, .tagged {\nfont-size: 0.9em;\npadding: 0.25em;\n}\n\n.tagging ul, .tagged ul {\nlist-style: none;margin: 0.25em;\npadding: 0;\n}\n\n.tagClear {\nclear: both;\n}\n\n.footer {\n	font-size: .9em;\n}\n\n.footer li {\ndisplay: inline;\n}\n\n* html .viewer pre {\n	width: 99%;\n	padding: 0 0 1em 0;\n}\n\n.viewer {\n	line-height: 1.4em;\n	padding-top: 0.5em;\n}\n\n.viewer .button {\n	margin: 0em 0.25em;\n	padding: 0em 0.25em;\n}\n\n.viewer blockquote {\n	line-height: 1.5em;\n	padding-left: 0.8em;\n	margin-left: 2.5em;\n}\n\n.viewer ul, .viewer ol{\n	margin-left: 0.5em;\n	padding-left: 1.5em;\n}\n\n.viewer table {\n	border-collapse: collapse;\n	margin: 0.8em 1.0em;\n}\n\n.viewer th, .viewer td, .viewer tr,.viewer caption{\n	padding: 3px;\n}\n\n.viewer table.listView {\n	font-size: 0.85em;\n	margin: 0.8em 1.0em;\n}\n\n.viewer table.listView th, .viewer table.listView td, .viewer table.listView tr {\n	padding: 0px 3px 0px 3px;\n}\n\n.viewer pre {\n	padding: 0.5em;\n	margin-left: 0.5em;\n	font-size: 1.2em;\n	line-height: 1.4em;\n	overflow: auto;\n}\n\n.viewer code {\n	font-size: 1.2em;\n	line-height: 1.4em;\n}\n\n.editor {\nfont-size: 1.1em;\n}\n\n.editor input, .editor textarea {\n	display: block;\n	width: 100%;\n	font: inherit;\n}\n\n.editorFooter {\n	padding: 0.25em 0em;\n	font-size: .9em;\n}\n\n.editorFooter .button {\npadding-top: 0px; padding-bottom: 0px;}\n\n.fieldsetFix {border: 0;\npadding: 0;\nmargin: 1px 0px 1px 0px;\n}\n\n.sparkline {\n	line-height: 1em;\n}\n\n.sparktick {\n	outline: 0;\n}\n\n.zoomer {\n	font-size: 1.1em;\n	position: absolute;\n	padding: 1em;\n}\n\n.cascade {\n	font-size: 1.1em;\n	position: absolute;\n	overflow: hidden;\n}\n/*}}}*/",
	StyleSheetPrint: "/*{{{*/\n@media print {\n#mainMenu, #sidebar, #messageArea, .toolbar {display: none ! important;}\n#displayArea {margin: 1em 1em 0em 1em;}\n/* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\nnoscript {display:none;}\n}\n/*}}}*/",
	PageTemplate: "<!--{{{-->\n<div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'>\n<div class='headerShadow'>\n<span class='siteTitle' refresh='content' tiddler='SiteTitle'></span>&nbsp;\n<span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'></span>\n</div>\n<div class='headerForeground'>\n<span class='siteTitle' refresh='content' tiddler='SiteTitle'></span>&nbsp;\n<span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'></span>\n</div>\n</div>\n<div id='mainMenu' refresh='content' tiddler='MainMenu'></div>\n<div id='sidebar'>\n<div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'></div>\n<div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'></div>\n</div>\n<div id='displayArea'>\n<div id='messageArea'></div>\n<div id='tiddlerDisplay'></div>\n</div>\n<!--}}}-->",
	ViewTemplate: "<!--{{{-->\n<div class='toolbar' macro='toolbar closeTiddler closeOthers +editTiddler permalink references jump'></div>\n<div class='title' macro='view title'></div>\n<div class='subtitle'><span macro='view modifier link'></span>, <span macro='view modified date [[DD MMM YYYY]]'></span> (<span macro='message views.wikified.createdPrompt'></span> <span macro='view created date [[DD MMM YYYY]]'></span>)</div>\n<div class='tagging' macro='tagging'></div>\n<div class='tagged' macro='tags'></div>\n<div class='viewer' macro='view text wikified'></div>\n<div class='tagClear'></div>\n<!--}}}-->",
	EditTemplate: "<!--{{{-->\n<div class='toolbar' macro='toolbar +saveTiddler -cancelTiddler deleteTiddler'></div>\n<div class='title' macro='view title'></div>\n<div class='editor' macro='edit title'></div>\n<div class='editor' macro='edit text'></div>\n<div class='editor' macro='edit tags'></div><div class='editorFooter'><span macro='message views.editor.tagPrompt'></span><span macro='tagChooser'></span></div>\n<!--}}}-->",
	MarkupPreHead: "<!--{{{-->\n<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/>\n<!--}}}-->",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: ""
	};

// ---------------------------------------------------------------------------------
// Translateable strings
// ---------------------------------------------------------------------------------

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#DownloadSoftware for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. This could be because your browser doesn't support saving (instead, use FireFox if you can), or because the pathname to your TiddlyWiki file contains illegal characters",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.plugins,{
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these tiddlers:\n\n%0",
	listViewTemplate : {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', tiddlerLink: 'title', title: "Title", type: 'TiddlerLink'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			],
		actions: [
			{caption: "More actions...", name: ''},
			{caption: "Remove systemConfig tag", name: 'remove'},
			{caption: "Delete these tiddlers forever", name: 'delete'}
			]}
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import tiddlers into a read-only TiddlyWiki. Try opening the TiddlyWiki file from a file:// URL",
	defaultPath: "http://www.tiddlywiki.com/index.html",
	fetchLabel: "fetch",
	fetchPrompt: "Fetch the tiddlywiki file",
	fetchError: "There were problems fetching the tiddlywiki file",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	wizardTitle: "Import tiddlers from another TiddlyWiki file",
	step1: "Step 1: Locate the TiddlyWiki file",
	step1prompt: "Enter the URL or pathname here: ",
	step1promptFile: "...or browse for a file: ",
	step1promptFeeds: "...or select a pre-defined feed: ",
	step1feedPrompt: "Choose...",
	step2: "Step 2: Loading TiddlyWiki file",
	step2Text: "Please wait while the file is loaded from: %0",
	step3: "Step 3: Choose the tiddlers to import",
	step4: "%0 tiddler(s) imported",
	step5: "Done",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', title: "Title", type: 'String'},
			{name: 'Snippet', field: 'text', title: "Snippet", type: 'String'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			],
		actions: [
			{caption: "More actions...", name: ''},
			{caption: "Import these tiddlers", name: 'import'}
			]}
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "GettingStarted",
	MainMenu: "GettingStarted",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	GettingStarted: "To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:\n* SiteTitle & SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n* MainMenu: The menu (usually on the left)\n* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\nYou'll also need to enter your username for signing your edits: <<option txtUserName>>",
	SideBarOptions: "<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal 'DD MMM YYYY'>><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel 'options Â»' 'Change TiddlyWiki advanced options'>>",
	OptionsPanel: "These InterfaceOptions for customising TiddlyWiki are saved in your browser\n\nYour username for signing your edits. Write it as a WikiWord (eg JoeBloggs)\n\n<<option txtUserName>>\n<<option chkSaveBackups>> SaveBackups\n<<option chkAutoSave>> AutoSave\n<<option chkRegExpSearch>> RegExpSearch\n<<option chkCaseSensitiveSearch>> CaseSensitiveSearch\n<<option chkAnimate>> EnableAnimations\n\n----\nAdvancedOptions\nPluginManager\nImportTiddlers",
	AdvancedOptions: "<<option chkGenerateAnRssFeed>> GenerateAnRssFeed\n<<option chkOpenInNewWindow>> OpenLinksInNewWindow\n<<option chkSaveEmptyTemplate>> SaveEmptyTemplate\n<<option chkToggleLinks>> Clicking on links to tiddlers that are already open causes them to close\n^^(override with Control or other modifier key)^^\n<<option chkHttpReadOnly>> HideEditingFeatures when viewed over HTTP\n<<option chkForceMinorUpdate>> Treat edits as MinorChanges by preserving date and time\n^^(override with Shift key when clicking 'done' or by pressing Ctrl-Shift-Enter^^\n<<option chkConfirmDelete>> ConfirmBeforeDeleting\nMaximum number of lines in a tiddler edit box: <<option txtMaxEditRows>>\nFolder name for backup files: <<option txtBackupFolder>>\n<<option chkInsertTabs>> Use tab key to insert tab characters instead of jumping to next field",
	SideBarTabs: "<<tabs txtMainTab Timeline Timeline TabTimeline All 'All tiddlers' TabAll Tags 'All tags' TabTags More 'More lists' TabMore>>",
	TabTimeline: "<<timeline>>",
	TabAll: "<<list all>>",
	TabTags: "<<allTags>>",
	TabMore: "<<tabs txtMoreTab Missing 'Missing tiddlers' TabMoreMissing Orphans 'Orphaned tiddlers' TabMoreOrphans Shadowed 'Shadowed tiddlers' TabMoreShadowed>>",
	TabMoreMissing: "<<list missing>>",
	TabMoreOrphans: "<<list orphans>>",
	TabMoreShadowed: "<<list shadowed>>",
	PluginManager: "<<plugins>>",
	ImportTiddlers: "<<importTiddlers>>"});

// ---------------------------------------------------------------------------------
// Main
// ---------------------------------------------------------------------------------

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
config.parsers = {}; // Hashmap of alternative parsers for the wikifier
var anim = new Animator(); // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = config.browser.isSafari || config.browser.isOpera;

// Starting up
function main()
{
	var now, then = new Date();
	startingUp = true;
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	store.loadFromDiv("storeArea","store",true);
	invokeParamifier(params,"onload");
	var pluginProblem = loadPlugins();
	formatter = new Formatter(config.formatters);
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	invokeParamifier(params,"onconfig");
	store.notifyAll();
	restart();
	if(pluginProblem)
		{
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
		}
	now = new Date();
	if(config.displayStartupTime)
		displayMessage("TiddlyWiki startup in " + (now-then)/1000 + " seconds");
	startingUp = false;
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty())
		{
		var defaultParams = store.getTiddlerText("DefaultTiddlers").parseParams("open",null,false);
		invokeParamifier(defaultParams,"onstart");
		}
	window.scrollTo(0,0);
}

function saveTest()
{
	var saveTest = document.getElementById("saveTest");
	if(saveTest.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	saveTest.appendChild(document.createTextNode("savetest"));
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	installedPlugins = [];
	var hadProblem = false;
	for(var t=0; t<configTiddlers.length; t++)
		{
		tiddler = configTiddlers[t];
		pluginInfo = getPluginInfo(tiddler);
		if(isPluginExecutable(pluginInfo))
			{
			pluginInfo.executed = true;
			pluginInfo.error = false;
			try
				{
				if(tiddler.text && tiddler.text != "")
					window.eval(tiddler.text);
				}
			catch(e)
				{
				pluginInfo.log.push(config.messages.pluginError.format([exceptionText(e)]));
				pluginInfo.error = true;
				hadProblem = true;
				}
			}
		else
			pluginInfo.warning = true;
		installedPlugins.push(pluginInfo);
		}
	return hadProblem;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable"))
		return verifyTail(plugin,false,config.messages.pluginDisabled);
	if(plugin.tiddler.isTagged("systemConfigForce"))
		return verifyTail(plugin,true,config.messages.pluginForced);
	if(plugin["CoreVersion"])
		{
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0]) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1]) - version.minor;
		if(w == 0 && coreVersion[2])
		 	w = parseInt(coreVersion[2]) - version.revision;
		if(w > 0)
			return verifyTail(plugin,false,config.messages.pluginVersionError);
		}
	return true;
}

function verifyTail(plugin,result,message)
{
	plugin.log.push(message);
	return result;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try
		{
		var m = config.macros[macro];
		if(m && m.handler)
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		else
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	catch(ex)
		{
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
		}
}

// ---------------------------------------------------------------------------------
// Paramifiers
// ---------------------------------------------------------------------------------

function getParameters()
{
	var p = null;
	if(window.location.hash)
		{
		p = decodeURI(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
		}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var t=1; t<params.length; t++)
		{
		var p = config.paramifiers[params[t].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[t].value);
		}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
		}
};

config.paramifiers.open = {
	onstart: function(v) {
		story.displayTiddler("bottom",v,null,false,false);
		}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
		}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
		}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
		}
};

config.paramifiers.tag = {
	onstart: function(v) {
		var tagged = store.getTaggedTiddlers(v,"title");
		for(var t=0; t<tagged.length; t++)
			story.displayTiddler("bottom",tagged[t].title,null,false,false);
		}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly)
			{
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
			}
		}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly)
			{
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
			}
		}
};

// ---------------------------------------------------------------------------------
// Formatter helpers
// ---------------------------------------------------------------------------------

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++)
		{
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
		}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},
	
	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			var s,v;
			if(lookaheadMatch[1])
				{
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
				}
			else
				{
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
				}
			if (s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
			}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++)
			{
			try
				{
				e.style[styles[t].style] = styles[t].value;
				}
			catch (ex)
				{
				}
			}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link))
			{
			//# Definitely not an external link
			return false;
			}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link))
			{
			// Definitely an external link
			return true;
			}
		if (link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1)
			{
			//# Link contains . / or \ so is probably an external link
			return true;
			}
		//# Otherwise assume it is not an external link
		return false;
	}

};

// ---------------------------------------------------------------------------------
// Standard formatters
// ---------------------------------------------------------------------------------

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},

	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k")
				{
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
				}
			else
				{
				if(nextRowType != currRowType)
					{
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
					}
				if(currRowType == "c")
					{
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
					}
				else
					{
					this.rowHandler(w,createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow"),prevColumns);
					rowCount++;
					}
				}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch)
			{
			if(cellMatch[1] == "~")
				{
				// Rowspan
				var last = prevColumns[col];
				if(last)
					{
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					}
				w.nextMatch = this.cellRegExp.lastIndex-1;
				}
			else if(cellMatch[1] == ">")
				{
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
				}
			else if(cellMatch[2])
				{
				// End of row
				if(prevCell && colSpanCount > 1)
					{
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
					}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
				}
			else
				{
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ")
					{
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
					}
				var cell;
				if(chr == "!")
					{
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
					}
				else
					cell = createTiddlyElement(e,"td");
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1, element:cell};
				if(colSpanCount > 1)
					{
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
					}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
				}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
			}
	}
},

{
	name: "heading",
	match: "^!{1,5}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:(?:(?:\\*)|(?:#)|(?:;)|(?::))+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var placeStack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch)
			{
			if(lookaheadMatch[1])
				{
				listType = "ul";
				itemType = "li";
				}
			else if(lookaheadMatch[2])
				{
				listType = "ol";
				itemType = "li";
				}
			else if(lookaheadMatch[3])
				{
				listType = "dl";
				itemType = "dt";
				}
			else if(lookaheadMatch[4])
				{
				listType = "dl";
				itemType = "dd";
				}
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			if(listLevel > currLevel)
				{
				for(var t=currLevel; t<listLevel; t++)
					placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],listType));
				}
			else if(listLevel < currLevel)
				{
				for(var t=currLevel; t>listLevel; t--)
					placeStack.pop();
				}
			else if(listLevel == currLevel && listType != currType)
				{
				placeStack.pop();
				placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],listType));
				}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(placeStack[placeStack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var placeStack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel)
				{
				for(t=currLevel; t<newLevel; t++)
					placeStack.push(createTiddlyElement(placeStack[placeStack.length-1],this.element));
				}
			else if(newLevel < currLevel)
				{
				for(t=currLevel; t>newLevel; t--)
					placeStack.pop();
				}
			currLevel = newLevel;
			w.subWikifyTerm(placeStack[placeStack.length-1],this.termRegExp);
			createTiddlyElement(placeStack[placeStack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched)
				{
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
				}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^\\{\\{\\{\\n",
	lookaheadRegExp: /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForCSS",
	match: "^/\\*[\\{]{3}\\*/\\n",
	lookaheadRegExp: /\/\*[\{]{3}\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*[\}]{3}\*\/$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForPlugin",
	match: "^//\\{\\{\\{\\n",
	lookaheadRegExp: /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg,
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "monospacedByLineForTemplate",
	match: "^<!--[\\{]{3}-->\\n",
	lookaheadRegExp: /<!--[\{]{3}-->\n*((?:^[^\n]*\n)+?)(\n*^<!--[\}]{3}-->$\n?)/mg, 
	element: "pre",
	handler: config.formatterHelpers.enclosedTextHelper
},

{
	name: "wikifyCommentForPlugin", 
	match: "^/\\*\\*\\*\\n",
	termRegExp: /(^\*\*\*\/\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "wikifyCommentForTemplate", 
	match: "^<!---\\n",
	termRegExp: /(^--->\n)/mg,
	handler: function(w) 
	{
		w.subWikifyTerm(w.output,this.termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1])
			{
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
			}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3])
				{
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link))
						? createExternalLink(w.output,link)
						: createTiddlyLink(w.output,link,false,null,w.isStatic);
				}
			else
				{
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic);
				}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "unWikiLink",
	match: config.textPrimitives.unWikiLink+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		w.outputText(w.output,w.matchStart+1,w.nextMatch);
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchStart > 0)
			{
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1)
				{
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
				}
			}
		if(w.autoLinkWikiWords == true || store.isShadowTiddler(w.matchText))
			{
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic);
			w.outputText(link,w.matchStart,w.nextMatch);
			}
		else
			{
			w.outputText(w.output,w.matchStart,w.nextMatch);
			}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[(<?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) // Simple bracketted link
			{
			var e = w.output;
			if(lookaheadMatch[5])
				{
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic);
				addClass(e,"imageLink");
				}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "boldByChar",
	match: "''",
	termRegExp: /('')/mg,
	element: "strong",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "italicByChar",
	match: "//",
	termRegExp: /(\/\/)/mg,
	element: "em",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "underlineByChar",
	match: "__",
	termRegExp: /(__)/mg,
	element: "u",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "strikeByChar",
	match: "--(?!\\s|$)",
	termRegExp: /((?!\s)--|(?=\n\n))/mg,
	element: "strike",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "superscriptByChar",
	match: "\\^\\^",
	termRegExp: /(\^\^)/mg,
	element: "sup",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "subscriptByChar",
	match: "~~",
	termRegExp: /(~~)/mg,
	element: "sub",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "monospacedByChar",
	match: "\\{\\{\\{",
	lookaheadRegExp: /\{\{\{((?:.|\n)*?)\}\}\}/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "styleByChar",
	match: "@@",
	termRegExp: /(@@)/mg,
	handler:  function(w)
	{
		var e = createTiddlyElement(w.output,"span");
		var styles = config.formatterHelpers.inlineCssHelper(w);
		if(styles.length == 0)
			e.className = "marked";
		else
			config.formatterHelpers.applyCssHelper(e,styles);
		w.subWikifyTerm(e,this.termRegExp);
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			{
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
		{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
		}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
		{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
		}
},

{
	name: "customClasses",
	match: "\\{\\{",
	termRegExp: /(\}\}\})/mg,
	lookaheadRegExp: /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch)
			{
			var e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			w.subWikifyTerm(e,this.termRegExp);
			}
	}
}

];

// ---------------------------------------------------------------------------------
// Wikifier
// ---------------------------------------------------------------------------------

function getParser(tiddler)
{
	var f = formatter;
	if(tiddler!=null)
		{
		for(var i in config.parsers)
			{
			if(tiddler.isTagged(config.parsers[i].formatTag))
				{
				f = config.parsers[i];
				break;
				}
			}
		}
	return f;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.subWikifyUnterm(output);
		}
}

function wikifyStatic(source,highlightRegExp,tiddler)
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	var html = "";
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikifyUnterm(e);
		html = e.innerHTML;
		e.parentNode.removeChild(e);
		}
	return html;
}

// Wikify a named tiddler to plain text
function wikifyPlain(title)
{
	if(store.tiddlerExists(title) || store.isShadowTiddler(title))
		{
		var wikifier = new Wikifier(store.getTiddlerText(title),formatter,null,store.getTiddler(title));
		return wikifier.wikifyPlain();
		}
	else
		return "";
}

// Highlight plain text into an element
function highlightify(source,output,highlightRegExp)
{
	if(source && source != "")
		{
		var wikifier = new Wikifier(source,formatter,highlightRegExp);
		wikifier.outputText(output,0,source.length);
		}
}

// Construct a wikifier object
// source - source string that's going to be wikified
// formatter - Formatter() object containing the list of formatters to be used
// highlightRegExp - regular expression of the text string to highlight
// tiddler - reference to the tiddler that's taken to be the container for this wikification
function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp)
		{
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
		}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	e.parentNode.removeChild(e);
	return text;
}

Wikifier.prototype.subWikify = function(output,terminator)
{
	// Handle the terminated and unterminated cases separately
	if (terminator)
		this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
	else
		this.subWikifyUnterm(output);
}

Wikifier.prototype.subWikifyUnterm = function(output)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first match
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch)
		{
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		// Figure out which formatter matched and call its handler
		for(var t=1; t<formatterMatch.length; t++)
			{
			if(formatterMatch[t])
				{
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
				}
			}
		// Get the next match
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
		}
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	// subWikify() can be indirectly recursive, so we need to save the old output pointer
	var oldOutput = this.output;
	this.output = output;
	// Get the first matches for the formatter and terminator RegExps
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch)
		{
		// Check for a terminator match  before the next formatter match
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index))
			{
			// Output any text before the match
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			// Set the match parameters
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			// Restore the output pointer
			this.output = oldOutput;
			return;
			}
		// It must be a formatter match; output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		// Figure out which formatter matched and call its handler
		for(var t=1; t<formatterMatch.length; t++)
			{
			if(formatterMatch[t])
				{
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
				}
			}
		// Get the next match
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
		}
	// Output any text after the last match
	if(this.nextMatch < this.source.length)
		{
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
		}
	// Restore the output pointer
	this.output = oldOutput;
}

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	// Check for highlights
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos))
		{
		// Deal with any plain text before the highlight
		if(this.highlightMatch.index > startPos)
			{
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
			}
		// Deal with the highlight
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		// Nudge along to the next highlight if we're done with this one
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
		}
	// Do the unhighlighted text left over
	if(startPos < endPos)
		{
		createTiddlyText(place,this.source.substring(startPos,endPos));
		}
}

// ---------------------------------------------------------------------------------
// Macro definitions
// ---------------------------------------------------------------------------------

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text;
	if(params[0])
		text = now.formatString(params[0].trim());
	else
		text = now.toLocaleString();
	createTiddlyElement(place,"span",null,null,text);
}

config.macros.version.handler = function(place)
{
	createTiddlyElement(place,"span",null,null,version.major + "." + version.minor + "." + version.revision + (version.beta ? " (beta " + version.beta + ")" : ""));
}

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] ? params[0] : "all";
	var theList = document.createElement("ul");
	place.appendChild(theList);
	if(this[type].prompt)
		createTiddlyElement(theList,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++)
		{
		var theListItem = document.createElement("li")
		theList.appendChild(theListItem);
		if(typeof results[t] == "string")
			createTiddlyLink(theListItem,results[t],true);
		else
			createTiddlyLink(theListItem,results[t].title,true);
		}
}

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
}

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
}

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
}

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
}

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags();
	var theDateList = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(theDateList,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++)
		{
		var theListItem =createTiddlyElement(theDateList,"li");
		var theTag = createTiddlyButton(theListItem,tags[t][0] + " (" + tags[t][1] + ")",this.tooltip.format([tags[t][0]]),onClickTag);
		theTag.setAttribute("tag",tags[t][0]);
		}
}

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] ? params[0] : "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	for(var t=tiddlers.length-1; t>=last; t--)
		{
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay)
			{
			var theDateList = document.createElement("ul");
			place.appendChild(theDateList);
			createTiddlyElement(theDateList,"li",null,"listTitle",tiddler[field].formatString(this.dateFormat));
			lastDay = theDay;
			}
		var theDateListItem = createTiddlyElement(theDateList,"li",null,"listLink");
		theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
		}
}

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick);
	var txt = createTiddlyElement(place,"input",null,"txtOptionInput");
	if(params[0])
		txt.value = params[0];
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	if(config.browser.isSafari)
		{
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
		}
	else
		txt.setAttribute("type","text");
}

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0)
		{
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
		}
}

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
}

config.macros.search.onKeyPress = function(e)
{
	if(!e) var e = window.event;
	switch(e.keyCode)
		{
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
		}
	if(this.value.length > 2)
		{
		if(this.value != this.getAttribute("lastSearchText"))
			{
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
			var txt = this;
			config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		}
	else
		{
		if(config.macros.search.timeout)
			clearTimeout(config.macros.search.timeout);
		}
}

config.macros.search.onFocus = function(e)
{
	this.select();
}

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] ? names[1] : null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args)
		{
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
		}
	var text = store.getTiddlerText(tiddlerName);
	if(text)
		{
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try
			{
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) 
				{
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
				}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
			}
		finally
			{
			stack.pop();
			}
		}
}

config.macros.tiddler.renderText = function(place,text,tiddlerName,params) 
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
}

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0]);
}

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++)
		{
		createTagButton(createTiddlyElement(theList,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(theList,sep);
		}
}

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var theList = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	theList.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(theList,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++)
		{
		createTiddlyLink(createTiddlyElement(theList,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(theList,sep);
		}
}

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
}

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
}

config.macros.saveChanges.handler = function(place)
{
	if(!readOnly)
		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);
}

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
}

config.macros.slider.onClickSlider = function(e)
{
	if(!e) var e = window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(anim && config.options.chkAnimate)
		anim.startAnimating(new Slider(n,!isOpen,e.shiftKey || e.altKey,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
}

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var cookie = cookie ? cookie : "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",cookie);
	panel.style.display = config.options[cookie] ? "block" : "none";
	place.appendChild(panel);
	return panel;
}

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh", "content");
	panel.setAttribute("tiddler", params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
}

config.macros.option.onChangeOption = function(e)
{
	var opt = this.getAttribute("option");
	var elementType,valueField;
	if(opt)
		{
		switch(opt.substr(0,3))
			{
			case "txt":
				elementType = "input";
				valueField = "value";
				break;
			case "chk":
				elementType = "input";
				valueField = "checked";
				break;
			}
		config.options[opt] = this[valueField];
		saveOptionCookie(opt);
		var nodes = document.getElementsByTagName(elementType);
		for(var t=0; t<nodes.length; t++)
			{
			var optNode = nodes[t].getAttribute("option");
			if(opt == optNode)
				nodes[t][valueField] = this[valueField];
			}
		}
	return(true);
}

config.macros.option.handler = function(place,macroName,params)
{
	var opt = params[0];
	if(config.options[opt] == undefined)
		return;
	var c;
	switch(opt.substr(0,3))
		{
		case "txt":
			c = document.createElement("input");
			c.onkeyup = this.onChangeOption;
			c.setAttribute("option",opt);
			c.className = "txtOptionInput";
			place.appendChild(c);
			c.value = config.options[opt];
			break;
		case "chk":
			c = document.createElement("input");
			c.setAttribute("type","checkbox");
			c.onclick = this.onChangeOption;
			c.setAttribute("option",opt);
			c.className = "chkOptionInput";
			place.appendChild(c);
			c.checked = config.options[opt];
			break;
		}
}



config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++)
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal);
	btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	var text = getParam(params,"text");
	if(text !== undefined) 
		btn.setAttribute("newText",text);
	return btn;
}

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal"))
		{
		var now = new Date();
		title = now.formatString(title.trim());
		}
	var params = this.getAttribute("params").split("|");
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	story.displayTiddler(null,title,template);
	var text = this.getAttribute("newText");
	if(typeof text == "string")
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<params.length;t++)
		story.setTiddlerTag(title,params[t],+1);
	story.focusTiddler(title,focus);
	return false;
}

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly)
		{
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
		}
}

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!readOnly)
		{
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : "";
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
		}
}

config.macros.sparkline.handler = function(place,macroName,params)
{
	var data = [];
	var min = 0;
	var max = 0;
	for(var t=0; t<params.length; t++)
		{
		var v = parseInt(params[t]);
		if(v < min)
			min = v;
		if(v > max)
			max = v;
		data.push(v);
		}
	if(data.length < 1)
		return;
	var box = createTiddlyElement(place,"span",null,"sparkline",String.fromCharCode(160));
	box.title = data.join(",");
	var w = box.offsetWidth;
	var h = box.offsetHeight;
	box.style.paddingRight = (data.length * 2 - w) + "px";
	box.style.position = "relative";
	for(var d=0; d<data.length; d++)
		{
		var tick = document.createElement("img");
		tick.border = 0;
		tick.className = "sparktick";
		tick.style.position = "absolute";
		tick.src = "data:image/gif,GIF89a%01%00%01%00%91%FF%00%FF%FF%FF%00%00%00%C0%C0%C0%00%00%00!%F9%04%01%00%00%02%00%2C%00%00%00%00%01%00%01%00%40%02%02T%01%00%3B";
		tick.style.left = d*2 + "px";
		tick.style.width = "2px";
		var v = Math.floor(((data[d] - min)/(max-min)) * h);
		tick.style.top = (h-v) + "px";
		tick.style.height = v + "px";
		box.appendChild(tick);
		}
}

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++)
		{
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
		}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
}

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
}

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++)
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab)
			{
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
			}
		else
			nodes[t].className = "tab tabUnselected"
	if(theTab)
		{
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			tabset.parentNode.removeChild(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie)
			{
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
			}
		}
}

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier)
{
	var terminator = ">>";
	var panel;
	if(wikifier)
		panel = createTiddlyElement(place,"div",null,"gradient");
	else
		panel = place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	var t;
	if(wikifier)
		{
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
		}
	var colours = [];
	for(t=1; t<params.length; t++)
		{
		var c = new RGB(params[t]);
		if(c)
			colours.push(c);
		}
	drawGradient(panel,params[0] != "vert",colours);
	if(wikifier)
		wikifier.subWikify(panel,terminator);
	if(document.all)
		{
		panel.style.height = "100%";
		panel.style.width = "100%";
		}
}

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0])
		{
		var m = config;
		var p = params[0].split(".");
		for(var t=0; t<p.length; t++)
			{
			if(p[t] in m)
				m = m[p[t]];
			else
				break;
			}
		createTiddlyText(place,m.toString().format(params.splice(1)));
		}
}

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0])
		{
		var value = store.getValue(tiddler,params[0]);
		if(value != undefined)
			switch(params[1])
				{
				case undefined:
					highlightify(value,place,highlightHack);
					break;
				case "link":
					createTiddlyLink(place,value,true);
					break;
				case "wikified":
					wikify(value,place,highlightHack,tiddler);
					break;
				case "date":
					value = Date.convertFromYYYYMMDDHHMM(value);
					if(params[2])
						createTiddlyText(place,value.formatString(params[2]));
					else
						createTiddlyText(place,value);
					break;
				}
		}
}

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	if((tiddler instanceof Tiddler) && field)
		{
		story.setDirty(tiddler.title,true);
		if(field != "text")
			{
				var e = createTiddlyElement(null,"input");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				e.setAttribute("edit",field);
				e.setAttribute("type","text");
				var v = store.getValue(tiddler,field);
				if(!v) 
					v = "";
				e.value = v;
				e.setAttribute("size","40");
				e.setAttribute("autocomplete","off");
				place.appendChild(e);
			}
		else
			{
				var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
				var wrapper2 = createTiddlyElement(wrapper1,"div");
				var e = createTiddlyElement(wrapper2,"textarea");
				if(tiddler.isReadOnly())
					e.setAttribute("readOnly","readOnly");
				var v = store.getValue(tiddler,field);
				if(!v) 
					v = "";
				e.value = v;
				var rows = 10;
				var lines = v.match(/\n/mg);
				var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
				if(lines != null && lines.length > rows)
					rows = lines.length + 5;
				rows = Math.min(rows,maxLines);
				e.setAttribute("rows",rows);
				e.setAttribute("edit",field);
				place.appendChild(wrapper1);
			}
		}
}

config.macros.tagChooser.onClick = function(e)
{
	if(!e) var e = window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags();
	if(tags.length == 0)
		createTiddlyText(createTiddlyElement(popup,"li"),lingo.popupNone);
	for(var t=0; t<tags.length; t++)
		{
		var theTag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		theTag.setAttribute("tag",tags[t][0]);
		theTag.setAttribute("tiddler", this.getAttribute("tiddler"));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return(false);
}

config.macros.tagChooser.onTagClick = function(e)
{
	if(!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return(false);
}

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler)
		{
		var title = tiddler.title;
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler", title);
		}
}

// Create a toolbar command button
// place - parent DOM element
// command - reference to config.commands[] member -or- name of member
// tiddler - reference to tiddler that toolbar applies to
// theClass - the class to give the button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,theClass)
{
	if(typeof commandName != "string")
		{
		var c = null;
		for(var t in config.commands)
			if(config.commands[t] == commandName)
				c = t;
		commandName = c;
		}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string"))
		{
		var title = tiddler.title;
		var command = config.commands[commandName];
		var ro = tiddler.isReadOnly();
		var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
		var text = ro && command.readOnlyText ? command.readOnlyText : command.text;
		var tooltip = ro && command.readOnlyTooltip ? command.readOnlyTooltip : command.tooltip;
		if((!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow))

			{
			var btn = createTiddlyButton(null,text,tooltip,this.onClickCommand);
			btn.setAttribute("commandName", commandName);
			btn.setAttribute("tiddler", title);
			if(theClass)
				addClass(btn,theClass);
			place.appendChild(btn);
			}
		}
}

config.macros.toolbar.onClickCommand = function(e)
{
	if(!e) var e = window.event;
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
}

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,theClass,event)
{
	var children = place.getElementsByTagName("a")
	for(var t=0; t<children.length; t++)
		{
		var c = children[t];
		if(hasClass(c,theClass) && c.getAttribute && c.getAttribute("commandName"))
			{
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
			}
		}
}

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++)
		{
		var c = params[t];
		var theClass = "";
		switch(c.substr(0,1))
			{
			case "+":
				theClass = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				theClass = "cancelCommand";
				c = c.substr(1);
				break;
			}
		if(c in config.commands)
			this.createCommand(place,c,tiddler,theClass);
		}
}

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var e = createTiddlyElement(place,"div");
	e.setAttribute("refresh","macro");
	e.setAttribute("macroName","plugins");
	e.setAttribute("params",paramString);
	this.refresh(e,paramString);
}

config.macros.plugins.refresh = function(place,params)
{
	var selectedRows = [];
	ListView.forEachSelector(place,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(place);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++)
		{
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null)
			{
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
			}
		}
	for(t=0; t<plugins.length; t++)
		{
		var p = plugins[t];
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
		}
	if(plugins.length == 0)
		createTiddlyElement(place,"em",null,null,this.noPluginText);
	else
		ListView.create(place,plugins,this.listViewTemplate,this.onSelectCommand);
}

config.macros.plugins.onSelectCommand = function(command,rowNames)
{
	var t;
	switch(command)
		{
		case "remove":
			for(t=0; t<rowNames.length; t++)
				store.setTiddlerTag(rowNames[t],false,"systemConfig");
			break;
		case "delete":
			if(rowNames.length > 0 && confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")])))
				{
				for(t=0; t<rowNames.length; t++)
					{
					store.removeTiddler(rowNames[t]);
					story.closeTiddler(rowNames[t],true,false);
					}
				}
			break;
		}
	if(config.options.chkAutoSave)
		saveChanges(true);
}

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
}

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
}

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly)
		{
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
		}
	var importer = createTiddlyElement(null,"div",null,"importTiddler wizard");
	createTiddlyElement(importer,"h1",null,null,this.wizardTitle);
	createTiddlyElement(importer,"h2",null,"step1",this.step1);
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	createTiddlyText(step,this.step1prompt);
	var input = createTiddlyElement(null,"input",null,"txtOptionInput");
	input.type = "text";
	input.size = 50;
	step.appendChild(input);
	importer.inputBox = input;
	createTiddlyElement(step,"br");
	createTiddlyText(step,this.step1promptFile);
	var fileInput = createTiddlyElement(null,"input",null,"txtOptionInput");
	fileInput.type = "file";
	fileInput.size = 50;
	fileInput.onchange = this.onBrowseChange;
	fileInput.onkeyup = this.onBrowseChange;
	step.appendChild(fileInput);
	createTiddlyElement(step,"br");
	createTiddlyText(step,this.step1promptFeeds);
	var feeds = this.getFeeds([{caption: this.step1feedPrompt, name: ""}]);
	createTiddlyDropDown(step,this.onFeedChange,feeds);
	createTiddlyElement(step,"br");
	createTiddlyButton(step,this.fetchLabel,this.fetchPrompt,this.onFetch,null,null,null);
        place.appendChild(importer);
}

config.macros.importTiddlers.getFeeds = function(feeds)
{
	var tagged = store.getTaggedTiddlers("contentPublisher","title");
	for(var t=0; t<tagged.length; t++)
		feeds.push({caption: tagged[t].title, name: store.getTiddlerSlice(tagged[t].title,"URL")});
	return feeds;
}

config.macros.importTiddlers.onFeedChange = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	importer.inputBox.value = this.value;
	this.selectedIndex = 0;
}

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	importer.inputBox.value = "file://" + this.value;
}

config.macros.importTiddlers.onFetch = function(e)
{
	var importer = findRelated(this,"importTiddler","className","parentNode");
	var url = importer.inputBox.value;
	var cutoff = findRelated(importer.firstChild,"step2","className","nextSibling");
	while(cutoff)
		{
		var temp = cutoff.nextSibling;
		cutoff.parentNode.removeChild(cutoff);
		cutoff = temp;
		}
	createTiddlyElement(importer,"h2",null,"step2",config.macros.importTiddlers.step2);
	var step = createTiddlyElement(importer,"div",null,"wizardStep",config.macros.importTiddlers.step2Text.format([url]));
	loadRemoteFile(url,config.macros.importTiddlers.onLoad,importer);
}

config.macros.importTiddlers.onLoad = function(status,params,responseText,url,xhr)
{
	if(!status)
		{
		displayMessage(this.fetchError);
		return;
		}
	var importer = params;
	// Check that the tiddler we're in hasn't been closed - doesn't work on IE
//	var p = importer;
//	while(p.parentNode)
//		p = p.parentNode;
//	if(!(p instanceof HTMLDocument))
//		return;
	// Crack out the content - (should be refactored)
	var posOpeningDiv = responseText.indexOf(startSaveArea);
	var limitClosingDiv = responseText.indexOf("<!--POST-BODY-START--"+">");
	var posClosingDiv = responseText.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? responseText.length : limitClosingDiv);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([url]));
		return;
		}
	var content = "<html><body>" + responseText.substring(posOpeningDiv,posClosingDiv + endSaveArea.length) + "</body></html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	importer.insertBefore(iframe,importer.firstChild);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	var importStore = new TiddlyWiki();
	importStore.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	// Extract data for the listview
	var tiddlers = [];
	importStore.forEachTiddler(function(title,tiddler)
		{
		var t = {};
		t.title = title;
		t.modified = tiddler.modified;
		t.modifier = tiddler.modifier;
		t.text = tiddler.text.substr(0,50);
		t.tags = tiddler.tags;
		tiddlers.push(t);
		});
	// Display the listview
	createTiddlyElement(importer,"h2",null,"step3",config.macros.importTiddlers.step3);
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	ListView.create(step,tiddlers,config.macros.importTiddlers.listViewTemplate,config.macros.importTiddlers.onSelectCommand);
	// Save the importer
	importer.store = importStore;
}

config.macros.importTiddlers.onSelectCommand = function(listView,command,rowNames)
{
	var importer = findRelated(listView,"importTiddler","className","parentNode");
	switch(command)
		{
		case "import":
			config.macros.importTiddlers.doImport(importer,rowNames);
			break;
		}
	if(config.options.chkAutoSave)
		saveChanges(true);
}

config.macros.importTiddlers.doImport = function(importer,rowNames)
{
	var theStore = importer.store;
	var overwrite = new Array();
	var t;
	for(t=0; t<rowNames.length; t++)
		{
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0)
		if(!confirm(this.confirmOverwriteText.format([overwrite.join(", ")])))
			return;
	for(t=0; t<rowNames.length; t++)
		{
		var inbound = theStore.fetchTiddler(rowNames[t]);
		store.saveTiddler(inbound.title, inbound.title, inbound.text, inbound.modifier, inbound.modified, inbound.tags);
		store.fetchTiddler(inbound.title).created = inbound.created;
		store.notify(rowNames[t],false);
		}
	store.notifyAll();
	store.setDirty(true);
	createTiddlyElement(importer,"h2",null,"step4",this.step4.format([rowNames.length]));
	var step = createTiddlyElement(importer,"div",null,"wizardStep");
	for(t=0; t<rowNames.length; t++)
		{
		createTiddlyLink(step,rowNames[t],true);
		createTiddlyElement(step,"br");
		}
	createTiddlyElement(importer,"h2",null,"step5",this.step5);
}
// ---------------------------------------------------------------------------------
// Menu and toolbar commands
// ---------------------------------------------------------------------------------

config.commands.closeTiddler.handler = function(event,src,title)
{
	story.closeTiddler(title,true,event.shiftKey || event.altKey);
	return false;
}

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
}

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
	story.focusTiddler(title,"text");
	return false;
}

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
	   story.displayTiddler(null,newTitle);
	return false;
}

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly)
		if(!confirm(this.warning.format([title])))
			return false;
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
}

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if (config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if (deleteIt)
		{
		store.removeTiddler(title);
		story.closeTiddler(title,true,event.shiftKey || event.altKey);
		if(config.options.chkAutoSave)
			saveChanges();
		}
	return false;
}

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
}

config.commands.references.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		var references = store.getReferringTiddlers(title);
		var c = false;
		for(var r=0; r<references.length; r++)
			if(references[r].title != title && !references[r].isTagged("excludeLists"))
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
				c = true;
				}
		if(!c)
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),this.popupNone);
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

config.commands.jump.handler = function(event,src,title)
{
	var popup = Popup.create(src);
	if(popup)
		{
		story.forEachTiddler(function(title,element) {
			createTiddlyLink(createTiddlyElement(popup,"li"),title,true);
			});
		}
	Popup.show(popup,false);
	event.cancelBubble = true;
	if (event.stopPropagation) event.stopPropagation();
	return false;
}

// ---------------------------------------------------------------------------------
// Tiddler() object
// ---------------------------------------------------------------------------------

function Tiddler()
{
	this.title = null;
	this.text = null;
	this.modifier = null;
	this.modified = new Date();
	this.created = new Date();
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
}

// Format the text for storage in an RSS item
Tiddler.prototype.saveToRss = function(url)
{
	var s = [];
	s.push("<item>");
	s.push("<title" + ">" + this.title.htmlEncode() + "</title" + ">");
	s.push("<description>" + wikifyStatic(this.text,null,this).htmlEncode() + "</description>");
	for(var t=0; t<this.tags.length; t++)
		s.push("<category>" + this.tags[t] + "</category>");
	s.push("<link>" + url + "#" + encodeURIComponent(String.encodeTiddlyLink(this.title)) + "</link>");
	s.push("<pubDate>" + this.modified.toGMTString() + "</pubDate>");
	s.push("</item>");
	return(s.join("\n"));
}

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
}

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
}

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
}

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
}

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
}

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
}

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(this.text);
	while(formatMatch)
		{
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) // wikiWordLink
			{
			if(formatMatch.index > 0)
				{
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(this.text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
				}
			else
				this.links.pushUnique(formatMatch[1]);
			}
		else if(formatMatch[2-t] && (store.tiddlerExists(formatMatch[3-t]) || store.isShadowTiddler(formatMatch[3-t]))) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		// Do not add link if match urlPattern (formatMatch[5-t])
		formatMatch = tiddlerLinkRegExp.exec(this.text);
		}
	this.linksUpdated = true;
	return;
}

Tiddler.prototype.getSubtitle = function()
{
	var theModifier = this.modifier;
	if(!theModifier)
		theModifier = config.messages.subtitleUnknown;
	var theModified = this.modified;
	if(theModified)
		theModified = theModified.toLocaleString();
	else
		theModified = config.messages.subtitleUnknown;
	return(config.messages.tiddlerLinkTooltip.format([this.title,theModifier,theModified]));
}

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
}

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
}

Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
}

// ---------------------------------------------------------------------------------
// TiddlyWiki() object contains Tiddler()s
// ---------------------------------------------------------------------------------

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
		};
	this.fetchTiddler = function(title) {
		return tiddlers[title];
		};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
		};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
		};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers)
			{
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
			}
		};
}

// Set the dirty flag
TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
}

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
}

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
}

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
}

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
			}
}

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel)
		for(var t=0; t<this.namedNotifications.length; t++)
			{
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
			}
}

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for (var i=0; i<this.namedNotifications.length; i++)
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	this.namedNotifications.push({name: title, notify: fn});
	return this;
}

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return (t != undefined);
}

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return typeof config.shadowTiddlers[title] == "string";
}

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
}

TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		return tiddler.text;
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1)
		{
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
		}
	if(this.isShadowTiddler(title))
		return config.shadowTiddlers[title];
	if(defaultText != undefined)
		return defaultText;
	return null;
}

TiddlyWiki.prototype.slicesRE = /(?:[\'\/]*~?(\w+)[\'\/]*\:[\'\/]*\s*(.*?)\s*$)|(?:\|[\'\/]*~?(\w+)\:?[\'\/]*\|\s*(.*?)\s*\|)/gm

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title) 
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	do 
		{
			var m = this.slicesRE.exec(text);
			if (m) 
				{
					if (m[1])
						slices[m[1]] = m[2];
					else
						slices[m[3]] = m[4];
				}
		}
	while(m);
	return slices;
}

// Returns the slice of text of the given name
//#
//# A text slice is a substring in the tiddler's text that is defined
//# either like this
//#    aName:  textSlice
//# or
//#    |aName:| textSlice |
//# or
//#    |aName| textSlice |
//#
//# In the text the name (or name:) may be decorated with '' or //. I.e.
//# this would also a possible text slice:
//#
//#    |''aName:''| textSlice |
//#
//# @param name should only contain "word characters" (i.e. "a-ZA-Z_0-9")
//# @return [may be undefined] the (trimmed) text of the specified slice.
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if (!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
}

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++)
		{
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
		}
	return r;
}

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match)
			{
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1])
				{
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
				}
			lastPos = match.index + match[0].length;
			}
		else
			textOut.push(text.substr(lastPos));
	} while(match);
	return(textOut.join(""));
}

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		{
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		this.notify(title,true);
		this.setDirty(true);
		}
}

TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields)
{
	var tiddler = this.fetchTiddler(title);
	var created;
	if(tiddler)
		{
		created = tiddler.created; // Preserve created date
		this.deleteTiddler(title);
		}
	else
		{
		tiddler = new Tiddler();
		created = modified;
		}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
}

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		{
		tiddler = new Tiddler();
		tiddler.title = title;
		this.addTiddler(tiddler);
		this.setDirty(true);
		}
	return tiddler;
}

// Load contents of a tiddlywiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate)
		{
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
		}
}

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
		});
}

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return store.getSaver().externalize(store);
}

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag)
{
	var candidates = this.reverseLookup("tags",excludeTag,false);
	var results = [];
	for(var t=0; t<candidates.length; t++)
		{
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
		}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
}

// Return an array of all the tags in use. Each member of the array is another array where [0] is the name of the tag and [1] is the number of occurances
TiddlyWiki.prototype.getTags = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++)
			{
			var tag = tiddler.tags[g];
			var f = false;
			for(var c=0; c<results.length; c++)
				if(results[c][0] == tag)
					{
					f = true;
					results[c][1]++;
					}
			if(!f)
				results.push([tag,1]);
			}
		});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
}

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
}

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
}

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++)
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		if(f)
			results.push(tiddler);
		});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
}

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
		});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
}

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		for(var n=0; n<tiddler.links.length;n++)
			{
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
			}
		});
	results.sort();
	return results;
}

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
		});
	results.sort();
	return results;
}

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers)
		if(typeof config.shadowTiddlers[t] == "string")
			results.push(t);
	results.sort();
	return results;
}

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler) 
{
	var t = (typeof tiddler == 'string') ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
}

TiddlyWiki.prototype.getLoader = function() 
{
	if (!this.loader) 
		this.loader = new TW21Loader();
	return this.loader;
}
 
TiddlyWiki.prototype.getSaver = function() 
{
	if (!this.saver) 
		this.saver = new TW21Saver();
	return this.saver;
}

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by '.'
TiddlyWiki.isValidFieldName = function (name) {
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
}

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name) {
	if (!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
}

function StringFieldAccess(n, readOnly) {
	this.set = readOnly 
		? function(t,v) {if (v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);}
		: function(t,v) {if (v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n) {
	this.set = function(t,v) {
			var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v); 
			if (d != t[n]) {
				t[n] = d; return true;
			}
		};
	this.get = function(t)   {return t[n].convertToYYYYMMDDHHMM();}
}

function LinksFieldAccess(n) {
	this.set = function(t,v) {
			var s = (typeof v == "string") ? v.readBracketedList() : v; 
			if (s.toString() != t[n].toString()) {
				t[n] = s; return true;
			}
		};
	this.get = function(t)   {return String.encodeTiddlyLinkList(t[n]);}
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	
	"title":    new StringFieldAccess("title", true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title", true),
	
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name) {
	return TiddlyWiki.standardFieldAccess[name] != undefined;
}

// Sets the value of the given field of the tiddler to the value. 
// Setting an ExtendedField's value to null or undefined removes the field. 
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler, fieldName, value) {
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return;
		
	fieldName = fieldName.toLowerCase();

	var isRemove = (value === undefined) || (value === null);

	if (!t.fields) 
		t.fields = {};
		
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if (accessor) {
		if (isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if (!h.set(t, value))
			return;

	} else {
		var oldValue = t.fields[fieldName];
		
		if (isRemove) {
			if (oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				
				// delete all fields in a namespace
				var re = new RegExp('^'+fieldName+'\\.');
				var dirty = false;
				for (var n in t.fields) {
					if (n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if (!dirty)
					return
			}
				
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
 			value = value instanceof Date 
				? value.convertToYYYYMMDDHHMMSSMMM() 
				: String(value);
			if (oldValue == value) 
				return;
			t.fields[fieldName] = value;
		}
	}
	
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if (!fieldName.match(/^temp\./))
		this.setDirty(true);
}

// Returns the value of the given field of the tiddler. 
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler, fieldName) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;

	fieldName = fieldName.toLowerCase();

	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if (accessor) {
		return accessor.get(t);
	}
	
	return t.fields ? t.fields[fieldName] : undefined;
}

// Calls the callback function for every field in the tiddler.
//
// When callback function returns a non-false value the iteration stops 
// and that value is returned. 
//
// The order of the fields is not defined.
// 
// @param callback a function(tiddler, fieldName, value). 
// 
TiddlyWiki.prototype.forEachField = function(tiddler, callback, onlyExtendedFields) {
	var t = this.resolveTiddler(tiddler);
	if (!t)
		return undefined;
	
	if (t.fields) {
		for (var n in t.fields) {
			var result = callback(t, n, t.fields[n]);
			if (result)
				return result;
		}
	}
	
	if (onlyExtendedFields)
		return undefined;

	for (var n in TiddlyWiki.standardFieldAccess) {
		if (n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
			
		var result = callback(t, n, TiddlyWiki.standardFieldAccess[n].get(t));
		if (result)
			return result;
	}

	return undefined;
};
// ---------------------------------------------------------------------------------
// Story functions
// ---------------------------------------------------------------------------------

// A story is a HTML div containing a sequence of tiddlers that can be manipulated
// container - id of containing element
// idPrefix - string prefix prepended to title to make ids for tiddlers in this story
function Story(container,idPrefix)
{
	this.container = container;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
}

// Iterate through all the tiddlers in a story
// fn - callback function to be called for each tiddler. Arguments are:
//		tiddler - reference to Tiddler object
//		element - reference to tiddler display element
Story.prototype.forEachTiddler = function(fn)
{
	var place = document.getElementById(this.container);
	if(!place)
		return;
	var e = place.firstChild;
	while(e)
		{
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
		}
}

// Display several tiddlers given their titles in an array. Parameters same as displayTiddler(), except:
// titles - array of string titles
Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,slowly)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,slowly);
}

// Display a given tiddler with a given template. If the tiddler is already displayed but with a different
// template, it is switched to the specified template
// srcElement - reference to element from which this one is being opened -or-
//              special positions "top", "bottom"
// title - title of tiddler to display
// template - the name of the tiddler containing the template -or-
//			  one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE -or-
//			  null or undefined to indicate the current template if there is one, DEFAULT_VIEW_TEMPLATE if not
// animate - whether to perform animations
// slowly - whether to perform animations in slomo
Story.prototype.displayTiddler = function(srcElement,title,template,animate,slowly)
{
	var place = document.getElementById(this.container);
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem)
		this.refreshTiddler(title,template);
	else
		{
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template);
		}
	if(srcElement && typeof srcElement !== "string")
		{
		if(anim && config.options.chkAnimate && (animate == undefined || animate == true))
			anim.startAnimating(new Cascade(title,srcElement,tiddlerElem,slowly),new Scroller(tiddlerElem,slowly));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
		}
}

// Figure out the appropriate position for a newly opened tiddler
// srcElement - reference to the element containing the link to the tiddler -or-
//              special positions "top", "bottom"
// returns - reference to the tiddler that the new one should appear before (null for the bottom of the story)
Story.prototype.positionTiddler = function(srcElement)
{
	var place = document.getElementById(this.container);
	var before;
	if(typeof srcElement == "string")
		{
		switch(srcElement)
			{
			case "top":
				before = place.firstChild;
				break;
			case "bottom":
				before = null;
				break;
			}
		}
	else
		{
		var after = this.findContainingTiddler(srcElement);
		if(after == null)
			before = place.firstChild;
		else if(after.nextSibling)
			before = after.nextSibling;
		else
			before = null;
		}
	return before;
}

// Create a tiddler frame at the appropriate place in a story column
// place - reference to parent element
// before - null, or reference to element before which to insert new tiddler
// title - title of new tiddler
// template - the name of the tiddler containing the template or one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE
Story.prototype.createTiddler = function(place,before,title,template)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.idPrefix + title,"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	place.insertBefore(tiddlerElem,before);
	this.refreshTiddler(title,template);
	return tiddlerElem;
}

// Overridable for choosing the name of the template to apply for a tiddler
Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
}

// Overridable for extracting the text of a template from a tiddler
Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
}

// Apply a template to an existing tiddler if it is not already displayed using that template
// title - title of tiddler to update
// template - the name of the tiddler containing the template or one of the constants DEFAULT_VIEW_TEMPLATE and DEFAULT_EDIT_TEMPLATE
// force - if true, forces the refresh even if the template hasn't changedd
Story.prototype.refreshTiddler = function(title,template,force)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem)
		{
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force)
			{
			var tiddler = store.getTiddler(title);
			if(!tiddler)
				{
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title))
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,[],version.date);
				else
					{
					var text = template=="EditTemplate"
								? config.views.editor.defaultText.format([title])
								: config.views.wikified.defaultText.format([title]);
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date);
					}
				}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			var me = this;
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			var html = this.getTemplateForTiddler(title,template,tiddler);
			tiddlerElem.innerHTML = html;
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(!store.tiddlerExists(title))
				{
				if(store.isShadowTiddler(title))
					addClass(tiddlerElem,"shadow");
				else
					addClass(tiddlerElem,"missing");
				}
			else
				{
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
				}
			}
		}
	return tiddlerElem;
}

// Refresh all tiddlers in the Story
Story.prototype.refreshAllTiddlers = function() 
{
	var place = document.getElementById(this.container);
	var e = place.firstChild;
	if(!e)
		return;
	this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
	while((e = e.nextSibling) != null) 
		this.refreshTiddler(e.getAttribute("tiddler"),e.getAttribute("template"),true);
}

// Default tiddler onmouseover/out event handlers
Story.prototype.onTiddlerMouseOver = function(e)
{
	if(window.addClass instanceof Function)
		addClass(this,"selected");
}

Story.prototype.onTiddlerMouseOut = function(e)
{
	if(window.removeClass instanceof Function)
		removeClass(this,"selected");
}

// Default tiddler ondblclick event handler
Story.prototype.onTiddlerDblClick = function(e)
{
	if(!e) var e = window.event;
	var theTarget = resolveTarget(e);
	if(theTarget && theTarget.nodeName.toLowerCase() != "input" && theTarget.nodeName.toLowerCase() != "textarea")
		{
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if (e.stopPropagation) e.stopPropagation();
		return true;
		}
	else
		return false;
}

Story.prototype.onTiddlerKeyPress = function(e)
{
	if(!e) var e = window.event;
	clearMessage();
	var consume = false; 
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode)
		{
		case 9: // Tab
			if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea")
				{
				replaceSelection(target,String.fromCharCode(9));
				consume = true; 
				}
			if(config.isOpera)
				{
				target.onblur = function()
					{
					this.focus();
					this.onblur = null;
					}
				}
			break;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
		case 77: // Ctrl-Enter is "M" on some platforms
			if(e.ctrlKey)
				{
				blurElement(this);
				config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
				consume = true;
				}
			break; 
		case 27: // Escape
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
			consume = true;
			break;
		}
	e.cancelBubble = consume;
	if(consume)
		{
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
		}
	return(!consume);
};

// Returns the specified field (input or textarea element) in a tiddler, otherwise the first edit field it finds
// or null if it found no edit field at all
Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	var e = null;
	if(tiddlerElem != null)
		{
		var children = tiddlerElem.getElementsByTagName("*");
		for (var t=0; t<children.length; t++)
			{
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea")
				{
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
				}
			}
		}
	return e;
}

// Focus a specified tiddler. Attempts to focus the specified field, otherwise the first edit field it finds
Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e)
		{
		e.focus();
		e.select();
		}
}

// Ensures that a specified tiddler does not have the focus
Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null && tiddlerElem.focus && tiddlerElem.blur)
		{
		tiddlerElem.focus();
		tiddlerElem.blur();
		}
}

// Adds a specified value to the edit controls (if any) of a particular
// array-formatted field of a particular tiddler (eg "tags")
//  title - name of tiddler
//  tag - value of field, without any [[brackets]]
//  mode - +1 to add the tag, -1 to remove it, 0 to toggle it
//  field - name of field (eg "tags")
Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = story.getTiddlerField(title,field);

	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
}

// The same as setTiddlerField but preset to the "tags" field
Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	Story.prototype.setTiddlerField(title,tag,mode,"tags");
}

// Close a specified tiddler
// title - name of tiddler to close
// animate - whether to perform animations
// slowly - whether to perform animations in slomo
Story.prototype.closeTiddler = function(title,animate,slowly)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		{
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(anim && config.options.chkAnimate && animate)
			anim.startAnimating(new Slider(tiddlerElem,false,slowly,"all"));
		else
			tiddlerElem.parentNode.removeChild(tiddlerElem);
		}
}

// Scrub IDs from a tiddler. This is so that the 'ghost' of a tiddler while it is being closed
// does not interfere with things
// tiddler - reference to the tiddler element
Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
}

// Set the 'dirty' flag of a tiddler
// title - title of tiddler to change
// dirty - new boolean status of flag
Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
}

// Is a particular tiddler dirty (with unsaved changes)?
Story.prototype.isDirty = function(title)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
}

// Determine whether any open tiddler are dirty
Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
		});
	return r;
}

// Close all tiddlers in the story
Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
		});
	window.scrollTo(0,0);
}

// Check if there are any tiddlers in the story
Story.prototype.isEmpty = function()
{
	var place = document.getElementById(this.container);
	return(place && place.firstChild == null);
}

// Perform a search and display the result
// text - text to search for
// useCaseSensitive - true for case sensitive matching
// useRegExp - true to interpret text as a RegExp
Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ?	 text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	var titles = [];
	for(var t=matches.length-1; t>=0; t--)
		titles.push(matches[t].title);
	this.displayTiddlers(null,titles);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([titles.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
}

// Determine if the specified element is within a tiddler in this story
// e - reference to an element
// returns: reference to a tiddler element or null if none
Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return(e);
}

// Gather any saveable fields from a tiddler element
// e - reference to an element to scan recursively
// fields - object to contain gathered field values
Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute)
		{
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");;
		if(e.hasChildNodes())
			{
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields)
			}
		}
}

// Determine whether a tiddler has any edit fields, and if so if their values have been changed
// title - name of tiddler
Story.prototype.hasChanges = function(title)
{
	var e = document.getElementById(this.idPrefix + title);
	if(e != null)
		{
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if (!tiddler)
			return false;
		for(var n in fields)
			if (store.getValue(title,n) != fields[n])
				return true;
		}
	return false;
}

// Save any open edit fields of a tiddler and updates the display as necessary
// title - name of tiddler
// minorUpdate - true if the modified date shouldn't be updated
// returns: title of saved tiddler, or null if not saved
Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = document.getElementById(this.idPrefix + title);
	if(tiddlerElem != null)
		{
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title ? fields.title : title;
		if(store.tiddlerExists(newTitle) && newTitle != title)
			{
			if(confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				this.closeTiddler(newTitle,false,false);
			else
				return null;
			}
		tiddlerElem.id = this.idPrefix + newTitle;
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		var newDate = new Date();
		store.saveTiddler(title,newTitle,fields.text,config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags);
		for (var n in fields) 
			if (!TiddlyWiki.isStandardField(n))
				store.setValue(newTitle,n,fields[n]);
		if(config.options.chkAutoSave)
			saveChanges();
		return newTitle;
		}
	return null;
}

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
		});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
}

// ---------------------------------------------------------------------------------
// Message area
// ---------------------------------------------------------------------------------

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e)
		{
		alert(text);
		return;
		}
	if(linkText)
		{
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
		}
	else
		e.appendChild(document.createTextNode(text));
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea)
		{
		removeChildren(msgArea);
		msgArea.style.display = "none";
		}
	return false;
}

// ---------------------------------------------------------------------------------
// Refresh mechanism
// ---------------------------------------------------------------------------------

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},
	
	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1)
			{
			removeChildren(e);
			wikify(store.getTiddlerText(title,title),e);
			return true;
			}
		else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++)
		{
		var e = nodes[c],type;
		if(e.getAttribute)
			type = e.getAttribute("refresh");
		else
			type = null;
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
		}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e)
		{
		var nextChild = e.nextSibling;
		if(e.getAttribute)
			{
			var macro = e.getAttribute("macro");
			if(macro)
				{
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1)
					{
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
					}
				invokeMacro(e,macro,params,null,tiddler);
				}
			}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
		}
}

function refreshPageTemplate(title)
{
	var stash = createTiddlyElement(document.body,"div");
	stash.style.display = "none";
	var display = document.getElementById("tiddlerDisplay");
	var nodes,t;
	if(display)
		{
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
		}
	var wrapper = document.getElementById("contentWrapper");
	if(!title)
		title = "PageTemplate";
	var html = store.getRecursiveTiddlerText(title,null,10);
	wrapper.innerHTML = html;
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = document.getElementById("tiddlerDisplay");
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div","tiddlerDisplay");
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	stash.parentNode.removeChild(stash);
}

function refreshDisplay(hint)
{
	var e = document.getElementById("contentWrapper");
	if(typeof hint == "string")
		hint = [hint];
	refreshElements(e,hint);
}

function refreshPageTitle()
{
	document.title = wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle");
}

function refreshStyles(title)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles("StyleSheet");
	refreshStyles("StyleSheetPrint");
}

// ---------------------------------------------------------------------------------
// Options cookie stuff
// ---------------------------------------------------------------------------------

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++)
		{
		var p = cookies[c].indexOf("=");
		if(p != -1)
			{
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			switch(name.substr(0,3))
				{
				case "txt":
					config.options[name] = unescape(value);
					break;
				case "chk":
					config.options[name] = value == "true";
					break;
				}
			}
		}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	switch(name.substr(0,3))
		{
		case "txt":
			c += escape(config.options[name].toString());
			break;
		case "chk":
			c += config.options[name] ? "true" : "false";
			break;
		}
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

// ---------------------------------------------------------------------------------
// Saving
// ---------------------------------------------------------------------------------

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false)
		{
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
		}
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + store.getRecursiveTiddlerText(tiddlerName,"") + "\n");
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	// Get the URL of the document
	var originalPath = document.location.toString();
	// Check we were loaded from a file URL
	if(originalPath.substr(0,5) != "file:")
		{
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	var localPath = getLocalPath(originalPath);
	// Load the original file
	var original = loadFile(localPath);
	if(original == null)
		{
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
		}
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	if((posOpeningDiv == -1) || (posClosingDiv == -1))
		{
		alert(config.messages.invalidFileError.format([localPath]));
		return;
		}
	// Save the backup
	if(config.options.chkSaveBackups)
		{
		var backupPath = getBackupPath(localPath);
		var backup = saveFile(backupPath,original);
		if(backup)
			displayMessage(config.messages.backupSaved,"file://" + backupPath);
		else
			alert(config.messages.backupFailed);
		}
	// Save Rss
	if(config.options.chkGenerateAnRssFeed)
		{
		var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
		var rssSave = saveFile(rssPath,convertUnicodeToUTF8(generateRss()));
		if(rssSave)
			displayMessage(config.messages.rssSaved,"file://" + rssPath);
		else
			alert(config.messages.rssFailed);
		}
	// Save empty template
	if(config.options.chkSaveEmptyTemplate)
		{
		var emptyPath,p;
		if((p = localPath.lastIndexOf("/")) != -1)
			emptyPath = localPath.substr(0,p) + "/empty.html";
		else if((p = localPath.lastIndexOf("\\")) != -1)
			emptyPath = localPath.substr(0,p) + "\\empty.html";
		else
			emptyPath = localPath + ".empty.html";
		var empty = original.substr(0,posOpeningDiv + startSaveArea.length) + original.substr(posClosingDiv);
		var emptySave = saveFile(emptyPath,empty);
		if(emptySave)
			displayMessage(config.messages.emptySaved,"file://" + emptyPath);
		else
			alert(config.messages.emptyFailed);
		}
	var save;
	try 
		{
		// Save new file
		var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + "\n" +
					convertUnicodeToUTF8(store.allTiddlersAsHtml()) + "\n" +
					original.substr(posClosingDiv);
		var newSiteTitle = convertUnicodeToUTF8((wikifyPlain("SiteTitle") + " - " + wikifyPlain("SiteSubtitle")).htmlEncode());
		revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
		revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
		revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
		revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
		revised = updateMarkupBlock(revised,"POST-BODY","MarkupPostBody");
		save = saveFile(localPath,revised);
		}
	catch (e) 
		{
		showException(e);
		}
	if(save)
		{
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
		}
	else
		alert(config.messages.mainFailed);
}

function getLocalPath(originalPath)
{
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format assuming
	// "file:///x:/path/path/path..." - pc local file --> "x:\path\path\path..."
	// "file://///server/share/path/path/path..." - FireFox pc network file --> "\\server\share\path\path\path..."
	// "file:///path/path/path..." - mac/unix local file --> "/path/path/path..."
	// "file://server/share/path/path/path..." - pc network file --> "\\server\share\path\path\path..."
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath)
{
	var backSlash = true;
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1)
		{
		dirPathPos = localPath.lastIndexOf("/");
		backSlash = false;
		}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + (backSlash ? "\\" : "/") + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + "." + (new Date()).convertToYYYYMMDDHHMMSSMMM() + ".html";
	return backupPath;
}

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>en-us</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + version.major + "." + version.minor + "." + version.revision + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for (var t=tiddlers.length-1; t>=n; t--)
		s.push(tiddlers[t].saveToRss(u));
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}


// UTF-8 encoding rules:
// 0x0000 - 0x007F:	0xxxxxxx
// 0x0080 - 0x07FF:	110xxxxx 10xxxxxx
// 0x0800 - 0xFFFF:	1110xxxx 10xxxxxx 10xxxxxx

function convertUTF8ToUnicode(u)
{
	if(window.netscape == undefined)
		return manualConvertUTF8ToUnicode(u);
	else
		return mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length)
		{
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80)
			dst++;
		else if(b1 < 0xE0)
			{
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
			}
		else
			{
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
			}
	}
	return(uni);
}

function mozConvertUTF8ToUnicode(u)
{
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
		}
	catch(e)
		{
		return manualConvertUTF8ToUnicode(u);
		} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return (fin.length > 0) ? s+fin : s;
}

function convertUnicodeToUTF8(s)
{
	if(window.netscape == undefined)
		return manualConvertUnicodeToUTF8(s);
	else
		return mozConvertUnicodeToUTF8(s);
}

function manualConvertUnicodeToUTF8(s)
{
	var re = /[^\u0000-\u007F]/g ;
	return s.replace(re, function($0) {return("&#" + $0.charCodeAt(0).toString() + ";");})
}

function mozConvertUnicodeToUTF8(s)
{
	try
		{
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
		}
	catch(e)
		{
		return manualConvertUnicodeToUTF8(s);
		} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	if(fin.length > 0)
		return u + fin;
	else
		return u;
}

function saveFile(fileUrl, content)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = ieSaveFile(fileUrl, content);
	if((r == null) || (r == false))
		r = javaSaveFile(fileUrl, content);
	return(r);
}

function loadFile(fileUrl)
{
	var r = null;
	if((r == null) || (r == false))
		r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return(r);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath, content)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		}
	catch(e)
		{
		//alert("Exception while attempting to save\n\n" + e.toString());
		return(null);
		}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return(true);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try
		{
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
		}
	catch(e)
		{
		//alert("Exception while attempting to load\n\n" + e.toString());
		return(null);
		}
	return(content);
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath, content)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				file.create(0, 0664);
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file, 0x20 | 0x02, 00004,null);
			out.write(content, content.length);
			out.flush();
			out.close();
			return(true);
			}
		catch(e)
			{
			//alert("Exception while attempting to save\n\n" + e);
			return(false);
			}
	return(null);
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components)
		try
			{
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if (!file.exists())
				return(null);
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file, 0x01, 00004, null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			return(sInputStream.read(sInputStream.available()));
			}
		catch(e)
			{
			//alert("Exception while attempting to load\n\n" + e);
			return(false);
			}
	return(null);
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	if(i > 0)
		return url.substring(i-1);
	return url;
}

function javaSaveFile(filePath, content)
{
	try
		{
		if(document.applets["TiddlySaver"])
			return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
		}
	catch(e)
		{
		}
	try
		{
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
		}
	catch(e)
		{
		return null;
		}
	return true;
}

function javaLoadFile(filePath)
{
	try
		{
	if(document.applets["TiddlySaver"])
		return String(document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8"));
		}
	catch(e)
		{
		}
	var content = [];
	try
		{
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while ((line = r.readLine()) != null)
			content.push(new String(line));
		r.close();
		}
	catch(e)
		{
		return null;
		}
	return content.join("\n");
}


// ---------------------------------------------------------------------------------
// Remote HTTP requests
// ---------------------------------------------------------------------------------

// Load a file over http
//   url - the source url
//   callback - function to call when there's a response
//   params - parameter object that gets passed to the callback for storing it's state
// Return value is the underlying XMLHttpRequest object, or 'null' if there was an error
// Callback function is called like this:
//   callback(status,params,responseText,xhr)
//     status - true if OK, false if error
//     params - the parameter object provided to loadRemoteFile()
//     responseText - the text of the file
//     xhr - the underlying XMLHttpRequest object
function loadRemoteFile(url,callback,params)
{
	// Get an xhr object
	var x;
	try
		{
		x = new XMLHttpRequest(); // Modern
		}
	catch(e)
		{
		try
			{
			x = new ActiveXObject("Msxml2.XMLHTTP"); // IE 6
			}
		catch (e)
			{
			return null;
			}
		}
	// Install callback
	x.onreadystatechange = function()
		{
		if (x.readyState == 4)
			{
			if ((x.status == 0 || x.status == 200) && callback)
				{
				callback(true,params,x.responseText,url,x);
			}
			else
				callback(false,params,null,url,x);
			}
		}
	// Send request
	if(window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	try
		{
		url = url + (url.indexOf("?") < 0 ? "?" : "&") + "nocache=" + Math.random();
		x.open("GET",url,true);
		if (x.overrideMimeType)
			x.overrideMimeType("text/html");
		x.send(null);
		}
	catch (e)
		{
		alert("Error in send " + e);
		return null;
		}
	return x;
}
// ---------------------------------------------------------------------------------
// TiddlyWiki-specific utility functions
// ---------------------------------------------------------------------------------

function createTiddlyButton(theParent,theText,theTooltip,theAction,theClass,theId,theAccessKey)
{
	var theButton = document.createElement("a");
	if(theAction)
		{
		theButton.onclick = theAction;
		theButton.setAttribute("href","javascript:;");
		}
	if(theTooltip)
		theButton.setAttribute("title",theTooltip);
	if(theText)
		theButton.appendChild(document.createTextNode(theText));
	if(theClass)
		theButton.className = theClass;
	else
		theButton.className = "button";
	if(theId)
		theButton.id = theId;
	if(theParent)
		theParent.appendChild(theButton);
	if(theAccessKey)
		theButton.setAttribute("accessKey",theAccessKey);
	return(theButton);
}

function createTiddlyLink(place,title,includeText,theClass,isStatic)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,theClass)
	var btn;
	if(isStatic)
		btn = createExternalLink(place,"#" + title);
	else
		btn = createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	return(btn);
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler)
		{
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
		}
	else
		{
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title))
			{
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
			}
		else
			{
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
			}
		}
	return {classes: classes.join(" "), subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var theLink = document.createElement("a");
	theLink.className = "externalLink";
	theLink.href = url;
	theLink.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		theLink.target = "_blank";
	place.appendChild(theLink);
	return(theLink);
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var theLink = theTarget;
	var title = null;
	do {
		title = theLink.getAttribute("tiddlyLink");
		theLink = theLink.parentNode;
	} while(title == null && theLink != null);
	if(title)
		{
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		var opening;
		if(toggling && document.getElementById("tiddler" + title))
			story.closeTiddler(title,true,e.shiftKey || e.altKey);
		else
			story.displayTiddler(theTarget,title,null,true,e.shiftKey || e.altKey);
		}
	clearMessage();
	return(false);
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler)
{
	var theTag = createTiddlyButton(place,tag,config.views.wikified.tag.tooltip.format([tag]),onClickTag);
	theTag.setAttribute("tag",tag);
	if(excludeTiddler)
		theTag.setAttribute("tiddler",excludeTiddler);
	return(theTag);
}

// Event handler for clicking on a tiddler tag
function onClickTag(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag)
		{
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++)
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		var lingo = config.views.wikified.tag;
		if(titles.length > 0)
			{
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++)
				{
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
				}
			}
		else
			createTiddlyText(createTiddlyElement(popup,"li",null,"disabled"),lingo.popupNone.format([tag]));
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(e)
{
	if (!e) var e = window.event;
	var tag = this.getAttribute("tag");
	var tagged = store.getTaggedTiddlers(tag);
	var titles = [];
	for(var t=0; t<tagged.length; t++)
		titles.push(tagged[t].title);
	story.displayTiddlers(this,titles);
	return(false);
}

function onClickError(e)
{
	if (!e) var e = window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++)
		{
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		}
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if (text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for (p in src)
		if (!preserveExisting || dst[p] === undefined)
			dst[p] = src[p];
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e, message)
{
	var s = e.description ? e.description : e.toString();
	return message ? "%0:\n%1".format([message, s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e, message)
{
	alert(exceptionText(e, message));
}

// ---------------------------------------------------------------------------------
// Animation engine
// ---------------------------------------------------------------------------------

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() // Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0)
		{
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},5);
		}
	this.running += arguments.length;
}

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length)
		{
		var animation = me.animations[a];
		if(animation.tick())
			a++;
		else
			{
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
			}
		}
}

// Map a 0..1 value to 0..1, but slow down at the start and end
Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
}

// ---------------------------------------------------------------------------------
// Cascade animation
// ---------------------------------------------------------------------------------

function Cascade(text,startElement,targetElement,slowly)
{
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	this.elements = [];
	this.startElement = startElement;
	this.startLeft = findPosX(this.startElement);
	this.startTop = findPosY(this.startElement);
	this.startWidth = Math.min(this.startElement.offsetWidth,winWidth);
	this.startHeight = Math.min(this.startElement.offsetHeight,winHeight);
	this.targetElement = targetElement;
	targetElement.style.position = "relative";
	targetElement.style.zIndex = 2;
	this.targetLeft = findPosX(this.targetElement);
	this.targetTop = findPosY(this.targetElement);
	this.targetWidth = Math.min(this.targetElement.offsetWidth,winWidth);
	this.targetHeight = Math.min(this.targetElement.offsetHeight,winHeight);
	this.progress = -1;
	this.steps = slowly ? config.cascadeSlow : config.cascadeFast;
	this.text = text;
	this.tick();
	return this;
}

Cascade.prototype.tick = function()
{
	this.progress++;
	if(this.progress >= this.steps)
		{
		while(this.elements.length > 0)
			this.removeTail();
		this.targetElement.style.position = "static";
		this.targetElement.style.zIndex = "";
		return false;
		}
	else
		{
		if(this.elements.length > 0 && this.progress > config.cascadeDepth)
			this.removeTail();
		if(this.progress < (this.steps - config.cascadeDepth))
			{
			var f = Animator.slowInSlowOut(this.progress/(this.steps - config.cascadeDepth - 1));
			var e = createTiddlyElement(document.body,"div",null,"cascade",this.text);
			e.style.zIndex = 1;
			e.style.left = this.startLeft + (this.targetLeft-this.startLeft) * f + "px";
			e.style.top = this.startTop + (this.targetTop-this.startTop) * f + "px";
			e.style.width = this.startWidth + (this.targetWidth-this.startWidth) * f + "px";
			e.style.height = this.startHeight + (this.targetHeight-this.startHeight) * f + "px";
			e.style.display = "block";
			this.elements.push(e);
			}
		return true;
		}
}

Cascade.prototype.removeTail = function()
{
	var e = this.elements[0];
	e.parentNode.removeChild(e);
	this.elements.shift();
}

// ---------------------------------------------------------------------------------
// Scroller animation
// ---------------------------------------------------------------------------------

function Scroller(targetElement,slowly)
{
	this.targetElement = targetElement;
	this.startScroll = findScrollY();
	this.targetScroll = ensureVisible(targetElement);
	this.progress = 0;
	this.step = slowly ? config.animSlow : config.animFast;
	return this;
}

Scroller.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress > 1)
		{
		window.scrollTo(0,this.targetScroll);
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		window.scrollTo(0,this.startScroll + (this.targetScroll-this.startScroll) * f);
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Slider animation
// ---------------------------------------------------------------------------------

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,slowly,deleteMode)
{
	this.element = element;
	element.style.display = "block";
	this.deleteMode = deleteMode;
	this.element.style.height = "auto";
	this.realHeight = element.offsetHeight;
	this.opening = opening;
	this.step = slowly ? config.animSlow : config.animFast;
	if(opening)
		{
		this.progress = 0;
		element.style.height = "0px";
		element.style.display = "block";
		}
	else
		{
		this.progress = 1;
		this.step = -this.step;
		}
	element.style.overflow = "hidden";
	return this;
}

Slider.prototype.stop = function()
{
	if(this.opening)
		{
		this.element.style.height = "auto";
		this.element.style.opacity = 1;
		this.element.style.filter = "alpha(opacity:100)";
		}
	else
		{
		switch(this.deleteMode)
			{
			case "none":
				this.element.style.display = "none";
				break;
			case "all":
				this.element.parentNode.removeChild(this.element);
				break;
			case "children":
				removeChildren(this.element);
				break;
			}
		}
}

Slider.prototype.tick = function()
{
	this.progress += this.step;
	if(this.progress < 0 || this.progress > 1)
		{
		this.stop();
		return false;
		}
	else
		{
		var f = Animator.slowInSlowOut(this.progress);
		var h = this.realHeight * f;
		this.element.style.height = h + "px";
		this.element.style.opacity = f;
		this.element.style.filter = "alpha(opacity:" + f * 100 +")";
		return true;
		}
}

// ---------------------------------------------------------------------------------
// Popup menu
// ---------------------------------------------------------------------------------

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root)
{
	Popup.remove();
	var popup = createTiddlyElement(document.body,"ol","popup","popup");
	Popup.stack.push({root: root, popup: popup});
	return popup;
}

Popup.onDocumentClick = function(e)
{
	if (!e) var e = window.event;
	var target = resolveTarget(e);
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
}

Popup.show = function(unused,slowly)
{
	var curr = Popup.stack[Popup.stack.length-1];
	var rootLeft = findPosX(curr.root);
	var rootTop = findPosY(curr.root);
	var rootHeight = curr.root.offsetHeight;
	var popupLeft = rootLeft;
	var popupTop = rootTop + rootHeight;
	var popupWidth = curr.popup.offsetWidth;
	var winWidth = findWindowWidth();
	if(popupLeft + popupWidth > winWidth)
		popupLeft = winWidth - popupWidth;
	curr.popup.style.left = popupLeft + "px";
	curr.popup.style.top = popupTop + "px";
	curr.popup.style.display = "block";
	addClass(curr.root,"highlight");
	if(anim && config.options.chkAnimate)
		anim.startAnimating(new Scroller(curr.popup,slowly));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
}

Popup.remove = function()
{
	if(Popup.stack.length > 0)
		{
		Popup.removeFrom(0);
		}
}

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--)
		{
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		p.popup.parentNode.removeChild(p.popup);
		}
	Popup.stack = Popup.stack.slice(0,from);
}

// ---------------------------------------------------------------------------------
// ListView gadget
// ---------------------------------------------------------------------------------

var ListView = {};

// Create a listview
//   place - where in the DOM tree to insert the listview
//   listObject - array of objects to be included in the listview
//   listTemplate - template for the listview
//   callback - callback for a command being selected
//   className - optional classname for the <table> element
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className ? className : "listView");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++)
		{
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader)
			colType.createHeader(c,columnTemplate,t);
		}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++)
		{
		rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(var c=0; c<listTemplate.rowClasses.length; c++)
			{
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
			}
		rowObject.rowElement = rowObject;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++)
			{
			var c = createTiddlyElement(r,"td");
			var columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			var colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem)
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
			rowObject.colElements[field] = c;
			}
		}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons)
		{
		for(t=0; t<listTemplate.buttons.length; t++)
			{
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
			}
		}
	return table;
}

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e)
		{
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection)
			alert(config.messages.nothingSelected);
		else
			{
			if(this.nodeName.toLowerCase() == "select")
				{
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
				}
			else
				callback(view,name,tiddlers);
			}
		};
}

// Invoke a callback for each selector checkbox in the listview
//   view - <table> element of listView
//   callback(checkboxElement,rowName)
//     where
//       checkboxElement - DOM element of checkbox
//       rowName - name of this row as assigned by the column template
//   result: true if at least one selector was checked
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++)
		{
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox")
			{
			var rn = cb.getAttribute("rowName");
			if(rn)
				{
				callback(cb,rn);
				hadOne = true;
				}
			}
		}
	return hadOne;
}

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				{
				for(var t=0; t<v.length; t++)
					{
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
					}
				}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				{
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
				}
		}
};
// ---------------------------------------------------------------------------------
// Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
// ---------------------------------------------------------------------------------

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return c;
}

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++)
		if(this[i] === item)
			return i;
	return -1;
}}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++)
		if(this[t][field] == value)
			return t;
	return null;
}

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1)
		{
		if(p == -1)
			this.push(value);
		}
	else if(mode == -1)
		{
		if(p != -1)
			this.splice(p,1);
		}
}

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++)
		if (this.indexOf(items[i]) != -1)
			return true;
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for (var i = 0; i<items.length; i++)
		if (this.indexOf(items[i]) == -1)
			return false;
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique != undefined && unique == false)
		this.push(item);
	else
		{
		if(this.indexOf(item) == -1)
			this.push(item);
		}
}

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	if(n < this.length)
		return this.slice(this.length-n);
	else
		return this;
}

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
}

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1)
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	return s.join("");
}

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1])
			{
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
			}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
}

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
}

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
}

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
}

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return(this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;"));
}

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return(this.replace(/&amp;/mg,"&").replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\""));
}

// Parse a space-separated string of name:value parameters where:
//   - the name or the value can be optional (in which case separate defaults are used instead)
//     - in case of ambiguity, a lone word is taken to be a value
//     - if 'cascadeDefaults' is set to true, then the defaults are modified by updated by each specified name or value
//     - name prefixes are not allowed if the 'noNames' parameter is true
//   - if both the name and value are present they must be separated by a colon
//   - the name and the value may both be quoted with single- or double-quotes, double-square brackets
//   - names or values quoted with {{double-curly braces}} are evaluated as a JavaScript expression
//     - as long as the 'allowEval' parameter is true
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p)
		{
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try
				{
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
				}
			catch(e)
				{
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(e);
				}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
		};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames
		? new RegExp(token,"mg")
		: new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match)
			{
			var n = parseToken(match,1);
			if(noNames)
				r.push({name: "", value: n});
			else
				{
				var v = parseToken(match,8);
				if(v == null && defaultName)
					{
					v = n;
					n = defaultName;
					}
				else if(v == null && defaultValue)
					v = defaultValue;
				r.push({name: n, value: v});
				if(cascadeDefaults)
					{
					defaultName = n;
					defaultValue = v;
					}
				}
			}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++)
		{
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
		}
	return r;
}

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
}

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.pushUnique(p[t].value,unique);
	return n;
}

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end) 
{
	var s = this.indexOf(start);
	if(s != -1)
		{
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s, e];
		}
}

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r 
		? this.substring(0,r[0]) + sub + this.substring(r[1])
		: this;
}

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if (r)
		return this.substring(r[0],r[1]);
}


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	if(title.indexOf(" ") == -1)
		return(title);
	else
		return("[[" + title + "]]");
}

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list)
		{
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
		}
	else
		return "";
}

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return(s);
}

String.prototype.startsWith = function(prefix) 
{
	return !prefix || this.substring(0,prefix.length) == prefix;
}

// Returns the first value of the given named parameter.
//#
//# @param params
//#         as returned by parseParams or null/undefined
//# @return [may be null/undefined]
//#
function getParam(params, name, defaultValue) {
	if (!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
//#
//# @param params
//#         as returned by parseParams or null/undefined
//#
function getFlag(params, name, defaultValue) {
	return !!getParam(params, name, defaultValue);
} 
	
// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	return t;
}

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000); 
	return Math.floor(n/7)+1;
}

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if (d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
}

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
}

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? "pm" : "am";
}

Date.prototype.daySuffix = function()
{
	var num = this.getDate();
	if (num >= 11 && num <= 13) return "th";
	else if (num.toString().substr(-1)=="1") return "st";
	else if (num.toString().substr(-1)=="2") return "nd";
	else if (num.toString().substr(-1)=="3") return "rd";
	return "th";
}

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getFullYear(),4) + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2));
}

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2));
}

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return(String.zeroPad(this.getUTCFullYear(),4) + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4));
}

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var theDate = new Date(Date.UTC(parseInt(d.substr(0,4),10),
							parseInt(d.substr(4,2),10)-1,
							parseInt(d.substr(6,2),10),
							parseInt(d.substr(8,2),10),
							parseInt(d.substr(10,2),10),0,0));
	return(theDate);
}

// ---------------------------------------------------------------------------------
// Crypto functions and associated conversion routines
// ---------------------------------------------------------------------------------

// Crypto "namespace"
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	var be = Array();
	var len = Math.floor(str.length/4);
	var i, j;
	for(i=0, j=0; i<len; i++, j+=4)
		{
		be[i] = ((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
		}
	while (j<str.length)
		{
		be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
		j++;
		}
	return be;
}

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	var str = "";
	for(var i=0;i<be.length*32;i+=8)
		str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
	return str;
}

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	var hex = "0123456789ABCDEF";
	var str = "";
	for(var i=0;i<be.length*4;i++)
		str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
	return str;
}

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return Crypto.be32sToHex(Crypto.sha1Str(str));
}

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return Crypto.sha1(Crypto.strToBe32s(str),str.length);
}

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	// Add 32-bit integers, wrapping at 32 bits
	//# Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
	add32 = function(a,b)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF);
		var msw = (a>>16)+(b>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Add five 32-bit integers, wrapping at 32 bits
	//# Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
	add32x5 = function(a,b,c,d,e)
	{
		var lsw = (a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
		var msw = (a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
		return (msw<<16)|(lsw&0xFFFF);
	};
	// Bitwise rotate left a 32-bit integer by 1 bit
	rol32 = function(n)
	{
		return (n>>>31)|(n<<1);
	};

	var len = blen*8;
	// Append padding so length in bits is 448 mod 512
	x[len>>5] |= 0x80 << (24-len%32);
	// Append length
	x[((len+64>>9)<<4)+15] = len;
	var w = Array(80);

	var k1 = 0x5A827999;
	var k2 = 0x6ED9EBA1;
	var k3 = 0x8F1BBCDC;
	var k4 = 0xCA62C1D6;

	var h0 = 0x67452301;
	var h1 = 0xEFCDAB89;
	var h2 = 0x98BADCFE;
	var h3 = 0x10325476;
	var h4 = 0xC3D2E1F0;

	for(var i=0;i<x.length;i+=16)
		{
		var j,t;
		var a = h0;
		var b = h1;
		var c = h2;
		var d = h3;
		var e = h4;
		for(j = 0;j<16;j++)
			{
			w[j] = x[i+j];
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=16;j<20;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),d^(b&(c^d)),w[j],k1);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=20;j<40;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k2);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=40;j<60;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),(b&c)|(d&(b|c)),w[j],k3);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}
		for(j=60;j<80;j++)
			{
			w[j] = rol32(w[j-3]^w[j-8]^w[j-14]^w[j-16]);
			t = add32x5(e,(a>>>27)|(a<<5),b^c^d,w[j],k4);
			e=d; d=c; c=(b>>>2)|(b<<30); b=a; a = t;
			}

		h0 = add32(h0,a);
		h1 = add32(h1,b);
		h2 = add32(h2,c);
		h3 = add32(h3,d);
		h4 = add32(h4,e);
		}
	return Array(h0,h1,h2,h3,h4);
}

// ---------------------------------------------------------------------------------
// RGB colour object
// ---------------------------------------------------------------------------------

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string")
		{
		if(r.substr(0,1) == "#")
			{
			if(r.length == 7)
				{
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
				}
			else
				{
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
				}
			}
		else
			{
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/ ;
			var c = r.match(rgbPattern);
			if (c)
				{
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
				}
			}
		}
	else
		{
		this.r = r;
		this.g = g;
		this.b = b;
		}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
}

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var r = this.r.clamp(0,1);
	var g = this.g.clamp(0,1);
	var b = this.b.clamp(0,1);
	return("#" + ("0" + Math.floor(r * 255).toString(16)).right(2) +
				 ("0" + Math.floor(g * 255).toString(16)).right(2) +
				 ("0" + Math.floor(b * 255).toString(16)).right(2));
}

// ---------------------------------------------------------------------------------
// DOM utilities - many derived from www.quirksmode.org
// ---------------------------------------------------------------------------------

function drawGradient(place,horiz,colours)
{
	for(var t=0; t<= 100; t+=2)
		{
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var f = t/100;
		var p = f*(colours.length-1);
		bar.style.backgroundColor = colours[Math.floor(p)].mix(colours[Math.ceil(p)],p-Math.floor(p)).toString();
		}
}

function createTiddlyText(theParent,theText)
{
	return theParent.appendChild(document.createTextNode(theText));
}

function createTiddlyCheckbox(theParent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	theParent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,theParent);
	return cb;
}

function createTiddlyElement(theParent,theElement,theID,theClass,theText)
{
	var e = document.createElement(theElement);
	if(theClass != null)
		e.className = theClass;
	if(theID != null)
		e.setAttribute("id",theID);
	if(theText != null)
		e.appendChild(document.createTextNode(theText));
	if(theParent != null)
		theParent.appendChild(e);
	return(e);
}

// Add an event handler
// Thanks to John Resig, via QuirksMode
function addEvent(obj,type,fn)
{
	if(obj.attachEvent)
		{
		obj['e'+type+fn] = fn;
		obj[type+fn] = function(){obj['e'+type+fn](window.event);}
		obj.attachEvent('on'+type,obj[type+fn]);
		}
	else
		obj.addEventListener(type,fn,false);
}

// Remove  an event handler
// Thanks to John Resig, via QuirksMode
function removeEvent(obj,type,fn)
{
	if(obj.detachEvent)
		{
		obj.detachEvent('on'+type,obj[type+fn]);
		obj[type+fn] = null;
		}
	else
		obj.removeEventListener(type,fn,false);
}

function addClass(e,theClass)
{
	var currClass = e.className.split(" ");
	if(currClass.indexOf(theClass) == -1)
		e.className += " " + theClass;
}

function removeClass(e,theClass)
{
	var currClass = e.className.split(" ");
	var i = currClass.indexOf(theClass);
	while(i != -1)
		{
		currClass.splice(i,1);
		i = currClass.indexOf(theClass);
		}
	e.className = currClass.join(" ");
}

function hasClass(e,theClass)
{
	if(e.className)
		{
		if(e.className.split(" ").indexOf(theClass) != -1)
			return true;
		}
	return false;
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name ? name : "tagName";
	relative = relative ? relative : "parentNode";
	if(name == "className")
		{
		while(e && !hasClass(e,value))
			{
			e = e[relative];
			}
		}
	else
		{
		while(e && e[name] != value)
			{
			e = e[relative];
			}
		}
	return e;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if (e.target)
		obj = e.target;
	else if (e.srcElement)
		obj = e.srcElement;
	if (obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return(obj);
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	var text = "";
	if(e.innerText)
		text = e.innerText;
	else if(e.textContent)
		text = e.textContent;
	return text;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop)
		return(posTop);
	else if(posBot > winBot)
		{
		if(e.offsetHeight < winHeight)
			return(posTop - (winHeight - e.offsetHeight));
		else
			return(posTop);
		}
	else
		return(winTop);
}

// Get the current width of the display window
function findWindowWidth()
{
	return(window.innerWidth ? window.innerWidth : document.documentElement.clientWidth);
}

// Get the current height of the display window
function findWindowHeight()
{
	return(window.innerHeight ? window.innerHeight : document.documentElement.clientHeight);
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return(window.scrollX ? window.scrollX : document.documentElement.scrollLeft);
}

// Get the current vertical page scroll position
function findScrollY()
{
	return(window.scrollY ? window.scrollY : document.documentElement.scrollTop);
}

function findPosX(obj)
{
	var curleft = 0;
	while (obj.offsetParent)
		{
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
		}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while (obj.offsetParent)
		{
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
		}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e != null && e.focus && e.blur)
		{
		e.focus();
		e.blur();
		}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Remove all children of a node
function removeChildren(e)
{
	while(e.hasChildNodes())
		e.removeChild(e.firstChild);
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id)
{
	if(!id)
		id = "customStyleSheet";
	var n = document.getElementById(id);
	if(document.createStyleSheet) // Test for IE's non-standard createStyleSheet method
		{
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		document.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
		}
	else
		{
		if(n)
			n.replaceChild(document.createTextNode(s),n.firstChild);
		else
			{
			var n = document.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(document.createTextNode(s));
			document.getElementsByTagName("head")[0].appendChild(n);
			}
		}
}

// Replace the current selection of a textarea or text input and scroll it into view

function replaceSelection(e,text)
{
	if (e.setSelectionRange)
		{
		var oldpos = e.selectionStart + 1;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionStart);
		e.setSelectionRange( oldpos, oldpos);
		var linecount = e.value.split('\n').length;
		var thisline = e.value.substr(0,e.selectionStart).split('\n').length-1;
		e.scrollTop = Math.floor((thisline-e.rows/2)*e.scrollHeight/linecount);
		}
	else if (document.selection)
		{
		var range = document.selection.createRange();
		if (range.parentElement() == e)
			{
			var isCollapsed = range.text == "";
			range.text = text;
			 if (!isCollapsed)
				{
				range.moveStart('character', -text.length);
				range.select();
				}
			}
		}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = ""; 
	while (e && e.nodeName == "#text")
		{
		t += e.nodeValue;
		e = e.nextSibling;
		}
	return t;
}
//# -------------------------
//# LoaderBase: A (abstract) storage loader that loads the tiddlers from a list of HTML elements.
//# The format of the elements is defined by subclasses of this loader through the internalizeTiddler implementation.
//# Subclasses must implement:
//# 			function getTitle(store, e)
//#
//# store must implement:
//# 			function createTiddler(title).
//#

function LoaderBase()
{
}

LoaderBase.prototype.loadTiddler = function(store,e,tiddlers)
{
	var title = this.getTitle(store, e);
	if (title)
		{
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store, tiddler, title, e);
		tiddlers.push(tiddler);
		}
}

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for (var t = 0; t < nodes.length; t++)
		{
		try
			{
			this.loadTiddler(store, nodes[t], tiddlers);
			}
		catch(e)
			{
			showException(e, config.messages.tiddlerLoadError.format([this.getTitle(store, nodes[t])]));
			}
		}
	return tiddlers;
}
	
//# -------------------------
//# SaverBase: a (abstract) storage saver that externalizes all tiddlers into a string, 
//# with every tiddler individually externalized (using this.externalizeTiddler) and joined with newlines 
//# Subclasses must implement:
//# 			function externalizeTiddler(store, tiddler)
//#
//# store must implement:
//# 			function getTiddlers(sortByFieldName)
//#

function SaverBase()
{
}

SaverBase.prototype.externalize = function(store) 
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for (var t = 0; t < tiddlers.length; t++)
		results.push(this.externalizeTiddler(store, tiddlers[t]));
	return results.join("\n");
}
//--------------------------------
// TW21Loader (inherits from LoaderBase)

function TW21Loader() {};

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store, e) {
	var title = null;
	if(e.getAttribute)
		title = e.getAttribute("tiddler");
	if(!title && e.id) {	
		var lenPrefix = store.idPrefix.length;
		if (e.id.substr(0,lenPrefix) == store.idPrefix)
			title = e.id.substr(lenPrefix);
	}
	return title;
}

TW21Loader.prototype.internalizeTiddler = function(store, tiddler, title, data) {
	var text = getNodeText(data.firstChild).unescapeLineBreaks();
	var modifier = data.getAttribute("modifier");
	var modified = Date.convertFromYYYYMMDDHHMM(data.getAttribute("modified"));
	var c = data.getAttribute("created");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : modified;
	var tags = data.getAttribute("tags");
	var fields = {};
	var attrs = data.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if (attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created, fields);
	return tiddler;
};

//--------------------------------
// TW21Saver (inherits from SaverBase)

function TW21Saver() {};

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store, tiddler) 
{
	try {
		var extendedFieldAttributes = "";
		store.forEachField(tiddler, 
			function(tiddler, fieldName, value) {
				// don't store stuff from the temp namespace
				if (!fieldName.match(/^temp\./))
					extendedFieldAttributes += ' %0="%1"'.format([fieldName, value.escapeLineBreaks().htmlEncode()]);
			}, true);
		return '<div tiddler="%0" modifier="%1" modified="%2" created="%3" tags="%4"%6>%5</div>'.format([
				tiddler.title.htmlEncode(),
				tiddler.modifier.htmlEncode(),
				tiddler.modified.convertToYYYYMMDDHHMM(),
				tiddler.created.convertToYYYYMMDDHHMM(),
				tiddler.getTags().htmlEncode(),
				tiddler.escapeLineBreaks().htmlEncode(),
				extendedFieldAttributes
			]);
	} catch (e) {
		throw exceptionText(e, config.messages.tiddlerSaveError.format([tiddler.title]));
	}
}

// ---------------------------------------------------------------------------------
// Deprecated code
// ---------------------------------------------------------------------------------

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
}

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
		{
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
		}
}

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
}

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
}

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
}

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
}

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,slowly)
{
	story.displayTiddlers(srcElement,titles,template,animate,slowly);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,slowly)
{
	story.displayTiddler(srcElement,title,template,animate,slowly);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");
// ---------------------------------------------------------------------------------
// End of scripts
// ---------------------------------------------------------------------------------
//]]>
</script>
<style type="text/css">

#saveTest {
	display: none;
}

.zoomer {
	display: none;
}

#messageArea {
	display: none;
}

#copyright {
	display: none;
}

.popup {
	position: absolute;
}

#storeArea {
	display: none;
	margin: 4em 10em 3em;
}

#storeArea div {
 padding: 0.5em;
 margin: 1em 0em 0em 0em;
 border-color: #f0f0f0 #606060 #404040 #d0d0d0; 
 border-style: solid; 
 border-width: 2px;
 overflow: auto;
}

#javascriptWarning {
	width: 100%;
	text-align: center;
	font-weight: bold;
	background-color: #dd1100;
	color: #fff;
	padding:1em 0em; 
}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.checkUnsavedChanges) checkUnsavedChanges();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
	<script type="text/javascript">
//<![CDATA[
if (useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
	</script>
	<div id="copyright">
	Welcome to TiddlyWiki by Jeremy Ruston, Copyright &copy; 2006 Osmosoft Limited
	</div>
	<noscript>
		<div id="javascriptWarning">This page requires JavaScript to function properly</div>
	</noscript>
	<div id="saveTest"></div>
	<div id="contentWrapper"></div>
	<div id="contentStash"></div>
	<div id="storeArea">
<div tiddler="13 February 2007" modifier="ChrisJobling" modified="200702130116" created="200702130114" tags="">Installed [[DokuWiki|http://wiki.splitbrain.org/wiki:dokuwiki]] wiki as my personal web site. You'll find it at http://eehope.swan.ac.uk/~eechris/dokuwiki/. Now all I need to do is set up suitable redirects for http://eehope.swan.ac.uk/~eechris/index.html.</div>
<div tiddler="13 May 2006" modifier="ChrisJobling" modified="200605131042" created="200605131040" tags="">Found out how to typeset two small figures side by side in ~LaTeX. (Thanks to [[Matt Guthaus|http://homepage.mac.com/mguthaus/tips/2005/tip050915.html]] for this one).\n</div>
<div tiddler="27 January 2007" modifier="ChrisJobling" modified="200701271417" created="200701271417" tags="">Upgraded CrispyNotes to version 2.1.3.</div>
<div tiddler="About this Presentation" modifier="ChrisJobling" modified="200703031143" created="200702211837" tags="help">This presentation is using a new client-side application technology called TiddlyWiki. Each major topic and sub topic is stored in this file as a [[tiddler]] which opens up on demand. Each tiddler is written in a special text-only syntax called TiddlyWikiText (based on the text that is used in WikiWikiWebs such as MediaWiki and [[Wikipedia]]). If you have saved this page to your computer (hard drive or USB flash drive) you will be able to edit this file directly to add your own notes, rearrange mine or whatever you need to do help you to learn the material. All that you need, the JavaScript that makes the application work, the CSS styles that make it look nice and the textual content, is all stored in a single XHTML file which you can use your browser's //view source// feature to see. So, not only is this a novel way of delivering course notes, it's also a case study in web application design. Enjoy!\n\n++++[How to use a local copy of this presentation to take notes]&gt;\n# Download a copy of the course site by right-clicking (or control-clicking) on [[this link|WebContent.html]] and selecting &quot;save link as...&quot; or &quot;save target as...&quot;\n# Open your downloaded &quot;WebContent.html&quot; file (or whatever you called it) in a new window.  \n** If you don't automatically see editing functions, click on this button: &lt;&lt;selectStylesheet [[Student]]&gt;&gt;\n# To add notes to an entry (e.g. a slide), click the &quot;new tiddlers&quot; button in the top toolbar that pops up when you hover your cursor over the entry.  Type whatever you want to type in your note, then click &quot;done&quot;.  Notice that your new note has automatically been tagged with the title of the slide you were annotating.  Your note will now appear in the Notes tab in the right hand column, because it has also been tagged 'Note'.\n** @@''N.B.''@@ Do not //edit// my entries, because then if I go back and change them, and you download the new version, your edits will be overwritten.  Keep your notes separate from my slides.  You can link //to// my slides as you please, by enclosing the title of the slide in double-square brackets, but to link my slides to your notes, use the &quot;addNote&quot; button from the entry you want to annotate.\n===\n\n++++[How to load updated lectures (after you've taken notes)]&gt;\n# After the next lecture, open your downloaded and annotated copy of the presentation, find this entry (LoadNewLectures), and then click on the button below to get the new entries.\n&lt;&lt;loadTiddlers &quot;label:load new entries for WebContent&quot; new http://eehope.swan.ac.uk/~eechris/teaching/modules/EG-146/WebContent.html&gt;&gt;\n\nSometimes I will update old entries.  When I do, I will tag the updated entries as &quot;updated&quot;.  To get these entries, click on this link:\n&lt;&lt;loadTiddlers &quot;label:load updated entries for WebContent&quot; tag:updated http://eehope.swan.ac.uk/~eechris/teaching/modules/EG-146/WebContent.html&gt;&gt;\n===</div>
<div tiddler="AllTagsExceptMacro" modifier="YourName" modified="200611091952" created="200611090517" tags="systemConfig excludeLists">/***\nMacro: allTagsExcept\nAuthor: Clint Checketts\nVersion: 1.0 Sept 8, 2005\n\nusage: {{{&lt;&lt; allTagsExcept systemConfig systemTiddlers &gt;&gt;}}} This will show all tags but those listed (e.g. systemConfig and systemTiddlers\n\n&lt;&lt;allTagsExcept systemConfig systemTiddlers &gt;&gt;\n***/\n//{{{\nversion.extensions.allTagsExcept = {major: 0, minor: 1, revision: 0, date: new Date(2005,8,15)};\nconfig.macros.allTagsExcept = {tooltip: &quot;Show tiddlers tagged with '%0'&quot;,noTags: &quot;There are no tags to display&quot;};\n\nconfig.macros.allTagsExcept.handler = function(place,macroName,params)\n{\n	var tags = store.getTags();\n	var theTagList = createTiddlyElement(place,&quot;ul&quot;,null,null,null);\n	if(tags.length == 0)\n		createTiddlyElement(theTagList,&quot;li&quot;,null,&quot;listTitle&quot;,this.noTags);\n	for (var t=0; t&lt;tags.length; t++) {\n            var includeTag = true;\n            for (var p=0;p&lt;params.length; p++) if (tags[t][0] == params[p]) includeTag = false;\n            if (includeTag){\n		var theListItem =createTiddlyElement(theTagList,&quot;li&quot;,null,null,null);\n		var theTag = createTiddlyButton(theListItem,tags[t][0] + &quot; (&quot; + tags[t][1] + &quot;)&quot;,this.tooltip.format([tags[t][0]]),onClickTag);\n		theTag.setAttribute(&quot;tag&quot;,tags[t][0]);\n           }\n	}\n}\n//}}}</div>
<div tiddler="Author" modifier="YourName" modified="200611091951" created="200608261938" tags="stylesheets excludeLists">&lt;&lt;template Author&gt;&gt;\n[[StyleSheet]]</div>
<div tiddler="AuthorPageTemplate" modifier="YourName" modified="200611091952" created="200611090455" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\n	&lt;div class='headerShadow'&gt;\n		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n	&lt;/div&gt;\n	&lt;div class='headerForeground'&gt;\n		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n	&lt;/div&gt;\n&lt;/div&gt;\n&lt;!-- horizontal MainMenu --&gt;\n&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n&lt;!-- original MainMenu menu --&gt;\n&lt;!-- &lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt; --&gt;\n&lt;div id='sidebar'&gt;\n	&lt;div id='sidebarOptions' refresh='content' tiddler='AuthorSideBarOptions'&gt;&lt;/div&gt;\n	&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='AuthorSideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n	&lt;div id='messageArea'&gt;&lt;/div&gt;\n	&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="AuthorSideBarOptions" modifier="YourName" modified="200611091948" created="200611090615" tags="excludeLists">&lt;&lt;search&gt;&gt;&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler&gt;&gt;&lt;&lt;newJournal 'DD MMM YYYY'&gt;&gt;&lt;&lt;saveChanges&gt;&gt;&lt;&lt;selectStylesheet&gt;&gt;&lt;&lt;upload&gt;&gt;&lt;&lt;slider chkSliderOptionsPanel OptionsPanel 'options Â»' 'Change TiddlyWiki advanced options'&gt;&gt;</div>
<div tiddler="AuthorSideBarTabs" modifier="YourName" modified="200611092008" created="200608262000" tags="excludeLists">&lt;&lt;tabs txtMainTab Timeline 'ordinary tiddlers by mod.date' TabTimeline Alpha 'ordinary tiddlers alpha' AuthorTabAll Tags 'All tags' AuthorTabTags Sys 'system tiddlers' TabSys More 'More lists' TabMore&gt;&gt;</div>
<div tiddler="AuthorTabAll" modifier="YourName" modified="200611092004" created="200608270417" tags="systemTiddlers excludeLists">&lt;&lt;tiddler TabAll&gt;&gt;</div>
<div tiddler="AuthorTabTags" modifier="YourName" modified="200611091959" created="200608262011" tags="excludeLists">&lt;&lt;allTags&gt;&gt;</div>
<div tiddler="AuthorViewTemplate" modifier="YourName" modified="200611091945" created="200611090503" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class='toolbar'&gt; &lt;span style=&quot;padding-right:2.15em;&quot; macro='monkeyTagger systemTag'&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class='toolbar'&gt;&lt;/div&gt;\n&lt;span style=&quot;padding-right:2.15em;&quot;&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='toolbar' macro='toolbar collapseTiddler collapseOthers -closeTiddler closeOthers +editTiddler deleteTiddler permalink references jump'&gt;&lt;/div&gt;\n&lt;div class=&quot;tagglyTagged&quot; macro=&quot;tags&quot;&gt;&lt;/div&gt;\n&lt;div class='titleContainer'&gt;\n	&lt;span class='title' macro='view title'&gt;&lt;/span&gt;\n	&lt;span macro=&quot;miniTag&quot;&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date [[DD MMM YYYY]]'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date [[DD MMM YYYY]]'&gt;&lt;/span&gt;)&lt;/div&gt;\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;div class=&quot;tagglyTagging&quot; macro=&quot;tagglyTagging&quot;&gt;&lt;/div&gt;\n&lt;div class='tagClear'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="BetterTimelineMacro" modifier="YourName" modified="200611100419" created="200607280926" tags="lewcidExtension systemConfig excludeLists">/***\n|Name|BetterTimelineMacro|\n|Created by|SaqImtiaz|\n|Location|http://lewcid.googlepages.com/lewcid.html#BetterTimelineMacro|\n|Version|0.5 beta|\n|Requires|~TW2.x|\n!!!Description:\nA replacement for the core timeline macro that offers more features:\n*list tiddlers with only specfic tag\n*exclude tiddlers with a particular tag\n*limit entries to any number of days, for example one week\n*specify a start date for the timeline, only tiddlers after that date will be listed.\n\n!!!Installation:\nCopy the contents of this tiddler to your TW, tag with systemConfig, save and reload your TW.\nEdit the ViewTemplate to add the fullscreen command to the toolbar.\n\n!!!Syntax:\n{{{&lt;&lt;timeline better:true&gt;&gt;}}}\n''the param better:true enables the advanced features, without it you will get the old timeline behaviour.''\n\nadditonal params:\n(use only the ones you want)\n{{{&lt;&lt;timeline better:true  onlyTag:Tag1 excludeTag:Tag2 sortBy:modified/created firstDay:YYYYMMDD maxDays:7 maxEntries:30&gt;&gt;}}}\n\n''explanation of syntax:''\nonlyTag: only tiddlers with this tag will be listed. Default is to list all tiddlers.\nexcludeTag: tiddlers with this tag will not be listed.\nsortBy: sort tiddlers by date modified or date created. Possible values are modified or created.\nfirstDay: useful for starting timeline from a specific date. Example: 20060701 for 1st of July, 2006\nmaxDays: limits timeline to include only tiddlers from the specified number of days. If you use a value of 7 for example, only tiddlers from the last 7 days will be listed.\nmaxEntries: limit the total number of entries in the timeline.\n\n\n!!!History:\n*28-07-06: ver 0.5 beta, first release\n\n!!!Code\n***/\n//{{{\n// Return the tiddlers as a sorted array\nTiddlyWiki.prototype.getTiddlers = function(field,excludeTag,excludeTag2,includeTag)\n{\n          var results = [];\n          this.forEachTiddler(function(title,tiddler)\n          {\n          if(excludeTag == undefined || tiddler.tags.find(excludeTag) == null)\n                 if(excludeTag2 == undefined || tiddler.tags.find(excludeTag2) == null)\n                        if(includeTag == undefined || tiddler.tags.find(includeTag)!=null)\n                                      results.push(tiddler);\n          });\n          if(field)\n                   results.sort(function (a,b) {if(a[field] == b[field]) return(0); else return (a[field] &lt; b[field]) ? -1 : +1; });\n          return results;\n}\n\n\n\n//this function by Udo\nfunction getParam(params, name, defaultValue)\n{\n          if (!params)\n          return defaultValue;\n          var p = params[0][name];\n          return p ? p[0] : defaultValue;\n}\n\nwindow.old_timeline_handler= config.macros.timeline.handler;\nconfig.macros.timeline.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n{\n          var args = paramString.parseParams(&quot;list&quot;,null,true);\n          var betterMode = getParam(args, &quot;better&quot;, &quot;false&quot;);\n          if (betterMode == 'true')\n          {\n          var sortBy = getParam(args,&quot;sortBy&quot;,&quot;modified&quot;);\n          var excludeTag = getParam(args,&quot;excludeTag&quot;,undefined);\n          var excludeTag2 = getParam(args,&quot;excludeTag2&quot;,undefined);\n          var includeTag = getParam(args,&quot;onlyTag&quot;,undefined);\n          var tiddlers = store.getTiddlers(sortBy,excludeTag,excludeTag2,includeTag);\n          var firstDayParam = getParam(args,&quot;firstDay&quot;,undefined);\n          var firstDay = (firstDayParam!=undefined)? firstDayParam: &quot;00010101&quot;;\n          var lastDay = &quot;&quot;;\n          var field= sortBy;\n          var maxDaysParam = getParam(args,&quot;maxDays&quot;,undefined);\n          var maxDays = (maxDaysParam!=undefined)? maxDaysParam*24*60*60*1000: (new Date()).getTime() ;\n          var maxEntries = getParam(args,&quot;maxEntries&quot;,undefined);\n          var last = (maxEntries!=undefined) ? tiddlers.length-Math.min(tiddlers.length,parseInt(maxEntries)) : 0;\n          for(var t=tiddlers.length-1; t&gt;=last; t--)\n                  {\n                  var tiddler = tiddlers[t];\n                  var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);\n                  if ((theDay&gt;=firstDay)&amp;&amp; (tiddler[field].getTime()&gt; (new Date()).getTime() - maxDays))\n                     {\n                     if(theDay != lastDay)\n                               {\n                               var theDateList = document.createElement(&quot;ul&quot;);\n                               place.appendChild(theDateList);\n                               createTiddlyElement(theDateList,&quot;li&quot;,null,&quot;listTitle&quot;,tiddler[field].formatString(this.dateFormat));\n                               lastDay = theDay;\n                               }\n                  var theDateListItem = createTiddlyElement(theDateList,&quot;li&quot;,null,&quot;listLink&quot;,null);\n                  theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));\n                  }\n                  }\n          }\n\n          else\n              {\n              window.old_timeline_handler.apply(this,arguments);\n              }\n}\n//}}}</div>
<div tiddler="CollapseTiddlersPlugin" modifier="YourName" modified="200611092001" created="200601231504" tags="systemConfig addon includeNew excludeLists">/***\n|''Name:''|CollapseTiddlersPlugin|\n|''Source:''|http://gensoft.revhost.net/Collapse.html|\n|''Author:''|Bradley Meck|\n|''License:''|unknown|\n|''~CoreVersion:''|2.0.10|\n\n|ELS 2/24/2006: added fallback to &quot;CollapsedTemplate if &quot;WebCollapsedTemplate&quot; is not found |\n|ELS 2/6/2006: added check for 'readOnly' flag to use alternative &quot;WebCollapsedTemplate&quot; |\n\n***/\n\nconfig.commands.collapseTiddler = {\ntext: &quot;fold&quot;,\ntooltip: &quot;Collapse this tiddler&quot;,\nhandler: function(event,src,title)\n{\nvar e = story.findContainingTiddler(src);\nif(e.getAttribute(&quot;template&quot;) != config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE]){\nvar t = (readOnly&amp;&amp;store.tiddlerExists(&quot;WebCollapsedTemplate&quot;))?&quot;WebCollapsedTemplate&quot;:&quot;CollapsedTemplate&quot;;\nif (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }\nif(e.getAttribute(&quot;template&quot;) != t ){\ne.setAttribute(&quot;oldTemplate&quot;,e.getAttribute(&quot;template&quot;));\nstory.displayTiddler(null,title,t);\n}\n}\n}\n}\n\nconfig.commands.expandTiddler = {\ntext: &quot;unfold&quot;,\ntooltip: &quot;Expand this tiddler&quot;,\nhandler: function(event,src,title)\n{\nvar e = story.findContainingTiddler(src);\nstory.displayTiddler(null,title,e.getAttribute(&quot;oldTemplate&quot;));\n}\n}\n\nconfig.macros.collapseAll = {\nhandler: function(place,macroName,params,wikifier,paramString,tiddler){\ncreateTiddlyButton(place,&quot;Collapse All&quot;,&quot;&quot;,function(){\nstory.forEachTiddler(function(title,tiddler){\nif(tiddler.getAttribute(&quot;template&quot;) != config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE])\nvar t = (readOnly&amp;&amp;store.tiddlerExists(&quot;WebCollapsedTemplate&quot;))?&quot;WebCollapsedTemplate&quot;:&quot;CollapsedTemplate&quot;;\nif (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }\nstory.displayTiddler(null,title,t);\n})})\n}\n}\n\nconfig.macros.expandAll = {\nhandler: function(place,macroName,params,wikifier,paramString,tiddler){\ncreateTiddlyButton(place,&quot;Expand All&quot;,&quot;&quot;,function(){\nstory.forEachTiddler(function(title,tiddler){\nvar t = (readOnly&amp;&amp;store.tiddlerExists(&quot;WebCollapsedTemplate&quot;))?&quot;WebCollapsedTemplate&quot;:&quot;CollapsedTemplate&quot;;\nif (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }\nif(tiddler.getAttribute(&quot;template&quot;) == t) story.displayTiddler(null,title,tiddler.getAttribute(&quot;oldTemplate&quot;));\n})})\n}\n}\n\nconfig.commands.collapseOthers = {\ntext: &quot;focus&quot;,\ntooltip: &quot;Expand this tiddler and collapse all others&quot;,\nhandler: function(event,src,title)\n{\nvar e = story.findContainingTiddler(src);\nstory.forEachTiddler(function(title,tiddler){\nif(tiddler.getAttribute(&quot;template&quot;) != config.tiddlerTemplates[DEFAULT_EDIT_TEMPLATE]){\nvar t = (readOnly&amp;&amp;store.tiddlerExists(&quot;WebCollapsedTemplate&quot;))?&quot;WebCollapsedTemplate&quot;:&quot;CollapsedTemplate&quot;;\nif (!store.tiddlerExists(t)) { alert(&quot;Can't find 'CollapsedTemplate'&quot;); return; }\nif (e==tiddler) t=e.getAttribute(&quot;oldTemplate&quot;);\n//////////\n// ELS 2006.02.22 - removed this line.  if t==null, then the *current* view template, not the default &quot;ViewTemplate&quot;, will be used.\n// if (!t||!t.length) t=!readOnly?&quot;ViewTemplate&quot;:&quot;WebViewTemplate&quot;;\n//////////\nstory.displayTiddler(null,title,t);\n}\n})\n}\n} </div>
<div tiddler="CollapsedTemplate" modifier="YourName" modified="200611091959" created="200601231511" tags="template includeNew excludeLists">&lt;!--{{{--&gt;\n&lt;div class='toolbar' macro='toolbar expandTiddler +collapseOthers -closeTiddler closeOthers editTiddler sendTiddler permalink references jump'&gt;&lt;/div&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="ColorPalette" modifier="YourName" modified="200611091952" created="200611090523" tags="excludeLists">Background: #fff\nForeground: #000\nPrimaryPale: #69c\nPrimaryLight: #36a\nPrimaryMid: #025\nPrimaryDark: #012\nSecondaryPale: #ffc\nSecondaryLight: #fe8\nSecondaryMid: #db4\nSecondaryDark: #520\nTertiaryPale: #eee\nTertiaryLight: #ccc\nTertiaryMid: #999\nTertiaryDark: #666\nError: #f88</div>
<div tiddler="ConfigTweaks" modifier="YourName" modified="200611091951" created="200610180258" tags="systemConfig excludeSearch excludeLists">//{{{\nconfig.options.chkHttpReadOnly = false; // means web visitors can experiment with your site by clicking edit\nconfig.options.chkInsertTabs = true;    // tab inserts a tab when editing a tiddler\nconfig.views.wikified.defaultText = &quot;&quot;; // don't need message when a tiddler doesn't exist\nconfig.views.editor.defaultText = &quot;&quot;;   // don't need message when creating a new tiddler \nconfig.options.chkSinglePageMode=false;\n//}}}\n</div>
<div tiddler="Crispy Notes" modifier="ChrisJobling" modified="200604281439" created="200604281439" tags="">My TiddlyWiki</div>
<div tiddler="DefaultTiddlers" modifier="ChrisJobling" modified="200604281516" created="200604281514" tags="">WhatsNew\nGettingStarted\nToDo</div>
<div tiddler="Drupal tips" modifier="ChrisJobling" modified="200705240853" created="200705240853" tags="">![[How to change Drupal &quot;admin&quot; password. UID1|http://occy.net/node/122]]\nSubmitted by occy on April 12, 2005 - 4:35am.geek\n\nIf you've ever lost your admin( UID 1 ) password to your drupal website, then you'll know how frustrating it is to try and recover it. Well, here is all you have to do to reset it.\n\nLog in to mysql and do the following:\n\n{{{\nupdate users set pass=md5('NEWPASS') where uid = 1;\n}}}\n</div>
<div tiddler="EG-259: Web Applications Technology" modifier="ChrisJobling" modified="200705291101" created="200705291046" tags="">* [[Ideas]]\n* [[Lesson Plans]]\n* [[Tools]]\n* [[New Topics]]</div>
<div tiddler="EditTemplate" modifier="YourName" modified="200611091952" created="200611090504" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class=&quot;toolbar&quot; macro=&quot;toolbar +saveTiddler closeOthers -cancelTiddler deleteTiddler&quot;&gt;&lt;/div&gt;\n&lt;div class=&quot;title&quot; macro=&quot;view title&quot;&gt;&lt;/div&gt;\n&lt;div class=&quot;editLabel&quot;&gt;Title&lt;/div&gt;&lt;div class=&quot;editor&quot; macro=&quot;edit title&quot;&gt;&lt;/div&gt;\n&lt;div class=&quot;editLabel&quot;&gt;Tags&lt;/div&gt;&lt;div class=&quot;editor&quot; macro=&quot;edit tags&quot;&gt;&lt;/div&gt;\n&lt;div class=&quot;editorFooter&quot;&gt;&lt;span macro=&quot;message views.editor.tagPrompt&quot;&gt;&lt;/span&gt;&lt;span macro=&quot;tagChooser&quot;&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class=&quot;editor&quot; macro=&quot;edit text&quot;&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="Example Slider" modifier="ChrisJobling" modified="200703031154" created="200611161805" tags="examples">&lt;&lt;slideShow&gt;&gt;\n-s-\n+++[Q. Causes of Civil War in Yugoslavia?]\n* A1.  Culture and Character\n** Ancient hatreds, âBalkan Ghostsâ\n* A2.  Institutions, Strategy, and Context\n** Scarcity\n** Uncertainty\n** Group ID \n** plus a few fanatics \n** and a few ambitious, unscrupulous ex-Communist rulers in control of the media\n===</div>
<div tiddler="ForEachTiddlerPlugin" modifier="YourName" modified="200611160419" created="200512281150" tags="ForEachTiddlerProject Plugin UdoBorkowski systemConfig ForEachTiddlerMacro excludeLists">/***\n|''Name:''|ForEachTiddlerPlugin|\n|''Version:''|1.0.6 (2006-09-16)|\n|''Source:''|http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]|\n|''Copyright:''|&amp;copy; 2005-2006 [[abego Software|http://www.abego-software.de]]|\n|''TiddlyWiki:''|1.2.38+, 2.0|\n|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|\n!Description\n\nCreate customizable lists, tables etc. for your selections of tiddlers. Specify the tiddlers to include and their order through a powerful language.\n\n''Syntax:'' \n|&gt;|{{{&lt;&lt;}}}''forEachTiddler'' [''in'' //tiddlyWikiPath//] [''where'' //whereCondition//] [''sortBy'' //sortExpression// [''ascending'' //or// ''descending'']] [''script'' //scriptText//] [//action// [//actionParameters//]]{{{&gt;&gt;}}}|\n|//tiddlyWikiPath//|The filepath to the TiddlyWiki the macro should work on. When missing the current TiddlyWiki is used.|\n|//whereCondition//|(quoted) JavaScript boolean expression. May refer to the build-in variables {{{tiddler}}} and  {{{context}}}.|\n|//sortExpression//|(quoted) JavaScript expression returning &quot;comparable&quot; objects (using '{{{&lt;}}}','{{{&gt;}}}','{{{==}}}'. May refer to the build-in variables {{{tiddler}}} and  {{{context}}}.|\n|//scriptText//|(quoted) JavaScript text. Typically defines JavaScript functions that are called by the various JavaScript expressions (whereClause, sortClause, action arguments,...)|\n|//action//|The action that should be performed on every selected tiddler, in the given order. By default the actions [[addToList|AddToListAction]] and [[write|WriteAction]] are supported. When no action is specified [[addToList|AddToListAction]]  is used.|\n|//actionParameters//|(action specific) parameters the action may refer while processing the tiddlers (see action descriptions for details). &lt;&lt;tiddler [[JavaScript in actionParameters]]&gt;&gt;|\n|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. 'or' means that exactly one of the two alternatives must exist.~~|\n\nSee details see [[ForEachTiddlerMacro]] and [[ForEachTiddlerExamples]].\n\n!Revision history\n* v1.0.6 (2006-09-16)\n** Context provides &quot;viewerTiddler&quot;, i.e. the tiddler used to view the macro. Most times this is equal to the &quot;inTiddler&quot;, but when using the &quot;tiddler&quot; macro both may be different.\n** Support &quot;begin&quot;, &quot;end&quot; and &quot;none&quot; expressions in &quot;write&quot; action\n* v1.0.5 (2006-02-05)\n** Pass tiddler containing the macro with wikify, context object also holds reference to tiddler containing the macro (&quot;inTiddler&quot;). Thanks to SimonBaird.\n** Support Firefox 1.5.0.1\n** Internal\n*** Make &quot;JSLint&quot; conform\n*** &quot;Only install once&quot;\n* v1.0.4 (2006-01-06)\n** Support TiddlyWiki 2.0\n* v1.0.3 (2005-12-22)\n** Features: \n*** Write output to a file supports multi-byte environments (Thanks to Bram Chen) \n*** Provide API to access the forEachTiddler functionality directly through JavaScript (see getTiddlers and performMacro)\n** Enhancements:\n*** Improved error messages on InternetExplorer.\n* v1.0.2 (2005-12-10)\n** Features: \n*** context object also holds reference to store (TiddlyWiki)\n** Fixed Bugs: \n*** ForEachTiddler 1.0.1 has broken support on win32 Opera 8.51 (Thanks to BrunoSabin for reporting)\n* v1.0.1 (2005-12-08)\n** Features: \n*** Access tiddlers stored in separated TiddlyWikis through the &quot;in&quot; option. I.e. you are no longer limited to only work on the &quot;current TiddlyWiki&quot;.\n*** Write output to an external file using the &quot;toFile&quot; option of the &quot;write&quot; action. With this option you may write your customized tiddler exports.\n*** Use the &quot;script&quot; section to define &quot;helper&quot; JavaScript functions etc. to be used in the various JavaScript expressions (whereClause, sortClause, action arguments,...).\n*** Access and store context information for the current forEachTiddler invocation (through the build-in &quot;context&quot; object) .\n*** Improved script evaluation (for where/sort clause and write scripts).\n* v1.0.0 (2005-11-20)\n** initial version\n\n!Code\n***/\n//{{{\n\n	\n//============================================================================\n//============================================================================\n//		   ForEachTiddlerPlugin\n//============================================================================\n//============================================================================\n\n// Only install once\nif (!version.extensions.ForEachTiddlerPlugin) {\n\nif (!window.abego) window.abego = {};\n\nversion.extensions.ForEachTiddlerPlugin = {\n	major: 1, minor: 0, revision: 6, \n	date: new Date(2006,8,16), \n	source: &quot;http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin&quot;,\n	licence: &quot;[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]&quot;,\n	copyright: &quot;Copyright (c) abego Software GmbH, 2005-2006 (www.abego-software.de)&quot;\n};\n\n// For backward compatibility with TW 1.2.x\n//\nif (!TiddlyWiki.prototype.forEachTiddler) {\n	TiddlyWiki.prototype.forEachTiddler = function(callback) {\n		for(var t in this.tiddlers) {\n			callback.call(this,t,this.tiddlers[t]);\n		}\n	};\n}\n\n//============================================================================\n// forEachTiddler Macro\n//============================================================================\n\nversion.extensions.forEachTiddler = {\n	major: 1, minor: 0, revision: 5, date: new Date(2006,2,5), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n\n// ---------------------------------------------------------------------------\n// Configurations and constants \n// ---------------------------------------------------------------------------\n\nconfig.macros.forEachTiddler = {\n	 // Standard Properties\n	 label: &quot;forEachTiddler&quot;,\n	 prompt: &quot;Perform actions on a (sorted) selection of tiddlers&quot;,\n\n	 // actions\n	 actions: {\n		 addToList: {},\n		 write: {}\n	 }\n};\n\n// ---------------------------------------------------------------------------\n//  The forEachTiddler Macro Handler \n// ---------------------------------------------------------------------------\n\nconfig.macros.forEachTiddler.getContainingTiddler = function(e) {\n	while(e &amp;&amp; !hasClass(e,&quot;tiddler&quot;))\n		e = e.parentNode;\n	var title = e ? e.getAttribute(&quot;tiddler&quot;) : null; \n	return title ? store.getTiddler(title) : null;\n};\n\nconfig.macros.forEachTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler) {\n	// config.macros.forEachTiddler.traceMacroCall(place,macroName,params,wikifier,paramString,tiddler);\n\n	if (!tiddler) tiddler = config.macros.forEachTiddler.getContainingTiddler(place);\n	// --- Parsing ------------------------------------------\n\n	var i = 0; // index running over the params\n	// Parse the &quot;in&quot; clause\n	var tiddlyWikiPath = undefined;\n	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;in&quot;) {\n		i++;\n		if (i &gt;= params.length) {\n			this.handleError(place, &quot;TiddlyWiki path expected behind 'in'.&quot;);\n			return;\n		}\n		tiddlyWikiPath = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);\n		i++;\n	}\n\n	// Parse the where clause\n	var whereClause =&quot;true&quot;;\n	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;where&quot;) {\n		i++;\n		whereClause = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);\n		i++;\n	}\n\n	// Parse the sort stuff\n	var sortClause = null;\n	var sortAscending = true; \n	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;sortBy&quot;) {\n		i++;\n		if (i &gt;= params.length) {\n			this.handleError(place, &quot;sortClause missing behind 'sortBy'.&quot;);\n			return;\n		}\n		sortClause = this.paramEncode(params[i]);\n		i++;\n\n		if ((i &lt; params.length) &amp;&amp; (params[i] == &quot;ascending&quot; || params[i] == &quot;descending&quot;)) {\n			 sortAscending = params[i] == &quot;ascending&quot;;\n			 i++;\n		}\n	}\n\n	// Parse the script\n	var scriptText = null;\n	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;script&quot;) {\n		i++;\n		scriptText = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);\n		i++;\n	}\n\n	// Parse the action. \n	// When we are already at the end use the default action\n	var actionName = &quot;addToList&quot;;\n	if (i &lt; params.length) {\n	   if (!config.macros.forEachTiddler.actions[params[i]]) {\n			this.handleError(place, &quot;Unknown action '&quot;+params[i]+&quot;'.&quot;);\n			return;\n		} else {\n			actionName = params[i]; \n			i++;\n		}\n	} \n	\n	// Get the action parameter\n	// (the parsing is done inside the individual action implementation.)\n	var actionParameter = params.slice(i);\n\n\n	// --- Processing ------------------------------------------\n	try {\n		this.performMacro({\n				place: place, \n				inTiddler: tiddler,\n				whereClause: whereClause, \n				sortClause: sortClause, \n				sortAscending: sortAscending, \n				actionName: actionName, \n				actionParameter: actionParameter, \n				scriptText: scriptText, \n				tiddlyWikiPath: tiddlyWikiPath});\n\n	} catch (e) {\n		this.handleError(place, e);\n	}\n};\n\n// Returns an object with properties &quot;tiddlers&quot; and &quot;context&quot;.\n// tiddlers holds the (sorted) tiddlers selected by the parameter,\n// context the context of the execution of the macro.\n//\n// The action is not yet performed.\n//\n// @parameter see performMacro\n//\nconfig.macros.forEachTiddler.getTiddlersAndContext = function(parameter) {\n\n	var context = config.macros.forEachTiddler.createContext(parameter.place, parameter.whereClause, parameter.sortClause, parameter.sortAscending, parameter.actionName, parameter.actionParameter, parameter.scriptText, parameter.tiddlyWikiPath, parameter.inTiddler);\n\n	var tiddlyWiki = parameter.tiddlyWikiPath ? this.loadTiddlyWiki(parameter.tiddlyWikiPath) : store;\n	context[&quot;tiddlyWiki&quot;] = tiddlyWiki;\n	\n	// Get the tiddlers, as defined by the whereClause\n	var tiddlers = this.findTiddlers(parameter.whereClause, context, tiddlyWiki);\n	context[&quot;tiddlers&quot;] = tiddlers;\n\n	// Sort the tiddlers, when sorting is required.\n	if (parameter.sortClause) {\n		this.sortTiddlers(tiddlers, parameter.sortClause, parameter.sortAscending, context);\n	}\n\n	return {tiddlers: tiddlers, context: context};\n};\n\n// Returns the (sorted) tiddlers selected by the parameter.\n//\n// The action is not yet performed.\n//\n// @parameter see performMacro\n//\nconfig.macros.forEachTiddler.getTiddlers = function(parameter) {\n	return this.getTiddlersAndContext(parameter).tiddlers;\n};\n\n// Performs the macros with the given parameter.\n//\n// @param parameter holds the parameter of the macro as separate properties.\n//				  The following properties are supported:\n//\n//						place\n//						whereClause\n//						sortClause\n//						sortAscending\n//						actionName\n//						actionParameter\n//						scriptText\n//						tiddlyWikiPath\n//\n//					All properties are optional. \n//					For most actions the place property must be defined.\n//\nconfig.macros.forEachTiddler.performMacro = function(parameter) {\n	var tiddlersAndContext = this.getTiddlersAndContext(parameter);\n\n	// Perform the action\n	var actionName = parameter.actionName ? parameter.actionName : &quot;addToList&quot;;\n	var action = config.macros.forEachTiddler.actions[actionName];\n	if (!action) {\n		this.handleError(parameter.place, &quot;Unknown action '&quot;+actionName+&quot;'.&quot;);\n		return;\n	}\n\n	var actionHandler = action.handler;\n	actionHandler(parameter.place, tiddlersAndContext.tiddlers, parameter.actionParameter, tiddlersAndContext.context);\n};\n\n// ---------------------------------------------------------------------------\n//  The actions \n// ---------------------------------------------------------------------------\n\n// Internal.\n//\n// --- The addToList Action -----------------------------------------------\n//\nconfig.macros.forEachTiddler.actions.addToList.handler = function(place, tiddlers, parameter, context) {\n	// Parse the parameter\n	var p = 0;\n\n	// Check for extra parameters\n	if (parameter.length &gt; p) {\n		config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;addToList&quot;, parameter, p);\n		return;\n	}\n\n	// Perform the action.\n	var list = document.createElement(&quot;ul&quot;);\n	place.appendChild(list);\n	for (var i = 0; i &lt; tiddlers.length; i++) {\n		var tiddler = tiddlers[i];\n		var listItem = document.createElement(&quot;li&quot;);\n		list.appendChild(listItem);\n		createTiddlyLink(listItem, tiddler.title, true);\n	}\n};\n\nabego.parseNamedParameter = function(name, parameter, i) {\n	var beginExpression = null;\n	if ((i &lt; parameter.length) &amp;&amp; parameter[i] == name) {\n		i++;\n		if (i &gt;= parameter.length) {\n			throw &quot;Missing text behind '%0'&quot;.format([name]);\n		}\n		\n		return config.macros.forEachTiddler.paramEncode(parameter[i]);\n	}\n	return null;\n}\n\n// Internal.\n//\n// --- The write Action ---------------------------------------------------\n//\nconfig.macros.forEachTiddler.actions.write.handler = function(place, tiddlers, parameter, context) {\n	// Parse the parameter\n	var p = 0;\n	if (p &gt;= parameter.length) {\n		this.handleError(place, &quot;Missing expression behind 'write'.&quot;);\n		return;\n	}\n\n	var textExpression = config.macros.forEachTiddler.paramEncode(parameter[p]);\n	p++;\n\n	// Parse the &quot;begin&quot; option\n	var beginExpression = abego.parseNamedParameter(&quot;begin&quot;, parameter, p);\n	if (beginExpression !== null) \n		p += 2;\n	var endExpression = abego.parseNamedParameter(&quot;end&quot;, parameter, p);\n	if (endExpression !== null) \n		p += 2;\n	var noneExpression = abego.parseNamedParameter(&quot;none&quot;, parameter, p);\n	if (noneExpression !== null) \n		p += 2;\n\n	// Parse the &quot;toFile&quot; option\n	var filename = null;\n	var lineSeparator = undefined;\n	if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;toFile&quot;) {\n		p++;\n		if (p &gt;= parameter.length) {\n			this.handleError(place, &quot;Filename expected behind 'toFile' of 'write' action.&quot;);\n			return;\n		}\n		\n		filename = config.macros.forEachTiddler.getLocalPath(config.macros.forEachTiddler.paramEncode(parameter[p]));\n		p++;\n		if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;withLineSeparator&quot;) {\n			p++;\n			if (p &gt;= parameter.length) {\n				this.handleError(place, &quot;Line separator text expected behind 'withLineSeparator' of 'write' action.&quot;);\n				return;\n			}\n			lineSeparator = config.macros.forEachTiddler.paramEncode(parameter[p]);\n			p++;\n		}\n	}\n	\n	// Check for extra parameters\n	if (parameter.length &gt; p) {\n		config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;write&quot;, parameter, p);\n		return;\n	}\n\n	// Perform the action.\n	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(textExpression, context);\n	var count = tiddlers.length;\n	var text = &quot;&quot;;\n	if (count &gt; 0 &amp;&amp; beginExpression)\n		text += config.macros.forEachTiddler.getEvalTiddlerFunction(beginExpression, context)(undefined, context, count, undefined);\n	\n	for (var i = 0; i &lt; count; i++) {\n		var tiddler = tiddlers[i];\n		text += func(tiddler, context, count, i);\n	}\n	\n	if (count &gt; 0 &amp;&amp; endExpression)\n		text += config.macros.forEachTiddler.getEvalTiddlerFunction(endExpression, context)(undefined, context, count, undefined);\n\n	if (count == 0 &amp;&amp; noneExpression) \n		text += config.macros.forEachTiddler.getEvalTiddlerFunction(noneExpression, context)(undefined, context, count, undefined);\n		\n\n	if (filename) {\n		if (lineSeparator !== undefined) {\n			lineSeparator = lineSeparator.replace(/\s\sn/mg, &quot;\sn&quot;).replace(/\s\sr/mg, &quot;\sr&quot;);\n			text = text.replace(/\sn/mg,lineSeparator);\n		}\n		saveFile(filename, convertUnicodeToUTF8(text));\n	} else {\n		var wrapper = place;\n		wikify(text, wrapper, null/* highlightRegExp */, context.inTiddler);\n	}\n};\n\n\n// ---------------------------------------------------------------------------\n//  Helpers\n// ---------------------------------------------------------------------------\n\n// Internal.\n//\nconfig.macros.forEachTiddler.createContext = function(placeParam, whereClauseParam, sortClauseParam, sortAscendingParam, actionNameParam, actionParameterParam, scriptText, tiddlyWikiPathParam, inTiddlerParam) {\n	return {\n		place : placeParam, \n		whereClause : whereClauseParam, \n		sortClause : sortClauseParam, \n		sortAscending : sortAscendingParam, \n		script : scriptText,\n		actionName : actionNameParam, \n		actionParameter : actionParameterParam,\n		tiddlyWikiPath : tiddlyWikiPathParam,\n		inTiddler : inTiddlerParam, // the tiddler containing the &lt;&lt;forEachTiddler ...&gt;&gt; macro call.\n		viewerTiddler : config.macros.forEachTiddler.getContainingTiddler(placeParam) // the tiddler showing the forEachTiddler result\n	};\n};\n\n// Internal.\n//\n// Returns a TiddlyWiki with the tiddlers loaded from the TiddlyWiki of \n// the given path.\n//\nconfig.macros.forEachTiddler.loadTiddlyWiki = function(path, idPrefix) {\n	if (!idPrefix) {\n		idPrefix = &quot;store&quot;;\n	}\n	var lenPrefix = idPrefix.length;\n	\n	// Read the content of the given file\n	var content = loadFile(this.getLocalPath(path));\n	if(content === null) {\n		throw &quot;TiddlyWiki '&quot;+path+&quot;' not found.&quot;;\n	}\n	\n	// Locate the storeArea div's\n	var posOpeningDiv = content.indexOf(startSaveArea);\n	var posClosingDiv = content.lastIndexOf(endSaveArea);\n	if((posOpeningDiv == -1) || (posClosingDiv == -1)) {\n		throw &quot;File '&quot;+path+&quot;' is not a TiddlyWiki.&quot;;\n	}\n	var storageText = content.substr(posOpeningDiv + startSaveArea.length, posClosingDiv);\n	\n	// Create a &quot;div&quot; element that contains the storage text\n	var myStorageDiv = document.createElement(&quot;div&quot;);\n	myStorageDiv.innerHTML = storageText;\n	myStorageDiv.normalize();\n	\n	// Create all tiddlers in a new TiddlyWiki\n	// (following code is modified copy of TiddlyWiki.prototype.loadFromDiv)\n	var tiddlyWiki = new TiddlyWiki();\n	var store = myStorageDiv.childNodes;\n	for(var t = 0; t &lt; store.length; t++) {\n		var e = store[t];\n		var title = null;\n		if(e.getAttribute)\n			title = e.getAttribute(&quot;tiddler&quot;);\n		if(!title &amp;&amp; e.id &amp;&amp; e.id.substr(0,lenPrefix) == idPrefix)\n			title = e.id.substr(lenPrefix);\n		if(title &amp;&amp; title !== &quot;&quot;) {\n			var tiddler = tiddlyWiki.createTiddler(title);\n			tiddler.loadFromDiv(e,title);\n		}\n	}\n	tiddlyWiki.dirty = false;\n\n	return tiddlyWiki;\n};\n\n\n	\n// Internal.\n//\n// Returns a function that has a function body returning the given javaScriptExpression.\n// The function has the parameters:\n// \n//	 (tiddler, context, count, index)\n//\nconfig.macros.forEachTiddler.getEvalTiddlerFunction = function (javaScriptExpression, context) {\n	var script = context[&quot;script&quot;];\n	var functionText = &quot;var theFunction = function(tiddler, context, count, index) { return &quot;+javaScriptExpression+&quot;}&quot;;\n	var fullText = (script ? script+&quot;;&quot; : &quot;&quot;)+functionText+&quot;;theFunction;&quot;;\n	return eval(fullText);\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.findTiddlers = function(whereClause, context, tiddlyWiki) {\n	var result = [];\n	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(whereClause, context);\n	tiddlyWiki.forEachTiddler(function(title,tiddler) {\n		if (func(tiddler, context, undefined, undefined)) {\n			result.push(tiddler);\n		}\n	});\n	return result;\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.createExtraParameterErrorElement = function(place, actionName, parameter, firstUnusedIndex) {\n	var message = &quot;Extra parameter behind '&quot;+actionName+&quot;':&quot;;\n	for (var i = firstUnusedIndex; i &lt; parameter.length; i++) {\n		message += &quot; &quot;+parameter[i];\n	}\n	this.handleError(place, message);\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.sortAscending = function(tiddlerA, tiddlerB) {\n	var result = \n		(tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) \n			? 0\n			: (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)\n			   ? -1 \n			   : +1; \n	return result;\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.sortDescending = function(tiddlerA, tiddlerB) {\n	var result = \n		(tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) \n			? 0\n			: (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)\n			   ? +1 \n			   : -1; \n	return result;\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.sortTiddlers = function(tiddlers, sortClause, ascending, context) {\n	// To avoid evaluating the sortClause whenever two items are compared \n	// we pre-calculate the sortValue for every item in the array and store it in a \n	// temporary property (&quot;forEachTiddlerSortValue&quot;) of the tiddlers.\n	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(sortClause, context);\n	var count = tiddlers.length;\n	var i;\n	for (i = 0; i &lt; count; i++) {\n		var tiddler = tiddlers[i];\n		tiddler.forEachTiddlerSortValue = func(tiddler,context, undefined, undefined);\n	}\n\n	// Do the sorting\n	tiddlers.sort(ascending ? this.sortAscending : this.sortDescending);\n\n	// Delete the temporary property that holds the sortValue.	\n	for (i = 0; i &lt; tiddlers.length; i++) {\n		delete tiddlers[i].forEachTiddlerSortValue;\n	}\n};\n\n\n// Internal.\n//\nconfig.macros.forEachTiddler.trace = function(message) {\n	displayMessage(message);\n};\n\n// Internal.\n//\nconfig.macros.forEachTiddler.traceMacroCall = function(place,macroName,params) {\n	var message =&quot;&lt;&lt;&quot;+macroName;\n	for (var i = 0; i &lt; params.length; i++) {\n		message += &quot; &quot;+params[i];\n	}\n	message += &quot;&gt;&gt;&quot;;\n	displayMessage(message);\n};\n\n\n// Internal.\n//\n// Creates an element that holds an error message\n// \nconfig.macros.forEachTiddler.createErrorElement = function(place, exception) {\n	var message = (exception.description) ? exception.description : exception.toString();\n	return createTiddlyElement(place,&quot;span&quot;,null,&quot;forEachTiddlerError&quot;,&quot;&lt;&lt;forEachTiddler ...&gt;&gt;: &quot;+message);\n};\n\n// Internal.\n//\n// @param place [may be null]\n//\nconfig.macros.forEachTiddler.handleError = function(place, exception) {\n	if (place) {\n		this.createErrorElement(place, exception);\n	} else {\n		throw exception;\n	}\n};\n\n// Internal.\n//\n// Encodes the given string.\n//\n// Replaces \n//	 &quot;$))&quot; to &quot;&gt;&gt;&quot;\n//	 &quot;$)&quot; to &quot;&gt;&quot;\n//\nconfig.macros.forEachTiddler.paramEncode = function(s) {\n	var reGTGT = new RegExp(&quot;\s\s$\s\s)\s\s)&quot;,&quot;mg&quot;);\n	var reGT = new RegExp(&quot;\s\s$\s\s)&quot;,&quot;mg&quot;);\n	return s.replace(reGTGT, &quot;&gt;&gt;&quot;).replace(reGT, &quot;&gt;&quot;);\n};\n\n// Internal.\n//\n// Returns the given original path (that is a file path, starting with &quot;file:&quot;)\n// as a path to a local file, in the systems native file format.\n//\n// Location information in the originalPath (i.e. the &quot;#&quot; and stuff following)\n// is stripped.\n// \nconfig.macros.forEachTiddler.getLocalPath = function(originalPath) {\n	// Remove any location part of the URL\n	var hashPos = originalPath.indexOf(&quot;#&quot;);\n	if(hashPos != -1)\n		originalPath = originalPath.substr(0,hashPos);\n	// Convert to a native file format assuming\n	// &quot;file:///x:/path/path/path...&quot; - pc local file --&gt; &quot;x:\spath\spath\spath...&quot;\n	// &quot;file://///server/share/path/path/path...&quot; - FireFox pc network file --&gt; &quot;\s\sserver\sshare\spath\spath\spath...&quot;\n	// &quot;file:///path/path/path...&quot; - mac/unix local file --&gt; &quot;/path/path/path...&quot;\n	// &quot;file://server/share/path/path/path...&quot; - pc network file --&gt; &quot;\s\sserver\sshare\spath\spath\spath...&quot;\n	var localPath;\n	if(originalPath.charAt(9) == &quot;:&quot;) // pc local file\n		localPath = unescape(originalPath.substr(8)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\s\s&quot;);\n	else if(originalPath.indexOf(&quot;file://///&quot;) === 0) // FireFox pc network file\n		localPath = &quot;\s\s\s\s&quot; + unescape(originalPath.substr(10)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\s\s&quot;);\n	else if(originalPath.indexOf(&quot;file:///&quot;) === 0) // mac/unix local file\n		localPath = unescape(originalPath.substr(7));\n	else if(originalPath.indexOf(&quot;file:/&quot;) === 0) // mac/unix local file\n		localPath = unescape(originalPath.substr(5));\n	else // pc network file\n		localPath = &quot;\s\s\s\s&quot; + unescape(originalPath.substr(7)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\s\s&quot;);	\n	return localPath;\n};\n\n// ---------------------------------------------------------------------------\n// Stylesheet Extensions (may be overridden by local StyleSheet)\n// ---------------------------------------------------------------------------\n//\nsetStylesheet(\n	&quot;.forEachTiddlerError{color: #ffffff;background-color: #880000;}&quot;,\n	&quot;forEachTiddler&quot;);\n\n//============================================================================\n// End of forEachTiddler Macro\n//============================================================================\n\n\n//============================================================================\n// String.startsWith Function\n//============================================================================\n//\n// Returns true if the string starts with the given prefix, false otherwise.\n//\nversion.extensions[&quot;String.startsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nString.prototype.startsWith = function(prefix) {\n	var n =  prefix.length;\n	return (this.length &gt;= n) &amp;&amp; (this.slice(0, n) == prefix);\n};\n\n\n\n//============================================================================\n// String.endsWith Function\n//============================================================================\n//\n// Returns true if the string ends with the given suffix, false otherwise.\n//\nversion.extensions[&quot;String.endsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nString.prototype.endsWith = function(suffix) {\n	var n = suffix.length;\n	return (this.length &gt;= n) &amp;&amp; (this.right(n) == suffix);\n};\n\n\n//============================================================================\n// String.contains Function\n//============================================================================\n//\n// Returns true when the string contains the given substring, false otherwise.\n//\nversion.extensions[&quot;String.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nString.prototype.contains = function(substring) {\n	return this.indexOf(substring) &gt;= 0;\n};\n\n//============================================================================\n// Array.indexOf Function\n//============================================================================\n//\n// Returns the index of the first occurance of the given item in the array or \n// -1 when no such item exists.\n//\n// @param item [may be null]\n//\nversion.extensions[&quot;Array.indexOf&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.indexOf = function(item) {\n	for (var i = 0; i &lt; this.length; i++) {\n		if (this[i] == item) {\n			return i;\n		}\n	}\n	return -1;\n};\n\n//============================================================================\n// Array.contains Function\n//============================================================================\n//\n// Returns true when the array contains the given item, otherwise false. \n//\n// @param item [may be null]\n//\nversion.extensions[&quot;Array.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.contains = function(item) {\n	return (this.indexOf(item) &gt;= 0);\n};\n\n//============================================================================\n// Array.containsAny Function\n//============================================================================\n//\n// Returns true when the array contains at least one of the elements \n// of the item. Otherwise (or when items contains no elements) false is returned.\n//\nversion.extensions[&quot;Array.containsAny&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.containsAny = function(items) {\n	for(var i = 0; i &lt; items.length; i++) {\n		if (this.contains(items[i])) {\n			return true;\n		}\n	}\n	return false;\n};\n\n\n//============================================================================\n// Array.containsAll Function\n//============================================================================\n//\n// Returns true when the array contains all the items, otherwise false.\n// \n// When items is null false is returned (even if the array contains a null).\n//\n// @param items [may be null] \n//\nversion.extensions[&quot;Array.containsAll&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};\n//\nArray.prototype.containsAll = function(items) {\n	for(var i = 0; i &lt; items.length; i++) {\n		if (!this.contains(items[i])) {\n			return false;\n		}\n	}\n	return true;\n};\n\n\n} // of &quot;install only once&quot;\n\n// Used Globals (for JSLint) ==============\n// ... DOM\n/*global 	document */\n// ... TiddlyWiki Core\n/*global 	convertUnicodeToUTF8, createTiddlyElement, createTiddlyLink, \n			displayMessage, endSaveArea, hasClass, loadFile, saveFile, \n			startSaveArea, store, wikify */\n//}}}\n\n\n/***\n!Licence and Copyright\nCopyright (c) abego Software ~GmbH, 2005 ([[www.abego-software.de|http://www.abego-software.de]])\n\nRedistribution and use in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this\nlist of conditions and the following disclaimer.\n\nRedistributions in binary form must reproduce the above copyright notice, this\nlist of conditions and the following disclaimer in the documentation and/or other\nmaterials provided with the distribution.\n\nNeither the name of abego Software nor the names of its contributors may be\nused to endorse or promote products derived from this software without specific\nprior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\nDAMAGE.\n***/\n\n</div>
<div tiddler="GettingStarted" modifier="ChrisJobling" modified="200703031922" created="200702211636" tags="">To get started with this blank TiddlyWiki, you'll need to modify the following tiddlers:\n* SiteTitle &amp; SiteSubtitle: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n* MainMenu: The menu (usually on the left)\n* DefaultTiddlers: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\nYou'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</div>
<div tiddler="Goundhog day again" modifier="ChrisJobling" modified="200706060924" created="200706060920" tags="[[institutional transformation]] abstract keynote">! by Terry Mayes\nTwelve years ago [1] [Terry Mayes] suggested that, despite the regular predictions of transformational change brought about by technology, only when we finally acknowledged the true nature of learning would we escape from the cycle of raised expectation followed by disappointment.  Since then we have seen several waves of renewed optimism, and we do seem much closer to the goal of understanding learning. The social, vicarious and identity-based nature of learning has been properly acknowledged, and e-pedagogy is driving much of the development. Yet, while it is possible to talk now about the real enhancements to our learning environments brought by a proper emphasis on dialogue and feedback it is still hard to describe our mainstream use of these tools as genuinely transformational. Yet perhaps this is how the revolution comes: creeping up without you noticing when things really changed -- incremental, bottom-up, evolutionary.  Groundhog Day may be a metaphor that encourages the wrong view of transformation.\n\nNevertheless, today, as the recent DEMOS report â~TheirSpaceâ [2] makes clear, the way that many young learners are communicating and creating their own media digitally, does feel transformational. Perhaps we have simply been looking in the wrong place. In this presentation I will invite consideration of whether social software-led participatory, mobile, peer-negotiated learning offers the first truly transformational paradigm. In doing this I will point to the current context of support and encouragement for e-pedagogy to spearhead institutional change. There has never been a more fertile ground for development, at least in UK post-compulsory education. I will point to the Higher Education Academy/JISC Benchmarking and Pathfinder Programmes, the JISC emphasis on pedagogy-led design and the learner experience, the Scottish e-learning Transformation Programme, and the Scottish QAA enhancement themes. In each of these a common thread can be discerned, of empowering and engaging learners to become digitally literate, to create their own learning materials and personal environments, and to use technology to more deeply understand, and better to negotiate, their own learning. In Wengerâs evocative phrase [3] , learning is taking on the quality of âhorizontalityâ. The technology is encouraging transformation through the power of pooling lots of individual learning experiences. The presentation will ask: is this finally transformational?\n\n[1] MAYES, J.T. Learning Technology and Groundhog Day, In W. Strang, V.B. Simpson &amp; D. Slater (Eds.) Hypermedia at Work: Practice and Theory in Higher Education. University of Kent Press : Canterbury (ISBN 0904938 57 3) 1995\n\n[2] H. Green and C. Hannon, Their Space: Education for a digital generation downloadable from [[www.demos.co.uk/publications/theirspace|http://www.demos.co.uk/publications/theirspace]]\n\n[3] WENGER, E. (2005) Learning for a small planet: a research agenda, available at [[www.ewenger.com/research|http://www.ewenger.com/research]]\n\n</div>
<div tiddler="ICCT Program" modifier="ChrisJobling" modified="200705010907" created="200704271603" tags="">[[Review 2007|ICCT Review 2007]]\n</div>
<div tiddler="ICCT Review 2007" modifier="ChrisJobling" modified="200705010939" created="200704271609" tags="ammp engineering icct 2007">For presentation at School of Engineering Annual Review, May 1^^st^^ 2007.\n[[Notes from meeting|School Review 2007]]\n&lt;&lt;slideShow&gt;&gt;\n-s-\n! Information, Communication and Computing Technology (ICCT) Discipline\n!! Programmes:\n* ~BSc Internet Technology (IT)\n* ~BSc Mobile Communications and Internet Technology (MCIT)\n* ~BSc ~E-Commerce Technology (ECT)\n* ~BSc Multimedia Technology (MT)\n!! Review Meeting held 27^^th^^ April. \nPresent: C.P. Jobling, J.T.Proudfoot, A.~McCowen, J.W.Jones and for part of the meeting S.P.Wilks, V.Teng, T.Davies, P.Igic, G.Burney(?), T.Maffeis, M.S.Towers. //Apologies//: J.S.D.Mason.\n-s-\n! Review of previous years outstanding issues\n* Inability to resource //Virtual Reality Systems// and //Emerging Multimedia Technology// meant that MT cannot be justified as a separate programme. \n* Remaining students (4) offered more options in level 3.\n-s-\n! Comment on Admissions, Progression, Outcomes/Qualifications Statistics\n|! Programme |! Admissions^^*^^ |! Level 1 |! Level 2 |! Level 3 |! Graduated 2006 |! Exit Qualifications |\n| IT (XEEIS) | 6 | 2 (1) | 2 (1) | 7 (1) | 5 | 3-2(i); 1-2(ii) |\n| MCIT (XEEBS) | 4 | 2 | 3 (1) | 5 | 4 | 1-2(i); 2-2(ii); 1-3; 1-F |\n| ECT (XEETS) | | 2 | | 1 | 3 | 1-2(i); 2-3 |\n| MT (XEEUS) |  | 1 | 1 | 2 | | |\n| ''Totals'' | 10 |  7 (1) | 6 (2) | 15 (1) | 11 | |\n^^*^^ based on 20% of current applications\n-s-\n! Issues arisen from student feedback, staff/student committee, ILC,\n* Relevance of ~EG-169 //Environmental Awareness for Engineers//\n* Relevance of MATLAB in ~EG-187/~EG-188 questioned.\n* General dissatisfaction with network teaching in EG-351 (module feedback).\n-s-\n! Proposed Changes to Structure Programmes of Study\n* ECT and MT to be withdrawn from 2006/2007\n* ~EBC315 ~E-Commerce now has a pre-requisite TB1 module ~EBC110 which will have to be added to level 2 ECT programme for existing students. Replaces ~EG-245.\n* Proposal to replace ~EG-169 Environmental Awareness for Engineers with new ~EGA106 Engineering Science for all programmes.\n* We propose that timetabling should allow ~EG-187/~EG-188, ~EG-189/~EG-190 to be streamed.\n* We understand that ICCT is to be effectively merged with EEE and directed by ~AMcC from September 2007.\n-s-\n! Proposed Changes to Admissions, Marketing or Selection Policy. (if Any)\n* Standard offer remains at 260 UCAS points. \n* MT and ECT to be removed from Admissions Lists, admissions promotion, UCAS, prospectus and Web.\n-s-\n! Modules to be allocated for next Session\n|! Code |! Title |! Credits |! TB |! Lecturer(s) |\n| ~EG-146 |Communications for the Internet | 10 | 1 | CPJ |\n| ~EG-153 |Practical Internet Technology I | 10 | 1 | CPJ |\n| ~EG-259 |Web Applications Technology	| 10 | 1 | CPJ |\n| ~EG-253 |Practical Internet Technology II | 10 | 1+2 | CPJ |\n| ~EG-371 |Multimedia Communications | 5 |  1 | JSDM |\n| ~EG-351 |Communication Systems and Networks | 10 | 1 | TD/CPJ |\n| ~EG-368 |Mobile IP | 10 | 2 | CPJ/TD |\n-s-\n! Modules to be externally taught\n|! Code |! Title |! Credits |! TB |! Lecturer(s) (proposed) |\n| ~EG-244|Software Engineering | 5 | 1 |Dr J. D. Holt |\n| ~EG-371 |Multimedia Technology | 5 | 1 |Dr M. Roach |\n-s-\n! Funded student initiatives\n* None\n-s-\n! Noteworthy Practice\n* Use of pod-casting in lectures ~EG-146, ~EG-259, ~EG-351, ~EG-368.\n-s-\n! Outstanding issues for discussion or resolution next session\n* Long-term viability of ICCT.\n* Review of Software Teaching within EEE/ICCT and Engineering.\n\n\n\n</div>
<div tiddler="Ideas" modifier="ChrisJobling" modified="200705291051" created="200705291051" tags="">* Base the module on practical examples: e.g. use a platform based on XAMPP-Lite (as suggested [[http://http://en.wikiversity.org/wiki/Web_Design/Dynamic_Websites|here]]) with Wordpress, MediaWiki, Drupal installed.\n\n* Put notes onto School's MediaWiki or DokuWiki (need to make a choice)\n\n</div>
<div tiddler="ImportTiddlersPlugin" modifier="YourName" modified="200611150541" created="200512271920" tags="systemConfig excludeLists">/***\n|''Name:''|ImportTiddlersPlugin|\n|''Source:''|http://www.TiddlyTools.com/#ImportTiddlersPlugin|\n|''Author:''|Eric Shulman - ELS Design Studios|\n|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|\n|''~CoreVersion:''|2.0.10|\n\nWhen many people share and edit copies of the same TiddlyWiki document, the ability to quickly collect all these changes back into a single, updated document that can then be redistributed to the entire group is very important.  It can also be very extremely helpful when moving your own tiddlers from document to document (e.g., when upgrading to the latest version of TiddlyWiki, or 'pre-loading' your favorite stylesheets into a new 'empty' TiddlyWiki document.)\n\nThis plugin lets you selectively combine tiddlers from any two TiddlyWiki documents.  An interactive control panel lets you pick a document to import from, and then select which tiddlers to import, with prompting for skip, rename, merge or replace actions when importing tiddlers that match existing titles.  Automatically add tags to imported tiddlers so they are easy to find later on.  Generates a detailed report of import 'history' in ImportedTiddlers.\n!!!!!Interactive interface\n&lt;&lt;&lt;\n{{{&lt;&lt;importTiddlers&gt;&gt;}}} or {{{&lt;&lt;importTiddlers core&gt;&gt;}}}\ninvokes the built-in importTiddlers macro (TW2.1.x+).  If installed in documents using TW2.0.x or earlier, fallback is to use 'link' display (see below)\n\n{{{&lt;&lt;importTiddlers link&gt;&gt;}}}\ncreates &quot;import tiddlers&quot; link that when clicked to show/hide import control panel\n\n{{{&lt;&lt;importTiddlers inline&gt;&gt;}}}\ncreates import control panel directly in tiddler content\n\n&lt;&lt;importTiddlers inline&gt;&gt;\n\nPress ''[browse]'' to select a TiddlyWiki document file to import.  You can also type in the path/filename or a remote document URL (starting with http://)and press ''[open]''.  //Note: There may be some delay to permit the browser time to access and load the document before updating the listbox with the titles of all tiddlers that are available to be imported.//\n\nSelect one or more titles from the listbox (hold CTRL or SHIFT while clicking to add/remove the highlight from individual list items).  You can press ''[select all]'' to quickly highlight all tiddler titles in the list.  Use the ''[-]'', ''[+]'', or ''[=]'' links to adjust the listbox size so you can view more (or less) tiddler titles at one time.  When you have chosen the tiddlers you want to import and entered any extra tags, press ''[import]'' to begin copying them to the current TiddlyWiki document.\n\n''select: all, new, changes, or differences''\n\nYou can click on ''all'', ''new'', ''changes'', or ''differences'' to automatically select a subset of tiddlers from the list. This makes it very quick and easy to find and import just the updated tiddlers you are interested in:\n&gt;''&quot;all&quot;'' selects ALL tiddlers from the import source document, even if they have not been changed.\n&gt;''&quot;new&quot;'' selects only tiddlers that are found in the import source document, but do not yet exist in the destination document\n&gt;''&quot;changes&quot;'' selects only tiddlers that exist in both documents but that are newer in the source document\n&gt;''&quot;differences&quot;'' selects all new and existing tiddlers that are different from the destination document (even if destination tiddler is newer)\n\n''Import Tagging:''\n\nTiddlers that have been imported can be automatically tagged, so they will be easier to find later on, after they have been added to your document.  New tags are entered into the &quot;add tags&quot; input field, and then //added// to the existing tags for each tiddler as it is imported.\n\n''Skip, Rename, Merge, or Replace:''\n\nWhen importing a tiddler whose title is identical to one that already exists, the import process pauses and the tiddler title is displayed in an input field, along with four push buttons: ''[skip]'', ''[rename]'', ''[merge]'' and ''[replace]''.\n\nTo bypass importing this tiddler, press ''[skip]''.  To import the tiddler with a different name (so that both the tiddlers will exist when the import is done), enter a new title in the input field and then press ''[rename]''.   Press ''[merge]'' to combine the content from both tiddlers into a single tiddler.  Press ''[replace]'' to overwrite the existing tiddler with the imported one, discarding the previous tiddler content.\n\n//Note: if both the title ''and'' modification date/////time match, the imported tiddler is assumed to be identical to the existing one, and will be automatically skipped (i.e., not imported) without asking.//\n\n''Import Report History''\n\nWhen tiddlers are imported, a report is generated into ImportedTiddlers, indicating when the latest import was performed, the number of tiddlers successfully imported, from what location, and by whom. It also includes a list with the title, date and author of each tiddler that was imported.\n\nWhen the import process is completed, the ImportedTiddlers report is automatically displayed for your review.  If more tiddlers are subsequently imported, a new report is //added// to ImportedTiddlers, above the previous report (i.e., at the top of the tiddler), so that a reverse-chronological history of imports is maintained.\n\nIf a cumulative record is not desired, the ImportedTiddlers report may be deleted at any time. A new ImportedTiddlers report will be created the next time tiddlers are imported.\n\nNote: You can prevent the ImportedTiddlers report from being generated for any given import activity by clearing the &quot;create a report&quot; checkbox before beginning the import processing.\n\n&lt;&lt;&lt;\n!!!!!non-interactive 'load tiddlers' macro\n&lt;&lt;&lt;\nUseful for automated installation/update of plugins and other tiddler content.\n\n{{{&lt;&lt;loadTiddlers &quot;label:load tiddlers from %0&quot; http://www.tiddlytools.com/example.html confirm&gt;&gt;}}}\n&lt;&lt;loadTiddlers &quot;label:load tiddlers from %0&quot; http://www.tiddlytools.com/example.html confirm&gt;&gt;\n\nSyntax:\n{{{&lt;&lt;loadTiddlers label:text prompt:text filter source quiet confirm&gt;&gt;}}}\n\n''label:text'' and ''prompt:text''\n&gt;defines link text and tooltip (prompt) that can be clicked to trigger the load tiddler processing.  If a label is NOT provided, then no link is created and loadTiddlers() is executed whenever the containing tiddler is rendered.\n''filter'' (optional) determines which tiddlers will be automatically selected for importing.  Use one of the following keywords:\n&gt;''&quot;all&quot;'' retrieves ALL tiddlers from the import source document, even if they have not been changed.\n&gt;''&quot;new&quot;'' retrieves only tiddlers that are found in the import source document, but do not yet exist in the destination document\n&gt;''&quot;changes&quot;'' retrieves only tiddlers that exist in both documents for which the import source tiddler is newer than the existing tiddler\n&gt;''&quot;updates&quot;'' retrieves both ''new'' and ''changed'' tiddlers (this is the default action when none is specified)\n&gt;''&quot;tiddler:~TiddlerName&quot;'' retrieves only the specific tiddler named in the parameter.\n&gt;''&quot;tag:text&quot;'' retrieves only the tiddlers tagged with the indicated text.\n''source'' (required) is the location of the imported document.  It can be either a local document path/filename in whatever format your system requires, or a remote web location (starting with &quot;http://&quot; or &quot;https://&quot;)\n&gt;use the keyword ''ask'' to prompt for a source location whenever the macro is invoked\n''&quot;quiet&quot;'' (optional)\n&gt;supresses all status message during the import processing (e.g., &quot;opening local file...&quot;, &quot;found NN tiddlers...&quot; etc).  Note that if ANY tiddlers are actualy imported, a final information message will still be displayed (along with the ImportedTiddlers report), even when 'quiet' is specified.  This ensures that changes to your document cannot occur without any visible indication at all.\n''&quot;confirm&quot;'' (optional)\n&gt;adds interactive confirmation.  A browser message box (OK/Cancel) is displayed for each tiddler that will be imported, so that you can manually bypass any tiddlers that you do not want to import.\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\ncopy/paste the following tiddlers into your document:\n''ImportTiddlersPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n\ncreate/edit ''SideBarOptions'': (sidebar menu items) \n^^Add &quot;&lt; &lt; ImportTiddlers &gt; &gt;&quot; macro^^\n\n''Quick Installation Tip #1:''\nIf you are using an unmodified version of TiddlyWiki (core release version &lt;&lt;version&gt;&gt;), you can get a new, empty TiddlyWiki with the Import Tiddlers plugin pre-installed (''[[download from here|TW+ImportExport.html]]''), and then simply import all your content from your old document into this new, empty document.\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.11.14 [3.1.2]'' fix macro handler parameter declaration (double-pasted param list corrupts IE)\n''2006.11.13 [3.1.1]'' use apply() method to invoke hijacked core handler\n''2006.11.13 [3.1.0]'' hijack TW2.1 built-in importTiddlers.handler() so it can co-exist with the plugin interface 'panel'.  Use macro without params (or use 'core' keyword) to display built-in core interface.  Use new &quot;link&quot; param to embed &quot;import tiddlers&quot; link that shows floating panel when clicked.  Renamed a few plugin utility functions so they don't collide with core internal functions.  More code restructuring to come.\n''2006.10.12 [3.0.8]'' in readTiddlersFromHTML(), fallback to find end of store area by matching &quot;/body&quot; when POST-BODY-START is not present (backward compatibility for older documents)\n''2006.09.10 [3.0.7]'' in readTiddlersFromHTML(), find end of store area by matching &quot;POST-BODY-START&quot; instead of &quot;/body&quot; \n''2006.08.16 [3.0.6]'' Use higher-level store.saveTiddler() instead of store.addTiddler() to avoid conflicts with ZW and other adaptations that hijack low-level tiddler handling.  Also, in CreateImportPanel(), no longer register notify to &quot;refresh listbox after every tiddler change&quot; (left over from old 'auto-filtered' list handling).  Thanks to Bob McElrath for report/solution.\n''2006.07.29 [3.0.5]'' added noChangeMsg to loadTiddlers processing.  if not 'quiet' mode, reports skipped tiddlers.\n''2006.04.18 [3.0.4]'' in loadTiddlers.handler, fixed parsing of &quot;prompt:&quot; param. Also, corrected parameters mismatch in loadTiddlers() callback function definition (order of params was wrong, resulting in filters NOT being applied)\n''2006.04.12 [3.0.3]'' moved many display messages to macro properties for easier L10N translations via 'lingo' definitions.\n''2006.04.12 [3.0.2]'' additional refactoring of 'core candidate' code.  Proposed API now defines &quot;loadRemoteFile()&quot; for XMLHttpRequest processing with built in fallback for handling local filesystem access, and readTiddlersFromHTML() to process the resulting source HTML content.\n''2006.04.04 [3.0.1]'' in refreshImportList(), when using [by tags], tiddlers without tags are now included in a new &quot;untagged&quot; psuedo-tag list section\n''2006.04.04 [3.0.0]'' Separate non-interactive {{{&lt;&lt;importTiddlers...&gt;&gt;}}} macro functionality for incorporation into TW2.1 core and renamed as {{{&lt;&lt;loadTiddlers&gt;&gt;}}} macro.  New parameters for loadTiddlers: ''label:text'' and ''prompt:text'' for link creation,  ''ask'' for filename/URL, ''tag:text'' for filtering, &quot;confirm&quot; for accept/reject of individual inbound tiddlers.  Also, ImportedTiddlers report generator output has been simplified and &quot;importReplace/importPublic&quot; tags and associated &quot;force&quot; param (which were rarely, if ever, used) has been dropped.\n''2006.03.30 [2.9.1]'' when extracting store area from remote URL, look for &quot;&lt;/body&gt;&quot; instead of &quot;&lt;/body&gt;\sn&lt;/html&gt;&quot; so it will match even if the &quot;\sn&quot; is absent from the source.\n''2006.03.30 [2.9.0]'' added optional 'force' macro param.  When present, autoImportTiddlers() bypasses the checks for importPublic and importReplace.  Based on a request from Tom Otvos.\n''2006.03.28 [2.8.1]'' in loadImportFile(), added checks to see if 'netscape' and 'x.overrideMimeType()' are defined (IE does *not* define these values, so we bypass this code)\nAlso, when extracting store area from remote URL, explicitly look for &quot;&lt;/body&gt;\sn&lt;/html&gt;&quot; to exclude any extra content that may have been added to the end of the file by hosting environments such as GeoCities.  Thanks to Tom Otvos for finding these bugs and suggesting some fixes.\n''2006.02.21 [2.8.0]'' added support for &quot;tiddler:TiddlerName&quot; filtering parameter in auto-import processing\n''2006.02.21 [2.7.1]'' Clean up layout problems with IE.  (Use tables for alignment instead of SPANs styled with float:left and float:right)\n''2006.02.21 [2.7.0]'' Added &quot;local file&quot; and &quot;web server&quot; radio buttons for selecting dynamic import source controls in ImportPanel.  Default file control is replaced with URL text input field when &quot;web server&quot; is selected.  Default remote document URL is defined in SiteURL tiddler.  Also, added option for prepending SiteProxy URL as prefix to remote URL to mask cross-domain document access (requires compatible server-side script)\n''2006.02.17 [2.6.0]'' Removed &quot;differences only&quot; listbox display mode, replaced with selection filter 'presets': all/new/changes/differences.  Also fixed initialization handling for &quot;add new tags&quot; so that checkbox state is correctly tracked when panel is first displayed.\n''2006.02.16 [2.5.4]'' added checkbox options to control &quot;import remote tags&quot; and &quot;keep existing tags&quot; behavior, in addition to existing &quot;add new tags&quot; functionality.\n''2006.02.14 [2.5.3]'' FF1501 corrected unintended global 't' (loop index) in importReport() and autoImportTiddlers()\n''2006.02.10 [2.5.2]'' corrected unintended global variable in importReport().\n''2006.02.05 [2.5.1]'' moved globals from window.* to config.macros.importTiddlers.* to avoid FireFox 1.5.0.1 crash bug when referencing globals\n''2006.01.18 [2.5.0]'' added checkbox for &quot;create a report&quot;.  Default is to create/update the ImportedTiddlers report.  Clear the checkbox to skip this step.\n''2006.01.15 [2.4.1]'' added &quot;importPublic&quot; tag and inverted default so that auto sharing is NOT done unless tagged with importPublic\n''2006.01.15 [2.4.0]'' Added support for tagging individual tiddlers with importSkip, importReplace, and/or importPrivate to control which tiddlers can be overwritten or shared with others when using auto-import macro syntax.  Defaults are to SKIP overwriting existing tiddlers with imported tiddlers, and ALLOW your tiddlers to be auto-imported by others.\n''2006.01.15 [2.3.2]'' Added &quot;ask&quot; parameter to confirm each tiddler before importing (for use with auto-importing)\n''2006.01.15 [2.3.1]'' Strip TW core scripts from import source content and load just the storeArea into the hidden IFRAME.  Makes loading more efficient by reducing the document size and by preventing the import document from executing its TW initialization (including plugins).  Seems to resolve the &quot;Found 0 tiddlers&quot; problem.  Also, when importing local documents, use convertUTF8ToUnicode() to convert the file contents so support international characters sets.\n''2006.01.12 [2.3.0]'' Reorganized code to use callback function for loading import files to support event-driven I/O via an ASYNCHRONOUS XMLHttpRequest.  Let's processing continue while waiting for remote hosts to respond to URL requests.  Added non-interactive 'batch' macro mode, using parameters to specify which tiddlers to import, and from what document source.  Improved error messages and diagnostics, plus an optional 'quiet' switch for batch mode to eliminate //most// feedback.\n''2006.01.11 [2.2.0]'' Added &quot;[by tags]&quot; to list of tiddlers, based on code submitted by BradleyMeck\n''2006.01.09 [2.1.1]'' When a URL is typed in, and then the &quot;open&quot; button is pressed, it generates both an onChange event for the file input and a click event for open button.  This results in multiple XMLHttpRequest()'s which seem to jam things up quite a bit.  I removed the onChange handling for file input field.  To open a file (local or URL), you must now explicitly press the &quot;open&quot; button in the control panel.\n''2006.01.08 [2.1.0]'' IMPORT FROM ANYWHERE!!! re-write getImportedTiddlers() logic to either read a local file (using local I/O), OR... read a remote file, using a combination of XML and an iframe to permit cross-domain reading of DOM elements.  Adapted from example code and techniques courtesy of Jonny LeRoy.\n''2006.01.06 [2.0.2]'' When refreshing list contents, fixed check for tiddlerExists() when &quot;show differences only&quot; is selected, so that imported tiddlers that don't exist in the current file will be recognized as differences and included in the list.\n''2006.01.04 [2.0.1]'' When &quot;show differences only&quot; is NOT checked, import all tiddlers that have been selected even when they have a matching title and date.\n''2005.12.27 [2.0.0]'' Update for TW2.0\nDefer initial panel creation and only register a notification function when panel first is created\n''2005.12.22 [1.3.1]'' tweak formatting in importReport() and add 'discard report' link to output\n''2005.12.03 [1.3.0]'' Dynamically create/remove importPanel as needed to ensure only one instance of interface elements exists, even if there are multiple instances of macro embedding.  Also, dynamically create/recreate importFrame each time an external TW document is loaded for importation (reduces DOM overhead and ensures a 'fresh' frame for each document)\n''2005.11.29 [1.2.1]'' fixed formatting of 'detail info' in importReport()\n''2005.11.11 [1.2.0]'' added 'inline' param to embed controls in a tiddler\n''2005.11.09 [1.1.0]'' only load HTML and CSS the first time the macro handler is called.  Allows for redundant placement of the macro without creating multiple instances of controls with the same ID's.\n''2005.10.25 [1.0.5]'' fixed typo in importReport() that prevented reports from being generated\n''2005.10.09 [1.0.4]'' combined documentation with plugin code instead of using separate tiddlers\n''2005.08.05 [1.0.3]'' moved CSS and HTML definitions into plugin code instead of using separate tiddlers\n''2005.07.27 [1.0.2]'' core update 1.2.29: custom overlayStyleSheet() replaced with new core setStylesheet()\n''2005.07.23 [1.0.1]'' added parameter checks and corrected addNotification() usage\n''2005.07.20 [1.0.0]'' Initial Release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]\n&lt;&lt;&lt;\n!!!!!Code\n***/\n// // ''MACRO DEFINITION''\n//{{{\n// Version\nversion.extensions.importTiddlers = {major: 3, minor: 1, revision: 2, date: new Date(2006,11,14)};\n\n// IE needs explicit global scoping for functions/vars called from browser events\nwindow.onClickImportButton=onClickImportButton;\nwindow.refreshImportList=refreshImportList;\n\n// default cookie/option values\nif (!config.options.chkImportReport) config.options.chkImportReport=true;\n\n// fixups for TW2.0.x and earlier\nif (window.merge==undefined) window.merge=function(dst,src,preserveExisting)\n	{ for (p in src) if (!preserveExisting||dst[p]===undefined) dst[p]=src[p]; return dst; }\nif (config.macros.importTiddlers==undefined) config.macros.importTiddlers={ };\n\nmerge(config.macros.importTiddlers,{\n	label: &quot;import tiddlers&quot;,\n	prompt: &quot;Copy tiddlers from another document&quot;,\n	foundMsg: &quot;Found %0 tiddlers in %1&quot;,\n	countMsg: &quot;%0 tiddlers selected for import&quot;,\n	importedMsg: &quot;Imported %0 of %1 tiddlers from %2&quot;,\n	src: &quot;&quot;,		// path/filename or URL of document to import (retrieved from SiteUrl tiddler)\n	proxy: &quot;&quot;,		// URL for remote proxy script (retrieved from SiteProxy tiddler)\n	useProxy: false,	// use specific proxy script in front of remote URL\n	inbound: null,		// hash-indexed array of tiddlers from other document\n	newTags: &quot;&quot;,		// text of tags added to imported tiddlers\n	addTags: true,		// add new tags to imported tiddlers\n	listsize: 8,		// # of lines to show in imported tiddler list\n	importTags: true,	// include tags from remote source document when importing a tiddler\n	keepTags: true,		// retain existing tags when replacing a tiddler\n	index: 0,		// current processing index in import list\n	sort: &quot;&quot;		// sort order for imported tiddler listbox\n});\n\nif (config.macros.importTiddlers.coreHandler==undefined)\n	config.macros.importTiddlers.coreHandler=config.macros.importTiddlers.handler; // save built-in handler\n\nconfig.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler) {\n	if (!params[0] || params[0].toLowerCase()=='core') { // default to built in\n		if (config.macros.importTiddlers.coreHandler)\n			config.macros.importTiddlers.coreHandler.apply(this,arguments);\n		else \n			createTiddlyButton(place,this.label,this.prompt,onClickImportMenu);\n	}\n	else if (params[0]=='link') // show link to floating panel\n		createTiddlyButton(place,this.label,this.prompt,onClickImportMenu);\n	else if (params[0]=='inline') {// show panel as INLINE tiddler content\n		createImportPanel(place);\n		document.getElementById(&quot;importPanel&quot;).style.position=&quot;static&quot;;\n		document.getElementById(&quot;importPanel&quot;).style.display=&quot;block&quot;;\n	}\n	else config.macros.loadTiddlers.handler(place,macroName,params); // any other params: loadtiddlers\n}\n//}}}\n\n// // ''INTERFACE DEFINITION''\n// // Handle link click to create/show/hide control panel\n//{{{\nfunction onClickImportMenu(e)\n{\n	if (!e) var e = window.event;\n	var parent=resolveTarget(e).parentNode;\n	var panel = document.getElementById(&quot;importPanel&quot;);\n	if (panel==undefined || panel.parentNode!=parent)\n		panel=createImportPanel(parent);\n	var isOpen = panel.style.display==&quot;block&quot;;\n	if(config.options.chkAnimate)\n		anim.startAnimating(new Slider(panel,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));\n	else\n		panel.style.display = isOpen ? &quot;none&quot; : &quot;block&quot; ;\n	e.cancelBubble = true;\n	if (e.stopPropagation) e.stopPropagation();\n	return(false);\n}\n//}}}\n\n// // Create control panel: HTML, CSS\n//{{{\nfunction createImportPanel(place) {\n	var panel=document.getElementById(&quot;importPanel&quot;);\n	if (panel) { panel.parentNode.removeChild(panel); }\n	setStylesheet(config.macros.importTiddlers.css,&quot;importTiddlers&quot;);\n	panel=createTiddlyElement(place,&quot;span&quot;,&quot;importPanel&quot;,null,null)\n	panel.innerHTML=config.macros.importTiddlers.html;\n	refreshImportList();\n	var siteURL=store.getTiddlerText(&quot;SiteUrl&quot;); if (!siteURL) siteURL=&quot;&quot;;\n	document.getElementById(&quot;importSourceURL&quot;).value=siteURL;\n	config.macros.importTiddlers.src=siteURL;\n	var siteProxy=store.getTiddlerText(&quot;SiteProxy&quot;); if (!siteProxy) siteProxy=&quot;SiteProxy&quot;;\n	document.getElementById(&quot;importSiteProxy&quot;).value=siteProxy;\n	config.macros.importTiddlers.proxy=siteProxy;\n	return panel;\n}\n//}}}\n\n// // CSS\n//{{{\nconfig.macros.importTiddlers.css = '\s\n#importPanel {\s\n	display: none; position:absolute; z-index:11; width:35em; right:105%; top:3em;\s\n	background-color: #eee; color:#000; font-size: 8pt; line-height:110%;\s\n	border:1px solid black; border-bottom-width: 3px; border-right-width: 3px;\s\n	padding: 0.5em; margin:0em; -moz-border-radius:1em;\s\n}\s\n#importPanel a, #importPanel td a { color:#009; display:inline; margin:0px; padding:1px; }\s\n#importPanel table { width:100%; border:0px; padding:0px; margin:0px; font-size:8pt; line-height:110%; background:transparent; }\s\n#importPanel tr { border:0px;padding:0px;margin:0px; background:transparent; }\s\n#importPanel td { color:#000; border:0px;padding:0px;margin:0px; background:transparent; }\s\n#importPanel select { width:98%;margin:0px;font-size:8pt;line-height:110%;}\s\n#importPanel input  { width:98%;padding:0px;margin:0px;font-size:8pt;line-height:110%}\s\n#importPanel .box { border:1px solid black; padding:3px; margin-bottom:5px; background:#f8f8f8; -moz-border-radius:5px;}\s\n#importPanel .topline { border-top:2px solid black; padding-top:3px; margin-bottom:5px; }\s\n#importPanel .rad { width:auto; }\s\n#importPanel .chk { width:auto; margin:1px;border:0; }\s\n#importPanel .btn { width:auto; }\s\n#importPanel .btn1 { width:98%; }\s\n#importPanel .btn2 { width:48%; }\s\n#importPanel .btn3 { width:32%; }\s\n#importPanel .btn4 { width:24%; }\s\n#importPanel .btn5 { width:19%; }\s\n#importPanel .importButton { padding: 0em; margin: 0px; font-size:8pt; }\s\n#importPanel .importListButton { padding:0em 0.25em 0em 0.25em; color: #000000; display:inline }\s\n#importCollisionPanel { display:none; margin:0.5em 0em 0em 0em; }\s\n';\n//}}}\n\n// // HTML \n//{{{\nconfig.macros.importTiddlers.html = '\s\n&lt;!-- source and report --&gt;\s\n&lt;table&gt;&lt;tr&gt;&lt;td align=left&gt;\s\n	import from\s\n	&lt;input type=&quot;radio&quot; class=&quot;rad&quot; name=&quot;importFrom&quot; value=&quot;file&quot; CHECKED\s\n		onClick=&quot;document.getElementById(\s'importLocalPanel\s').style.display=this.checked?\s'block\s':\s'none\s';\s\n			document.getElementById(\s'importHTTPPanel\s').style.display=!this.checked?\s'block\s':\s'none\s'&quot;&gt; local file\s\n	&lt;input type=&quot;radio&quot; class=&quot;rad&quot; name=&quot;importFrom&quot; value=&quot;http&quot;\s\n		onClick=&quot;document.getElementById(\s'importLocalPanel\s').style.display=!this.checked?\s'block\s':\s'none\s';\s\n			document.getElementById(\s'importHTTPPanel\s').style.display=this.checked?\s'block\s':\s'none\s'&quot;&gt; web server\s\n&lt;/td&gt;&lt;td align=right&gt;\s\n	&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkImportReport&quot; checked\s\n		onClick=&quot;config.options[\s'chkImportReport\s']=this.checked;&quot;&gt; create a report\s\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\s\n&lt;!-- import from local file  --&gt;\s\n&lt;div id=&quot;importLocalPanel&quot; style=&quot;display:block;margin-bottom:5px;margin-top:5px;padding-top:3px;border-top:1px solid #999&quot;&gt;\s\nlocal document path/filename:&lt;br&gt;\s\n&lt;input type=&quot;file&quot; id=&quot;fileImportSource&quot; size=57 style=&quot;width:100%&quot;\s\n	onKeyUp=&quot;config.macros.importTiddlers.src=this.value&quot;\s\n	onChange=&quot;config.macros.importTiddlers.src=this.value;&quot;&gt;\s\n&lt;/div&gt;&lt;!--panel--&gt;\s\n\s\n&lt;!-- import from http server --&gt;\s\n&lt;div id=&quot;importHTTPPanel&quot; style=&quot;display:none;margin-bottom:5px;margin-top:5px;padding-top:3px;border-top:1px solid #999&quot;&gt;\s\n&lt;table&gt;&lt;tr&gt;&lt;td align=left&gt;\s\n	remote document URL:&lt;br&gt;\s\n&lt;/td&gt;&lt;td align=right&gt;\s\n	&lt;input type=&quot;checkbox&quot; class=&quot;chk&quot; id=&quot;importUseProxy&quot;\s\n		onClick=&quot;config.macros.importTiddlers.useProxy=this.checked;\s\n			document.getElementById(\s'importSiteProxy\s').style.display=this.checked?\s'block\s':\s'none\s'&quot;&gt; use a proxy script\s\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\s\n&lt;input type=&quot;text&quot; id=&quot;importSiteProxy&quot; style=&quot;display:none;margin-bottom:1px&quot; onfocus=&quot;this.select()&quot; value=&quot;SiteProxy&quot;\s\n	onKeyUp=&quot;config.macros.importTiddlers.proxy=this.value&quot;\s\n	onChange=&quot;config.macros.importTiddlers.proxy=this.value;&quot;&gt;\s\n&lt;input type=&quot;text&quot; id=&quot;importSourceURL&quot; onfocus=&quot;this.select()&quot; value=&quot;SiteUrl&quot;\s\n	onKeyUp=&quot;config.macros.importTiddlers.src=this.value&quot;\s\n	onChange=&quot;config.macros.importTiddlers.src=this.value;&quot;&gt;\s\n&lt;/div&gt;&lt;!--panel--&gt;\s\n\s\n&lt;table&gt;&lt;tr&gt;&lt;td align=left&gt;\s\n	select:\s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectAll&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;select all tiddlers&quot;&gt;\s\n		&amp;nbsp;all&amp;nbsp;&lt;/a&gt;\s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectNew&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;select tiddlers not already in destination document&quot;&gt;\s\n		&amp;nbsp;added&amp;nbsp;&lt;/a&gt; \s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectChanges&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;select tiddlers that have been updated in source document&quot;&gt;\s\n		&amp;nbsp;changes&amp;nbsp;&lt;/a&gt; \s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importSelectDifferences&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;select tiddlers that have been added or are different from existing tiddlers&quot;&gt;\s\n		&amp;nbsp;differences&amp;nbsp;&lt;/a&gt; \s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importToggleFilter&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;show/hide selection filter&quot;&gt;\s\n		&amp;nbsp;filter&amp;nbsp;&lt;/a&gt; \s\n&lt;/td&gt;&lt;td align=right&gt;\s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importListSmaller&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;reduce list size&quot;&gt;\s\n		&amp;nbsp;&amp;#150;&amp;nbsp;&lt;/a&gt;\s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importListLarger&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;increase list size&quot;&gt;\s\n		&amp;nbsp;+&amp;nbsp;&lt;/a&gt;\s\n	&lt;a href=&quot;JavaScript:;&quot; id=&quot;importListMaximize&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot; title=&quot;maximize/restore list size&quot;&gt;\s\n		&amp;nbsp;=&amp;nbsp;&lt;/a&gt;\s\n&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\s\n&lt;select id=&quot;importList&quot; size=8 multiple\s\n	onchange=&quot;setTimeout(\s'refreshImportList(\s'+this.selectedIndex+\s')\s',1)&quot;&gt;\s\n	&lt;!-- NOTE: delay refresh so list is updated AFTER onchange event is handled --&gt;\s\n&lt;/select&gt;\s\n&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkAddTags&quot; checked\s\n	onClick=&quot;config.macros.importTiddlers.addTags=this.checked;&quot;&gt;add new tags &amp;nbsp;\s\n&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkImportTags&quot; checked\s\n	onClick=&quot;config.macros.importTiddlers.importTags=this.checked;&quot;&gt;import source tags &amp;nbsp;\s\n&lt;input type=checkbox class=&quot;chk&quot; id=&quot;chkKeepTags&quot; checked\s\n	onClick=&quot;config.macros.importTiddlers.keepTags=this.checked;&quot;&gt;keep existing tags&lt;br&gt;\s\n&lt;input type=text id=&quot;txtNewTags&quot; size=15 onKeyUp=&quot;config.macros.importTiddlers.newTags=this.value&quot; autocomplete=off&gt;\s\n&lt;div align=center&gt;\s\n	&lt;input type=button id=&quot;importOpen&quot; class=&quot;importButton&quot; style=&quot;width:32%&quot; value=&quot;open&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n	&lt;input type=button id=&quot;importStart&quot;	 class=&quot;importButton&quot; style=&quot;width:32%&quot; value=&quot;import&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n	&lt;input type=button id=&quot;importClose&quot;	 class=&quot;importButton&quot; style=&quot;width:32%&quot; value=&quot;close&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n&lt;/div&gt;\s\n&lt;div id=&quot;importCollisionPanel&quot;&gt;\s\n	tiddler already exists:\s\n	&lt;input type=text id=&quot;importNewTitle&quot; size=15 autocomplete=off&quot;&gt;\s\n	&lt;div align=center&gt;\s\n	&lt;input type=button id=&quot;importSkip&quot;	class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;skip&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n	&lt;input type=button id=&quot;importRename&quot;  class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;rename&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n	&lt;input type=button id=&quot;importMerge&quot;   class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;merge&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n	&lt;input type=button id=&quot;importReplace&quot; class=&quot;importButton&quot; style=&quot;width:23%&quot; value=&quot;replace&quot;\s\n		onclick=&quot;onClickImportButton(this)&quot;&gt;\s\n	&lt;/div&gt;\s\n&lt;/div&gt;\s\n';\n//}}}\n\n// // Control interactions\n//{{{\nfunction onClickImportButton(which)\n{\n	// DEBUG alert(which.id);\n	var theList		  = document.getElementById('importList');\n	if (!theList) return;\n	var thePanel	= document.getElementById('importPanel');\n	var theCollisionPanel   = document.getElementById('importCollisionPanel');\n	var theNewTitle   = document.getElementById('importNewTitle');\n	var count=0;\n	switch (which.id)\n		{\n		case 'fileImportSource':\n		case 'importOpen':		// load import source into hidden frame\n			importReport();		// if an import was in progress, generate a report\n			config.macros.importTiddlers.inbound=null;	// clear the imported tiddler buffer\n			refreshImportList();	// reset/resize the listbox\n			if (config.macros.importTiddlers.src==&quot;&quot;) break;\n			// Load document into hidden iframe so we can read it's DOM and fill the list\n			config.macros.importTiddlers.loadRemoteFile(config.macros.importTiddlers.src, function(src,txt) {\n				var tiddlers = readTiddlersFromHTML(txt);\n				var count=tiddlers?tiddlers.length:0;\n				displayMessage(config.macros.importTiddlers.foundMsg.format([count,src]));\n				config.macros.importTiddlers.inbound=tiddlers;\n				window.refreshImportList(0);\n			});\n			break;\n		case 'importSelectAll':		// select all tiddler list items (i.e., not headings)\n			importReport();		// if an import was in progress, generate a report\n			for (var t=0,count=0; t &lt; theList.options.length; t++) {\n				if (theList.options[t].value==&quot;&quot;) continue;\n				theList.options[t].selected=true;\n				count++;\n			}\n			clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n			break;\n		case 'importSelectNew':		// select tiddlers not in current document\n			importReport();		// if an import was in progress, generate a report\n			for (var t=0,count=0; t &lt; theList.options.length; t++) {\n				theList.options[t].selected=false;\n				if (theList.options[t].value==&quot;&quot;) continue;\n				theList.options[t].selected=!store.tiddlerExists(theList.options[t].value);\n				count+=theList.options[t].selected?1:0;\n			}\n			clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n			break;\n		case 'importSelectChanges':		// select tiddlers that are updated from existing tiddlers\n			importReport();		// if an import was in progress, generate a report\n			for (var t=0,count=0; t &lt; theList.options.length; t++) {\n				theList.options[t].selected=false;\n				if (theList.options[t].value==&quot;&quot;||!store.tiddlerExists(theList.options[t].value)) continue;\n				for (var i=0; i&lt;config.macros.importTiddlers.inbound.length; i++) // find matching inbound tiddler\n					{ var inbound=config.macros.importTiddlers.inbound[i]; if (inbound.title==theList.options[t].value) break; }\n				theList.options[t].selected=(inbound.modified-store.getTiddler(theList.options[t].value).modified&gt;0); // updated tiddler\n				count+=theList.options[t].selected?1:0;\n			}\n			clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n			break;\n		case 'importSelectDifferences':		// select tiddlers that are new or different from existing tiddlers\n			importReport();		// if an import was in progress, generate a report\n			for (var t=0,count=0; t &lt; theList.options.length; t++) {\n				theList.options[t].selected=false;\n				if (theList.options[t].value==&quot;&quot;) continue;\n				if (!store.tiddlerExists(theList.options[t].value)) { theList.options[t].selected=true; count++; continue; }\n				for (var i=0; i&lt;config.macros.importTiddlers.inbound.length; i++) // find matching inbound tiddler\n					{ var inbound=config.macros.importTiddlers.inbound[i]; if (inbound.title==theList.options[t].value) break; }\n				theList.options[t].selected=(inbound.modified-store.getTiddler(theList.options[t].value).modified!=0); // changed tiddler\n				count+=theList.options[t].selected?1:0;\n			}\n			clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n			break;\n		case 'importToggleFilter': // show/hide filter\n		case 'importFilter': // apply filter\n			alert(&quot;coming soon!&quot;);\n			break;\n		case 'importStart':		// initiate the import processing\n			importReport();		// if an import was in progress, generate a report\n			config.macros.importTiddlers.index=0;\n			config.macros.importTiddlers.index=importTiddlers(0);\n			importStopped();\n			break;\n		case 'importClose':		// unload imported tiddlers or hide the import control panel\n			// if imported tiddlers not loaded, close the import control panel\n			if (!config.macros.importTiddlers.inbound) { thePanel.style.display='none'; break; }\n			importReport();		// if an import was in progress, generate a report\n			config.macros.importTiddlers.inbound=null;	// clear the imported tiddler buffer\n			refreshImportList();	// reset/resize the listbox\n			break;\n		case 'importSkip':	// don't import the tiddler\n			var theItem	= theList.options[config.macros.importTiddlers.index];\n			for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n			if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n			var theImported = config.macros.importTiddlers.inbound[j];\n			theImported.status='skipped after asking';			// mark item as skipped\n			theCollisionPanel.style.display='none';\n			config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index+1);	// resume with NEXT item\n			importStopped();\n			break;\n		case 'importRename':		// change name of imported tiddler\n			var theItem		= theList.options[config.macros.importTiddlers.index];\n			for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n			if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n			var theImported		= config.macros.importTiddlers.inbound[j];\n			theImported.status	= 'renamed from '+theImported.title;	// mark item as renamed\n			theImported.set(theNewTitle.value,null,null,null,null);		// change the tiddler title\n			theItem.value		= theNewTitle.value;			// change the listbox item text\n			theItem.text		= theNewTitle.value;			// change the listbox item text\n			theCollisionPanel.style.display='none';\n			config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index);	// resume with THIS item\n			importStopped();\n			break;\n		case 'importMerge':	// join existing and imported tiddler content\n			var theItem	= theList.options[config.macros.importTiddlers.index];\n			for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n			if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n			var theImported	= config.macros.importTiddlers.inbound[j];\n			var theExisting	= store.getTiddler(theItem.value);\n			var theText	= theExisting.text+'\sn----\sn^^merged from: ';\n			theText		+='[['+config.macros.importTiddlers.src+'#'+theItem.value+'|'+config.macros.importTiddlers.src+'#'+theItem.value+']]^^\sn';\n			theText		+='^^'+theImported.modified.toLocaleString()+' by '+theImported.modifier+'^^\sn'+theImported.text;\n			var theDate	= new Date();\n			var theTags	= theExisting.getTags()+' '+theImported.getTags();\n			theImported.set(null,theText,null,theDate,theTags);\n			theImported.status   = 'merged with '+theExisting.title;	// mark item as merged\n			theImported.status  += ' - '+theExisting.modified.formatString(&quot;MM/DD/YYYY 0hh:0mm:0ss&quot;);\n			theImported.status  += ' by '+theExisting.modifier;\n			theCollisionPanel.style.display='none';\n			config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index);	// resume with this item\n			importStopped();\n			break;\n		case 'importReplace':		// substitute imported tiddler for existing tiddler\n			var theItem		  = theList.options[config.macros.importTiddlers.index];\n			for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n			if (config.macros.importTiddlers.inbound[j].title==theItem.value) break;\n			var theImported     = config.macros.importTiddlers.inbound[j];\n			var theExisting	  = store.getTiddler(theItem.value);\n			theImported.status  = 'replaces '+theExisting.title;		// mark item for replace\n			theImported.status += ' - '+theExisting.modified.formatString(&quot;MM/DD/YYYY 0hh:0mm:0ss&quot;);\n			theImported.status += ' by '+theExisting.modifier;\n			theCollisionPanel.style.display='none';\n			config.macros.importTiddlers.index=importTiddlers(config.macros.importTiddlers.index);	// resume with THIS item\n			importStopped();\n			break;\n		case 'importListSmaller':		// decrease current listbox size, minimum=5\n			if (theList.options.length==1) break;\n			theList.size-=(theList.size&gt;5)?1:0;\n			config.macros.importTiddlers.listsize=theList.size;\n			break;\n		case 'importListLarger':		// increase current listbox size, maximum=number of items in list\n			if (theList.options.length==1) break;\n			theList.size+=(theList.size&lt;theList.options.length)?1:0;\n			config.macros.importTiddlers.listsize=theList.size;\n			break;\n		case 'importListMaximize':	// toggle listbox size between current and maximum\n			if (theList.options.length==1) break;\n			theList.size=(theList.size==theList.options.length)?config.macros.importTiddlers.listsize:theList.options.length;\n			break;\n		}\n}\n//}}}\n\n// // refresh listbox\n//{{{\nfunction refreshImportList(selectedIndex)\n{\n	var theList  = document.getElementById(&quot;importList&quot;);\n	if (!theList) return;\n	// if nothing to show, reset list content and size\n	if (!config.macros.importTiddlers.inbound) \n	{\n		while (theList.length &gt; 0) { theList.options[0] = null; }\n		theList.options[0]=new Option('please open a document...',&quot;&quot;,false,false);\n		theList.size=config.macros.importTiddlers.listsize;\n		return;\n	}\n	// get the sort order\n	if (!selectedIndex)   selectedIndex=0;\n	if (selectedIndex==0) config.macros.importTiddlers.sort='title';		// heading\n	if (selectedIndex==1) config.macros.importTiddlers.sort='title';\n	if (selectedIndex==2) config.macros.importTiddlers.sort='modified';\n	if (selectedIndex==3) config.macros.importTiddlers.sort='tags';\n	if (selectedIndex&gt;3) {\n		// display selected tiddler count\n		for (var t=0,count=0; t &lt; theList.options.length; t++) count+=(theList.options[t].selected&amp;&amp;theList.options[t].value!=&quot;&quot;)?1:0;\n		clearMessage(); displayMessage(config.macros.importTiddlers.countMsg.format([count]));\n		return; // no refresh needed\n	}\n\n	// get the alphasorted list of tiddlers (optionally, filter out unchanged tiddlers)\n	var tiddlers=config.macros.importTiddlers.inbound;\n	tiddlers.sort(function (a,b) {if(a['title'] == b['title']) return(0); else return (a['title'] &lt; b['title']) ? -1 : +1; });\n	// clear current list contents\n	while (theList.length &gt; 0) { theList.options[0] = null; }\n	// add heading and control items to list\n	var i=0;\n	var indent=String.fromCharCode(160)+String.fromCharCode(160);\n	theList.options[i++]=new Option(tiddlers.length+' tiddler'+((tiddlers.length!=1)?'s are':' is')+' in the document',&quot;&quot;,false,false);\n	theList.options[i++]=new Option(((config.macros.importTiddlers.sort==&quot;title&quot;   )?&quot;&gt;&quot;:indent)+' [by title]',&quot;&quot;,false,false);\n	theList.options[i++]=new Option(((config.macros.importTiddlers.sort==&quot;modified&quot;)?&quot;&gt;&quot;:indent)+' [by date]',&quot;&quot;,false,false);\n	theList.options[i++]=new Option(((config.macros.importTiddlers.sort==&quot;tags&quot;)?&quot;&gt;&quot;:indent)+' [by tags]',&quot;&quot;,false,false);\n	// output the tiddler list\n	switch(config.macros.importTiddlers.sort)\n		{\n		case &quot;title&quot;:\n			for(var t = 0; t &lt; tiddlers.length; t++)\n				theList.options[i++] = new Option(tiddlers[t].title,tiddlers[t].title,false,false);\n			break;\n		case &quot;modified&quot;:\n			// sort descending for newest date first\n			tiddlers.sort(function (a,b) {if(a['modified'] == b['modified']) return(0); else return (a['modified'] &gt; b['modified']) ? -1 : +1; });\n			var lastSection = &quot;&quot;;\n			for(var t = 0; t &lt; tiddlers.length; t++) {\n				var tiddler = tiddlers[t];\n				var theSection = tiddler.modified.toLocaleDateString();\n				if (theSection != lastSection) {\n					theList.options[i++] = new Option(theSection,&quot;&quot;,false,false);\n					lastSection = theSection;\n				}\n				theList.options[i++] = new Option(indent+indent+tiddler.title,tiddler.title,false,false);\n			}\n			break;\n		case &quot;tags&quot;:\n			var theTitles = {}; // all tiddler titles, hash indexed by tag value\n			var theTags = new Array();\n			for(var t=0; t&lt;tiddlers.length; t++) {\n				var title=tiddlers[t].title;\n				var tags=tiddlers[t].tags;\n				if (!tags || !tags.length) {\n					if (theTitles[&quot;untagged&quot;]==undefined) { theTags.push(&quot;untagged&quot;); theTitles[&quot;untagged&quot;]=new Array(); }\n					theTitles[&quot;untagged&quot;].push(title);\n				}\n				else for(var s=0; s&lt;tags.length; s++) {\n					if (theTitles[tags[s]]==undefined) { theTags.push(tags[s]); theTitles[tags[s]]=new Array(); }\n					theTitles[tags[s]].push(title);\n				}\n			}\n			theTags.sort();\n			for(var tagindex=0; tagindex&lt;theTags.length; tagindex++) {\n				var theTag=theTags[tagindex];\n				theList.options[i++]=new Option(theTag,&quot;&quot;,false,false);\n				for(var t=0; t&lt;theTitles[theTag].length; t++)\n					theList.options[i++]=new Option(indent+indent+theTitles[theTag][t],theTitles[theTag][t],false,false);\n			}\n			break;\n		}\n	theList.selectedIndex=selectedIndex;		  // select current control item\n	if (theList.size&lt;config.macros.importTiddlers.listsize) theList.size=config.macros.importTiddlers.listsize;\n	if (theList.size&gt;theList.options.length) theList.size=theList.options.length;\n}\n//}}}\n\n// // re-entrant processing for handling import with interactive collision prompting\n//{{{\nfunction importTiddlers(startIndex)\n{\n	if (!config.macros.importTiddlers.inbound) return -1;\n\n	var theList = document.getElementById('importList');\n	if (!theList) return;\n	var t;\n	// if starting new import, reset import status flags\n	if (startIndex==0)\n		for (var t=0;t&lt;config.macros.importTiddlers.inbound.length;t++)\n			config.macros.importTiddlers.inbound[t].status=&quot;&quot;;\n	for (var i=startIndex; i&lt;theList.options.length; i++)\n		{\n		// if list item is not selected or is a heading (i.e., has no value), skip it\n		if ((!theList.options[i].selected) || ((t=theList.options[i].value)==&quot;&quot;))\n			continue;\n		for (var j=0;j&lt;config.macros.importTiddlers.inbound.length;j++)\n			if (config.macros.importTiddlers.inbound[j].title==t) break;\n		var inbound = config.macros.importTiddlers.inbound[j];\n		var theExisting = store.getTiddler(inbound.title);\n		// avoid redundant import for tiddlers that are listed multiple times (when 'by tags')\n		if (inbound.status==&quot;added&quot;)\n			continue;\n		// don't import the &quot;ImportedTiddlers&quot; history from the other document...\n		if (inbound.title=='ImportedTiddlers')\n			continue;\n		// if tiddler exists and import not marked for replace or merge, stop importing\n		if (theExisting &amp;&amp; (inbound.status.substr(0,7)!=&quot;replace&quot;) &amp;&amp; (inbound.status.substr(0,5)!=&quot;merge&quot;))\n			return i;\n		// assemble tags (remote + existing + added)\n		var newTags = &quot;&quot;;\n		if (config.macros.importTiddlers.importTags)\n			newTags+=inbound.getTags()	// import remote tags\n		if (config.macros.importTiddlers.keepTags &amp;&amp; theExisting)\n			newTags+=&quot; &quot;+theExisting.getTags(); // keep existing tags\n		if (config.macros.importTiddlers.addTags &amp;&amp; config.macros.importTiddlers.newTags.trim().length)\n			newTags+=&quot; &quot;+config.macros.importTiddlers.newTags; // add new tags\n		inbound.set(null,null,null,null,newTags.trim());\n		// set the status to 'added' (if not already set by the 'ask the user' UI)\n		inbound.status=(inbound.status==&quot;&quot;)?'added':inbound.status;\n		// do the import!\n                // OLD: store.addTiddler(in); store.setDirty(true);\n		store.saveTiddler(inbound.title, inbound.title, inbound.text, inbound.modifier, inbound.modified, inbound.tags);\n                store.fetchTiddler(inbound.title).created = inbound.created; // force creation date to imported value\n		}\n	return(-1);	// signals that we really finished the entire list\n}\n//}}}\n\n//{{{\nfunction importStopped()\n{\n	var theList     = document.getElementById('importList');\n	var theNewTitle = document.getElementById('importNewTitle');\n	if (!theList) return;\n	if (config.macros.importTiddlers.index==-1)\n		importReport();		// import finished... generate the report\n	else\n		{\n		// DEBUG alert('import stopped at: '+config.macros.importTiddlers.index);\n		// import collision... show the collision panel and set the title edit field\n		document.getElementById('importCollisionPanel').style.display='block';\n		theNewTitle.value=theList.options[config.macros.importTiddlers.index].value;\n		}\n}\n//}}}\n\n// // ''REPORT GENERATOR''\n//{{{\nfunction importReport(quiet)\n{\n	if (!config.macros.importTiddlers.inbound) return;\n	// DEBUG alert('importReport: start');\n\n	// if import was not completed, the collision panel will still be open... close it now.\n	var panel=document.getElementById('importCollisionPanel'); if (panel) panel.style.display='none';\n\n	// get the alphasorted list of tiddlers\n	var tiddlers = config.macros.importTiddlers.inbound;\n	// gather the statistics\n	var count=0;\n	for (var t=0; t&lt;tiddlers.length; t++)\n		if (tiddlers[t].status &amp;&amp; tiddlers[t].status.trim().length &amp;&amp; tiddlers[t].status.substr(0,7)!=&quot;skipped&quot;) count++;\n\n	// generate a report\n	if (count &amp;&amp; config.options.chkImportReport) {\n		// get/create the report tiddler\n		var theReport = store.getTiddler('ImportedTiddlers');\n		if (!theReport) { theReport= new Tiddler(); theReport.title = 'ImportedTiddlers'; theReport.text  = &quot;&quot;; }\n		// format the report content\n		var now = new Date();\n		var newText = &quot;On &quot;+now.toLocaleString()+&quot;, &quot;+config.options.txtUserName\n		newText +=&quot; imported &quot;+count+&quot; tiddler&quot;+(count==1?&quot;&quot;:&quot;s&quot;)+&quot; from\sn[[&quot;+config.macros.importTiddlers.src+&quot;|&quot;+config.macros.importTiddlers.src+&quot;]]:\sn&quot;;\n		if (config.macros.importTiddlers.addTags &amp;&amp; config.macros.importTiddlers.newTags.trim().length)\n			newText += &quot;imported tiddlers were tagged with: \s&quot;&quot;+config.macros.importTiddlers.newTags+&quot;\s&quot;\sn&quot;;\n		newText += &quot;&lt;&lt;&lt;\sn&quot;;\n		for (var t=0; t&lt;tiddlers.length; t++) if (tiddlers[t].status) newText += &quot;#[[&quot;+tiddlers[t].title+&quot;]] - &quot;+tiddlers[t].status+&quot;\sn&quot;;\n		newText += &quot;&lt;&lt;&lt;\sn&quot;;\n// 20060918 ELS: DON'T ADD &quot;discard&quot; BUTTON TO REPORT\n//		newText += &quot;&lt;html&gt;&lt;input type=\s&quot;button\s&quot; href=\s&quot;javascript:;\s&quot; &quot;;\n//		newText += &quot;onclick=\s&quot;story.closeTiddler('&quot;+theReport.title+&quot;'); store.deleteTiddler('&quot;+theReport.title+&quot;');\s&quot; &quot;;\n//		newText += &quot;value=\s&quot;discard report\s&quot;&gt;&lt;/html&gt;&quot;;\n		// update the ImportedTiddlers content and show the tiddler\n		theReport.text	 = newText+((theReport.text!=&quot;&quot;)?'\sn----\sn':&quot;&quot;)+theReport.text;\n		theReport.modifier = config.options.txtUserName;\n		theReport.modified = new Date();\n		// OLD: store.addTiddler(theReport);\n                store.saveTiddler(theReport.title, theReport.title, theReport.text, theReport.modifier, theReport.modified, theReport.tags);\n		if (!quiet) { story.displayTiddler(null,theReport.title,1,null,null,false); story.refreshTiddler(theReport.title,1,true); }\n	}\n\n	// reset status flags\n	for (var t=0; t&lt;config.macros.importTiddlers.inbound.length; t++) config.macros.importTiddlers.inbound[t].status=&quot;&quot;;\n\n	// refresh display if tiddlers have been loaded\n	if (count) { store.setDirty(true);  store.notifyAll(); }\n\n	// always show final message when tiddlers were actually loaded\n	if (count) displayMessage(config.macros.importTiddlers.importedMsg.format([count,tiddlers.length,config.macros.importTiddlers.src]));\n}\n//}}}\n\n/***\n!!!!! non-interactive 'load tiddlers' macro\n***/\n//{{{\n// default cookie/option values\nif (!config.options.chkImportReport) config.options.chkImportReport=true;\n\nconfig.macros.loadTiddlers = {\n	label: &quot;&quot;,\n	prompt: &quot;add/update tiddlers from '%0'&quot;,\n	askMsg: &quot;Please enter a local path/filename or a remote URL&quot;,\n	openMsg: &quot;Opening %0&quot;,\n	openErrMsg: &quot;Could not open %0 - error=%1&quot;,\n	readMsg: &quot;Read %0 bytes from %1&quot;,\n	foundMsg: &quot;Found %0 tiddlers in %1&quot;,\n	nochangeMsg: &quot;'%0' is up-to-date... skipped.&quot;,\n	loadedMsg: &quot;Loaded %0 of %1 tiddlers from %2&quot;\n};\n\nconfig.macros.loadTiddlers.handler = function(place,macroName,params) {\n	var label=(params[0] &amp;&amp; params[0].substr(0,6)=='label:')?params.shift().substr(6):this.label;\n	var prompt=(params[0] &amp;&amp; params[0].substr(0,7)=='prompt:')?params.shift().substr(7):this.prompt;\n	var filter=&quot;updates&quot;;\n	if (params[0] &amp;&amp; (params[0]=='all' || params[0]=='new' || params[0]=='changes' || params[0]=='updates'\n		|| params[0].substr(0,8)=='tiddler:' || params[0].substr(0,4)=='tag:'))\n		filter=params.shift();\n	var src=params.shift(); if (!src || !src.length) return; // filename is required\n	var quiet=(params[0]==&quot;quiet&quot;); if (quiet) params.shift();\n	var ask=(params[0]==&quot;confirm&quot;); if (ask) params.shift();\n	var force=(params[0]==&quot;force&quot;); if (force) params.shift();\n	if (label.trim().length) {\n		// link triggers load tiddlers from another file/URL and then applies filtering rules to add/replace tiddlers in the store\n		createTiddlyButton(place,label.format([src]),prompt.format([src]), function() {\n			if (src==&quot;ask&quot;) src=prompt(config.macros.loadTiddlers.askMsg);\n			config.macros.importTiddlers.loadRemoteFile(src,loadTiddlers,quiet,ask,filter,force);\n		})\n	}\n	else {\n		// load tiddlers from another file/URL and then apply filtering rules to add/replace tiddlers in the store\n		if (src==&quot;ask&quot;) src=prompt(config.macros.loadTiddlers.askMsg);\n		config.macros.importTiddlers.loadRemoteFile(src,loadTiddlers,quiet,ask,filter,force);\n	}\n}\n\nfunction loadTiddlers(src,html,quiet,ask,filter,force)\n{\n	var tiddlers = readTiddlersFromHTML(html);\n	var count=tiddlers?tiddlers.length:0;\n	if (!quiet) displayMessage(config.macros.loadTiddlers.foundMsg.format([count,src]));\n	var count=0;\n	if (tiddlers) for (var t=0;t&lt;tiddlers.length;t++) {\n		var inbound = tiddlers[t];\n		var theExisting = store.getTiddler(inbound.title);\n		if (inbound.title=='ImportedTiddlers')\n			continue; // skip &quot;ImportedTiddlers&quot; history from the other document...\n\n		// apply the all/new/changes/updates filter (if any)\n		if (filter &amp;&amp; filter!=&quot;all&quot;) {\n			if ((filter==&quot;new&quot;) &amp;&amp; theExisting) // skip existing tiddlers\n				continue;\n			if ((filter==&quot;changes&quot;) &amp;&amp; !theExisting) // skip new tiddlers\n				continue;\n			if ((filter.substr(0,4)==&quot;tag:&quot;) &amp;&amp; inbound.tags.find(filter.substr(4))==null) // must match specific tag value\n				continue;\n			if ((filter.substr(0,8)==&quot;tiddler:&quot;) &amp;&amp; inbound.title!=filter.substr(8)) // must match specific tiddler name\n				continue;\n			if (!force &amp;&amp; store.tiddlerExists(inbound.title) &amp;&amp; ((theExisting.modified.getTime()-inbound.modified.getTime())&gt;=0))\n				{ if (!quiet) displayMessage(config.macros.loadTiddlers.nochangeMsg.format([inbound.title])); continue; }\n		}\n		// get confirmation if required\n		if (ask &amp;&amp; !confirm((theExisting?&quot;Update&quot;:&quot;Add&quot;)+&quot; tiddler '&quot;+inbound.title+&quot;'\snfrom &quot;+src))\n			{ tiddlers[t].status=&quot;skipped - cancelled by user&quot;; continue; }\n		// DO IT!\n		// OLD: store.addTiddler(in);\n                store.saveTiddler(inbound.title, inbound.title, inbound.text, inbound.modifier, inbound.modified, inbound.tags);\n                store.fetchTiddler(inbound.title).created = inbound.created; // force creation date to imported value\n		tiddlers[t].status=theExisting?&quot;updated&quot;:&quot;added&quot;\n		count++;\n	}\n	if (count) {\n		// refresh display\n		store.setDirty(true);\n		store.notifyAll();\n		// generate a report\n		if (config.options.chkImportReport) {\n			// get/create the report tiddler\n			var theReport = store.getTiddler('ImportedTiddlers');\n			if (!theReport) { theReport= new Tiddler(); theReport.title = 'ImportedTiddlers'; theReport.text  = &quot;&quot;; }\n			// format the report content\n			var now = new Date();\n			var newText = &quot;On &quot;+now.toLocaleString()+&quot;, &quot;+config.options.txtUserName+&quot; loaded &quot;+count+&quot; tiddlers from\sn[[&quot;+src+&quot;|&quot;+src+&quot;]]:\sn&quot;;\n			newText += &quot;&lt;&lt;&lt;\sn&quot;;\n			for (var t=0; t&lt;tiddlers.length; t++) if (tiddlers[t].status) newText += &quot;#[[&quot;+tiddlers[t].title+&quot;]] - &quot;+tiddlers[t].status+&quot;\sn&quot;;\n			newText += &quot;&lt;&lt;&lt;\sn&quot;;\n// 20060918 ELS: DON'T ADD &quot;discard&quot; BUTTON TO REPORT\n//			newText += &quot;&lt;html&gt;&lt;input type=\s&quot;button\s&quot; href=\s&quot;javascript:;\s&quot; &quot;;\n//			newText += &quot;onclick=\s&quot;story.closeTiddler('&quot;+theReport.title+&quot;'); store.deleteTiddler('&quot;+theReport.title+&quot;');\s&quot; &quot;;\n//			newText += &quot;value=\s&quot;discard report\s&quot;&gt;&lt;/html&gt;&quot;;\n			// update the ImportedTiddlers content and show the tiddler\n			theReport.text	 = newText+((theReport.text!=&quot;&quot;)?'\sn----\sn':&quot;&quot;)+theReport.text;\n			theReport.modifier = config.options.txtUserName;\n			theReport.modified = new Date();\n			// OLD: store.addTiddler(theReport);\n                        store.saveTiddler(theReport.title, theReport.title, theReport.text, theReport.modifier, theReport.modified, theReport.tags);\n			if (!quiet) { story.displayTiddler(null,theReport.title,1,null,null,false); story.refreshTiddler(theReport.title,1,true); }\n		}\n	}\n	// always show final message when tiddlers were actually loaded\n	if (!quiet||count) displayMessage(config.macros.loadTiddlers.loadedMsg.format([count,tiddlers.length,src]));\n}\n\n// replaces existing core function\n\nconfig.macros.importTiddlers.loadRemoteFile = function(src,callback,quiet,ask,filter,force) {\n	if (src==undefined || !src.length) return null; // filename is required\n	if (!quiet) clearMessage();\n	if (!quiet) displayMessage(config.macros.loadTiddlers.openMsg.format([src]));\n	if (src.substr(0,4)!=&quot;http&quot; &amp;&amp; src.substr(0,4)!=&quot;file&quot;) { // if not a URL, fallback to read from local filesystem\n		var txt=loadFile(src);\n		if ((txt==null)||(txt==false)) // file didn't load\n			{ if (!quiet) displayMessage(config.macros.loadTiddlers.openErrMsg.format([src,&quot;(unknown)&quot;])); }\n		else {\n			if (!quiet) displayMessage(config.macros.loadTiddlers.readMsg.format([txt.length,src]));\n			if (callback) callback(src,convertUTF8ToUnicode(txt),quiet,ask,filter,force);\n		}\n	}\n	else {\n		var x; // get an request object\n		try {x = new XMLHttpRequest()} // moz\n		catch(e) {\n			try {x = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;)} // IE 6\n			catch (e) {\n				try {x = new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;)} // IE 5\n				catch (e) { return }\n			}\n		}\n		// setup callback function to handle server response(s)\n		x.onreadystatechange = function() {\n			if (x.readyState == 4) {\n				if (x.status==0 || x.status == 200) {\n					if (!quiet) displayMessage(config.macros.loadTiddlers.readMsg.format([x.responseText.length,src]));\n					if (callback) callback(src,x.responseText,quiet,ask,filter,force);\n				}\n				else {\n					if (!quiet) displayMessage(config.macros.loadTiddlers.openErrMsg.format([src,x.status]));\n				}\n			}\n		}\n		// get privileges to read another document's DOM via http:// or file:// (moz-only)\n		if (typeof(netscape)!=&quot;undefined&quot;) {\n			try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;); }\n			catch (e) { if (!quiet) displayMessage(e.description?e.description:e.toString()); }\n		}\n		// send the HTTP request\n		try {\n			var url=src+(src.indexOf('?')&lt;0?'?':'&amp;')+'nocache='+Math.random();\n			x.open(&quot;GET&quot;,src,true);\n			if (x.overrideMimeType) x.overrideMimeType('text/html');\n			x.send(null);\n		}\n		catch (e) {\n			if (!quiet) {\n				displayMessage(config.macros.loadTiddlers.openErrMsg.format([src,&quot;(unknown)&quot;]));\n				displayMessage(e.description?e.description:e.toString());\n			}\n		}\n	}\n}\n\nfunction readTiddlersFromHTML(html)\n{\n	// extract store area from html \n	var start=html.indexOf('&lt;div id=&quot;storeArea&quot;&gt;');\n	var end=html.indexOf(&quot;&lt;!--POST-BODY-START--&quot;+&quot;&gt;&quot;,start);\n	if (end==-1) var end=html.indexOf(&quot;&lt;/body&quot;+&quot;&gt;&quot;,start); // backward-compatibility for older documents\n	var sa=&quot;&lt;html&gt;&lt;body&gt;&quot;+html.substring(start,end)+&quot;&lt;/body&gt;&lt;/html&gt;&quot;;\n\n	// load html into iframe document\n	var f=document.getElementById(&quot;loaderFrame&quot;); if (f) document.body.removeChild(f);\n	f=document.createElement(&quot;iframe&quot;); f.id=&quot;loaderFrame&quot;;\n	f.style.width=&quot;0px&quot;; f.style.height=&quot;0px&quot;; f.style.border=&quot;0px&quot;;\n	document.body.appendChild(f);\n	var d=f.document;\n	if (f.contentDocument) d=f.contentDocument; // For NS6\n	else if (f.contentWindow) d=f.contentWindow.document; // For IE5.5 and IE6\n	d.open(); d.writeln(sa); d.close();\n\n	// read tiddler DIVs from storeArea DOM element	\n	var sa = d.getElementById(&quot;storeArea&quot;);\n	if (!sa) return null;\n	sa.normalize();\n	var nodes = sa.childNodes;\n	if (!nodes || !nodes.length) return null;\n	var tiddlers = [];\n	for(var t = 0; t &lt; nodes.length; t++) {\n		var title = null;\n		if(nodes[t].getAttribute)\n			title = nodes[t].getAttribute(&quot;tiddler&quot;);\n		if(!title &amp;&amp; nodes[t].id &amp;&amp; (nodes[t].id.substr(0,5) == &quot;store&quot;))\n			title = nodes[t].id.substr(5);\n		if(title &amp;&amp; title != &quot;&quot;)\n			tiddlers.push((new Tiddler()).loadFromDiv(nodes[t],title));\n	}\n	return tiddlers;\n}\n//}}}</div>
<div tiddler="InlineJavascriptPlugin" modifier="YourName" modified="200611091958" created="200611091958" tags="systemConfig excludeLists">/***\n''InlineJavascriptPlugin for ~TiddlyWiki version 1.2.x and 2.0''\n^^author: Eric Shulman - ELS Design Studios\nsource: http://www.TiddlyTools.com/#InlineJavascriptPlugin\nlicense: [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]^^\n\nInsert Javascript executable code directly into your tiddler content.  Lets you ''call directly into TW core utility routines, define new functions, calculate values, add dynamically-generated TiddlyWiki-formatted output'' into tiddler content, or perform any other programmatic actions each time the tiddler is rendered.\n!!!!!Usage\n&lt;&lt;&lt;\nWhen installed, this plugin adds new wiki syntax for surrounding tiddler content with {{{&lt;script&gt;}}} and {{{&lt;/script&gt;}}} markers, so that it can be treated as embedded javascript and executed each time the tiddler is rendered.\n\n''Deferred execution from an 'onClick' link''\nBy including a label=&quot;...&quot; parameter in the initial {{{&lt;script&gt;}}} marker, the plugin will create a link to an 'onclick' script that will only be executed when that specific link is clicked, rather than running the script each time the tiddler is rendered.\n\n''External script source files:''\nYou can also load javascript from an external source URL, by including a src=&quot;...&quot; parameter in the initial {{{&lt;script&gt;}}} marker (e.g., {{{&lt;script src=&quot;demo.js&quot;&gt;&lt;/script&gt;}}}).  This is particularly useful when incorporating third-party javascript libraries for use in custom extensions and plugins.  The 'foreign' javascript code remains isolated in a separate file that can be easily replaced whenever an updated library file becomes available.\n\n''Defining javascript functions and libraries:''\nAlthough the external javascript file is loaded while the tiddler content is being rendered, any functions it defines will not be available for use until //after// the rendering has been completed.  Thus, you cannot load a library and //immediately// use it's functions within the same tiddler.  However, once that tiddler has been loaded, the library functions can be freely used in any tiddler (even the one in which it was initially loaded).\n\nTo ensure that your javascript functions are always available when needed, you should load the libraries from a tiddler that will be rendered as soon as your TiddlyWiki document is opened.  For example, you could put your {{{&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;}}} syntax into a tiddler called LoadScripts, and then add {{{&lt;&lt;tiddler LoadScripts&gt;&gt;}}} in your MainMenu tiddler.\n\nSince the MainMenu is always rendered immediately upon opening your document, the library will always be loaded before any other tiddlers that rely upon the functions it defines.  Loading an external javascript library does not produce any direct output in the tiddler, so these definitions should have no impact on the appearance of your MainMenu.\n\n''Creating dynamic tiddler content''\nAn important difference between this implementation of embedded scripting and conventional embedded javascript techniques for web pages is the method used to produce output that is dynamically inserted into the document:\n* In a typical web document, you use the document.write() function to output text sequences (often containing HTML tags) that are then rendered when the entire document is first loaded into the browser window.\n* However, in a ~TiddlyWiki document, tiddlers (and other DOM elements) are created, deleted, and rendered &quot;on-the-fly&quot;, so writing directly to the global 'document' object does not produce the results you want (i.e., replacing the embedded script within the tiddler content), and completely replaces the entire ~TiddlyWiki document in your browser window.\n* To allow these scripts to work unmodified, the plugin automatically converts all occurences of document.write() so that the output is inserted into the tiddler content instead of replacing the entire ~TiddlyWiki document.\n\nIf your script does not use document.write() to create dynamically embedded content within a tiddler, your javascript can, as an alternative, explicitly return a text value that the plugin can then pass through the wikify() rendering engine to insert into the tiddler display.  For example, using {{{return &quot;thistext&quot;}}} will produce the same output as {{{document.write(&quot;thistext&quot;)}}}.\n\n//Note: your script code is automatically 'wrapped' inside a function, {{{_out()}}}, so that any return value you provide can be correctly handled by the plugin and inserted into the tiddler.  To avoid unpredictable results (and possibly fatal execution errors), this function should never be redefined or called from ''within'' your script code.//\n\n''Accessing the ~TiddlyWiki DOM''\nThe plugin provides one pre-defined variable, 'place', that is passed in to your javascript code so that it can have direct access to the containing DOM element into which the tiddler output is currently being rendered.\n\nAccess to this DOM element allows you to create scripts that can:\n* vary their actions based upon the specific location in which they are embedded\n* access 'tiddler-relative' information (use findContainingTiddler(place))\n* perform direct DOM manipulations (when returning wikified text is not enough)\n&lt;&lt;&lt;\n!!!!!Examples\n&lt;&lt;&lt;\nan &quot;alert&quot; message box:\n{{{\n&lt;script&gt;alert('InlineJavascriptPlugin: this is a demonstration message');&lt;/script&gt;\n}}}\n&lt;script&gt;alert('InlineJavascriptPlugin: this is a demonstration message');&lt;/script&gt;\n\ndynamic output:\n{{{\n&lt;script&gt;return (new Date()).toString();&lt;/script&gt;\n}}}\n&lt;script&gt;return (new Date()).toString();&lt;/script&gt;\n\nwikified dynamic output:\n{{{\n&lt;script&gt;return &quot;link to current user: [[&quot;+config.options.txtUserName+&quot;]]&quot;;&lt;/script&gt;\n}}}\n&lt;script&gt;return &quot;link to current user: [[&quot;+config.options.txtUserName+&quot;]]&quot;;&lt;/script&gt;\n\ndynamic output using 'place' to get size information for current tiddler\n{{{\n&lt;script&gt;\n   if (!window.story) window.story=window;\n   var title=story.findContainingTiddler(place).id.substr(7);\n   return title+&quot; is using &quot;+store.getTiddlerText(title).length+&quot; bytes&quot;;\n&lt;/script&gt;\n}}}\n&lt;script&gt;\n   if (!window.story) window.story=window;\n   var title=story.findContainingTiddler(place).id.substr(7);\n   return title+&quot; is using &quot;+store.getTiddlerText(title).length+&quot; bytes&quot;;\n&lt;/script&gt;\n\ncreating an 'onclick' button/link that runs a script\n{{{\n&lt;script label=&quot;click here&quot;&gt;\n   if (!window.story) window.story=window;\n   alert(&quot;Hello World!\snlinktext='&quot;+place.firstChild.data+&quot;'\sntiddler='&quot;+story.findContainingTiddler(place).id.substr(7)+&quot;'&quot;);\n&lt;/script&gt;\n}}}\n&lt;script label=&quot;click here&quot;&gt;\n   if (!window.story) window.story=window;\n   alert(&quot;Hello World!\snlinktext='&quot;+place.firstChild.data+&quot;'\sntiddler='&quot;+story.findContainingTiddler(place).id.substr(7)+&quot;'&quot;);\n&lt;/script&gt;\n\nloading a script from a source url\n{{{\n&lt;script src=&quot;demo.js&quot;&gt;return &quot;loading demo.js...&quot;&lt;/script&gt;\n&lt;script label=&quot;click to execute demo() function&quot;&gt;demo()&lt;/script&gt;\n}}}\nwhere http://www.TiddlyTools.com/demo.js contains:\n&gt;function demo() { alert('this output is from demo(), defined in demo.js') }\n&gt;alert('InlineJavascriptPlugin: demo.js has been loaded');\n&lt;script src=&quot;demo.js&quot;&gt;return &quot;loading demo.js...&quot;&lt;/script&gt;\n&lt;script label=&quot;click to execute demo() function&quot;&gt;demo()&lt;/script&gt;\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\nimport (or copy/paste) the following tiddlers into your document:\n''InlineJavascriptPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.01.05 [1.4.0]''\nadded support 'onclick' scripts.  When label=&quot;...&quot; param is present, a button/link is created using the indicated label text, and the script is only executed when the button/link is clicked.  'place' value is set to match the clicked button/link element.\n''2005.12.13 [1.3.1]''\nwhen catching eval error in IE, e.description contains the error text, instead of e.toString().  Fixed error reporting so IE shows the correct response text.  Based on a suggestion by UdoBorkowski\n''2005.11.09 [1.3.0]''\nfor 'inline' scripts (i.e., not scripts loaded with src=&quot;...&quot;), automatically replace calls to 'document.write()' with 'place.innerHTML+=' so script output is directed into tiddler content\nBased on a suggestion by BradleyMeck\n''2005.11.08 [1.2.0]''\nhandle loading of javascript from an external URL via src=&quot;...&quot; syntax\n''2005.11.08 [1.1.0]''\npass 'place' param into scripts to provide direct DOM access \n''2005.11.08 [1.0.0]''\ninitial release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]]\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.inlineJavascript= {major: 1, minor: 4, revision: 0, date: new Date(2006,1,5)};\n\nconfig.formatters.push( {\n	name: &quot;inlineJavascript&quot;,\n	match: &quot;\s\s&lt;script&quot;,\n	lookahead: &quot;\s\s&lt;script(?: src=\s\s\s&quot;((?:.|\s\sn)*?)\s\s\s&quot;)?(?: label=\s\s\s&quot;((?:.|\s\sn)*?)\s\s\s&quot;)?\s\s&gt;((?:.|\s\sn)*?)\s\s&lt;/script\s\s&gt;&quot;,\n\n	handler: function(w) {\n		var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n		lookaheadRegExp.lastIndex = w.matchStart;\n		var lookaheadMatch = lookaheadRegExp.exec(w.source)\n		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {\n			if (lookaheadMatch[1]) { // load a script library\n				// make script tag, set src, add to body to execute, then remove for cleanup\n				var script = document.createElement(&quot;script&quot;); script.src = lookaheadMatch[1];\n				document.body.appendChild(script); document.body.removeChild(script);\n			}\n			if (lookaheadMatch[2] &amp;&amp; lookaheadMatch[3]) { // create a link to an 'onclick' script\n				// add a link, define click handler, save code in link (pass 'place'), set link attributes\n				var link=createTiddlyElement(w.output,&quot;a&quot;,null,&quot;tiddlyLinkExisting&quot;,lookaheadMatch[2]);\n				link.onclick=function(){try{return(eval(this.code))}catch(e){alert(e.description?e.description:e.toString())}}\n				link.code=&quot;function _out(place){&quot;+lookaheadMatch[3]+&quot;};_out(this);&quot;\n				link.setAttribute(&quot;href&quot;,&quot;javascript:;&quot;); link.setAttribute(&quot;title&quot;,&quot;&quot;); link.style.cursor=&quot;pointer&quot;;\n			}\n			else if (lookaheadMatch[3]) { // run inline script code\n				var code=&quot;function _out(place){&quot;+lookaheadMatch[3]+&quot;};_out(w.output);&quot;\n				code=code.replace(/document.write\s(/gi,'place.innerHTML+=(');\n				try { var out = eval(code); } catch(e) { out = e.description?e.description:e.toString(); }\n				if (out &amp;&amp; out.length) wikify(out,w.output);\n			}\n			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n		}\n	}\n} )\n//}}}\n</div>
<div tiddler="Innovating e-Learning 2007" modifier="ChrisJobling" modified="200706060926" created="200706060918" tags="e-learning conference">! Theme 1: Instutional Transformation\n!! Keynote 1\n* [[Goundhog day again]]\n\n\nAll papers in F:\sDocuments\sresearch\sLearning Technology\sInnovating e-Learning 2007.</div>
<div tiddler="Install package build tools" modifier="ChrisJobling" modified="200708241158" created="200708241158" tags="linux tips build">Install the basic tools required for building binary packages:\n{{{\n$ sudo apt-get install devscripts build-essential fakeroot\n}}}\n\n[Source [[Ubuntu Hacks, #63|http://safari.oreilly.com/0596527209/I-0596527209-CHP-6-SECT-10#ID-ID-d2599e0-976405]]]\n</div>
<div tiddler="LegacyStrikeThroughPlugin" modifier="YourName" modified="200611092001" created="200609160342" tags="systemConfig excludeLists">/***\n|''Name:''|LegacyStrikeThroughPlugin|\n|''Description:''|Support for  legacy (pre 2.1) strike through formatting|\n|''Version:''|1.0.1|\n|''Date:''|Jul 21, 2006|\n|''Source:''|http://www.tiddlywiki.com/#LegacyStrikeThroughPlugin|\n|''Author:''|MartinBudden (mjbudden (at) gmail (dot) com)|\n|''License:''|[[BSD open source license]]|\n|''CoreVersion:''|2.1.0|\n|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|\n\n***/\n\n//{{{\n\n// Ensure that the LegacyStrikeThrough Plugin is only installed once.\nif(!version.extensions.LegacyStrikeThroughPlugin)\n	{\n	version.extensions.LegacyStrikeThroughPlugin = true;\n\nconfig.formatters.push(\n{\n	name: &quot;legacyStrikeByChar&quot;,\n	match: &quot;==&quot;,\n	termRegExp: /(==)/mg,\n	element: &quot;strike&quot;,\n	handler: config.formatterHelpers.createElementAndWikify\n});\n\n} // end of &quot;install only once&quot;\n//}}}\n</div>
<div tiddler="Lesson Plans" modifier="ChrisJobling" modified="200705291310" created="200705291119" tags="">! Lecture 1: Module Introduction\n* Introduce topics to be covered.\n* Revision of EG-146: HTTP, URLs, Web Content -- Client side: XHTML/CSS/JavaScript; Server side: CGI. \n* Discuss the Architecture of Web Applications.\n* Introduce the programming to be covered: XML/HTML/CSS/JavaScript/Perl (or Python or Ruby), PHP, SQL. Mention AJAX.\n* Installing the basic tool kit (off-line Screen cast maybe)\n* The Apache Web Server\n* Configuring XAMPP (off-line homework)\n! Lecture 2: Content Management Systems\n* Survey of Bloggers, Wikis, BB, CMS\n* The LAMP plaform\n** Prominence of Linux/Apache/Perl|Python|PHP/MySQL in this space\n* Installing a basic CMS framework (details off-line)\n** phpMySQL\n** Drupal CMS\n** WordPress blogger\n** MediaWiki or DokuWiki wiki\n** phpBB\n* Homework add these features to your system.\n! Lecture 3: Revision of HTML and CSS\n* Preparation: read [[WordPress Theme Guide|http://urbangiraffe.com/themes/guides/|]]\n* CSS for layout ...\n! Lecture 4: The Architecture of Web Applications\n* A lecture on [[Representational State Transfer (REST)]] [new stuff]\n\n! Introducing JavaScript\n* Three or four lectures\n\n! Regular Expressions\n* For validation\n\n! XForms\n* Video [[HTML Forms Next Generation|http://video.google.co.uk/videoplay?docid=-6347740793556865808]] by Dave Raggett at Google March 5, 2007.\n* Advanced widgets for the web\n* Illustrated with Dave Raggett's [[http://www.w3.org/2007/03/html-forms|presentation]]\n\n! CGI Programming\n* 3 lectures\n\n! PHP Programming\n* 3 or 4 lectures\n\n! Databases\n* 2 lectures\n! Web Application Frameworks\n* Probably Ruby on Rails\n\n! Case Studies\n* WordPress\n* Drupal\n* MediaWiki/DokuWiki\n\n! Web Services(?)\n\n! Lecture 22: Module Review and Revision Guide\n\n!</div>
<div tiddler="Linux Tips" modifier="ChrisJobling" modified="200708241157" created="200708241157" tags="linux tips">* [[Install package build tools]]</div>
<div tiddler="MainMenu" modifier="ChrisJobling" modified="200704301852" created="200604281508" tags="">GettingStarted\n[[WhatsNew]]\n[[ICCT Program]]\n[[Administration]]\n[[Teaching]]\n[[Research]]\n[[Presentations]]\n[[Notes&amp;Queries]]\nToDo</div>
<div tiddler="MarkupPreHead" modifier="YourName" modified="200706151542" created="200611090514" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml'/&gt;\n&lt;!--}}}--&gt;\n\n&lt;style type=&quot;text/css&quot;&gt;#contentWrapper {display:none;}&lt;/style&gt;&lt;div id=&quot;SplashScreen&quot; style=&quot;border: 3px solid #ccc; display: block; text-align: center; width: 320px; margin: 100px auto; padding: 50px; color:#000; font-size: 28px; font-family:Tahoma; background-color:#eee;&quot;&gt;&lt;b&gt;CrispyNotes&lt;/b&gt; is loading&lt;blink&gt; ...&lt;/blink&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-size: 14px; color:red;&quot;&gt;Requires Javascript.&lt;/span&gt;&lt;/div&gt;</div>
<div tiddler="MonkeyTagger" modifier="YourName" modified="200611091947" created="200611091941" tags="systemConfig excludeLists">/***\n| Name:|''monkeyTagger''|\n| Created by:|SaqImtiaz|\n| Location:|http://lewcid.googlepages.com/lewcid.html|\n| Version:|0.9 (08-Apr-2006)|\n| Requires:|~TW2.07|\n\n!About:\n*an adaptation of TagAdderMacro for monkeyGTD and tagglytagging user, but could be useful to just about anyone!\n*{{{&lt;&lt;monkeyTagger Project&gt;&gt;}}} gives a drop down list of all tags, tagged with Project.\n*The list allows toggling of tags on the current tiddler.\n*logging options for task management.\n\n!Demo:\n&lt;&lt;monkeyTagger Status&gt;&gt;\n\n!Installation:\n*Copy this tiddler to your TW with the systemConfig tag\n*either copy the following to your ViewTemplate:\n{{{&lt;div class='tagged' macro='monkeyTagger tagToTrack'&gt;&lt;/div&gt;}}}\nor\n*better yet, define your own toolbar class and add as many as you need to create a nice toolbar.\nEg:\n{{{&lt;div class='toolbar' &gt;\n&lt;span style=&quot;padding-right:0.15em;&quot; macro='monkeyTagger Project'&gt;&lt;/span&gt;\n&lt;span style=&quot;padding-right:0.15em;&quot; macro='monkeyTagger Status'&gt;&lt;/span&gt;\n&lt;span macro='toolbar -closeTiddler closeOthers +editTiddler permalink references jump'&gt;&lt;/span&gt;\n&lt;/div&gt;}}}\n (adjust padding to taste)\n\n!Usage:\n\n''Syntax:''\n|&gt;|{{{&lt;&lt;monkeyTagger source:&quot;sourcetag&quot; label:&quot;customlabel&quot; logging:&quot;true/false&quot; anchor:&quot;anchortext&quot;  arrow:&quot;true/false&quot;&gt;&gt;}}}|\n|label:|quoted text to use as a customlabel|\n|arrow:|add arrow to custom label, values are &quot;true&quot; or &quot;false&quot;|\n|anchor:|quoted text to specify where to add logging text|\n|logging:|enable logging of tags added (for task management), values are &quot;true&quot; or &quot;false&quot;|\n\nthe only parameter you ''have'' to pass is the source. When passing only one parameter, you can write either something like:\n{{{&lt;&lt;monkeyTagger &quot;Project&quot;&gt;&gt;}}} or {{{&lt;&lt;monkeyTagger source:&quot;Project&quot;&gt;&gt;}}} for &lt;&lt;monkeyTagger Project&gt;&gt;\nAll other parameters are optional, and can be written in any order.\n\n''Defaults:''\n|label:|default label if not specified = source tag + arrow|\n|arrow:|true |\n|logging:|false |\n|anchor:|none used by default, logging text added to end of tiddler |\n\n''Examples:''\n|custom label| {{{&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot;&gt;&gt;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot;&gt;&gt;|\n|custom label without arrow| {{{&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot; arrow:&quot;false&quot;&gt;&gt;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot; arrow:&quot;false&quot;&gt;&gt;|\n|logging enabled| {{{&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot;&gt;&gt;|\n|logging enabled with anchor text|{{{&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot; anchor:&quot;anchortext&quot;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot; anchor:&quot;anchortext&quot;&gt;&gt;|\n\n''Tips:''\n*Make sure your anchor text doesn't occur more than once in every tiddler, as the first instance will be used.\n*I recommend using something like {{{/%StatusLog%/}}} as an invisible anchor.\n*Use a tag based template, and add monkeyTagger macro's with logging enabled to the toolbar in just your taskmanagement templates.\n\n!To Do:\n*add sorting options if requested.\n*''add exclude tag feature''!\n\n!History\n*Version 0.9: \n**changed to named parameters to make it more user friendly\n**added option to disable/enable dropdown arrow in custom labels\n**added logging option with anchor text.\n\n!CODE\n***/\n//{{{\n\nconfig.macros.monkeyTagger= {};\n//config.macros.monkeyTagger.dropdownchar = (document.all?&quot;â¼&quot;:&quot;â¾&quot;); // the fat one is the only one that works in IE\nconfig.macros.monkeyTagger.dropdownchar = &quot;â¼&quot;; // uncomment previous line and comment this for smaller version in FF\nconfig.macros.monkeyTagger.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n{\n var nAV = paramString.parseParams('test', null, true);\n\n if ((nAV[0].arrow)&amp;&amp;(nAV[0].arrow[0])=='false')\n    var arrow=': ';\n else\n     var arrow=': '+ config.macros.monkeyTagger.dropdownchar;\n\n if((nAV[0].source)&amp;&amp;(nAV[0].source[0])!='.')\n        {var tagToTrack = nAV[0].source[0]}\n else if(params[0]&amp;&amp;(params[0]!='.'))\n      {var tagToTrack = params[0]}\n else\n       {return false;};\n var monkeylabel = ((nAV[0].label)&amp;&amp;(nAV[0].label[0])!='.')?nAV[0].label[0]+arrow: tagToTrack+arrow;\n var logmode = ((nAV[0].logging)&amp;&amp;(nAV[0].logging[0])!='.')?nAV[0].logging[0]: &quot;false&quot;;\n if ((nAV[0].anchor)&amp;&amp;(nAV[0].anchor[0])!='.')\n    var anchor = nAV[0].anchor[0];\n var monkeytooltip=tagToTrack + ' :';\n\n\n     if(tiddler instanceof Tiddler)\n                {var title = tiddler.title;\n                \n                var addcomment = function(tiddler,newTag){\n                    var now = new Date();\n                    var timeFormat= 'DD/0MM/YY 0hh:0mm';\n                    var formattednow= now.formatString(timeFormat);\n                    var txt=&quot;\sn*''&quot;+tagToTrack+&quot;'' set as ''&quot;+newTag+&quot;'' on &quot;+formattednow;\n                    if (anchor &amp;&amp; anchor!='.')\n                       {var pos=tiddler.text.indexOf(anchor);\n                       if (pos!=-1) {pos=pos + anchor.length}\n                       else if (pos==-1) {pos=tiddler.text.length}}\n                    else if (!anchor){var pos = tiddler.text.length;};\n\n                    tiddler.set(null,tiddler.text.substr(0,pos)+txt+tiddler.text.substr(pos));\n                    story.refreshTiddler(tiddler.title,null,true);\n                    return false;\n}\n\n                var ontagclick = function(e) {\n                    if (!e) var e = window.event;\n                    var tag = this.getAttribute(&quot;tag&quot;);\n                    var t=store.getTiddler(title);\n                    if (!t || !t.tags) return;\n                    if (t.tags.find(tag)==null)\n                       {t.tags.push(tag)\n                         if (logmode==&quot;true&quot;){addcomment(t,tag);}}\n                    else\n                        {t.tags.splice(t.tags.find(tag),1)};\n                    story.saveTiddler(title);\n                    story.refreshTiddler(title,null,true);\n                    return false;\n                    };\n                var onclick = function(e) {\n                    if (!e) var e = window.event;\n                    var popup = Popup.create(this);\n                    var thistiddler=store.getTiddler(title);\n\n                    var taggedarray = new Array();\n                    var tagslabel = new Array();\n\n                    var taggedtiddlers = store.getTaggedTiddlers(tagToTrack);\n                    for (var t=0; t&lt;taggedtiddlers.length; t++){\n                        var taggedtitle= ((taggedtiddlers[t]).title);\n                        taggedarray.push(taggedtitle);}\n\n                    for (var t=0; t&lt;taggedarray.length; t++){\n                        var temptag = taggedarray[t];\n                        if (thistiddler.tags.find(temptag)==null)\n                           {var temptag='[ ] '+ temptag;\n                           tagslabel.push(temptag);}\n                        else\n                            {var temptag ='[x] '+ temptag;\n                            tagslabel.push(temptag);}\n                            }\n\n                   if(tagslabel.length == 0)\n                          createTiddlyText(createTiddlyElement(popup,&quot;li&quot;),('no '+tagToTrack));\n                          for (var t=0; t&lt;tagslabel.length; t++)\n                          {\n                          var theTag = createTiddlyButton(createTiddlyElement(popup,&quot;li&quot;),tagslabel[t],(&quot;toggle '&quot;+ ([taggedarray[t]]))+&quot;'&quot;,ontagclick);\n                          theTag.setAttribute(&quot;tag&quot;,taggedarray[t]);\n                          }\n       Popup.show(popup,false);\n       e.cancelBubble = true;\n       if (e.stopPropagation) e.stopPropagation();\n       return(false);\n};\n //createTiddlyButton(place,monkeylabel,monkeylabel,onclick);\n\nvar createdropperButton = function(place){\nvar sp = createTiddlyElement(place,&quot;span&quot;,null,&quot;monkeytaggerbutton&quot;);\nvar theDropDownBtn = createTiddlyButton(sp,monkeylabel,monkeytooltip,onclick);\n};\n\ncreatedropperButton(place);\n }\n};\nsetStylesheet(\n &quot;.toolbar .monkeytaggerbutton {margin-right:0em; border:0px solid #fff; padding:0px; padding-right:0px; padding-left:0px;}\sn&quot;+\n &quot;.monkeytaggerbutton a.button {padding:2px; padding-left:2px; padding-right:2px;}\sn&quot;+\n// &quot;.monkeytaggerbutton {font-size:130%;}\sn&quot;+\n//&quot;.monkeytaggerbutton .button {color:#703;}\sn&quot;+\n &quot;&quot;,\n&quot;MonkeyTaggerStyles&quot;);\n\n//}}}</div>
<div tiddler="MonkeyTaggerMacro" modifier="YourName" modified="200611092001" created="200607191653" tags="lewcidExtension systemConfig excludeLists">/***\n| Name:|''monkeyTagger''|\n| Created by:|SaqImtiaz|\n| Location:|http://lewcid.googlepages.com/lewcid.html|\n| Version:|0.9 (08-Apr-2006)|\n| Requires:|~TW2.07|\n\n!About:\n*an adaptation of TagAdderMacro for monkeyGTD and tagglytagging user, but could be useful to just about anyone!\n*{{{&lt;&lt;monkeyTagger Project&gt;&gt;}}} gives a drop down list of all tags, tagged with Project.\n*The list allows toggling of tags on the current tiddler.\n*logging options for task management.\n\n!Demo:\n&lt;&lt;monkeyTagger Status&gt;&gt;\n\n!Installation:\n*Copy this tiddler to your TW with the systemConfig tag\n*either copy the following to your ViewTemplate:\n{{{&lt;div class='tagged' macro='monkeyTagger tagToTrack'&gt;&lt;/div&gt;}}}\nor\n*better yet, define your own toolbar class and add as many as you need to create a nice toolbar.\nEg:\n{{{&lt;div class='toolbar' &gt;\n&lt;span style=&quot;padding-right:0.15em;&quot; macro='monkeyTagger Project'&gt;&lt;/span&gt;\n&lt;span style=&quot;padding-right:0.15em;&quot; macro='monkeyTagger Status'&gt;&lt;/span&gt;\n&lt;span macro='toolbar -closeTiddler closeOthers +editTiddler permalink references jump'&gt;&lt;/span&gt;\n&lt;/div&gt;}}}\n (adjust padding to taste)\n\n!Usage:\n\n''Syntax:''\n|&gt;|{{{&lt;&lt;monkeyTagger source:&quot;sourcetag&quot; label:&quot;customlabel&quot; logging:&quot;true/false&quot; anchor:&quot;anchortext&quot;  arrow:&quot;true/false&quot;&gt;&gt;}}}|\n|label:|quoted text to use as a customlabel|\n|arrow:|add arrow to custom label, values are &quot;true&quot; or &quot;false&quot;|\n|anchor:|quoted text to specify where to add logging text|\n|logging:|enable logging of tags added (for task management), values are &quot;true&quot; or &quot;false&quot;|\n\nthe only parameter you ''have'' to pass is the source. When passing only one parameter, you can write either something like:\n{{{&lt;&lt;monkeyTagger &quot;Project&quot;&gt;&gt;}}} or {{{&lt;&lt;monkeyTagger source:&quot;Project&quot;&gt;&gt;}}} for &lt;&lt;monkeyTagger Project&gt;&gt;\nAll other parameters are optional, and can be written in any order.\n\n''Defaults:''\n|label:|default label if not specified = source tag + arrow|\n|arrow:|true |\n|logging:|false |\n|anchor:|none used by default, logging text added to end of tiddler |\n\n''Examples:''\n|custom label| {{{&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot;&gt;&gt;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot;&gt;&gt;|\n|custom label without arrow| {{{&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot; arrow:&quot;false&quot;&gt;&gt;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; label:&quot;customlabel&quot; arrow:&quot;false&quot;&gt;&gt;|\n|logging enabled| {{{&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot;&gt;&gt;|\n|logging enabled with anchor text|{{{&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot; anchor:&quot;anchortext&quot;}}} |&lt;&lt;monkeyTagger source:&quot;Project&quot; logging:&quot;true&quot; anchor:&quot;anchortext&quot;&gt;&gt;|\n\n''Tips:''\n*Make sure your anchor text doesn't occur more than once in every tiddler, as the first instance will be used.\n*I recommend using something like {{{/%StatusLog%/}}} as an invisible anchor.\n*Use a tag based template, and add monkeyTagger macro's with logging enabled to the toolbar in just your taskmanagement templates.\n\n!To Do:\n*add sorting options if requested.\n*''add exclude tag feature''!\n\n!History\n*Version 0.9: \n**changed to named parameters to make it more user friendly\n**added option to disable/enable dropdown arrow in custom labels\n**added logging option with anchor text.\n\n!CODE\n***/\n//{{{\n\nconfig.macros.monkeyTagger= {};\n//config.macros.monkeyTagger.dropdownchar = (document.all?&quot;â¼&quot;:&quot;â¾&quot;); // the fat one is the only one that works in IE\nconfig.macros.monkeyTagger.dropdownchar = &quot;â¼&quot;; // uncomment previous line and comment this for smaller version in FF\nconfig.macros.monkeyTagger.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n{\n var nAV = paramString.parseParams('test', null, true);\n\n if ((nAV[0].arrow)&amp;&amp;(nAV[0].arrow[0])=='false')\n    var arrow=': ';\n else\n     var arrow=': '+ config.macros.monkeyTagger.dropdownchar;\n\n if((nAV[0].source)&amp;&amp;(nAV[0].source[0])!='.')\n        {var tagToTrack = nAV[0].source[0]}\n else if(params[0]&amp;&amp;(params[0]!='.'))\n      {var tagToTrack = params[0]}\n else\n       {return false;};\n var monkeylabel = ((nAV[0].label)&amp;&amp;(nAV[0].label[0])!='.')?nAV[0].label[0]+arrow: tagToTrack+arrow;\n var logmode = ((nAV[0].logging)&amp;&amp;(nAV[0].logging[0])!='.')?nAV[0].logging[0]: &quot;false&quot;;\n if ((nAV[0].anchor)&amp;&amp;(nAV[0].anchor[0])!='.')\n    var anchor = nAV[0].anchor[0];\n var monkeytooltip=tagToTrack + ' :';\n\n\n     if(tiddler instanceof Tiddler)\n                {var title = tiddler.title;\n                \n                var addcomment = function(tiddler,newTag){\n                    var now = new Date();\n                    var timeFormat= 'DD/0MM/YY 0hh:0mm';\n                    var formattednow= now.formatString(timeFormat);\n                    var txt=&quot;\sn*''&quot;+tagToTrack+&quot;'' set as ''&quot;+newTag+&quot;'' on &quot;+formattednow;\n                    if (anchor &amp;&amp; anchor!='.')\n                       {var pos=tiddler.text.indexOf(anchor);\n                       if (pos!=-1) {pos=pos + anchor.length}\n                       else if (pos==-1) {pos=tiddler.text.length}}\n                    else if (!anchor){var pos = tiddler.text.length;};\n\n                    tiddler.set(null,tiddler.text.substr(0,pos)+txt+tiddler.text.substr(pos));\n                    story.refreshTiddler(tiddler.title,null,true);\n                    return false;\n}\n\n                var ontagclick = function(e) {\n                    if (!e) var e = window.event;\n                    var tag = this.getAttribute(&quot;tag&quot;);\n                    var t=store.getTiddler(title);\n                    if (!t || !t.tags) return;\n                    if (t.tags.find(tag)==null)\n                       {t.tags.push(tag)\n                         if (logmode==&quot;true&quot;){addcomment(t,tag);}}\n                    else\n                        {t.tags.splice(t.tags.find(tag),1)};\n                    story.saveTiddler(title);\n                    story.refreshTiddler(title,null,true);\n                    return false;\n                    };\n                var onclick = function(e) {\n                    if (!e) var e = window.event;\n                    var popup = Popup.create(this);\n                    var thistiddler=store.getTiddler(title);\n\n                    var taggedarray = new Array();\n                    var tagslabel = new Array();\n\n                    var taggedtiddlers = store.getTaggedTiddlers(tagToTrack);\n                    for (var t=0; t&lt;taggedtiddlers.length; t++){\n                        var taggedtitle= ((taggedtiddlers[t]).title);\n                        taggedarray.push(taggedtitle);}\n\n                    for (var t=0; t&lt;taggedarray.length; t++){\n                        var temptag = taggedarray[t];\n                        if (thistiddler.tags.find(temptag)==null)\n                           {var temptag='[ ] '+ temptag;\n                           tagslabel.push(temptag);}\n                        else\n                            {var temptag ='[x] '+ temptag;\n                            tagslabel.push(temptag);}\n                            }\n\n                   if(tagslabel.length == 0)\n                          createTiddlyText(createTiddlyElement(popup,&quot;li&quot;),('no '+tagToTrack));\n                          for (var t=0; t&lt;tagslabel.length; t++)\n                          {\n                          var theTag = createTiddlyButton(createTiddlyElement(popup,&quot;li&quot;),tagslabel[t],(&quot;toggle '&quot;+ ([taggedarray[t]]))+&quot;'&quot;,ontagclick);\n                          theTag.setAttribute(&quot;tag&quot;,taggedarray[t]);\n                          }\n       Popup.show(popup,false);\n       e.cancelBubble = true;\n       if (e.stopPropagation) e.stopPropagation();\n       return(false);\n};\n //createTiddlyButton(place,monkeylabel,monkeylabel,onclick);\n\nvar createdropperButton = function(place){\nvar sp = createTiddlyElement(place,&quot;span&quot;,null,&quot;monkeytaggerbutton&quot;);\nvar theDropDownBtn = createTiddlyButton(sp,monkeylabel,monkeytooltip,onclick);\n};\n\ncreatedropperButton(place);\n }\n};\nsetStylesheet(\n &quot;.toolbar .monkeytaggerbutton {margin-right:0em; border:0px solid #fff; padding:0px; padding-right:0px; padding-left:0px;}\sn&quot;+\n &quot;.monkeytaggerbutton a.button {padding:2px; padding-left:2px; padding-right:2px;}\sn&quot;+\n// &quot;.monkeytaggerbutton {font-size:130%;}\sn&quot;+\n//&quot;.monkeytaggerbutton .button {color:#703;}\sn&quot;+\n &quot;&quot;,\n&quot;MonkeyTaggerStyles&quot;);\n\n//}}}</div>
<div tiddler="MptwStyleSheet" modifier="YourName" modified="200611091950" created="200611090456" tags="excludeLists">/*{{{*/\n/* a contrasting background so I can see where one tiddler ends and the other begins */\nbody {\n	background: [[ColorPalette::TertiaryLight]];\n}\n\n/* sexy colours and font for the header */\n.headerForeground {\n	color: [[ColorPalette::PrimaryPale]];\n}\n.headerShadow, .headerShadow a {\n	color: [[ColorPalette::PrimaryMid]];\n}\n.headerForeground, .headerShadow {\n	padding: 1em 1em 0;\n	font-family: 'Trebuchet MS' sans-serif;\n	font-weight:bold;\n}\n.headerForeground .siteSubtitle {\n	color: [[ColorPalette::PrimaryLight]];\n}\n.headerShadow .siteSubtitle {\n	color: [[ColorPalette::PrimaryMid]];\n}\n\n/* make shadow go and down right instead of up and left */\n.headerShadow {\n	left: 1px;\n	top: 1px;\n}\n\n/* sexy tiddler titles */\n.title {\n	font-size: 200%;\n	color: [[ColorPalette::PrimaryLight]];\n}\n\n/* more subtle tiddler subtitle */\n.subtitle {\n	padding:0px;\n	margin:0px;\n	padding-left:0.5em;\n	font-size: 90%;\n	color: [[ColorPalette::TertiaryMid]];\n}\n.subtitle .tiddlyLink {\n	color: [[ColorPalette::TertiaryMid]];\n}\n\n/* a little bit of extra whitespace */\n.viewer {\n	padding-bottom:3px;\n}\n\n/* don't want any background color for headings */\nh1,h2,h3,h4,h5,h6 {\n	background: [[ColorPalette::Background]];\n	color: [[ColorPalette::Foreground]];\n}\n\n/* give tiddlers 3d style border and explicit background */\n.tiddler {\n	background: [[ColorPalette::Background]];\n	border-right: 2px [[ColorPalette::TertiaryMid]] solid;\n	border-bottom: 2px [[ColorPalette::TertiaryMid]] solid;\n	margin-bottom: 1em;\n	padding-bottom: 2em;\n}\n\n/* make options slider look nicer */\n#sidebarOptions .sliderPanel {\n	border:solid 1px [[ColorPalette::PrimaryLight]];\n}\n\n\n/* the borders look wrong with the body background */\n#sidebar .button {\n	border-style: none;\n}\n\n/* displays the list of a tiddler's tags horizontally. used in ViewTemplate */\n.tagglyTagged li.listTitle {\n	display:none\n}\n.tagglyTagged li {\n	display: inline; font-size:90%;\n}\n.tagglyTagged ul {\n	margin:0px; padding:0px;\n}\n\n/* this means you can put line breaks in SidebarOptions for readability */\n#sidebarOptions br {\n	display:none;\n}\n/* undo the above in OptionsPanel */\n#sidebarOptions .sliderPanel br {\n	display:inline;\n}\n\n/* horizontal main menu stuff */\n#displayArea {\n	margin: 1em 15.7em 0em 1em; /* use the freed up space */\n}\n#topMenu br {\n	display: none;\n}\n#topMenu {\n	background: [[ColorPalette::PrimaryMid]];\n	color:[[ColorPalette::PrimaryPale]];\n}\n#topMenu {\n	padding:2px;\n}\n#topMenu .button, #topMenu .tiddlyLink, #topMenu a {\n	margin-left: 0.5em;\n	margin-right: 0.5em;\n	padding-left: 3px;\n	padding-right: 3px;\n	color: [[ColorPalette::PrimaryPale]];\n	font-size: 115%;\n}\n#topMenu .button:hover, #topMenu .tiddlyLink:hover {\n	background: [[ColorPalette::PrimaryDark]];\n}\n\n/* make it print a little cleaner */\n@media print {\n	#topMenu {\n		display: none ! important;\n	}\n	/* not sure if we need all the importants */\n	.tiddler {\n		border-style: none ! important;\n		margin:0px ! important;\n		padding:0px ! important;\n		padding-bottom:2em ! important;\n	}\n	.tagglyTagging .button, .tagglyTagging .hidebutton {\n		display: none ! important;\n	}\n	.headerShadow {\n		visibility: hidden ! important;\n	}\n	.tagglyTagged .quickopentag, .tagged .quickopentag {\n		border-style: none ! important;\n	}\n	.quickopentag a.button, .miniTag {\n		display: none ! important;\n	}\n}\n/*}}}*/\n</div>
<div tiddler="NestedSlidersPlugin" modifier="YourName" modified="200611091959" created="200512161202" tags="systemConfig includeNew authoring excludeLists">/***\n|''Name:''|NestedSlidersPlugin|\n|''Source:''|http://www.TiddlyTools.com/#NestedSlidersPlugin|\n|''Author:''|Eric Shulman - ELS Design Studios|\n|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|\n|''~CoreVersion:''|2.0.10|\n\nQuickly make any tiddler content into an expandable 'slider' panel, without needing to create a separate tiddler to contain the slider content.  Optional syntax allows ''default to open'', ''custom button label/tooltip'' and ''automatic blockquote formatting.''\n\nYou can also 'nest' these sliders as deep as you like (see complex nesting example below), so that expandable 'tree-like' hierarchical displays can be created.  This is most useful when converting existing in-line text content to create in-line annotations, footnotes, context-sensitive help, or other subordinate information displays.\n\nFor more details, please click on a section headline below:\n++++!!!!![Configuration]&gt;\nDebugging messages for 'lazy sliders' deferred rendering:\n&lt;&lt;option chkDebugLazySliderDefer&gt;&gt; show debugging alert when deferring slider rendering\n&lt;&lt;option chkDebugLazySliderRender&gt;&gt; show debugging alert when deferred slider is actually rendered\n===\n++++!!!!![Usage]&gt;\nWhen installed, this plugin adds new wiki syntax for embedding 'slider' panels directly into tiddler content.  Use {{{+++}}} and {{{===}}} to delimit the slider content.  Additional optional syntax elements let you specify\n*default to open\n*cookiename\n*heading level\n*floater (with optional CSS width value)\n*mouse auto rollover\n*custom class/label/tooltip/accesskey\n*automatic blockquote\n*deferred rendering\nThe complete syntax, using all options, is:\n//{{{\n++++(cookiename)!!!!!^width^*{{class{[label=key|tooltip]}}}&gt;...\ncontent goes here\n===\n//}}}\nwhere:\n* {{{+++}}} (or {{{++++}}}) and {{{===}}}^^\nmarks the start and end of the slider definition, respectively.  When the extra {{{+}}} is used, the slider will be open when initially displayed.^^\n* {{{(cookiename)}}}^^\nsaves the slider opened/closed state, and restores this state whenever the slider is re-rendered.^^\n* {{{!}}} through {{{!!!!!}}}^^\ndisplays the slider label using a formatted headline (Hn) style instead of a button/link style^^\n* {{{^width^}}} (or just {{{^}}})^^\nmakes the slider 'float' on top of other content rather than shifting that content downward.  'width' must be a valid CSS value (e.g., &quot;30em&quot;, &quot;180px&quot;, &quot;50%&quot;, etc.).  If omitted, the default width is &quot;auto&quot; (i.e., fit to content)^^\n* {{{*}}}^^\nautomatically opens/closes slider on &quot;rollover&quot; as well as when clicked^^\n* {{{{{class{[label=key|tooltip]}}}}}}^^\nuses custom label/tooltip/accesskey.  {{{{{class{...}}}}}}, {{{=key}}} and {{{|tooltip}}} are optional.  'class' is any valid CSS class name, used to style the slider label text.  'key' must be a ''single letter only''.  Default labels/tootips are: &quot;&gt;&quot; (more) and &quot;&lt;&quot; (less), with no default access key assignment.^^\n* {{{&quot;&gt;&quot;}}} //(without the quotes)//^^\nautomatically adds blockquote formatting to slider content^^\n* {{{&quot;...&quot;}}} //(without the quotes)//^^\ndefers rendering of closed sliders until the first time they are opened.  //Note: deferred rendering may produce unexpected results in some cases.  Use with care.//^^\n\n//Note: to make slider definitions easier to read and recognize when editing a tiddler, newlines immediately following the {{{+++}}} 'start slider' or preceding the {{{===}}} 'end slider' sequence are automatically supressed so that excess whitespace is eliminated from the output.//\n===\n++++!!!!![Examples]&gt;\nsimple in-line slider: \n{{{\n+++\n   content\n===\n}}}\n+++\n   content\n===\n----\nuse a custom label and tooltip: \n{{{\n+++[label|tooltip]\n   content\n===\n}}}\n+++[label|tooltip]\n   content\n===\n----\ncontent automatically blockquoted: \n{{{\n+++&gt;\n   content\n===\n}}}\n+++&gt;\n   content\n===\n----\nall options combined //(default open, cookie, heading, sized floater, rollover, class, label/tooltip/key, blockquoted, deferred)//\n{{{\n++++(testcookie)!!!^30em^*{{big{[label=Z|click or press Alt-Z to open]}}}&gt;...\n   content\n===\n}}}\n++++(testcookie)!!!^30em^*{{big{[label=Z|click or press Alt-Z to open]}}}&gt;...\n   content\n===\n----\ncomplex nesting example:\n{{{\n+++^[get info...=I|click for information or press Alt-I]\n   put some general information here, plus a floating slider with more specific info:\n   +++^10em^[view details...|click for details]\n      put some detail here, which could include a rollover with a +++^25em^*[glossary definition]explaining technical terms===\n   ===\n===\n}}}\n+++^[get info...=I|click for information or press Alt-I]\n   put some general information here, plus a floating slider with more specific info:\n   +++^10em^[view details...|click for details]\n      put some detail here, which could include a rollover with a +++^25em^*[glossary definition]explaining technical terms===\n   ===\n===\n===\n!!!!!Installation\n&lt;&lt;&lt;\nimport (or copy/paste) the following tiddlers into your document:\n''NestedSlidersPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.07.28 - 2.0.0'' added custom class syntax around label/tip/key syntax: {{{{{classname{[label=key|tip]}}}}}}\n''2006.07.25 - 1.9.3'' when parsing slider, save default open/closed state in button element, then in onClickNestedSlider(), if slider state matches saved default, instead of saving cookie, delete it.  Significantly reduces the 'cookie overhead' when default slider states are used.\n''2006.06.29 - 1.9.2'' in onClickNestedSlider(), when setting focus to first control, skip over type=&quot;hidden&quot;\n''2006.06.22 - 1.9.1'' added panel.defaultPanelWidth to save requested panel width, even after resizing has changed the style value\n''2006.05.11 - 1.9.0'' added optional '^width^' syntax for floating sliders and '=key' syntax for setting an access key on a slider label\n''2006.05.09 - 1.8.0'' in onClickNestedSlider(), when showing panel, set focus to first child input/textarea/select element\n''2006.04.24 - 1.7.8'' in adjustSliderPos(), if floating panel is contained inside another floating panel, subtract offset of containing panel to find correct position\n''2006.02.16 - 1.7.7'' corrected deferred rendering to account for use-case where show/hide state is tracked in a cookie\n''2006.02.15 - 1.7.6'' in adjustSliderPos(), ensure that floating panel is positioned completely within the browser window (i.e., does not go beyond the right edge of the browser window)\n''2006.02.04 - 1.7.5'' add 'var' to unintended global variable declarations to avoid FireFox 1.5.0.1 crash bug when assigning to globals\n''2006.01.18 - 1.7.4'' only define adjustSliderPos() function if it has not already been provided by another plugin.  This lets other plugins 'hijack' the function even when they are loaded first.\n''2006.01.16 - 1.7.3'' added adjustSliderPos(place,btn,panel,panelClass) function to permit specialized logic for placement of floating panels.  While it provides improved placement for many uses of floating panels, it exhibits a relative offset positioning error when used within *nested* floating panels.  Short-term workaround is to only adjust the position for 'top-level' floaters.\n''2006.01.16 - 1.7.2'' added button property to slider panel elements so that slider panel can tell which button it belongs to.  Also, re-activated and corrected animation handling so that nested sliders aren't clipped by hijacking Slider.prototype.stop so that &quot;overflow:hidden&quot; can be reset to &quot;overflow:visible&quot; after animation ends\n''2006.01.14 - 1.7.1'' added optional &quot;^&quot; syntax for floating panels.  Defines new CSS class, &quot;.floatingPanel&quot;, as an alternative for standard in-line &quot;.sliderPanel&quot; styles.\n''2006.01.14 - 1.7.0'' added optional &quot;*&quot; syntax for rollover handling to show/hide slider without requiring a click (Based on a suggestion by tw4efl)\n''2006.01.03 - 1.6.2'' When using optional &quot;!&quot; heading style, instead of creating a clickable &quot;Hn&quot; element, create an &quot;A&quot; element inside the &quot;Hn&quot; element.  (allows click-through in SlideShowPlugin, which captures nearly all click events, except for hyperlinks)\n''2005.12.15 - 1.6.1'' added optional &quot;...&quot; syntax to invoke deferred ('lazy') rendering for initially hidden sliders\nremoved checkbox option for 'global' application of lazy sliders\n''2005.11.25 - 1.6.0'' added optional handling for 'lazy sliders' (deferred rendering for initially hidden sliders)\n''2005.11.21 - 1.5.1'' revised regular expressions: if present, a single newline //preceding// and/or //following// a slider definition will be suppressed so start/end syntax can be place on separate lines in the tiddler 'source' for improved readability.  Similarly, any whitespace (newlines, tabs, spaces, etc.) trailing the 'start slider' syntax or preceding the 'end slider' syntax is also suppressed.\n''2005.11.20 - 1.5.0'' added (cookiename) syntax for optional tracking and restoring of slider open/close state\n''2005.11.11 - 1.4.0'' added !!!!! syntax to render slider label as a header (Hn) style instead of a button/link style\n''2005.11.07 - 1.3.0'' removed alternative syntax {{{(((}}} and {{{)))}}} (so they can be used by other\nformatting extensions) and simplified/improved regular expressions to trim multiple excess newlines\n''2005.11.05 - 1.2.1'' changed name to NestedSlidersPlugin\nmore documentation\n''2005.11.04 - 1.2.0'' added alternative character-mode syntax {{{(((}}} and {{{)))}}}\ntweaked &quot;eat newlines&quot; logic for line-mode {{{+++}}} and {{{===}}} syntax\n''2005.11.03 - 1.1.1'' fixed toggling of default tooltips (&quot;more...&quot; and &quot;less...&quot;) when a non-default button label is used\ncode cleanup, added documentation\n''2005.11.03 - 1.1.0'' changed delimiter syntax from {{{(((}}} and {{{)))}}} to {{{+++}}} and {{{===}}}\nchanged name to EasySlidersPlugin\n''2005.11.03 - 1.0.0'' initial public release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was implemented by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]] with initial research and suggestions from RodneyGomes, GeoffSlocock, and PaulPetterson.\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.nestedSliders = {major: 2, minor: 0, revision: 0, date: new Date(2006,7,28)};\n//}}}\n\n//{{{\n// options for deferred rendering of sliders that are not initially displayed\nif (config.options.chkDebugLazySliderDefer==undefined) config.options.chkDebugLazySliderDefer=false;\nif (config.options.chkDebugLazySliderRender==undefined) config.options.chkDebugLazySliderRender=false;\n\n// default styles for 'floating' class\nsetStylesheet(&quot;.floatingPanel { position:absolute; z-index:10; padding:0.5em; margin:0em; \s\n	background-color:#eee; color:#000; border:1px solid #000; text-align:left; }&quot;,&quot;floatingPanelStylesheet&quot;);\n//}}}\n\n//{{{\nconfig.formatters.push( {\n	name: &quot;nestedSliders&quot;,\n	match: &quot;\s\sn?\s\s+{3}&quot;,\n	terminator: &quot;\s\ss*\s\s={3}\s\sn?&quot;,\n	lookahead: &quot;\s\sn?\s\s+{3}(\s\s+)?(\s\s([^\s\s)]*\s\s))?(\s\s!*)?(\s\s^(?:[^\s\s^\s\s*\s\s[\s\s&gt;]*\s\s^)?)?(\s\s*)?(?:\s\s{\s\s{([\s\sw]+[\s\ss\s\sw]*)\s\s{)?(\s\s[[^\s\s]]*\s\s])?(?:\s\s}{3})?(\s\s&gt;)?(\s\s.\s\s.\s\s.)?\s\ss*&quot;,\n	handler: function(w)\n		{\n			// defopen=lookaheadMatch[1]\n			// cookiename=lookaheadMatch[2]\n			// header=lookaheadMatch[3]\n			// panelwidth=lookaheadMatch[4]\n			// rollover=lookaheadMatch[5]\n			// class=lookaheadMatch[6]\n			// label=lookaheadMatch[7]\n			// blockquote=lookaheadMatch[8]\n			// deferred=lookaheadMatch[9]\n\n			 lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);\n			lookaheadRegExp.lastIndex = w.matchStart;\n			var lookaheadMatch = lookaheadRegExp.exec(w.source)\n			if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)\n			{\n				// location for rendering button and panel\n				var place=w.output;\n\n				// default to closed, no cookie, no accesskey\n				var show=&quot;none&quot;; var title=&quot;&gt;&quot;; var tooltip=&quot;show&quot;; var cookie=&quot;&quot;; var key=&quot;&quot;;\n\n				// extra &quot;+&quot;, default to open\n				if (lookaheadMatch[1])\n					{ show=&quot;block&quot;; title=&quot;&lt;&quot;; tooltip=&quot;hide&quot;; }\n\n				// cookie, use saved open/closed state\n				if (lookaheadMatch[2]) {\n					cookie=lookaheadMatch[2].trim().slice(1,-1);\n					cookie=&quot;chkSlider&quot;+cookie;\n					if (config.options[cookie]==undefined)\n						{ config.options[cookie] = (show==&quot;block&quot;) }\n					if (config.options[cookie])\n						{ show=&quot;block&quot;; title=&quot;&lt;&quot;; tooltip=&quot;hide&quot;; }\n					else\n						{ show=&quot;none&quot;; title=&quot;&gt;&quot;; tooltip=&quot;show&quot;; }\n				}\n\n				// parse custom label/tooltip/accesskey: [label=X|tooltip]\n				if (lookaheadMatch[7]) {\n					title = lookaheadMatch[7].trim().slice(1,-1);\n					var pos=title.indexOf(&quot;|&quot;);\n					if (pos!=-1) { tooltip = title.substr(pos+1,title.length); title=title.substr(0,pos); }\n					if (title.substr(title.length-2,1)==&quot;=&quot;) { key=title.substr(title.length-1,1); title=title.slice(0,-2); }\n					if (pos==-1) tooltip += &quot; &quot;+title; // default tooltip: &quot;show/hide &lt;title&gt;&quot;\n				}\n\n				// create the button\n				if (lookaheadMatch[3]) { // use &quot;Hn&quot; header format instead of button/link\n					var lvl=(lookaheadMatch[3].length&gt;6)?6:lookaheadMatch[3].length;\n					var btn = createTiddlyElement(createTiddlyElement(place,&quot;h&quot;+lvl,null,null,null),&quot;a&quot;,null,lookaheadMatch[6],title);\n					btn.onclick=onClickNestedSlider;\n					btn.setAttribute(&quot;href&quot;,&quot;javascript:;&quot;);\n					btn.setAttribute(&quot;title&quot;,tooltip);\n				}\n				else\n					var btn = createTiddlyButton(place,title,tooltip,onClickNestedSlider,lookaheadMatch[6]);\n\n				// set extra button attributes\n				btn.sliderCookie = cookie; // save the cookiename (if any) in the button object\n				btn.defOpen=lookaheadMatch[1]!=null; // save default open/closed state (boolean)\n				btn.keyparam=key; // save the access key letter (&quot;&quot; if none)\n				if (key.length) {\n					btn.setAttribute(&quot;accessKey&quot;,key); // init access key\n					btn.onfocus=function(){this.setAttribute(&quot;accessKey&quot;,this.keyparam);}; // **reclaim** access key on focus\n				}\n\n				// &quot;non-click&quot; MouseOver open/close slider\n				if (lookaheadMatch[5]) btn.onmouseover=onClickNestedSlider;\n\n				// create slider panel\n				var panelClass=lookaheadMatch[4]?&quot;floatingPanel&quot;:&quot;sliderPanel&quot;;\n				var panel=createTiddlyElement(place,&quot;div&quot;,null,panelClass,null);\n				panel.button = btn; // so the slider panel know which button it belongs to\n				panel.defaultPanelWidth=(lookaheadMatch[4] &amp;&amp; lookaheadMatch[4].length&gt;2)?lookaheadMatch[4].slice(1,-1):&quot;&quot;; // save requested panel size\n				btn.sliderPanel=panel;\n				panel.style.display = show;\n				panel.style.width=panel.defaultPanelWidth;\n\n				// render slider (or defer until shown) \n				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n				if ((show==&quot;block&quot;)||!lookaheadMatch[9]) {\n					// render now if panel is supposed to be shown or NOT deferred rendering\n					w.subWikify(lookaheadMatch[8]?createTiddlyElement(panel,&quot;blockquote&quot;):panel,this.terminator);\n					// align slider/floater position with button\n					adjustSliderPos(place,btn,panel,panelClass);\n				}\n				else {\n					var src = w.source.substr(w.nextMatch);\n					var endpos=findMatchingDelimiter(src,&quot;+++&quot;,&quot;===&quot;);\n					panel.setAttribute(&quot;raw&quot;,src.substr(0,endpos));\n					panel.setAttribute(&quot;blockquote&quot;,lookaheadMatch[8]?&quot;true&quot;:&quot;false&quot;);\n					panel.setAttribute(&quot;rendered&quot;,&quot;false&quot;);\n					w.nextMatch += endpos+3;\n					if (w.source.substr(w.nextMatch,1)==&quot;\sn&quot;) w.nextMatch++;\n					if (config.options.chkDebugLazySliderDefer) alert(&quot;deferred '&quot;+title+&quot;':\sn\sn&quot;+panel.getAttribute(&quot;raw&quot;));\n				}\n			}\n		}\n	}\n)\n\n// TBD: ignore 'quoted' delimiters (e.g., &quot;{{{+++foo===}}}&quot; isn't really a slider)\nfunction findMatchingDelimiter(src,starttext,endtext) {\n	var startpos = 0;\n	var endpos = src.indexOf(endtext);\n	// check for nested delimiters\n	while (src.substring(startpos,endpos-1).indexOf(starttext)!=-1) {\n		// count number of nested 'starts'\n		var startcount=0;\n		var temp = src.substring(startpos,endpos-1);\n		var pos=temp.indexOf(starttext);\n		while (pos!=-1)  { startcount++; pos=temp.indexOf(starttext,pos+starttext.length); }\n		// set up to check for additional 'starts' after adjusting endpos\n		startpos=endpos+endtext.length;\n		// find endpos for corresponding number of matching 'ends'\n		while (startcount &amp;&amp; endpos!=-1) {\n			endpos = src.indexOf(endtext,endpos+endtext.length);\n			startcount--;\n		}\n	}\n	return (endpos==-1)?src.length:endpos;\n}\n//}}}\n\n//{{{\nwindow.onClickNestedSlider=function(e)\n{\n	if (!e) var e = window.event;\n	var theTarget = resolveTarget(e);\n	var theLabel = theTarget.firstChild.data;\n	var theSlider = theTarget.sliderPanel\n	var isOpen = theSlider.style.display!=&quot;none&quot;;\n	// if using default button labels, toggle labels\n	if (theLabel==&quot;&gt;&quot;) theTarget.firstChild.data = &quot;&lt;&quot;;\n	else if (theLabel==&quot;&lt;&quot;) theTarget.firstChild.data = &quot;&gt;&quot;;\n	// if using default tooltips, toggle tooltips\n	if (theTarget.getAttribute(&quot;title&quot;)==&quot;show&quot;)\n		theTarget.setAttribute(&quot;title&quot;,&quot;hide&quot;);\n	else if (theTarget.getAttribute(&quot;title&quot;)==&quot;hide&quot;)\n		theTarget.setAttribute(&quot;title&quot;,&quot;show&quot;);\n	if (theTarget.getAttribute(&quot;title&quot;)==&quot;show &quot;+theLabel)\n		theTarget.setAttribute(&quot;title&quot;,&quot;hide &quot;+theLabel);\n	else if (theTarget.getAttribute(&quot;title&quot;)==&quot;hide &quot;+theLabel)\n		theTarget.setAttribute(&quot;title&quot;,&quot;show &quot;+theLabel);\n	// deferred rendering (if needed)\n	if (theSlider.getAttribute(&quot;rendered&quot;)==&quot;false&quot;) {\n		if (config.options.chkDebugLazySliderRender)\n			alert(&quot;rendering '&quot;+theLabel+&quot;':\sn\sn&quot;+theSlider.getAttribute(&quot;raw&quot;));\n		var place=theSlider;\n		if (theSlider.getAttribute(&quot;blockquote&quot;)==&quot;true&quot;)\n			place=createTiddlyElement(place,&quot;blockquote&quot;);\n		wikify(theSlider.getAttribute(&quot;raw&quot;),place);\n		theSlider.setAttribute(&quot;rendered&quot;,&quot;true&quot;);\n	}\n	// show/hide the slider\n	if(config.options.chkAnimate)\n		anim.startAnimating(new Slider(theSlider,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));\n	else\n		theSlider.style.display = isOpen ? &quot;none&quot; : &quot;block&quot;;\n	// reset to default width (might have been changed via plugin code)\n	theSlider.style.width=theSlider.defaultPanelWidth;\n	// align slider/floater position with target button\n	if (!isOpen) adjustSliderPos(theSlider.parentNode,theTarget,theSlider,theSlider.className);\n	// if showing panel, set focus to first 'focus-able' element in panel\n	if (theSlider.style.display!=&quot;none&quot;) {\n		var ctrls=theSlider.getElementsByTagName(&quot;*&quot;);\n		for (var c=0; c&lt;ctrls.length; c++) {\n			var t=ctrls[c].tagName.toLowerCase();\n			if ((t==&quot;input&quot; &amp;&amp; ctrls[c].type!=&quot;hidden&quot;) || t==&quot;textarea&quot; || t==&quot;select&quot;)\n				{ ctrls[c].focus(); break; }\n		}\n	}\n	if (this.sliderCookie &amp;&amp; this.sliderCookie.length) {\n		config.options[this.sliderCookie]=!isOpen;\n		if (config.options[this.sliderCookie]!=this.defOpen)\n			saveOptionCookie(this.sliderCookie);\n		else { // remove cookie if slider is in default display state\n			var ex=new Date(); ex.setTime(ex.getTime()-1000);\n			document.cookie = this.sliderCookie+&quot;=novalue; path=/; expires=&quot;+ex.toGMTString();\n		}\n	}\n	return false;\n}\n\n// hijack animation handler 'stop' handler so overflow is visible after animation has completed\nSlider.prototype.coreStop = Slider.prototype.stop;\nSlider.prototype.stop = function() { this.coreStop(); this.element.style.overflow = &quot;visible&quot;; }\n\n// adjust panel position based on button position\nif (window.adjustSliderPos==undefined) window.adjustSliderPos=function(place,btn,panel,panelClass) {\n	if (panelClass==&quot;floatingPanel&quot;) {\n		var left=0;\n		var top=btn.offsetHeight; \n		if (place.style.position!=&quot;relative&quot;) {\n			var left=findPosX(btn);\n			var top=findPosY(btn)+btn.offsetHeight;\n			var p=place; while (p &amp;&amp; p.className!='floatingPanel') p=p.parentNode;\n			if (p) { left-=findPosX(p); top-=findPosY(p); }\n		}\n		if (left+panel.offsetWidth &gt; getWindowWidth()) left=getWindowWidth()-panel.offsetWidth-10;\n		panel.style.left=left+&quot;px&quot;; panel.style.top=top+&quot;px&quot;;\n	}\n}\n\nfunction getWindowWidth() {\n	if(document.width!=undefined)\n		return document.width; // moz (FF)\n	if(document.documentElement &amp;&amp; ( document.documentElement.clientWidth || document.documentElement.clientHeight ) )\n		return document.documentElement.clientWidth; // IE6\n	if(document.body &amp;&amp; ( document.body.clientWidth || document.body.clientHeight ) )\n		return document.body.clientWidth; // IE4\n	if(window.innerWidth!=undefined)\n		return window.innerWidth; // IE - general\n	return 0; // unknown\n}\n//}}}</div>
<div tiddler="New Topics" modifier="ChrisJobling" modified="200705291106" created="200705291105" tags="query">Just a simple brain dump. Needs refining!\n* ''RE''presentational ''State'' ''T''ransfer (REST)\n* More on XML/XSLT\n* XForms\n* Agile Web Development Frameworks: Rails? Django? etc\n* Java Servlets? (maybe too much)\n* Content systems: CMS/Blog/Wiki\n* Case studies: \n** Drupal\n** MediaWiki or DokuWiki\n** WordPress\n** Rails or one of its kin\n** Cocoon?</div>
<div tiddler="NewHerePlugin" modifier="YourName" modified="200611091954" created="200610200252" tags="systemConfig excludeSearch excludeLists">/***\n| Name:|NewHerePlugin|\n| Description:|Creates the new here and new journal toolbar commands|\n| Version:|6.1.6|\n| Date:|06-Oct-2006|\n| Source:|http://mptw.tiddlyspot.com/#NewHerePlugin|\n| Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|\n| CoreVersion:|2.1.x|\nTo use edit your ViewTemplate and add newHere to the toolbar div, eg\n{{{&lt;div class='toolbar' macro='toolbar ... newHere'&gt;&lt;/div&gt;}}}\nNote: would be good if we could do this instead some day\n{{{&lt;&lt;newTiddler tag:{{tiddler.title}} label:'new here'&gt;&gt;}}}\n***/\n//{{{\nmerge(config.commands,{\n\n	newHere: {\n		text: 'new here',\n		tooltip: 'Create a new tiddler tagged as this tiddler',\n		hideReadOnly: true,\n		handler: function(e,src,title) {\n			if (!readOnly) {\n				clearMessage();\n				var t=document.getElementById('tiddler'+title);\n				story.displayTiddler(t,config.macros.newTiddler.title,DEFAULT_EDIT_TEMPLATE);\n				story.setTiddlerTag(config.macros.newTiddler.title, title, 0);\n				story.focusTiddler(config.macros.newTiddler.title,&quot;title&quot;); // doesn't work??\n				return false;\n			}\n		}\n	},\n\n	newJournalHere: {\n		//text: 'new journal here',  // too long\n		text: 'new journal',\n		hideReadOnly: true,\n		dataFormat: 'DD MMM YYYY', // adjust to your preference\n		//dataFormat: 'YYYY-0MM-0DD', \n		tooltip: 'Create a new journal tiddler tagged as this tiddler',\n		handler: function(e,src,title) {\n			if (!readOnly) {\n				clearMessage();\n				var now = new Date();\n				var t=document.getElementById('tiddler'+title);\n				var newtitle = now.formatString(this.dataFormat)\n				story.displayTiddler(t,newtitle,DEFAULT_EDIT_TEMPLATE);\n				story.setTiddlerTag(newtitle, title, 0);\n				story.focusTiddler(newtitle,&quot;title&quot;);\n				return false;\n			}\n		}\n	}\n\n});\n//}}}\n</div>
<div tiddler="NewerHereMacro" modifier="YourName" modified="200611091949" created="200611090717" tags="systemConfig excludeLists">//{{{\nmerge(config.macros,{   \n    newHere: { \n        handler: function(place,macroName,params,wikifier,paramString,tiddler) { \n                wikify(&quot;&lt;&lt;newTiddler &quot;+paramString+&quot; tag:[[&quot;+tiddler.title+&quot;]]&gt;&gt;&quot;,place,null,tiddler); \n        } \n    } \n}); \n//}}}</div>
<div tiddler="Notes&amp;Queries" modifier="ChrisJobling" modified="200708241158" created="200705010938" tags="">* [[School Review 2007]]\n* [[Rsync tips]]\n* [[Wiki Trials]]\n* [[Linux Tips]]</div>
<div tiddler="PageTemplate" modifier="YourName" modified="200611091950" created="200611090625" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\n	&lt;div class='headerShadow'&gt;\n		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n	&lt;/div&gt;\n	&lt;div class='headerForeground'&gt;\n		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n	&lt;/div&gt;\n&lt;/div&gt;\n&lt;!-- horizontal MainMenu --&gt;\n&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n&lt;!-- original MainMenu menu --&gt;\n&lt;!-- &lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt; --&gt;\n&lt;div id='sidebar'&gt;\n	&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\n	&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n	&lt;div id='messageArea'&gt;&lt;/div&gt;\n	&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="QuickOpenTagPlugin" modifier="YourName" modified="200611091954" created="200610200252" tags="systemConfig excludeSearch excludeLists">/***\n| Name:|QuickOpenTagPlugin|\n| Description:|Changes tag links to make it easier to open tags as tiddlers|\n| Version:|6.1.1|\n| Date:|01-Oct-2006|\n| Source:|http://mptw.tiddlyspot.com/#QuickOpenTagPlugin|\n| Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|\n| CoreVersion:|2.1.x|\n***/\n//{{{\nconfig.quickOpenTag = {\n\n	dropdownChar: (document.all ? &quot;\su25bc&quot; : &quot;\su25be&quot;), // the little one doesn't work in IE\n\n	createTagButton: function(place,tag,excludeTiddler) {\n		// little hack so we can to &lt;&lt;tag PrettyTagName|RealTagName&gt;&gt;\n		var splitTag = tag.split(&quot;|&quot;);\n		var pretty = tag;\n		if (splitTag.length == 2) {\n			tag = splitTag[1];\n			pretty = splitTag[0];\n		}\n		\n		var sp = createTiddlyElement(place,&quot;span&quot;,null,&quot;quickopentag&quot;);\n		createTiddlyText(createTiddlyLink(sp,tag,false),pretty);\n		\n		var theTag = createTiddlyButton(sp,config.quickOpenTag.dropdownChar,\n                        config.views.wikified.tag.tooltip.format([tag]),onClickTag);\n		theTag.setAttribute(&quot;tag&quot;,tag);\n		if (excludeTiddler)\n			theTag.setAttribute(&quot;tiddler&quot;,excludeTiddler);\n    		return(theTag);\n	},\n\n	miniTagHandler: function(place,macroName,params,wikifier,paramString,tiddler) {\n		var tagged = store.getTaggedTiddlers(tiddler.title);\n		if (tagged.length &gt; 0) {\n			var theTag = createTiddlyButton(place,config.quickOpenTag.dropdownChar,\n                        	config.views.wikified.tag.tooltip.format([tiddler.title]),onClickTag);\n			theTag.setAttribute(&quot;tag&quot;,tiddler.title);\n			theTag.className = &quot;miniTag&quot;;\n		}\n	},\n\n	allTagsHandler: function(place,macroName,params) {\n		var tags = store.getTags();\n		var theDateList = createTiddlyElement(place,&quot;ul&quot;);\n		if(tags.length == 0)\n			createTiddlyElement(theDateList,&quot;li&quot;,null,&quot;listTitle&quot;,this.noTags);\n		for (var t=0; t&lt;tags.length; t++) {\n			var theListItem = createTiddlyElement(theDateList,&quot;li&quot;);\n			var theLink = createTiddlyLink(theListItem,tags[t][0],true);\n			var theCount = &quot; (&quot; + tags[t][1] + &quot;)&quot;;\n			theLink.appendChild(document.createTextNode(theCount));\n			var theDropDownBtn = createTiddlyButton(theListItem,&quot; &quot; +\n			config.quickOpenTag.dropdownChar,this.tooltip.format([tags[t][0]]),onClickTag);\n			theDropDownBtn.setAttribute(&quot;tag&quot;,tags[t][0]);\n		}\n	},\n\n	// todo fix these up a bit\n	styles: \n&quot;/*{{{*/\sn&quot;+\n&quot;/* created by QuickOpenTagPlugin */\sn&quot;+\n&quot;.tagglyTagged .quickopentag, .tagged .quickopentag \sn&quot;+\n&quot;	{ margin-right:1.2em; border:1px solid #eee; padding:2px; padding-right:0px; padding-left:1px; }\sn&quot;+\n&quot;.quickopentag .tiddlyLink { padding:2px; padding-left:3px; }\sn&quot;+\n&quot;.quickopentag a.button { padding:1px; padding-left:2px; padding-right:2px;}\sn&quot;+\n&quot;/* extra specificity to make it work right */\sn&quot;+\n&quot;#displayArea .viewer .quickopentag a.button, \sn&quot;+\n&quot;#displayArea .viewer .quickopentag a.tiddyLink, \sn&quot;+\n&quot;#mainMenu .quickopentag a.tiddyLink, \sn&quot;+\n&quot;#mainMenu .quickopentag a.tiddyLink \sn&quot;+\n&quot;	{ border:0px solid black; }\sn&quot;+\n&quot;#displayArea .viewer .quickopentag a.button, \sn&quot;+\n&quot;#mainMenu .quickopentag a.button \sn&quot;+\n&quot;	{ margin-left:0px; padding-left:2px; }\sn&quot;+\n&quot;#displayArea .viewer .quickopentag a.tiddlyLink, \sn&quot;+\n&quot;#mainMenu .quickopentag a.tiddlyLink \sn&quot;+\n&quot;	{ margin-right:0px; padding-right:0px; padding-left:0px; margin-left:0px; }\sn&quot;+\n&quot;a.miniTag {font-size:150%;} \sn&quot;+\n&quot;#mainMenu .quickopentag a.button \sn&quot;+\n&quot;	/* looks better in right justified main menus */\sn&quot;+\n&quot;	{ margin-left:0px; padding-left:2px; margin-right:0px; padding-right:0px; }\sn&quot; + \n&quot;#topMenu .quickopentag { padding:0px; margin:0px; border:0px; }\sn&quot; +\n&quot;#topMenu .quickopentag .tiddlyLink { padding-right:1px; margin-right:0px; }\sn&quot; +\n&quot;#topMenu .quickopentag .button { padding-left:1px; margin-left:0px; border:0px; }\sn&quot; +\n&quot;/*}}}*/\sn&quot;+\n		&quot;&quot;,\n\n	init: function() {\n		// we fully replace these builtins. can't hijack them easily\n		window.createTagButton = this.createTagButton;\n		config.macros.allTags.handler = this.allTagsHandler;\n		config.macros.miniTag = { handler: this.miniTagHandler };\n		config.shadowTiddlers[&quot;QuickOpenTagStyles&quot;] = this.styles;\n		if (store)\n			store.addNotification(&quot;QuickOpenTagStyles&quot;,refreshStyles);\n		else\n			config.notifyTiddlers.push({name:&quot;QuickOpenTagStyles&quot;, notify: refreshStyles});\n	}\n\n}\n\nconfig.quickOpenTag.init();\n\n//}}}\n</div>
<div tiddler="QuickOpenTagStyle" modifier="YourName" modified="200611091950" created="200611091417" tags="excludeLists">/*{{{*/\n#topMenu .quickopentag { padding:0px; margin:0px; border:0px; }\n#topMenu .quickopentag .tiddlyLink { padding-right:1px; margin-right:0px; }\n#topMenu .quickopentag .button { padding-left:1px; margin-left:0px; border:0px; }\n/*}}}*/</div>
<div tiddler="RenameTagsPlugin" modifier="YourName" modified="200611091954" created="200610200252" tags="systemConfig excludeSearch excludeLists">/***\n| Name:|RenameTagsPlugin|\n| Description:|Allows you to easily rename or delete tags across multiple tiddlers|\n| Version:|6.1.18|\n| Date:|18-Oct-2006|\n| Source:|http://mptw.tiddlyspot.com/#RenameTagsPlugin|\n| Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|\n| CoreVersion:|2.1.x|\nRename a tag and you will be prompted to rename it in all its tagged tiddlers.\n***/\n//{{{\nconfig.renameTags = {\n\n	prompts: {\n		rename: &quot;Rename the tag '%0' to '%1' in %2 tidder%3?&quot;,\n		remove: &quot;Remove the tag '%0' from %1 tidder%2?&quot;\n	},\n\n	removeTag: function(tag,tiddlers) {\n		store.suspendNotifications();\n		for (var i=0;i&lt;tiddlers.length;i++) {\n			store.setTiddlerTag(tiddlers[i].title,false,tag);\n		}\n		store.resumeNotifications();\n		store.notifyAll();\n	},\n\n	renameTag: function(oldTag,newTag,tiddlers) {\n		store.suspendNotifications();\n		for (var i=0;i&lt;tiddlers.length;i++) {\n			store.setTiddlerTag(tiddlers[i].title,false,oldTag); // remove old\n			store.setTiddlerTag(tiddlers[i].title,true,newTag);  // add new\n		}\n		store.resumeNotifications();\n		store.notifyAll();\n	},\n\n	storeMethods: {\n\n		saveTiddler_orig_renameTags: TiddlyWiki.prototype.saveTiddler,\n\n		saveTiddler: function(title,newTitle,newBody,modifier,modified,tags,fields) {\n			if (title != newTitle) {\n				var tagged = this.getTaggedTiddlers(title);\n				if (tagged.length &gt; 0) {\n					// then we are renaming a tag\n					if (confirm(config.renameTags.prompts.rename.format([title,newTitle,tagged.length,tagged.length&gt;1?&quot;s&quot;:&quot;&quot;])))\n						config.renameTags.renameTag(title,newTitle,tagged);\n\n					if (!this.tiddlerExists(title) &amp;&amp; newBody == &quot;&quot;)\n						// dont create unwanted tiddler\n						return null;\n				}\n			}\n			return this.saveTiddler_orig_renameTags(title,newTitle,newBody,modifier,modified,tags,fields);\n		},\n\n		removeTiddler_orig_renameTags: TiddlyWiki.prototype.removeTiddler,\n\n		removeTiddler: function(title) {\n			var tagged = this.getTaggedTiddlers(title);\n			if (tagged.length &gt; 0)\n				if (confirm(config.renameTags.prompts.remove.format([title,tagged.length,tagged.length&gt;1?&quot;s&quot;:&quot;&quot;])))\n					config.renameTags.removeTag(title,tagged);\n			return this.removeTiddler_orig_renameTags(title);\n		}\n\n	},\n\n	init: function() {\n		merge(TiddlyWiki.prototype,this.storeMethods);\n	}\n}\n\nconfig.renameTags.init();\n\n//}}}\n\n</div>
<div tiddler="Research" modifier="ChrisJobling" modified="200706060926" created="200706060926" tags="">! Conferences\n!! Attended\n* [[Innovating e-Learning 2007]]</div>
<div tiddler="Rsync tips" modifier="ChrisJobling" modified="200705080858" created="200705080858" tags="rsync tips howto">To synchronize two directories (Makefile targets):\n{{{\nget:\n	rsync -avuzb --exclude '*~' SRC DST\nput: \n	rsync -Cavuzb --exclude '*~' SRC DST\nsync:\n	get put\n}}}\nTo mirror two directories:\n{{{\nrsync -az -e ssh --delete SRC DST\n}}}\nTo backup a directory:\n{{{\nrsync -Cavz SRC DST\n}}}\n! Explanation of the arguments\n{{{\n-C, --cvs-exclude	auto ignore files in the same way CVS does\n-a, --archive	 	you want recursion and you want to preserve file permissions and ownerships, etc.\n-z, --compress		compress files during transfer\n-v, --verbose		verbose mode\n-u, --update		update, skip files already on the receiver\n-b, --backup		backup\n--exclude		exclude these file \n--delete		delete files that do not exist on the sending side\n-e			alternative remote shell\n}}}</div>
<div tiddler="Sandbox" modifier="ChrisJobling" modified="200604281626" created="200604281626" tags="">Bring your bucket and spade!\n\nTesting testing one two three!</div>
<div tiddler="School Review 2007" modifier="ChrisJobling" modified="200705010940" created="200705010940" tags="">* VDU safety classes will be held 11th, 17th and 23rd May in civil and computation.</div>
<div tiddler="Select" modifier="YourName" modified="200611092011" created="200611090619" tags="excludeLists">Ordinarily, this tiddler would be not be accessible from the default templates, unless you knew to add #Select to the URL.\n\nFor some reason, you have to click //off// of Author, to Default, say, and then click back to Author to get the [[Author]] templates and styles.\n \n&lt;&lt;selectStylesheet&gt;&gt;\n\n&lt;&lt;saveChanges&gt;&gt;\n\n&lt;&lt;search&gt;&gt;</div>
<div tiddler="SelectStylesheetPlugin" modifier="YourName" modified="200611150341" created="200511060404" tags="excludeLists systemConfig">/***\n|''Name:''|SelectStylesheetPlugin|\n|''Source:''|http://www.TiddlyTools.com/#SelectStylesheetPlugin|\n|''Author:''|Eric Shulman - ELS Design Studios|\n|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|\n|''~CoreVersion:''|2.0.10|\n\nSelect alternative TiddlyWiki CSS stylesheet 'themes' from a list of tiddlers tagged with &quot;stylesheets&quot;.\n\n!!!!!Usage\n&lt;&lt;&lt;\nThis plugin defines a macro that creates a stylesheet link or selection listbox/droplist that can be added to the content of any tiddler (such as the OptionsPanel or MainMenu tiddlers).\n\nFirst, create (or import) a custom style sheet tiddler (i.e, a tiddler containing CSS definitions) and tag it with &lt;&lt;tag stylesheets&gt;&gt; so it can be included in the selection list.  Then, add the {{{&lt;&lt;selectStylesheet&gt;&gt;}}} macro to the desired tiddler to display the stylesheet list.  (note: to create a link to apply a specific stylesheet, include the stylesheet tiddlername as a parameter.  See below for more details).\n\nSelect your desired stylesheet from the droplist:\n** ''[system]'' uses the built-in CSS definitions\n** ''[default]'' uses &quot;StyleSheet&quot; tiddler (if present)\n** //tiddlername// uses any named stylesheet\nThe currently selected stylesheet is indicated by a '&gt;' symbol.\n\n//Note: If a selected stylesheet tiddler no longer exists (i.e, the tiddler was deleted or renamed after it had been selected for use), the [default] CSS tiddler (&quot;StyleSheet&quot;) will be used as a fallback.  If this tiddler does not exist either, then the built-in CSS definitions are used.//\n&lt;&lt;&lt;\n!!!!!Parameters\n&lt;&lt;&lt;\nThe selectStylesheet macro accepts parameters to control various features and functions. //Note: while each parameter is optional and may be omitted from the macro, the parameters (when present) must appear in the order shown below.//\n* ''size:nnn''\nDetermines the number of lines to display in the stylesheet list.  If this parameter is omitted or &quot;size:1&quot; is specified, a single-line droplist is created.  When a size &gt; 1 is provided, a standard, fixed-size scrollable listbox is created.  You can use &quot;size:0&quot; or &quot;size:auto&quot; to display a varible-height listbox that automatically adjusts to fit the current list contents without scrolling.\n* ''width:nnn[cm|px|em|%]''\nControls the width of the stylesheet list.  Overrides the built-in CSS width declaration (=100%).  Use standard CSS width units (cm=centimeters, px=pixels, em=M-space, %=proportional to containing area).  You can also use a &quot;.selectStylesheet&quot; custom CSS class definition to override the built-in CSS declarations for the stylesheet list.\n* ''label:text'' and ''prompt:text''\nwhen used in conjunction with a specific named stylesheet to create a stylesheet link (see //tiddlername// param, below), these two parameters define the link text the 'tooltip' text that appears near the mouse pointer when placed over the link, respectively.\n* ''//tiddlername//''\nIf you include a stylesheet //tiddlername// parameter in the macro (e.g., {{{&lt;&lt;selectStylesheet [[Woodshop]]&gt;&gt;}}} then a link will be created instead of a listbox/droplist.  Selecting this link applies the specified stylesheet.  You may use the special keywords ''[system]'' to use the built-in CSS definitions, or ''[none]'' to bypass all stylesheet tiddlers (sometimes useful during CSS debugging).\n\n&lt;&lt;&lt;\n!!!!!Nested Stylesheets\n&lt;&lt;&lt;\nThe CSS definitions for TiddlyWiki are fairly substantial, and stylesheet tiddlers can include hundreds of lines of CSS statements.  Often, these stylesheets will use the exact same CSS for the bulk of their definitions plus several changes or additions to create a difference in appearance.  This results in lots of duplicated CSS definitions that can become difficult to keep 'in sync' with each other.\n\nTo make this problem much easier to manage, you can move the common CSS definitions into separate stylesheet tiddlers.  Then, embed {{{[[tiddlertitle]]}}} references in the original stylesheet tiddlers to re-combine the CSS definitions into a single stylesheet 'theme' to be applied.\n\nWith some clever division of CSS into separate tiddlers, you can quite easily construct dozens of stylesheet combinations.  You can also mark the common CSS tiddlers with tags and use them as overlay stylesheets so you can mix-and-match their styles to create even more 'on-the-fly' stylesheet combinations.\n\nNote: Normally, when rendering tiddler content for display, the {{{[[tiddlertitle]]}}} syntax means &quot;insert a link to this tiddler&quot;.  However, when applying stylesheets, this syntax means &quot;insert the content of this tiddler&quot;\n&lt;&lt;&lt;\n!!!!!Bypassing default shadow styles (for 'CSS gurus')\n&lt;&lt;&lt;\nNormally, TiddlyWiki documents automatically use CSS definitions contained in ''shadow tiddlers:'' StyleSheetLayout, StyleSheetColors, and StyleSheetPrint.  Custom stylesheet definitions are then ''overlayed'' on top of these default styles, allowing you to modify and extend the CSS definitions to suit your desired look-and-feel, by just adding a few lines of CSS, instead of directly modifying the shadow tiddlers (which, while it is allowed, is not recommended).\n\nPrior to version 4.3.0 (2006 August 27), the plugin behavior always bypassed the shadow stylesheets when applying a selected custom stylesheet.  As a result, the custom stylesheet definitions had to contain this syntax: {{{[[StyleSheetLayout]] [[StyleSheetColors]] [[StyleSheetPrint]]}}} to make use of the default CSS definitions.  Unfortunately, this made it awkward to import and use 'standard' StyleSheet tiddlers defined for use without the SelectStylesheetPlugin, as they didn't necessarily contain the needed references to the shadow defaults.\n\n''As of version 4.3.0, SelectStylesheetPlugin no longer bypasses the default shadow stylesheets, so that the {{{[[...]]}}} references to the shadows are not required to include the default styles.''\n\nHowever, if overriding a CSS definition in a custom StyleSheet is simply not sufficient for your needs, you can still ''completely bypass the built-in shadow styles'' by entering\n{{{\nconfig.options.chkBypassShadowStyles=true\n}}}\ninto a tiddler tagged with&lt;&lt;tag systemConfig&gt;&gt; (e.g., &quot;ConfigTweaks&quot;).  This ''internal system value'' causes the plugin to revert to the pre-4.3.0 behavior so that it skips the shadow styles when applying a selected stylesheet.  Note that this setting is not a user-level preference, so it is not presented as a checkbox option nor stored in a cookie, as it is intended to only be set by the //author// of the document.\n&lt;&lt;&lt;\n!!!!!Changing templates or invoking custom javascript from a stylesheet\n&lt;&lt;&lt;\nIn addition to CSS definitions, some TiddlyWiki look-and-feel designs also make adjustments to the TiddlyWiki document structure so that certain document features can be moved, hidden, or otherwise redefined.  The default set of templates that control the document structure are called PageTemplate, ViewTemplate, and EditTemplate.  To select an alternative set of templates, you can include the special psuedo-macro ''{{{&lt;&lt;template prefix&gt;&gt;}}}'' in your stylesheet.  This adds the indicated prefix to the standard template names, and automatically switches to using those templates whenever the stylesheet is selected and applied.\n\nWhenever a document is being viewed in read-only mode (i.e., via http: protocol), an implied template prefix of &quot;Web&quot; is also used, and is inserted between any custom template prefix and the standard template name.  For example, ''{{{&lt;&lt;template Custom&gt;&gt;}}}'' will use {{{CustomWebViewTemplate}}} when the document is in read-only mode.  You can specify an alternative for this implied prefix by including a second prefix parameter in the pseudo-macro.  For example, ''{{{&lt;&lt;template Custom ReadOnly&gt;&gt;}}}'' will use {{{CustomReadOnlyViewTemplate}}}.  Note: if a template tiddler with the indicated combination of custom and read-only prefixes is not available, a suitable fallback template is chosen, first by omitting the custom prefix, then by omitting the read-only prefix, and finally by omitting both, and reverting to the appropriate default template.\n\nIn addition to selecting alternative templates, a stylesheet can also include the psuedo-macro ''{{{&lt;&lt;init tiddlertitle&gt;&gt;}}}'' to execute custom javascript that can access TiddlyWiki internal data and 'core' functions or perform direct manipulation of the currently-rendered DOM elements of the document.  First, place the desired javascript code into one or more tiddlers (note: //although these tiddlers will contain javascript, ''do NOT tag them as 'systemConfig', since this will cause the javascript to be executed every time TW starts'', rather than only when a specific stylesheet has been selected//).  Then, add the ''{{{&lt;&lt;init tiddlertitle&gt;&gt;}}}'' pseudo-macro to your stylesheet so the javascript will be executed when that specific stylesheet is selected and applied.\n\nOf course, when another stylesheet is subsequently selected, other custom javascript functions may be needed to reset whatever TW internal data changes or DOM manipulations were performed by any {{{&lt;&lt;init&gt;&gt;}}} scripts.  You can define tiddlers containing these ''reset'' scripts by embedding ''{{{&lt;&lt;reset tiddlertitle&gt;&gt;}}}'' in your stylesheet definition.  Unlike {{{&lt;&lt;init&gt;&gt;}}} scripts, any tiddlers declared in this way will NOT be executed when the stylesheet is applied, but will be remembered and automatically executed before applying another stylesheet.\n\nNote: These special-purpose psuedo-macros are only executed when the stylesheet containing them is actually in use.  When these macros are rendered as part of the tiddler content (such as when //viewing// a stylesheet definition), the macros simply report their values without performing any actions.\n&lt;&lt;&lt;\n!!!!!Examples\n&lt;&lt;&lt;\nsingle auto-sized listbox\n{{{&lt;&lt;selectStylesheet size:auto width:60%&gt;&gt;}}}\n&lt;&lt;selectStylesheet size:auto width:60%&gt;&gt;\n\ndroplist for stylesheets\n{{{&lt;&lt;selectStylesheet size:1 width:30%&gt;&gt;}}}\n&lt;&lt;selectStylesheet size:1 width:30%&gt;&gt;\n\ninline links to set specific stylesheets\n{{{&lt;&lt;selectStylesheet Woodshop&gt;&gt; or &lt;&lt;selectStylesheet [[Edge of Night]]&gt;&gt; or &lt;&lt;selectStylesheet [default]&gt;&gt;  or &lt;&lt;selectStylesheet [none]&gt;&gt; or &lt;&lt;selectStylesheet label:TiddlyWiki &quot;prompt:The standard TW stylesheet&quot; [system]&gt;&gt;\n}}}\n&lt;&lt;selectStylesheet Woodshop&gt;&gt; or &lt;&lt;selectStylesheet [[Edge of Night]]&gt;&gt; or &lt;&lt;selectStylesheet [default]&gt;&gt;  or &lt;&lt;selectStylesheet [none]&gt;&gt; or &lt;&lt;selectStylesheet label:TiddlyWiki &quot;prompt:The standard TW stylesheet&quot; [system]&gt;&gt;\n\nstylesheet definitions (tagged with &quot;stylesheets&quot;):\n&lt;&lt;tag stylesheets&gt;&gt;\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\nimport (or copy/paste) the following tiddlers into your document:\n''SelectStylesheetPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n^^documentation and javascript for SelectStylesheethandling^^\n\ncreate/edit ''OptionsPanel'':\nAdd &quot;{{{&lt;&lt;selectStylesheet [size:nnn|auto] [width:nnn[cm|px|em|%]&gt;&gt;}}}&quot; macro.\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.11.14'' [4.3.5] in applyPageTemplate(), only force use of selectStylesheet alternative page template if explicit template parameter is NOT provided (i.e., allow other plugin code to pass a value for the template).  Based on a request by Paulo Soares.\n''2006.11.12'' [4.3.4] in applyStylesheets(), moved invocation of 'reset' handlers so they occur BEFORE switching to another template. (thanks to UdoBorkowski for the bug report)\n''2006.11.11'' [4.3.3] in initSelectStylesheetNotification(), hijack previously registered notifications for refreshPageTemplate() in addition to refreshStyles().  This ensures that non-default PageTemplate is displayed when document is first loaded (thanks to AndresLister for bug report).\n''2006.11.11'' [4.3.2] in applyStylesheets(), use getRecursiveTiddlerText() instead of getTiddlerText() to retrieve system-default shadow stylesheet. (thanks to UdoBorkowski for the bug report)\n''2006.09.26'' [4.3.1] in applyStylesheets(), corrected setting of StyleSheetPrint.  Restored &quot;[none]&quot; choice in listbox.\n''2006.08.27'' [4.3.0] in applyStylesheets(), changed default so that shadow stylesheets are automatically applied ALONG WITH the selected custom stylesheet. Use config.options.chkBypassShadowStyles=true to revert to the prior handling (i.e., skip the shadow stylesheets)\n''2006.08.26'' [4.2.7] in applyStylesheets(), added depth-limiting param to getRecursiveTiddlerText() to avoid inifinite recursion.  Note: limits nesting of stylesheets to 10 levels (same as core).\n''2006.06.28 [4.2.6]'' added 'nocookie' param to set(), so &quot;style:xyz&quot; param can **temporarily** override stylesheet (by NOT overwriting the cookie value)\n''2006.05.18 [4.2.5]'' revert to 'onchange' handling, BUT... don't *reload* the list contents each time selection changes (just move the &quot;&gt;&quot; indicator to the current item instead), AND... track onkeydown/up to avoid FF crash due to excess calls to set() when scrolling a listbox by holding down arrow keys.\n''2006.05.15 [4.2.4]'' switch from 'onchange' listbox handling to 'onclick' and 'onkeyup'.  Avoids FF **CRASH** due to stylesheets being excessively refreshed *during* onchange due to keyboard event handling.\n''2006.04.21 [4.2.3]'' recognize &quot;stylesheet&quot; tag when building list of available stylesheets (in addition to plural, &quot;stylesheets&quot;)\n''2006.04.05 [4.2.2]'' in applyStylesheet(), reverted change from 4.2.0: *don't* apply &quot;StyleSheetColors&quot; and &quot;StyleSheetLayout&quot; along with selected stylesheet, so custom stylesheet can completely bypass the default formatting.  To include default formatting in a stylesheet, embed &quot;[[StyleSheetColors]] [[StyleSheetLayout]]&quot; \n''2006.03.30 [4.2.1]'' in applyStylesheet(), change calls from &quot;window.eval()&quot; to just &quot;eval()&quot; to avoid FF1501 'global variable crash' problem \n''2006.03.30 [4.2.0]'' remove [none] choice from listbox.  Added handling for &lt;&lt;selectStylesheet sheetname&gt;&gt; to create a link that applies the specified sheet instead of presenting a listbox of available sheets.  added &quot;style:&quot; paramifier.  Apply &quot;StyleSheetColors&quot; and &quot;StyleSheetLayout&quot; along with selected stylesheet (i.e., overlay selected sheet on top of shadow styles instead of replacing default shadow styles).  Based on suggestions from Clint Checketts.\n''2006.03.09 [4.1.4]'' in refreshSelectStylesheet(), make sure that tiddler named in stylesheet cookie value still exists before attempting to select it in the listbox.\n''2006.02.25 [4.1.3]'' Problem: the &quot;&gt;&quot; indicator was not always being refreshed, due to event &quot;timing&quot; issues.  refreshSelectStylesheet() deferred for 10msec so it will execute *after* onChangeSelectStylesheet event processing has completed.\n''2006.02.24 [4.1.2]'' Problem: {{{&lt;&lt;template&gt;&gt;}}} macro was not being processed in IE.\nCause: regexp processing creates browser-internal &quot;private globals&quot; used to keep track of the regexp parser's state, including the current 'scan' position within the source string.  This lets you use search() and exec() inside loops to scan for successive pattern matches.  In applyStyleSheet(), &quot;theCSS.search(templateRegExp)&quot; was called before &quot;theCSS.exec(templateRegExp)&quot;.  As a result, the regexp parser had already matched the {{{&lt;&lt;template&gt;&gt;}}} macro embedded in the CSS and thus did not actually process the macro and switch the templates.\nFix: use {{{indexOf(&quot;&lt;&lt;template&quot;)}}} instead of search(templateRegExp) to check for presence of template switching macro in CSS.\n''2006.02.23 [4.1.1]'' performance fixes: in switchTemplates(), added default init of 'altTemplate' value to prevent unneeded triggering of refreshPageTemplate() during TW load-time when using standard templates.  Saves LOTS of startup time and avoids the dreaded &quot;script is running slowly&quot; FireFox warnings.\nAlso, the forEachTiddler() call to force a &quot;refresh all tiddlers&quot; (needed when view/edit templates are changed) was moved from applyPageTemplate() and is now called directly from switchTemplates().  This eliminates redundant re-rendering of tiddlers while the page template is being refreshed.\n''2006.02.21 [4.1.0]'' added {{{&lt;&lt;template&gt;&gt;}}} pseudo-macro with new switchTemplate() function.  Allows stylsheets to switch page/view/edit templates by adding a prefix to standard template names.  Detects readOnly mode and automatically adds &quot;Web&quot; to template name (e.g. &quot;MyWebViewTemplate&quot;).  Defines &quot;Web&quot; shadow templates and &quot;viewSource&quot; toolbar command.\n''2006.02.21 [4.0.3]'' added real macro handlers for psuedo-macros &quot;init&quot;, &quot;reset&quot; so they will display in the stylesheet tiddler without appearing as an error.\n''2006.01.20 [4.0.2]'' add 'var' to unintended global variable declarations and wrapped notification hijack in init function to eliminate globals and avoid FireFox 1.5.0.1 crash bug when referencing globals\n''2006.01.20 [4.0.1]'' Added optional &quot;init&quot; keyword for {{{&lt;&lt;init tiddlertitle&gt;&gt;}}} psuedo-macro syntax (note: previous {{{&lt;&lt;tiddlertitle&gt;&gt;}}} syntax still permitted)\nRevised documentation to better describe use of init/reset for custom code invokation.\n''2005.11.05 [4.0.0]'' Entire plugin simplified in response to new &quot;shadow stylesheet&quot; architecture introduced in TW1.2.37.  Concept of separate overlays has been removed.  Stylesheet themes are assembled using [[tiddler]] 'nesting' syntax, and tagged as 'stylesheet'.  A single listbox/droplist is provided to select themes.\n''2005.10.25 [3.1.0]'' added support for embedding {{{&lt;&lt;reset tiddlertitle&gt;&gt;}}} companion code (to declare 'DOM cleanup' routines invoked when a stylesheet is UNloaded)\n//Based on a request from ClintChecketts//\n''2005.10.09 [3.0.1]'' combined documentation and code in a single tiddler\n''2005.08.15 [3.0.0]'' Another major re-write.  Replaced separate &quot;selectOverlays&quot; macro definition with 'overlays' parameter on 'selectStylesheet' macro.  Added support for embedding {{{&lt;&lt;tiddlertitle&gt;&gt;}}} companion code.  applyStylesheets() completely re-designed to address quirks with loading and combining multiple stylesheets using browser-specific native handling, as well as add support for executing companion code.  Stylesheets+overlays+code are now handled in a platform-neutral manner that avoids differences between browser implementations and uses much less overhead in the DOM.\n''2005.08.07 [2.0.0]'' Major re-write to not use static ID values for listbox controls, so that multiple macro instances can exist without corrupting each other or the DOM.  Moved HTML and CSS definitions into plugin code instead of using separate tiddlers.  Added new features: support for multiple groups of overlay stylesheets with collapsible tree display. Added size and width params for listbox display.\n''2005.07.27 [1.0.3]'' core update 1.2.29: custom overlayStyleSheet() replaced with new core setStylesheet()\n''2005.07.25 [1.0.2]'' correct 'fallback' handling in selectStyleSheet()\n''2005.07.23 [1.0.1]'' added parameter checks and corrected addNotification() usage\n''2005.07.20 [1.0.0]'' Initial Release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]].  Thanks to David Jaquith for testing and bug reports and SteveRumsby for feature suggestions.\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.selectStylesheet = {major: 4, minor: 3, revision: 5, date: new Date(2006,11,14)};\n\n// IE needs explicit global scoping for functions/vars called from browser events\nwindow.refreshSelectStylesheet=refreshSelectStylesheet;\nwindow.applyStylesheets=applyStylesheets;\n\nif (!config.options.txtStyleSheet) config.options.txtStyleSheet=&quot;StyleSheet&quot;;\n//}}}\n\n//{{{\n// define macro rendering handler\nconfig.macros.selectStylesheet = { };\nconfig.macros.selectStylesheet.reset = [];\nconfig.macros.selectStylesheet.handler = function(place,macroName,params) {\n	setStylesheet(&quot;.selectStylesheet {width:100%;font-size:8pt;margin:0em}&quot;,&quot;selectStylesheetPlugin&quot;);\n	var autosize=1;\n	if (params[0] &amp;&amp; (params[0]==&quot;size:auto&quot;))\n		{ autosize=0; params.shift(); }\n	if (params[0] &amp;&amp; (params[0].substr(0,5)==&quot;size:&quot;))\n		autosize=(params.shift()).substr(5);\n	if (params[0] &amp;&amp; (params[0].substr(0,6)==&quot;width:&quot;))\n		var width=(params.shift()).substr(6);\n	if (params[0] &amp;&amp; (params[0].substr(0,6)==&quot;label:&quot;))\n		var label=(params.shift()).substr(6);\n	if (params[0] &amp;&amp; (params[0].substr(0,7)==&quot;prompt:&quot;))\n		var prompt=(params.shift()).substr(7);\n	if (params[0] &amp;&amp; params[0].trim().length) // create a link that sets a specific stylesheet\n		createTiddlyButton(place,label?label:params[0],prompt?prompt:params[0], function(){config.macros.selectStylesheet.set(params[0]); return false;});\n	else { // create a select list of available stylesheets\n		var theList=createTiddlyElement(place,&quot;select&quot;,null,&quot;selectStylesheet&quot;,null);\n		theList.onkeydown=function() // track keystrokes for listbox only\n			{ if (this.size&gt;1 &amp;&amp; !this.keydown) { this.keydown=true; this.previousIndex=this.selectedIndex; } return true; };\n		theList.onkeyup=function()\n			{ if (this.keydown) { this.keydown=false; if (this.selectedIndex!=this.previousIndex) config.macros.selectStylesheet.set(this.value); } return true; };\n		theList.onchange=function()\n			{ if (!this.keydown) config.macros.selectStylesheet.set(this.value); return true; };\n		theList.size=1;\n		theList.autosize=autosize;\n		if (width) theList.style.width=width;\n		store.addNotification(null,refreshSelectStylesheet);\n		refreshSelectStylesheet();\n	}\n}\nconfig.macros.selectStylesheet.set = function(theSheet,nocookie) {\n	if (!theSheet || !theSheet.trim().length) return;\n	var allStyleLists=getElementsByClass(&quot;selectStylesheet&quot;);\n	for (var k=0; k&lt;allStyleLists.length; k++) {\n		var theList=allStyleLists[k];\n		for (var t=0; t&lt;theList.options.length; t++)	 {\n			if (theList.options[t].text.substr(0,1)==&quot;&gt;&quot;)\n				theList.options[t].text=String.fromCharCode(160)+String.fromCharCode(160)+theList.options[t].text.substr(1);\n			if ((theList.options[t].value==theSheet) || (theSheet==&quot;[default]&quot; &amp;&amp; theList.options[t].value==&quot;StyleSheet&quot;))\n				{ theList.options[t].text=&quot;&gt;&quot;+theList.options[t].text.substr(2); theList.selectedIndex=t; }\n		}\n	}\n	config.options.txtStyleSheet=theSheet;\n	if (!nocookie) saveOptionCookie(&quot;txtStyleSheet&quot;);\n	applyStylesheets();\n	return;\n}\nif (config.paramifiers) config.paramifiers.style = { onstart: function(theSheet) { config.macros.selectStylesheet.set(theSheet,true); } };\n\n// set to TRUE to enable debugging status messages when stylesheets are applied\nconfig.macros.selectStylesheet.verbose = false;\n\n// hijack existing notifications for refreshStyles() and refreshPageTemplate() handlers\ninitSelectStylesheetNotification();\nfunction initSelectStylesheetNotification() {\n	for (var i=0; i&lt;store.namedNotifications.length; i++) {\n		if (store.namedNotifications[i].notify==window.refreshStyles)\n			store.namedNotifications[i].notify=applyStylesheets;\n		if (store.namedNotifications[i].notify==window.refreshPageTemplate)\n			store.namedNotifications[i].notify=applyPageTemplate;\n	}\n}\n\n// hijack refreshStyles() handler\nconfig.macros.selectStylesheet.coreRefreshStyles = window.refreshStyles;\nwindow.refreshStyles=applyStylesheets;\n\n// hijack refreshPageTemplate() handler\nconfig.macros.selectStylesheet.coreRefreshPageTemplate = window.refreshPageTemplate;\nwindow.refreshPageTemplate=applyPageTemplate;\n\nfunction getElementsByClass(classname)\n{\n	var arr=new Array();\n	var count=0;\n	var all=document.all? document.all : document.getElementsByTagName(&quot;*&quot;);\n	for (var i=0; i&lt;all.length; i++)\n		if (all[i].className==classname)\n			arr[count++]=all[i];\n	return arr;\n}\n\nfunction refreshSelectStylesheet()\n{\n	var indent = String.fromCharCode(160)+String.fromCharCode(160)+String.fromCharCode(160);\n	// for all instances of the selectStylesheet control\n	var allStyleLists=getElementsByClass(&quot;selectStylesheet&quot;);\n	for (var k=0; k&lt;allStyleLists.length; k++) {\n		var theList=allStyleLists[k];\n		// clear current list contents\n		while (theList.length &gt; 0) { theList.options[0] = null; }\n		theList.selectedIndex=-1;\n		// fill the stylesheet list\n		var count=0;\n		// prompt text\n		theList.options[count++] = new Option(&quot;select a stylesheet:&quot;,&quot;&quot;,false,false);\n		// option: none (built-in hard-coded CSS only)\n		theList.options[count++] = new Option(indent+&quot;[none]&quot;,&quot;[none]&quot;,false,false);\n		// option: default (built-in plus shadow stylesheets)\n		theList.options[count++] = new Option(indent+&quot;[system]&quot;,&quot;[system]&quot;,false,false);\n		// option: StyleSheet tiddler, if present\n		if (store.getTiddler(&quot;StyleSheet&quot;)!=undefined)\n			theList.options[count++] = new Option(indent+&quot;[default]&quot;,&quot;StyleSheet&quot;,false,false);\n		// options: CSS tiddlers tagged with &quot;stylesheets&quot; or &quot;stylesheet&quot;\n		var theSheets=store.getTaggedTiddlers(&quot;stylesheets&quot;).concat(store.getTaggedTiddlers(&quot;stylesheet&quot;));\n		for (var i=0; i&lt;theSheets.length; i++) {\n			var theTitle=theSheets[i].title;\n			if (theTitle==&quot;StyleSheet&quot;) continue;\n			theList.options[count++] = new Option(indent+theTitle,theTitle,false,false);\n		}\n		// make sure the requested stylesheet exists, fallback if not...\n		var theSheet=config.options.txtStyleSheet;\n		if (theSheet!=&quot;[none]&quot; &amp;&amp; theSheet!=&quot;[system]&quot; &amp;&amp; !store.getTiddler(theSheet)) theSheet=&quot;StyleSheet&quot;;\n		if (!store.getTiddler(theSheet)) theSheet=&quot;[system]&quot;;\n		// set the listbox selection to current stylesheet\n		theList.selectedIndex=0;	// default to first item\n		for (var t=0; t&lt;theList.options.length; t++)	\n			if (theList.options[t].value==theSheet)\n				{ theList.selectedIndex=t; break; }\n		theList.options[t].text=&quot;&gt;&quot;+theList.options[t].text.substr(2);\n		// autosize as appropriate\n		theList.size=(theList.autosize&lt;1)?theList.options.length:theList.autosize;\n	} // end of &quot;for all instances&quot;\n}\n//}}}\n\n//{{{\nconfig.macros.selectStylesheet.templates = { };\nfunction switchTemplates(which,readOnlyPrefix)\n{\n	// remember original templates (init only)\n	if (!config.macros.selectStylesheet.templates.originalpage)\n		config.macros.selectStylesheet.templates.originalpage = &quot;PageTemplate&quot;;\n	if (!config.macros.selectStylesheet.templates.originalview)\n		config.macros.selectStylesheet.templates.originalview = config.tiddlerTemplates[1];\n	if (!config.macros.selectStylesheet.templates.originaledit)\n		config.macros.selectStylesheet.templates.originaledit = config.tiddlerTemplates[2];\n	if (!config.macros.selectStylesheet.altTemplate)\n		config.macros.selectStylesheet.altTemplate=&quot;&quot;;\n\n	// define shorthand variables just for code readability \n	var page=config.macros.selectStylesheet.templates.originalpage;\n	var view=config.macros.selectStylesheet.templates.originalview;\n	var edit=config.macros.selectStylesheet.templates.originaledit;\n\n	// get 'readOnly' mode... set by TW core, but not until after the plugin is loaded, so we need to do this here as well...\n	var loc = document.location.href;\n	if (readOnly==undefined)\n		var readOnly = (loc.substr(0,4) == &quot;http&quot; || loc.substr(0,3) == &quot;ftp&quot;) ? config.options.chkHttpReadOnly : false;\n\n	// get prefix defaults\n	if (!which) var which=&quot;&quot;;\n	if (!readOnlyPrefix) var readOnlyPrefix = &quot;Web&quot;;\n	if (!readOnly) readOnlyPrefix=&quot;&quot;;\n	var alt = which+readOnlyPrefix;\n\n	var msg=&quot;current template prefix: '%0', requested template prefix '%1'&quot;;\n	if (config.macros.selectStylesheet.verbose) alert(msg.format([config.macros.selectStylesheet.altTemplate,alt]));\n\n	// only switch if really changing templates\n	if (alt == config.macros.selectStylesheet.altTemplate) return;\n\n	// remember which templates are being used\n	config.macros.selectStylesheet.altTemplate = alt;\n\n	// set page template, with fallbacks for missing combinations\n	var pageTemplate=alt+page;\n	if (!store.getTiddlerText(pageTemplate)) pageTemplate=which+page;\n	if (!store.getTiddlerText(pageTemplate)) pageTemplate=readOnlyPrefix+page;\n	if (!store.getTiddlerText(pageTemplate)) pageTemplate=page;\n	config.macros.selectStylesheet.templates.currentpage = pageTemplate;\n\n	// set view template, with fallbacks for missing combinations\n	var viewTemplate=alt+view;\n	if (!store.getTiddlerText(viewTemplate)) viewTemplate=which+view;\n	if (!store.getTiddlerText(viewTemplate)) viewTemplate=readOnlyPrefix+view;\n	if (!store.getTiddlerText(viewTemplate)) viewTemplate=view;\n	config.tiddlerTemplates[1] = config.macros.selectStylesheet.templates.currentview = viewTemplate;\n\n	// set edit template, with fallbacks for missing combinations\n	var editTemplate=alt+edit;\n	if (!store.getTiddlerText(editTemplate)) editTemplate=which+edit;\n	if (!store.getTiddlerText(editTemplate)) editTemplate=readOnlyPrefix+edit;\n	if (!store.getTiddlerText(editTemplate)) editTemplate=edit;\n	config.tiddlerTemplates[2] = config.macros.selectStylesheet.templates.currentedit = editTemplate;\n\n	var msg=&quot;switching to templates: %0, %1, %2&quot;;\n	if (config.macros.selectStylesheet.verbose) alert(msg.format([pageTemplate,viewTemplate,editTemplate]));\n\n	// apply page template\n	window.applyPageTemplate();\n	// apply view/edit templates\n	story.forEachTiddler(function(title,element) { this.refreshTiddler(title,null,true);});\n\n}\n// Hijack refreshPageTemplate to force alternative template to be used (if any)\nfunction applyPageTemplate(template)\n{\n	var cw=document.getElementById(&quot;contentWrapper&quot;);\n	cw.style.display=&quot;none&quot;;\n	if (!template) var template=config.macros.selectStylesheet.templates.currentpage;\n	if (config.macros.selectStylesheet.verbose) alert(&quot;Apply PageTemplate: %0&quot;.format([template]));\n	config.macros.selectStylesheet.coreRefreshPageTemplate(template);\n	cw.style.display=&quot;block&quot;;\n}\n//}}}\n\n//{{{\nfunction applyStylesheets()\n{\n	// define pattern to match executable &lt;&lt;tiddlername&gt;&gt; references embedded in CSS text\n	var setTiddlerRegExp = new RegExp(&quot;(?:&lt;&lt;(?:init )([^&gt;]+)&gt;&gt;)&quot;,&quot;mg&quot;);\n	var resetTiddlerRegExp = new RegExp(&quot;(?:&lt;&lt;reset ([^&gt;]+)&gt;&gt;)&quot;,&quot;mg&quot;);\n	var templateRegExp = new RegExp(&quot;(?:&lt;&lt;template ([^\ss&gt;]+)( [^&gt;]+)?&gt;&gt;)&quot;,&quot;mg&quot;);\n\n	// make sure the requested stylesheet exists, fallback if not...\n	var theSheet=config.options.txtStyleSheet;\n	switch (theSheet) {\n		case &quot;[none]&quot;:\n		case &quot;[system]&quot;:\n			break;\n		default:\n			if (!store.getTiddler(theSheet)) theSheet=&quot;StyleSheet&quot;;\n			if (!store.getTiddler(theSheet)) theSheet=&quot;[system]&quot;;\n			break;\n	}\n\n	// When store.NotifyAll() is invoked, it can trigger multiple calls to applyStylesheets(),\n	// even though only one is needed to set the styles and render things properly.  The extra calls\n	// add unnecessary processing overhead by performing multiple re-rendering of entire TW display,\n	// often resulting in &quot;slow script&quot; warnings.  To avoid this, we can track the last stylesheet that\n	// was applied and only apply the current requested sheet if it is really a different sheet, OR\n	// if the TW contents have actually changed (which might include changes to the current stylesheet)\n	if (theSheet==config.macros.selectStylesheet.current &amp;&amp; !store.dirty) return;\n	config.macros.selectStylesheet.current=theSheet;\n\n	// get the primary stylesheet CSS\n	var msg=&quot;stylesheet: '%0'&quot;;\n	if (config.macros.selectStylesheet.verbose) alert(msg.format([theSheet]));\n	var theCSS = (theSheet.substr(0,1)=='[')?&quot;&quot;:store.getRecursiveTiddlerText(theSheet,&quot;&quot;,10);\n	if (theSheet.substr(0,1)!='[') store.addNotification(theSheet,refreshStyles);\n\n	// execute any saved stylesheet 'reset' code tiddlers\n	while (config.macros.selectStylesheet.reset.length) {\n		var tiddler=config.macros.selectStylesheet.reset.shift();\n		var msg=&quot;stylesheet reset macro: '%0'&quot;;\n		if (config.macros.selectStylesheet.verbose) alert(msg.format([tiddler]));\n		var msg=&quot;error in '%0': %1&quot;;\n		try { eval(store.getTiddlerText(tiddler)); }\n		catch(e) { displayMessage(msg.format([tiddler,e.toString()])); }\n	}\n\n	// if &lt;&lt;template&gt;&gt; reference is not specified, reset to standard template\n	if (theCSS.indexOf(&quot;&lt;&lt;template&quot;)==-1) switchTemplates();\n\n	// execute any embedded &lt;&lt;template&gt;&gt; references\n	do {\n		var match = templateRegExp.exec(theCSS);\n		if(match &amp;&amp; match[1]) switchTemplates(match[1],match[2]);\n	} while(match);\n	// filter out embedded &lt;&lt;template&gt;&gt; references\n	theCSS = theCSS.replace(templateRegExp,&quot;&quot;);\n\n	// save embedded &lt;&lt;reset tiddlername&gt;&gt; references\n	do {\n		var match = resetTiddlerRegExp.exec(theCSS);\n		if(match &amp;&amp; match[1])\n			config.macros.selectStylesheet.reset.push(match[1]);\n	} while(match);\n	// filter out embedded &lt;&lt;reset tiddlername&gt;&gt; references\n	theCSS = theCSS.replace(resetTiddlerRegExp,&quot;&quot;);\n\n	// execute any embedded &lt;&lt;init tiddlername&gt;&gt; references\n	do {\n		var match = setTiddlerRegExp.exec(theCSS);\n		if(match &amp;&amp; match[1]) {\n			var msg=&quot;stylesheet macro: '%0'&quot;;\n			if (config.macros.selectStylesheet.verbose) alert(msg.format([match[1]]));\n			var msg=&quot;error in '%0': %1&quot;;\n			try { eval(store.getTiddlerText(match[1])); }\n			catch(e) { displayMessage(msg.format([match[1],e.toString()])); }\n		}\n	} while(match);\n	// filter out embedded &lt;&lt;set tiddlername&gt;&gt; references\n	theCSS = theCSS.replace(setTiddlerRegExp,&quot;&quot;);\n\n	// finally, apply the styles\n	switch (theSheet) {\n		case &quot;[none]&quot;: // no styles\n			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheetColors&quot;);\n			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheetLayout&quot;);\n			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheetPrint&quot;);\n			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheet&quot;);\n			break;\n		case &quot;[system]&quot;: // default styles only\ntheSheet,&quot;&quot;,10\n			setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetLayout&quot;,&quot;&quot;,10),&quot;StyleSheetLayout&quot;);\n			setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetColors&quot;,&quot;&quot;,10),&quot;StyleSheetColors&quot;);\n			setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetPrint&quot;,&quot;&quot;,10),&quot;StyleSheetPrint&quot;);\n			setStylesheet(&quot;&quot;,&quot;StyleSheet&quot;);\n			break;\n		default: // alternative stylesheet *replaces* default styles\n			if (config.options.chkBypassShadowStyles) { // NOTE: hard-coded value, not saved as cookie, adjust in &quot;ConfigTweaks&quot;\n				// stylesheet *replaces* default styles\n				setStylesheet(&quot;/* overridden by [[&quot;+theSheet+&quot;]] */&quot;,&quot;StyleSheetLayout&quot;);\n				setStylesheet(&quot;/* overridden by [[&quot;+theSheet+&quot;]] */&quot;,&quot;StyleSheetColors&quot;);\n				setStylesheet(&quot;/* overridden by [[&quot;+theSheet+&quot;]] */&quot;,&quot;StyleSheetPrint&quot;);\n			}\n			else {\n				// stylesheet *overlays* default styles\n				setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetLayout&quot;,&quot;&quot;,10),&quot;StyleSheetLayout&quot;);\n				setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetColors&quot;,&quot;&quot;,10),&quot;StyleSheetColors&quot;);\n				setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetPrint&quot;,&quot;&quot;,10),&quot;StyleSheetPrint&quot;);\n			}\n			setStylesheet(theCSS,&quot;StyleSheet&quot;);\n			break;\n	}\n}\n\nconfig.macros.init = { };\nconfig.macros.init.handler = function(place,macroName,params)\n	{ var out=&quot;init: [[%0]]&quot;; wikify(out.format(params),place); }\nconfig.macros.reset = { };\nconfig.macros.reset.handler = function(place,macroName,params)\n	{ var out=&quot;reset: [[%0]]&quot;; wikify(out.format(params),place); }\nconfig.macros.template = { };\nconfig.macros.template.handler = function(place,macroName,params)\n	{ var out=&quot;use template prefix: ''%0 %1''&quot;; wikify(out.format(params),place); }\n\n//}}}</div>
<div tiddler="SideBarOptions" modifier="YourName" modified="200611091924" created="200611090615" tags="excludeLists">&lt;&lt;search&gt;&gt;\n+++[Take Notes (if offline)]\n&lt;&lt;selectStylesheet Student&gt;&gt;\n===</div>
<div tiddler="SideBarTabs" modifier="YourName" modified="200611091950" created="200611090632" tags="excludeLists">&lt;&lt;tabs txtMainTab Timeline Timeline TabTimeline All 'All tiddlers' TabAll Tags 'All tags' TabTags&gt;&gt;</div>
<div tiddler="SinglePageModePlugin" modifier="YourName" modified="200611092001" created="200512271815" tags="systemConfig addon includeNew excludeLists">/***\n|''Name:''|SinglePageModePlugin|\n|''Source:''|http://www.TiddlyTools.com/#SinglePageModePlugin|\n|''Author:''|Eric Shulman - ELS Design Studios|\n|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|\n|''~CoreVersion:''|2.0.10|\n\nNormally, as you click on the links in TiddlyWiki, more and more tiddlers are displayed on the page. The order of this tiddler display depends upon when and where you have clicked. Some people like this non-linear method of reading the document, while others have reported that when many tiddlers have been opened, it can get somewhat confusing.\n\n!!!!!Usage\n&lt;&lt;&lt;\nSinglePageMode allows you to configure TiddlyWiki to navigate more like a traditional multipage web site with only one item displayed at a time.  When SinglePageMode is enabled, the title of the current tiddler is automatically displayed in the browser window's titlebar and the browser's location URL is updated with a 'permalink' for the current tiddler so that it is easier to create a browser 'bookmark' for the current tiddler.\n\nEven when SinglePageMode is disabled (i.e., displaying multiple tiddlers is permitted), you can reduce the potential for confusion by enable TopOfPageMode, which forces tiddlers to always open at the top of the page instead of being displayed following the tiddler containing the link that was clicked.\n&lt;&lt;&lt;\n!!!!!Configuration\n&lt;&lt;&lt;\nWhen installed, this plugin automatically adds checkboxes in the AdvancedOptions tiddler so you can enable/disable the plugin behavior.  For convenience, these checkboxes are also included here:\n\n&lt;&lt;option chkSinglePageMode&gt;&gt; Display one tiddler at a time\n&lt;&lt;option chkTopOfPageMode&gt;&gt; Always open tiddlers at the top of the page\n&lt;&lt;&lt;\n!!!!!Installation\n&lt;&lt;&lt;\nimport (or copy/paste) the following tiddlers into your document:\n''SinglePageModePlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)\n^^documentation and javascript for SinglePageMode handling^^\n\nWhen installed, this plugin automatically adds checkboxes in the ''shadow'' AdvancedOptions tiddler so you can enable/disable this behavior.  However, if you have customized your AdvancedOptions, you will need to ''manually add these checkboxes to your customized tiddler.''\n&lt;&lt;&lt;\n!!!!!Revision History\n&lt;&lt;&lt;\n''2006.07.04 [2.2.1]'' in hijack for displayTiddlers(), suspend TPM as well as SPM so that DefaultTiddlers displays in the correct order.\n''2006.06.01 [2.2.0]'' added chkTopOfPageMode (TPM) handling\n''2006.02.04 [2.1.1]'' moved global variable declarations to config.* to avoid FireFox 1.5.0.1 crash bug when assigning to globals\n''2005.12.27 [2.1.0]'' hijack displayTiddlers() so that SPM can be suspended during startup while displaying the DefaultTiddlers (or #hash list).  Also, corrected initialization for undefined SPM flag to &quot;false&quot;, so default behavior is to display multiple tiddlers\n''2005.12.27 [2.0.0]'' Update for TW2.0\n''2005.11.24 [1.1.2]'' When the back and forward buttons are used, the page now changes to match the URL.  Based on code added by Clint Checketts\n''2005.10.14 [1.1.1]'' permalink creation now calls encodeTiddlyLink() to handle tiddler titles with spaces in them\n''2005.10.14 [1.1.0]'' added automatic setting of window title and location bar ('auto-permalink').  feature suggestion by David Dickens.\n''2005.10.09 [1.0.1]'' combined documentation and code in a single tiddler\n''2005.08.15 [1.0.0]'' Initial Release\n&lt;&lt;&lt;\n!!!!!Credits\n&lt;&lt;&lt;\nThis feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]].\nSupport for BACK/FORWARD buttons adapted from code developed by Clint Checketts\n&lt;&lt;&lt;\n!!!!!Code\n***/\n//{{{\nversion.extensions.SinglePageMode= {major: 2, minor: 2, revision: 1, date: new Date(2006,7,3)};\n\nif (config.options.chkSinglePageMode==undefined) config.options.chkSinglePageMode=false;\nconfig.shadowTiddlers.AdvancedOptions += &quot;\sn&lt;&lt;option chkSinglePageMode&gt;&gt; Display one tiddler at a time&quot;;\n\nif (config.options.chkTopOfPageMode==undefined) config.options.chkTopOfPageMode=false;\nconfig.shadowTiddlers.AdvancedOptions += &quot;\sn&lt;&lt;option chkTopOfPageMode&gt;&gt; Always open tiddlers at the top of the page&quot;;\n\nconfig.SPMTimer = 0;\nconfig.lastURL = window.location.hash;\nfunction checkLastURL()\n{\n	if (!config.options.chkSinglePageMode)\n		{ window.clearInterval(config.SPMTimer); config.SPMTimer=0; return; }\n	if (config.lastURL == window.location.hash)\n		return;\n	var tiddlerName = convertUTF8ToUnicode(decodeURI(window.location.hash.substr(1)));\n	tiddlerName=tiddlerName.replace(/\s[\s[/,&quot;&quot;).replace(/\s]\s]/,&quot;&quot;); // strip any [[ ]] bracketing\n	if (tiddlerName.length) story.displayTiddler(null,tiddlerName,1,null,null);\n}\n\nif (Story.prototype.SPM_coreDisplayTiddler==undefined) Story.prototype.SPM_coreDisplayTiddler=Story.prototype.displayTiddler;\nStory.prototype.displayTiddler = function(srcElement,title,template,animate,slowly)\n{\n	if (config.options.chkSinglePageMode) {\n		window.location.hash = encodeURIComponent(String.encodeTiddlyLink(title));\n		config.lastURL = window.location.hash;\n		document.title = wikifyPlain(&quot;SiteTitle&quot;) + &quot; - &quot; + title;\n		story.closeAllTiddlers();\n		if (!config.SPMTimer) config.SPMTimer=window.setInterval(function() {checkLastURL();},1000);\n	}\n	if (config.options.chkTopOfPageMode) { story.closeTiddler(title); window.scrollTo(0,0); srcElement=null; }\n	this.SPM_coreDisplayTiddler(srcElement,title,template,animate,slowly)\n}\n\nif (Story.prototype.SPM_coreDisplayTiddlers==undefined) Story.prototype.SPM_coreDisplayTiddlers=Story.prototype.displayTiddlers;\nStory.prototype.displayTiddlers = function(srcElement,titles,template,unused1,unused2,animate,slowly)\n{\n	// suspend single-page mode when displaying multiple tiddlers\n	var saveSPM=config.options.chkSinglePageMode; config.options.chkSinglePageMode=false;\n	var saveTPM=config.options.chkTopOfPageMode; config.options.chkTopOfPageMode=false;\n	this.SPM_coreDisplayTiddlers(srcElement,titles,template,unused1,unused2,animate,slowly);\n	config.options.chkSinglePageMode=saveSPM; config.options.chkTopOfPageMode=saveTPM;\n}\n//}}}</div>
<div tiddler="SiteSubtitle" modifier="ChrisJobling" modified="200604281507" created="200604281507" tags="">A scratch-pad for miscellaneous scriblings and musings.</div>
<div tiddler="SiteTitle" modifier="ChrisJobling" modified="200604281506" created="200604281506" tags="">CrispyNotes</div>
<div tiddler="Slide" modifier="YourName" modified="200611091954" created="200609071841" tags="excludeSearch hideTagged stylesheets excludeLists">&lt;&lt;template Slide&gt;&gt;\n[[SlideStyleSheet]]\n&lt;&lt;init SlideConfigTweaks&gt;&gt;\n&lt;&lt;reset ConfigTweaks&gt;&gt;</div>
<div tiddler="SlideConfigTweaks" modifier="YourName" modified="200611091951" created="200611090647" tags="excludeLists">config.options.chkSinglePageMode=true</div>
<div tiddler="SlideMainMenu" modifier="ChrisJobling" modified="200703021919" created="200609081432" tags="excludeSearch excludeLists">[[Introduction|Introducing Web Content]]\n[[HTTP|Revising the Hypertext Protocol (HTTP)]] \n[[Standards|Web Standards]]\n[[Design|Designing for a Variety of Browsers]] \n[[Accessibility]] \n[[i18n|Internationalization]] \n&lt;&lt;selectStylesheet&gt;&gt;</div>
<div tiddler="SlidePageTemplate" modifier="YourName" modified="200611091954" created="200609071852" tags="excludeSearch excludeLists">&lt;!--{{{--&gt;\n&lt;div id='mainMenu' refresh='content' tiddler='SlideMainMenu'&gt;&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n&lt;div id='messageArea'&gt;&lt;/div&gt;\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="SlideShowExample" modifier="ChrisJobling" modified="200703031129" created="200605312117" tags="examples">==N.B. This works with Paulo Soares' SlideShowPlugin; it doesn't (yet?) work with my set-up here, which uses the SelectStylesheetPlugin.  There's some kind of conflict, because right now if you click on any of the links below you still see title header and rhs tags, which is to say that it's still using the default PageTemplate, not Paulo's SlideShowPageTemplate.==\nNow fixed (Nov.14th)\n\n&lt;&lt;slideShow&gt;&gt; - A simple slide show that keeps the TW style \n&lt;&lt;slideShow style:'MySSStyleSheet' clock:'+'&gt;&gt; - A themed slide show with a clock showing the presentation elapsed time\n&lt;&lt;slideShow repeat clock:'-20'&gt;&gt; - A looping slide show with a 20 minutes countdown clock\n&lt;&lt;slideShow slidePause:1000&gt;&gt; - A timed slideshow that runs once\n&lt;&lt;slideShow slidePause:1000 repeat&gt;&gt; - A timed looping slideshow\n-s-\n!The [[SlideShowPlugin]]\nPress F11 to go fullscreen and adjust the font sizes with Ctrl++ Ctrl+- (or Ctrl+mousewheel).\n\nThis plugin was developed by Paulo Soares and Clint Checketts.\n{{Comment{This block is not shown in the slide show.\n@@Don't show me!!!@@}}}\n-s-\n!How slides are separated\nIn a tiddler, you start each slide with the markup {{{-s-}}}\n-s-\nSlides don't have to have titles like this poor one\n-s-\n!A slide with subsections and a long title\nCheck to TOC below to see how this slide title is abbreviated.\n!!Section 1\nThis is a section\n!!!Subsection 1.1\nThis is a subsection\n!!!Subsection 1.2\nThis is another subsection\n!!!!Subsubsection 1.2.1\nThis is a subsubsection\n-s-\n!Using the keyboard\nThe following keys are defined:\n*Left arrow - previous overlay\n*Down arrow - previous slide\n*Right arrow - next overlay\n*Up arrow - next slide\n*Home - first slide\n*End - last slide\n*Escape - exit slide show\n*Spacebar - pause/resume slide show in auto advance mode\n-s-\n!Slide show parameters\n*The slide show can be themed by providing a ~StyleSheet ({{{&lt;&lt;slideShow style:'MyStyleSheet'&gt;&gt;}}})\n*By default, there is a clock at bottom of the browser window that displays the current time. This clock can also show the presentation elapsed time with {{{&lt;&lt;slideShow clock:'+'&gt;&gt;}}} or a countdown clock with {{{&lt;&lt;slideShow clock:'-20'&gt;&gt;}}} (for 20 minutes). In these two cases, if you click on the clock display it will be restarted\n*The slide show can be set to loop ({{{&lt;&lt;slideShow repeat&gt;&gt;}}})\n*You can set it so each slide changes after X milliseconds ({{{&lt;&lt;slideShow slidePause:X&gt;&gt;}}}) (auto advance mode)\n*Use auto start mode to begin the slideshow the moment the tiddler is opened ({{{&lt;&lt;slideShow autostart&gt;&gt;&gt;}}})\n*You can disable overlays with {{{&lt;&lt;slideShow noOverlays&gt;&gt;}}}\n*These parameters can be mixed and matched in any order: {{{&lt;&lt;slideShow slidePause:1000 repeat&gt;&gt;}}} is the same as {{{&lt;&lt;slideShow repeat slidePause:1000&gt;&gt;}}}\n-s-\n!Overlays\nTo see how incremental display works use the left and right mouse buttons.\n{{Overlay1{You can}}} {{Overlay2{present things}}} {{Overlay1{in an arbitrary order!!!}}}\n{{Overlay3{Its a bit harder with lists but it works:}}}\n&lt;html&gt;\n&lt;ol&gt;\n&lt;li class=&quot;Overlay4&quot;&gt;First item&lt;/li&gt;\n&lt;li class=&quot;Overlay5&quot;&gt;Second item&lt;/li&gt;\n&lt;li class=&quot;Overlay4&quot;&gt;Last item&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/html&gt;\n{{Comment{You can hide comments on a slide that won't display in the slide show}}}</div>
<div tiddler="SlideShowPageTemplate" modifier="PauloSoares" modified="200611100001" created="200611092159" tags="">&lt;!--{{{--&gt;\n&lt;div id='displayArea'&gt;\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="SlideShowPlugin" modifier="YourName" modified="200611161453" created="200601060046" tags="plugin myPlugin systemConfig">/***\n|''Name:''|SlideShowPlugin|\n|''Description:''|Creates a simple slide show type display|\n|''Version:''|1.5.1|\n|''Date:''|Nov 10, 2006|\n|''Source:''|http://www.math.ist.utl.pt/~psoares/addons.html|\n|''Author:''|Paulo Soares (psoares (at) math (dot) ist (dot) utl (dot) pt) and [[Clint Checketts|http://www.checkettsweb.com]]|\n|''License:''|[[BSD open source license]]|\n|''~CoreVersion:''|2.1.0|\n|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|\n&lt;&lt;tiddler SlideShowPluginDoc&gt;&gt;\n!Code\n***/\n//{{{\nconfig.macros.slideShow = {label: &quot;slide show&quot;, maxTOCLength: 30};\nconfig.macros.slideShow.messages = {gotoLabel: &quot;Go to slide:&quot;};\nconfig.views.wikified.slideShow = {text: &quot;slide show&quot;, tooltip: &quot;Start slide show&quot;};\nconfig.views.wikified.slideShow.quit = {text: &quot;end&quot;, tooltip: &quot;Quit the slide show&quot;};\nconfig.views.wikified.slideShow.firstSlide = {text: &quot;&lt;&lt;&quot;, tooltip: &quot;first slide&quot;};\nconfig.views.wikified.slideShow.previousSlide = {text: &quot;&lt;&quot;, tooltip: &quot;previous slide&quot;};\nconfig.views.wikified.slideShow.nextSlide = {text: &quot;&gt;&quot;, tooltip: &quot;next slide&quot;};\nconfig.views.wikified.slideShow.lastSlide = {text: &quot;&gt;&gt;&quot;, tooltip: &quot;last slide&quot;};\nconfig.views.wikified.slideShow.resetClock = {text: &quot; &quot;, tooltip: &quot;reset&quot;};\n\nconfig.formatters.push( {\n name: &quot;SlideSeparator&quot;,\n match: &quot;^-s-+$\s\sn?&quot;,\n handler: function(w)\n {\n createTiddlyElement(w.output,&quot;hr&quot;,null,'slideSeparator');\n }\n}\n)\n\nfunction changeStyleSheet(tiddlerName) {\n if (tiddlerName == null) tiddlerName = &quot;StyleSheet&quot;;\n setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetColors&quot;),&quot;StyleSheetColors&quot;);\n setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetLayout&quot;),&quot;StyleSheetLayout&quot;);\n var theCSS = store.getRecursiveTiddlerText(tiddlerName,&quot;&quot;);\n setStylesheet(theCSS,&quot;StyleSheet&quot;);\n}\n\n//Excellent (and versatile) reparser created by Paul Petterson for parsing the paramString in a macro\nfunction reparse( params ) {\n var re = /([^:\ss]+)(?:\s:((?:\sd+)|(?:[&quot;'](?:[^&quot;']+)[&quot;']))|\ss|$)/g;\n var ret = new Array() ;\n var m ;\n while( (m = re.exec( params )) != null ) ret[ m[1] ] = m[2]?m[2]:true ;\n return ret ;\n}\n\nfunction getElementsByClass(searchClass,node,tag) {\n var classElements = new Array();\n if ( node == null ) node = document;\n if ( tag == null ) tag = '*';\n var els = node.getElementsByTagName(tag);\n var elsLen = els.length;\n var pattern = new RegExp(&quot;(^|\s\ss)&quot;+searchClass+&quot;(\s\ss|$)&quot;);\n var j=0;\n for (var i = 0; i &lt; elsLen; i++) {\n if ( pattern.test(els[i].className) ) {\n classElements[j] = els[i];\n j++;\n }\n }\n return classElements;\n}\n\n// 'keys' code adapted from S5 which in turn was adapted from MozPoint (http://mozpoint.mozdev.org/)\nfunction keys(key) {\n if (document.getElementById('contentWrapper').className == &quot;slideShowMode&quot;){\n if (!key) {\n key = event;\n key.which = key.keyCode;\n }\n switch (key.which) {\n case 32: // spacebar\n if(time&gt;0){\n if(autoAdvance){\n clearInterval(autoAdvance);\n autoAdvance = null;\n } else {\n autoAdvance=setInterval(&quot;GoToSlide(1)&quot;, time);\n }\n }\n break;\n case 34: // page down\n case 39: // rightkey\n GoToSlide(&quot;n&quot;);\n break;\n case 40: // downkey\n GoToSlide(-1);\n break;\n case 33: // page up\n case 37: // leftkey\n GoToSlide(&quot;p&quot;);\n break;\n case 38: // upkey\n GoToSlide(1);\n break;\n case 36: // home\n GoToSlide(&quot;f&quot;);\n break;\n case 35: // end\n GoToSlide(&quot;l&quot;);\n break;\n case 27: // escape\n endSlideShow();\n break;\n }\n\n }\n return false;\n}\n\nfunction clicker(e) {\n if (!e) var e = window.event;\n var target = resolveTarget(e);\n //Whenever something is clicked that won't advance the slide make sure that the table of contents gets hidden\n if (target.getAttribute('href') != null || isParentOrSelf(target, 'toc') || isParentOrSelf(target,'embed') || isParentOrSelf(target,'object') || isParentOrSelf(target, 'pageFooter') || isParentOrSelf(target, 'navigator')){\n //Don't hide the TOC if the indexNumbers (which trigger the index) is clicked\n if(isParentOrSelf(target,'indexNumbers') || isParentOrSelf(target,'jumpInput')){\n return true;\n }\n showHideTOC('none');\n return true;\n }\n \n //Advance a slide if the TOC is visible otherwise make sure that the TOC gets hidden\n if ((!e.which &amp;&amp; e.button == 1) || e.which == 1) {\n if (document.getElementById('toc').style.display != 'block'){\n GoToSlide(&quot;n&quot;);\n } else {\n showHideTOC('none');\n }\n }\n \n if ((!e.which &amp;&amp; e.button == 2) || e.which == 3) {\n if (document.getElementById('toc').style.display != 'block'){\n GoToSlide(&quot;p&quot;);\n } else {\n showHideTOC('none');\n }\n return false;\n }\n}\n\nfunction isParentOrSelf(element, id) {\n if (element == null || element.nodeName=='BODY') return false;\n else if (element.id == id) return true;\n else return isParentOrSelf(element.parentNode, id);\n}\n\nGoToSlide=function(step) {\n var new_pos;\n var slideHolder = document.getElementById('slideContainer');\n //The parse float ensures that the attribute is returned as a number and not a string.\n var cur_pos = parseFloat(slideHolder.getAttribute('currentslide'));\n var numberSlides = parseFloat(slideHolder.getAttribute('numberSlides'));\n switch (step) {\n case &quot;f&quot;:\n new_pos=0;\n break;\n case &quot;l&quot;:\n new_pos=numberSlides-1;\n break;\n case &quot;n&quot;:\n var numberOverlays = parseFloat(slideHolder.childNodes[cur_pos].getAttribute('numberOverlays'));\n var currentOverlay = parseFloat(slideHolder.getAttribute('currentOverlay'));\n if(numberOverlays==0 || currentOverlay==numberOverlays){\n new_pos=cur_pos+1;\n } else {\n var className=&quot;Overlay&quot;+currentOverlay;\n var overlay=getElementsByClass(className,slideHolder.childNodes[cur_pos]);\n for(var i=0; i&lt;overlay.length; i++) {overlay[i].className=className+' previousOverlay';}\n currentOverlay++;\n slideHolder.setAttribute('currentOverlay',currentOverlay);\n className=&quot;Overlay&quot;+currentOverlay;\n overlay=getElementsByClass(className,slideHolder.childNodes[cur_pos]);\n for(i=0; i&lt;overlay.length; i++) {overlay[i].className=className+' currentOverlay';}\n return false;\n }\n break;\n case &quot;p&quot;:\n var numberOverlays = parseFloat(slideHolder.childNodes[cur_pos].getAttribute('numberOverlays'));\n var currentOverlay = parseFloat(slideHolder.getAttribute('currentOverlay'));\n if(numberOverlays==0 || currentOverlay==0){\n new_pos=cur_pos-1;\n } else {\n var className=&quot;Overlay&quot;+currentOverlay;\n var overlays=getElementsByClass(className,slideHolder.childNodes[cur_pos]);\n for(var i=0; i&lt;overlays.length; i++) {overlays[i].className=className+' nextOverlay';}\n currentOverlay--;\n className=&quot;Overlay&quot;+currentOverlay;\n overlays=getElementsByClass(className,slideHolder.childNodes[cur_pos]);\n for(i=0; i&lt;overlays.length; i++) {overlays[i].className=className+' currentOverlay';}\n slideHolder.setAttribute('currentOverlay',currentOverlay);\n return false;\n }\n break;\n default:\n new_pos=cur_pos+step;\n }\n\n if(slideShowCircularMode &amp;&amp; new_pos == numberSlides) new_pos=0;\n if(slideShowCircularMode &amp;&amp; new_pos&lt;0) new_pos=(numberSlides - 1);\n if(step!=0 &amp;&amp; new_pos&gt;=0 &amp;&amp; new_pos&lt;numberSlides) {\n slideHolder.childNodes[cur_pos].style.display='none';\n slideHolder.childNodes[new_pos].style.display='block';\n slideHolder.setAttribute('currentslide',new_pos);\n var numberOverlays = parseFloat(slideHolder.childNodes[new_pos].getAttribute('numberOverlays'));\n if(step==&quot;p&quot;){\n var currentOverlay=numberOverlays;\n var state=' previousOverlay';\n } else {\n var currentOverlay=0;\n var state=' nextOverlay';\n }\n slideHolder.setAttribute('currentOverlay',currentOverlay);\n if(numberOverlays&gt;0) {\n for(var i=1; i&lt;=numberOverlays; i++){\n var className=&quot;Overlay&quot;+i;\n var overlays=getElementsByClass(className,slideHolder.childNodes[new_pos]);\n for(var j=0; j&lt;overlays.length; j++) {overlays[j].className=className+state;}\n }\n if(step==&quot;p&quot;){\n var className=&quot;Overlay&quot;+numberOverlays;\n var overlays=getElementsByClass(className,slideHolder.childNodes[new_pos]);\n for(var j=0; j&lt;overlays.length; j++) {overlays[j].className=className+' currentOverlay';}\n }\n }\n new_pos++;\n var indexNumbers = document.getElementById('indexNumbers');\n indexNumbers.firstChild.data = new_pos+'/'+numberSlides;\n if((new_pos==numberSlides) &amp;&amp; !slideShowCircularMode &amp;&amp; autoAdvance) clearInterval(autoAdvance);\n return true;\n }\n return false;\n}\n\nfunction tocShowSlide(e) {\n if (!e) var e = window.event;\n var target = resolveTarget(e);\n var slide = target.getAttribute('slideNumber');\n var cur_pos = document.getElementById('slideContainer').getAttribute('currentslide');\n var step = slide-cur_pos;\n if(step!=0) GoToSlide(step);\n showHideTOC('none');\n return;\n}\n\n//Toggle the display of the table of contents\nfunction showHideTOC(display){\n var toc = document.getElementById('toc');\n //Reset the input box\n document.getElementById('jumpInput').value = &quot;&quot;;\n\n if (display == null || display.length == null){\n if (toc.style.display == 'none' || toc.style.display == ''){\n toc.style.display = 'block';\n document.getElementById('jumpInput').focus();\n } else {\n toc.style.display = 'none';\n }\n } else {\n toc.style.display = display;\n if (display == 'block')\n document.getElementById('jumpInput').focus();\n }\n}\n\nfunction makeSignature(title,params){\n var signature = title+store.getTiddler(title).modified;\n if(params['style']) signature += params['style'];\n if(params['repeat']) signature += &quot;repeat&quot;;\n if(params['slidePause'] &gt; 0) signature += params['slidePause'];\n if(params['autostart']) signature += &quot;autostart&quot;;\n if(params['clock']) signature += params['clock'];\n if(params['noOverlays']) signature += &quot;noOverlays&quot;;\n return signature;\n}\n\nfunction padZero(x){\n return (x&gt;=10 || x&lt;0 ? &quot;&quot; : &quot;0&quot;)+x;\n}\n\nsetClock=function(){\n var actualTime = new Date();\n var newTime = actualTime.getTime() - clockStartTime;\n newTime = clockMultiplier*newTime+clockInterval+clockCorrection;\n actualTime.setTime(newTime);\n newTime = padZero(actualTime.getHours()) + &quot;:&quot; + padZero(actualTime.getMinutes())+ &quot;:&quot; + padZero(actualTime.getSeconds());\n var clock = document.getElementById('slideClock');\n clock.firstChild.nodeValue = newTime;\n}\n\nresetClock=function(){\n var time = new Date(0);\n if(clockStartTime&gt;time){\n var startTime = new Date();\n clockStartTime=startTime.getTime();\n }\n}\n\nvar title;\nvar place;\nvar autoAdvance=null;\nvar autoStart=null;\nvar slideClock=null;\nvar noOverlays=false;\nvar time = 0;\nvar slideShowCircularMode;\nvar slideShowStyleSheet;\nvar slideShowParams;\nvar clockMultiplier;\nvar clockInterval;\nvar clockCorrection=0;\nvar clockStartTime;\nvar openTiddlers;\n\nconfig.macros.slideShow.handler = function(aPlace,macroName,params,wikifier,paramString,tiddler){\n if(tiddler instanceof Tiddler){\n var lingo = config.views.wikified.slideShow;\n var autostart = false;\n if (!e) var e = window.event;\n \n place = aPlace;\n title = tiddler.title;\n params = reparse(paramString);\n var onclick = function(){config.macros.slideShow.onClickSlideShow(params);};\n createTiddlyButton(aPlace,lingo.text,lingo.tooltip,onclick);\n \n var slideShowHolder = document.getElementById('slideShowWrapper');\n //If no show exist previously, create it\n if(params['autostart']){\n if(slideShowHolder != null){\n var signature = slideShowHolder.getAttribute('showSignature');\n if(signature.indexOf(&quot;autostart&quot;)==-1) autostart = true;\n } else {autostart = true;}\n if(autostart){\n slideShowParams = params;\n setTimeout(config.macros.slideShow.onClickSlideShow,100);\n }\n }\n }\n}\n\nvar disableFunction = function(e){return false;}\nvar enableFunction = function(e){}\n\nconfig.macros.slideShow.onClickSlideShow = function(newParams) {\n if(typeof(newParams)==&quot;number&quot;) newParams=slideShowParams;\n openTiddlers = new Array;\n var viewer=document.getElementById('tiddlerDisplay');\n for(var i=0; i&lt;viewer.childNodes.length; i++){\n var name = viewer.childNodes[i].getAttribute('tiddler');\n openTiddlers.push(name);\n }\n document.oncontextmenu = disableFunction;\n clockMultiplier = 1;\n clockInterval = 0;\n var startTime = new Date(0);\n slideShowCircularMode = false;\n time = 0;\n slideShowStyleSheet = null;\n if(newParams['style']){\n slideShowStyleSheet = eval(newParams['style']);\n } \n if(newParams['repeat']){\n slideShowCircularMode = true;\n }\n if(newParams['slidePause'] &gt; 0){\n time = newParams['slidePause'];\n }\n if(newParams['clock']){\n clockCorrection=startTime.getTimezoneOffset()*60000;\n startTime = new Date();\n var clockType= eval(newParams['clock']);\n if(clockType != '+') {\n clockMultiplier = -1;\n clockInterval = -clockType*60000;\n }\n }\n clockStartTime=startTime.getTime();\n if(newParams['noOverlays']){\n noOverlays = true;\n }\n var contentWrapper = document.getElementById('contentWrapper');\n if (contentWrapper.className != &quot;slideShowMode&quot;){\n clearMessage();\n //Attach the key and mouse listeners\n document.onkeyup = keys;\n document.onmouseup = clicker;\n \n var slideShowHolder = document.getElementById('slideShowWrapper');\n story.refreshTiddler(title,&quot;SlideShowViewTemplate&quot;,true);\n //If no show exist previously, create it\n if(slideShowHolder == null){\n createSlides(newParams);\n //If there was once waiting in the background and it matches the one we just started, resume it\n } else if (slideShowHolder.getAttribute('showSignature') == makeSignature(title,newParams)){\n \n //Remove dblClick on edit function\n var theTiddler = document.getElementById(&quot;tiddler&quot;+title);\n theTiddler.ondblclick = function() {};\n\n // Grab the 'viewer' element and give it a signature so the show can be resumed if stopped\n var tiddlerElements = theTiddler.childNodes;\n var viewer;\n for (var i = 0; i &lt; tiddlerElements.length; i++){\n if (tiddlerElements[i].className == &quot;viewer&quot;) viewer = tiddlerElements[i];\n }\n theTiddler.insertBefore(slideShowHolder,viewer);\n theTiddler.removeChild(viewer);\n slideShowHolder.style.display = 'block';\n document.getElementById(&quot;pageFooter&quot;).className = &quot;pageFooterOff&quot;;\n \n //If the show we started it totally new than the resumable one, create the new one and kill the resumable one\n } else {\n slideShowHolder.parentNode.removeChild(slideShowHolder);\n createSlides(newParams);\n }\n slideClock=setInterval(&quot;setClock()&quot;, 1000); \n if(time&gt;0) autoAdvance=setInterval(&quot;GoToSlide(1)&quot;, time); \n story.closeAllTiddlers(title);\n toggleSlideStyles();\n } else {\n endSlideShow();\n }\n return ;\n \n}\n\nfunction endSlideShow(){\n //Set aside show so it can be resumed later\n var showHolder = document.getElementById('slideShowWrapper');\n showHolder.style.display = 'none';\n document.getElementById('contentWrapper').parentNode.appendChild(showHolder);\n document.oncontextmenu = enableFunction;\n if(autoAdvance) clearInterval(autoAdvance);\n if(slideClock) clearInterval(slideClock);\n story.refreshTiddler(title,null,true);\n story.closeAllTiddlers();\n toggleSlideStyles();\n story.displayTiddlers(null,openTiddlers,DEFAULT_VIEW_TEMPLATE);\n document.onmouseup = function(){};\n}\n\nfunction isInteger(s){\n var i;\n for (i = 0; i &lt; s.length; i++){\n // Check that current character is number.\n var c = s.charAt(i);\n if (((c &lt; &quot;0&quot;) || (c &gt; &quot;9&quot;))) return false;\n }\n // All characters are numbers.\n return true;\n}\n\nfunction jumpInputToSlide(e){\n if (!e) {\n e = window.event;\n e.which = e.keyCode;\n }\n if(e.which==13){\n var jumpInput= document.getElementById(&quot;jumpInput&quot;).value;\n if(isInteger(jumpInput)){\n var step=jumpInput-document.getElementById('slideContainer').getAttribute('currentslide')-1;\n if (GoToSlide(step)){\n showHideTOC('none'); \n }\n }\n }\n return;\n}\n\n//Used to shorten the TOC fields\nfunction abbreviateLabel(label){\n var maxTOCLength = config.macros.slideShow.maxTOCLength;\n if(label.length&gt;maxTOCLength) {\n var temp = new Array();\n temp = label.split(' ');\n label = temp[0];\n for(var j=1; j&lt;temp.length; j++){\n if((label.length+temp[j].length)&lt;=maxTOCLength){\n label += &quot; &quot; + temp[j];\n } else {\n label += &quot; ...&quot;;\n break;\n }\n }\n }\n return label;\n}\n\ncreateSlides = function(newParams){\n var lingo = config.views.wikified.slideShow;\n\n //Remove dblClick on edit function\n var theTiddler = document.getElementById(&quot;tiddler&quot;+title);\n theTiddler.ondblclick = function() {};\n\n // Grab the 'viewer' element and give it a signature so the show can be resumed if stopped\n var tiddlerElements = theTiddler.childNodes;\n var viewer;\n for (var i = 0; i &lt; tiddlerElements.length; i++){\n if (tiddlerElements[i].className == &quot;viewer&quot;) viewer = tiddlerElements[i];\n }\n viewer.id = 'slideShowWrapper';\n viewer.setAttribute(&quot;showSignature&quot;,makeSignature(title,newParams));\n\n //Hide the text that comes before the first H1 element (I think I may put this into a cover page type thing)\n while(viewer.childNodes.length &gt; 0 &amp;&amp; viewer.firstChild.nodeName.toUpperCase() != &quot;HR&quot; &amp;&amp; viewer.firstChild.className!=&quot;slideSeparator&quot;) {\n viewer.removeChild(viewer.firstChild);\n }\n \n //Cycle through the content and each time you hit an H1 begin a new slide div\n var slideNumber = 0;\n var slideHolder = document.createElement('DIV');\n slideHolder.id = &quot;slideContainer&quot;;\n \n while(viewer.childNodes.length &gt; 0){\n //Create a new slide a append it to the slide holder\n if (viewer.firstChild.nodeName.toUpperCase() == &quot;HR&quot; &amp;&amp; viewer.firstChild.className==&quot;slideSeparator&quot;){\n slideNumber++;\n var slide = document.createElement('DIV');\n slide.id = &quot;slideNumber&quot;+slideNumber;\n slide.className = &quot;slide&quot;;\n if (slideNumber &gt; 1) {\n slideHolder.setAttribute('currentslide',0);\n slide.style.display='none';\n } else {\n slide.style.display='block';\n }\n slideHolder.appendChild(slide); \n viewer.removeChild(viewer.firstChild);\n } else {\n if(viewer.firstChild.nodeName==&quot;SPAN&quot; &amp;&amp; viewer.firstChild.className==&quot;&quot; &amp;&amp; viewer.firstChild.hasChildNodes()) {\n var anchor=viewer.firstChild.nextSibling;\n for (var ii=0;ii&lt;viewer.firstChild.childNodes.length;ii++) {\n var clone=viewer.firstChild.childNodes[ii].cloneNode(true);\n viewer.insertBefore(clone,anchor);\n }\n viewer.removeChild(viewer.firstChild);\n } else {\n slide.appendChild(viewer.firstChild);\n }\n }\n }\n \n //Stick the slides back into the viewer\n viewer.appendChild(slideHolder);\n slideHolder.setAttribute('numberSlides',slideNumber);\n \n //Create the navigation bar\n var pagefooter = createTiddlyElement(viewer,&quot;DIV&quot;,&quot;pageFooter&quot;,&quot;pageFooterOff&quot;);\n var navigator = createTiddlyElement(pagefooter,&quot;SPAN&quot;,&quot;navigator&quot;);\n\n //Make it so that when the footer is hovered over the class will change to make it visible\n pagefooter.onmouseover = function () {pagefooter.className = &quot;pageFooterOn&quot;};\n pagefooter.onmouseout = function () {pagefooter.className = &quot;pageFooterOff&quot;};\n\n //Create the control button for the navigation \n var onClickQuit = function(){endSlideShow();};\n createTiddlyButton(navigator,lingo.quit.text,lingo.quit.tooltip,onClickQuit);\n createTiddlyButton(navigator,lingo.firstSlide.text,lingo.firstSlide.tooltip,first_slide);\n createTiddlyButton(navigator,lingo.previousSlide.text,lingo.previousSlide.tooltip,previous_slide);\n createTiddlyButton(navigator,lingo.nextSlide.text,lingo.nextSlide.tooltip,next_slide);\n createTiddlyButton(navigator,lingo.lastSlide.text,lingo.lastSlide.tooltip,last_slide); \n createTiddlyButton(navigator,lingo.resetClock.text,lingo.resetClock.tooltip,resetClock,&quot;button&quot;,&quot;slideClock&quot;); \n\n var indexNumbers = createTiddlyElement(pagefooter,&quot;SPAN&quot;,&quot;indexNumbers&quot;,&quot;indexNumbers&quot;,&quot;1/&quot;+slideNumber)\n indexNumbers.onclick = showHideTOC;\n var toc = createTiddlyElement(pagefooter,&quot;UL&quot;,&quot;toc&quot;);\n var ovl=1;\n for (var i=0;i&lt;slideHolder.childNodes.length;i++) {\n if(!noOverlays) {\n var ovl=1;\n while(1){\n var className=&quot;Overlay&quot;+ovl;\n var overlays=getElementsByClass(className,slideHolder.childNodes[i]);\n if(overlays.length&gt;0){\n for(var j=0; j&lt;overlays.length; j++) {overlays[j].className+=' nextOverlay';}\n ovl++;\n } else {break;}\n }\n }\n slideHolder.childNodes[i].setAttribute(&quot;numberOverlays&quot;,ovl-1);\n slideHolder.setAttribute(&quot;currentOverlay&quot;,0);\n\n //Loop through each slide and check the header's content\n var tocLabel = null; \n for (var j=0;j&lt;slideHolder.childNodes[i].childNodes.length;j++) {\n var node = slideHolder.childNodes[i].childNodes[j];\n if(node.nodeName==&quot;H1&quot; || node.nodeName==&quot;H2&quot; || node.nodeName==&quot;H3&quot; || node.nodeName==&quot;H4&quot;) {\n var htstring = node.innerHTML;\n var stripped = htstring.replace(/(&lt;([^&gt;]+)&gt;)/ig,&quot;&quot;);\n tocLabel = abbreviateLabel(stripped);\n var tocLevel=&quot;tocLevel&quot;+node.nodeName.charAt(1);\n var tocItem = createTiddlyElement(toc,&quot;LI&quot;,null,tocLevel);\n var tocLink = createTiddlyElement(tocItem,&quot;A&quot;,null,&quot;tocItem&quot;,tocLabel);\n tocLink.setAttribute(&quot;slideNumber&quot;,i);\n tocLink.onclick=tocShowSlide;\n }\n }\n }\n \n\n //Input box to jump to s specific slide\n var tocItem = createTiddlyElement(toc,&quot;LI&quot;,null,&quot;tocJumpItem&quot;,config.macros.slideShow.messages.gotoLabel);\n var tocJumpInput = createTiddlyElement(tocItem,&quot;INPUT&quot;,&quot;jumpInput&quot;);\n tocJumpInput.type=&quot;text&quot;;\n tocJumpInput.onkeyup=jumpInputToSlide;\n}\n\nvar next_slide= function(e){GoToSlide(1);}\nvar first_slide= function(e){GoToSlide(&quot;f&quot;);}\nvar previous_slide= function(e){GoToSlide(-1);}\nvar last_slide= function(e){GoToSlide(&quot;l&quot;);}\n\nfunction toggleSlideStyles(){\n var contentWrapper = document.getElementById('contentWrapper');\n if (contentWrapper.className == &quot;slideShowMode&quot;){\n contentWrapper.className = &quot;&quot;;\n window.applyPageTemplate();\n if(slideShowStyleSheet) changeStyleSheet();\n } else{\n contentWrapper.className = &quot;slideShowMode&quot;;\n window.applyPageTemplate(&quot;SlideShowPageTemplate&quot;);\n if(slideShowStyleSheet) changeStyleSheet(slideShowStyleSheet);\n }\n}\n\nsetStylesheet(&quot;/***\sn!Slide Mode Styles\sn***/\sn/*{{{*/\sn#contentWrapper.slideShowMode #slideContainer{\sn display: block;\sn}\sn\sn#contentWrapper.slideShowMode .Comment{\sn display: none;\sn}\sn\sn#contentWrapper.slideShowMode .nextOverlay{\sn visibility: hidden;\sn}\sn\sn#contentWrapper.slideShowMode .currentOverlay{\sn visibility: visible;\sn}\sn\sn#contentWrapper.slideShowMode .previousOverlay{\sn visibility: visible;\sn}\sn\sn#jump{\sn text-align: right;\sn}\sn\sn.pageFooterOff #navigator{\sn visibility: hidden;\sn}\sn\sn.pageFooterOn #navigator{\sn visibility: visible;\sn}\sn\sn#contentWrapper.slideShowMode #slideClock{\sn cursor: pointer; margin: 0 5px 0 5px; border: 1px solid #db4\sn}\sn\sn#contentWrapper.slideShowMode,\sn #contentWrapper.slideShowMode #displayArea{\sn width: 100%;\sn font-size: 1.5em;\sn margin: 0 !important;\sn padding: 0;\sn}\sn\sn#slideContainer{\sn display: none;\sn}\sn\sn.indexNumbers{\sn cursor: pointer;\sn}\sn\sn#navigator{\sn visibility: hidden;\sn bottom: 0;\sn}\sn\sn#toc{\sn display: none;\sn position: absolute;\sn font-size: .75em;\sn bottom: 2em;\sn right: 0;\sn background: #fff;\sn border: 1px solid #000;\sn text-align: left;\sn}\sn\snul#toc, #toc li{\sn margin: 0;\sn padding: 0;\sn list-style: none;\sn line-height: 1em;\sn}\sn\sn.tocJumpItem{\sn margin-right: 2em;\sn}\sn\sn.tocJumpItem input{\snmargin-right: 1em;\sn border: 0;\sn}\sn\sn#toc a,\sn#toc a.button{\sn display: block;\sn padding: .1em;\sn}\sn\sn#toc .tocLevel1{\snfont-size: .8em;\sn}\sn\sn#toc .tocLevel2{\sn margin-left: 1em;\sn font-size: .75em;\sn}\sn\sn#toc .tocLevel3{\sn margin-left: 2em;\snfont-size: .75em;\sn}\sn\sn#toc .tocLevel4{\sn margin-left: 3em;\snfont-size: .65em;\sn}\sn\sn#toc a{\sn cursor: pointer;\sn}\sn\snh1{\sn min-height: 1em;\sn}\sn\sn.slide h1{\sn min-height: 0;\sn}\sn\sn/* The '&amp;gt;' selector is ignored by IE6 and earlier so the proper rules are given */\sn#pageFooter{\sn position: fixed;\sn bottom: 2px;\sn right: 2px;\sn width: 100%;\sn text-align: right;\sn}\sn\sn/* This is a hack to trick IE6 and earlier to put the navbar on the bottom of the page */\sn* html #pageFooter {\sn position: absolute;\sn width: 100%;\sn text-align: right;\sn right: auto; bottom: auto;\sn left: expression( ( -20 - pageFooter.offsetWidth + ( document.documentElement.clientWidth ? document.documentElement.clientWidth : document.body.clientWidth ) + ( ignoreMe2 = document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft ) ) + 'px' );\sn top: expression( ( -10 - pageFooter.offsetHeight + ( document.documentElement.clientHeight ? document.documentElement.clientHeight : document.body.clientHeight ) + ( ignoreMe = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ) ) + 'px' );\sn}\sn\sn\sn\sn/*}}}*/&quot;,&quot;slideShowStyles&quot;);\n//}}}</div>
<div tiddler="SlideShowPluginDoc" modifier="PauloSoares" modified="200611100025" created="200604191137" tags="plugin myPlugin">!Description\nThis plugin turns a TiddlyWiki tiddler into a simple slide show type display. Most features that are usually found in presentation software are available. It should work in a way that does not interfere with TiddlyWiki. When you close the slide show you get back to your good old TW. \n\nThis plugin has been tested in Firefox and Internet Explorer. Let me know if something seems broken.\n!Usage\nTo use this plugin you //must// be using TiddlyWiki 2.0. Some optional features (as the incremental display) require version 2.0.8 or higher. To install the plugin copy the tiddlers SlideShowPlugin, SlideShowPageTemplate and SlideShowViewTemplate to your TW, label the first one with the //systemConfig// tag, save the TW and refresh the browser.\n\nTo make a slide show simply drop {{{&lt;&lt;slideShow&gt;&gt;}}} at the beginning of a tiddler and use {{{--s--}}} to start each slide. \n\nIf you move your mouse over the bottom of the browser window you will see a few navigation buttons, a clock and a table of contents that shows up when you click the slide number.\n\nAny block of text marked as {{{{{Comment{For my eyes only!}}}}}} will not be displayed in the slide show.\n\nSee these and other features in this [[SlideShowExample]].\n!Incremental display\nA succession of overlays (or layers) can be defined in each slide by marking blocks of text with {{{{{Overlay1{...some text...}}}}}}, {{{{{Overlay2{...some text...}}}}}}, {{{{{Overlay3{...some text...}}}}}}, ...\n\nTo costumize the way overlays are shown you can redefine the following CSS classes\n*contentWrapper.slideShowMode .previousOverlay \n*contentWrapper.slideShowMode .currentOverlay \n*contentWrapper.slideShowMode .nextOverlay \nin a ~StyleSheet. The default style simply hides the next overlays and shows the current and the previous ones as normal text.\n!Slide show parameters\n*The slide show can be themed by providing a ~StyleSheet ({{{&lt;&lt;slideShow style:'MyStyleSheet'&gt;&gt;}}})\n*By default, there is a clock at bottom of the browser window that displays the current time. This clock can also show the presentation elapsed time with {{{&lt;&lt;slideShow clock:'+'&gt;&gt;}}} or a countdown clock with {{{&lt;&lt;slideShow clock:'-20'&gt;&gt;}}} (for 20 minutes). In these two cases, if you click on the clock display it will be restarted\n*The slide show can be set to loop ({{{&lt;&lt;slideShow repeat&gt;&gt;}}})\n*You can set it so each slide changes after X milliseconds ({{{&lt;&lt;slideShow slidePause:X&gt;&gt;}}}) (auto advance mode)\n*Use auto start mode to begin the slideshow the moment the tiddler is opened ({{{&lt;&lt;slideShow autostart&gt;&gt;&gt;}}})\n*You can disable overlays with {{{&lt;&lt;slideShow noOverlays&gt;&gt;}}}\n*These parameters can be mixed and matched in any order: {{{&lt;&lt;slideShow slidePause:1000 repeat&gt;&gt;}}} is the same as {{{&lt;&lt;slideShow repeat slidePause:1000&gt;&gt;}}}\n!Slide show navigation\nYou can navigate through a slide show using the keyboard or the mouse. To quickly move to titled sections you can use the table of contents. \n!!Mouse navigation\nLeft (right) clicking on a slide jumps to the next (previous) overlay. To move to the beginning of the next or previous slide you must use the navigation bar at the bottom of the browser's window. If there are no overlays defined both operations are equivalent.\n!!Keyboard navigation\nThe following keys are defined:\n*Left arrow - previous overlay\n*Down arrow - previous slide\n*Right arrow - next overlay\n*Up arrow - next slide\n*Home - first slide\n*End - last slide\n*Escape - exit slide show\n*Spacebar - pause/resume slide show in auto advance mode\n!Revision history\n*1.5.1 10/11/2006\n**added SlideShowPageTemplate and SlideShowViewTemplate. This way, the plugin no longer requires a standard TW layout. Thanks to Andrew Lister for the idea.\n*1.5.0 18/09/2006\n**fixed restoring stylesheet on exit\n**changed (again!) the way how slides are separated (slide shows prepared for previous versions must be fixed)\n*1.4.0 20/04/2006\n**changed the way how slides are separated (slide shows prepared for previous versions must be fixed)\n**now works with content included with the {{{&lt;&lt;tiddler&gt;&gt;}}} macro\n**added incremental display (overlays)\n**improved documentation\n**assorted small fixes\n*1.3.1 10/03/2006\n**removed empty slide titles\n**fixed wrong numberSlides when slides have div's\n**fixed wrong time in Windows\n*1.3.0 26/02/2006\n**restore open tiddlers on exit\n**fixed problem with markup in headers (should work with NestedSlidersPlugin)\n**added slide comments (blocks of text in the tiddler that don't show up in the presentation)\n*1.2.1 28/01/2006\n**pause timed slideshow with spacebar\n**added clock with 3 different modes\n**fixed bugs with style and abbreviation options\n**general cleanup\n*1.2.0 07/01/2006\n**added a resume feature\n**added themes support\n*1.1.5 14/12/2005\n**added mouse support\n**cleaned up navbar generation\n*1.1.0 12/12/2005\n**added support for IE\n**added key listeners\n*1.0.0 11/12/2005\n**initial release\n!Todo\n*Time code is still very hackerish and unreliable.</div>
<div tiddler="SlideShowViewTemplate" modifier="PauloSoares" modified="200611100001" created="200611092307" tags="">&lt;!--{{{--&gt;\n&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="SlideSideBarOptions" modifier="YourName" modified="200611091957" created="200609071926" tags="excludeSearch excludeLists">&lt;&lt;selectStylesheet&gt;&gt;\n&lt;&lt;saveChanges&gt;&gt;\n&lt;&lt;search&gt;&gt;</div>
<div tiddler="SlideSize" modifier="YourName" modified="200611091958" created="200609111603" tags="excludeSearch excludeLists">&lt;script label=&quot;Click to resize to 1024,768&quot;&gt;\nresizeTo(1024, 768);\n&lt;/script&gt;</div>
<div tiddler="SlideStyleSheet" modifier="YourName" modified="200611091951" created="200609071854" tags="excludeSearch excludeLists">[[StyleSheetColors]]\n[[StyleSheetLayout]]\n[[MptwStyleSheet]]\n/*{{{*/\nbody {font-size:175%;}\n#displayArea { margin: 0em 0em 0em 5em; } \n#mainMenu {width: 3.5em;}\n/*}}}*/\n</div>
<div tiddler="SlideViewTemplate" modifier="YourName" modified="200611091957" created="200609071840" tags="excludeSearch excludeLists">&lt;!--{{{--&gt;\n&lt;div class=&quot;toolbar&quot; macro=&quot;toolbar +editTiddler -closeTiddler&quot;&gt;&lt;/div&gt;\n&lt;div&gt;&lt;span class=&quot;title&quot; macro=&quot;view title&quot;&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class='viewer'&gt; &lt;span macro='view text wikified'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="SplashScreenPlugin" modifier="YourName" modified="200611092001" created="200607191631" tags="lewcidExtension systemConfig excludeLists">/***\n\n''Inspired by [[TiddlyPom|http://www.warwick.ac.uk/~tuspam/tiddlypom.html]]''\n\n|Name|SplashScreenPlugin|\n|Created by|SaqImtiaz|\n|Location|http://lewcid.googlepages.com/lewcid.html#SplashScreenPlugin|\n|Version|0.21 |\n|Requires|~TW2.08+|\n!Description:\nProvides a simple splash screen that is visible while the TW is loading.\n\n!Installation\nCopy the source text of this tiddler to your TW in a new tiddler, tag it with systemConfig and save and reload. The SplashScreen will now be installed and will be visible the next time you reload your TW.\n\n!Customizing\nOnce the SplashScreen has been installed and you have reloaded your TW, the splash screen html will be present in the MarkupPreHead tiddler. You can edit it and customize to your needs.\n\n!History\n* 20-07-06 : version 0.21, modified to hide contentWrapper while SplashScreen is displayed.\n* 26-06-06 : version 0.2, first release\n\n!Code\n***/\n//{{{\nvar old_lewcid_splash_restart=restart;\n\nrestart = function()\n{   if (document.getElementById(&quot;SplashScreen&quot;))\n        document.getElementById(&quot;SplashScreen&quot;).style.display = &quot;none&quot;;\n      if (document.getElementById(&quot;contentWrapper&quot;))\n        document.getElementById(&quot;contentWrapper&quot;).style.display = &quot;block&quot;;\n    \n    old_lewcid_splash_restart();\n   \n    if (splashScreenInstall)\n       {if(config.options.chkAutoSave)\n			{saveChanges();}\n        displayMessage(&quot;TW SplashScreen has been installed, please save and refresh your TW.&quot;);\n        }\n}\n\n\nvar oldText = store.getTiddlerText(&quot;MarkupPreHead&quot;);\nif (oldText.indexOf(&quot;SplashScreen&quot;)==-1)\n   {var siteTitle = store.getTiddlerText(&quot;SiteTitle&quot;);\n   var splasher='\sn\sn&lt;style type=&quot;text/css&quot;&gt;#contentWrapper {display:none;}&lt;/style&gt;&lt;div id=&quot;SplashScreen&quot; style=&quot;border: 3px solid #ccc; display: block; text-align: center; width: 320px; margin: 100px auto; padding: 50px; color:#000; font-size: 28px; font-family:Tahoma; background-color:#eee;&quot;&gt;&lt;b&gt;'+siteTitle +'&lt;/b&gt; is loading&lt;blink&gt; ...&lt;/blink&gt;&lt;br&gt;&lt;br&gt;&lt;span style=&quot;font-size: 14px; color:red;&quot;&gt;Requires Javascript.&lt;/span&gt;&lt;/div&gt;';\n   if (! store.tiddlerExists(&quot;MarkupPreHead&quot;))\n       {var myTiddler = store.createTiddler(&quot;MarkupPreHead&quot;);}\n   else\n      {var myTiddler = store.getTiddler(&quot;MarkupPreHead&quot;);}\n      myTiddler.set(myTiddler.title,oldText+splasher,config.options.txtUserName,null,null);\n      store.setDirty(true);\n      var splashScreenInstall = true;\n}\n//}}}</div>
<div tiddler="Student" modifier="YourName" modified="200611091953" created="200611080527" tags="stylesheets excludeSearch excludeLists">&lt;&lt;template Student&gt;&gt;\n[[StyleSheet]]</div>
<div tiddler="StudentPageTemplate" modifier="YourName" modified="200611091950" created="200611090711" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\n	&lt;div class='headerShadow'&gt;\n		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n	&lt;/div&gt;\n	&lt;div class='headerForeground'&gt;\n		&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n		&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n	&lt;/div&gt;\n&lt;/div&gt;\n&lt;!-- horizontal MainMenu --&gt;\n&lt;div id='topMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n&lt;!-- original MainMenu menu --&gt;\n&lt;!-- &lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt; --&gt;\n&lt;div id='sidebar'&gt;\n	&lt;div id='sidebarOptions' refresh='content' tiddler='StudentSideBarOptions'&gt;&lt;/div&gt;\n	&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='StudentSideBarTabs'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;div id='displayArea'&gt;\n	&lt;div id='messageArea'&gt;&lt;/div&gt;\n	&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n&lt;/div&gt;\n&lt;!--}}}--&gt;\n</div>
<div tiddler="StudentSideBarOptions" modifier="YourName" modified="200611110707" created="200611080416" tags="excludeSearch excludeLists">&lt;&lt;search&gt;&gt;&lt;&lt;closeAll&gt;&gt;&lt;&lt;newTiddler&gt;&gt;&lt;&lt;newJournal 'DD MMM YYYY'&gt;&gt;&lt;&lt;saveChanges&gt;&gt;+++[change templates]\n&lt;&lt;selectStylesheet default&gt;&gt;\n&lt;&lt;selectStylesheet Student&gt;&gt;\n===&lt;&lt;slider chkSliderOptionsPanel OptionsPanel 'options Â»' 'Change TiddlyWiki advanced options'&gt;&gt;</div>
<div tiddler="StudentSideBarTabs" modifier="YourName" modified="200611091953" created="200611080421" tags="excludeLists">&lt;&lt;tabs txtMainTab 'Lecture Slides' 'Lecture notes provided by AL' TabLectures 'My Notes' 'Notes taken in class by me' TabNotes Tags 'All entries by tag' TabTags&gt;&gt;</div>
<div tiddler="StudentViewTemplate" modifier="YourName" modified="200611110707" created="200611110529" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class=&quot;toolbar&quot;&gt; \n&lt;span macro=&quot;newHere tag:Note&quot;&gt;&lt;/span&gt; \n&lt;/div&gt; \n&lt;div class='toolbar'&gt;&lt;span style=&quot;padding-right:2.15em;&quot;&gt;&lt;/span&gt;&lt;/div&gt;\n&lt;div class='toolbar' &gt; \n&lt;span macro='toolbar collapseTiddler collapseOthers -closeTiddler closeOthers +editTiddler deleteTiddler permalink references jump'&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class=&quot;tagglyTagged&quot; macro=&quot;tags&quot;&gt;&lt;/div&gt;\n&lt;div class='titleContainer'&gt;\n	&lt;span class='title' macro='view title'&gt;&lt;/span&gt;\n	&lt;span macro=&quot;miniTag&quot;&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date [[DD MMM YYYY]]'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date [[DD MMM YYYY]]'&gt;&lt;/span&gt;)&lt;/div&gt;\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;div class='tagClear'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="StyleSheet" modifier="YourName" modified="200611091950" created="200611090449" tags="excludeLists">[[StyleSheetColors]]\n[[StyleSheetLayout]]\n[[MptwStyleSheet]]\n[[QuickOpenTagStyle]]</div>
<div tiddler="StyleSheetLayout" modifier="ChrisJobling" modified="200703021905" created="200703021903" tags="">/*{{{*/\n* html .tiddler {\n    height: 1%;\n}\n\nbody {\n	font-size: .75em;\n	font-family: arial,helvetica;\n	margin: 0;\n	padding: 0;\n}\n\nh1,h2,h3,h4,h5 {\n	font-weight: bold;\n	text-decoration: none;\n	padding-left: 0.4em;\n}\n\nh1 {font-size: 1.35em;}\nh2 {font-size: 1.25em;}\nh3 {font-size: 1.1em;}\nh4 {font-size: 1em;}\nh5 {font-size: .9em;}\n\nhr {\n	height: 1px;\n}\n\na{\n	text-decoration: none;\n}\n\ndt {font-weight: bold;}\n\nol { list-style-type: decimal }\nol ol { list-style-type: lower-alpha }\nol ol ol { list-style-type: lower-roman }\nol ol ol ol { list-style-type: decimal }\nol ol ol ol ol { list-style-type: lower-alpha }\nol ol ol ol ol ol { list-style-type: lower-roman }\nol ol ol ol ol ol ol { list-style-type: decimal }\n\n.txtOptionInput {\n	width: 11em;\n}\n\n#contentWrapper .chkOptionInput {\n	border: 0;\n}\n\n.externalLink {\n	text-decoration: underline;\n}\n\n.indent {margin-left:3em;}\n.outdent {margin-left:3em; text-indent:-3em;}\ncode.escaped {white-space:nowrap;}\n\n.tiddlyLinkExisting {\n	font-weight: bold;\n}\n\n.tiddlyLinkNonExisting {\n	font-style: italic;\n}\n\n/* the 'a' is required for IE, otherwise it renders the whole tiddler a bold */\na.tiddlyLinkNonExisting.shadow {\n	font-weight: bold;\n}\n\n#mainMenu .tiddlyLinkExisting, \n#mainMenu .tiddlyLinkNonExisting,\n#sidebarTabs .tiddlyLinkNonExisting{\n font-weight: normal;\n font-style: normal;\n font-size: smaller;\n}\n\n#sidebarTabs .tiddlyLinkExisting {\n font-weight: bold;\n font-style: normal;\n}\n\n.header {\n		position: relative;\n}\n\n.header a:hover {\n	background: transparent;\n}\n\n.headerShadow {\n	position: relative;\n	padding: 4.5em 0em 1em 1em;\n	left: -1px;\n	top: -1px;\n}\n\n.headerForeground {\n	position: absolute;\n	padding: 4.5em 0em 1em 1em;\n	left: 0px;\n	top: 0px;\n}\n\n.siteTitle {\n	font-size: 3em;\n}\n\n.siteSubtitle {\n	font-size: 1.2em;\n}\n\n#mainMenu {\n	position: absolute;\n	left: 0;\n	width: 10em;\n	text-align: right;\n	line-height: 1.6em;\n	padding: 1.5em 0.5em 0.5em 0.5em;\n	font-size: 1.1em;\n}\n\n#sidebar {\n	position: absolute;\n	right: 3px;\n	width: 16em;\n	font-size: .9em;\n}\n\n#sidebarOptions {\n	padding-top: 0.3em;\n}\n\n#sidebarOptions a {\n	margin: 0em 0.2em;\n	padding: 0.2em 0.3em;\n	display: block;\n}\n\n#sidebarOptions input {\n	margin: 0.4em 0.5em;\n}\n\n#sidebarOptions .sliderPanel {\n	margin-left: 1em;\n	padding: 0.5em;\n	font-size: .85em;\n}\n\n#sidebarOptions .sliderPanel a {\n	font-weight: bold;\n	display: inline;\n	padding: 0;\n}\n\n#sidebarOptions .sliderPanel input {\n	margin: 0 0 .3em 0;\n}\n\n#sidebarTabs .tabContents {\n	width: 15em;\n	overflow: hidden;\n}\n\n.wizard {\n	padding: 0.1em 0em 0em 2em;\n}\n\n.wizard h1 {\n	font-size: 2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.4em 0em 0.2em 0em;\n}\n\n.wizard h2 {\n	font-size: 1.2em;\n	font-weight: bold;\n	background: none;\n	padding: 0em 0em 0em 0em;\n	margin: 0.2em 0em 0.2em 0em;\n}\n\n.wizardStep {\n	padding: 1em 1em 1em 1em;\n}\n\n.wizard .button {\n	margin: 0.5em 0em 0em 0em;\n	font-size: 1.2em;\n}\n\n#messageArea {\nposition:absolute; top:0; right:0; margin: 0.5em; padding: 0.5em;\n}\n\n*[id='messageArea'] {\nposition:fixed !important; z-index:99;}\n\n.messageToolbar {\ndisplay: block;\ntext-align: right;\n}\n\n#messageArea a{\n	text-decoration: underline;\n}\n\n.popup {\n	font-size: .9em;\n	padding: 0.2em;\n	list-style: none;\n	margin: 0;\n}\n\n.popup hr {\n	display: block;\n	height: 1px;\n	width: auto;\n	padding: 0;\n	margin: 0.2em 0em;\n}\n\n.listBreak {\n	font-size: 1px;\n	line-height: 1px;\n}\n\n.listBreak div {\n	margin: 2px 0;\n}\n\n.popup li.disabled {\n	padding: 0.2em;\n}\n\n.popup li a{\n	display: block;\n	padding: 0.2em;\n}\n\n.tabset {\n	padding: 1em 0em 0em 0.5em;\n}\n\n.tab {\n	margin: 0em 0em 0em 0.25em;\n	padding: 2px;\n}\n\n.tabContents {\n	padding: 0.5em;\n}\n\n.tabContents ul, .tabContents ol {\n	margin: 0;\n	padding: 0;\n}\n\n.txtMainTab .tabContents li {\n	list-style: none;\n}\n\n.tabContents li.listLink {\n	 margin-left: .75em;\n}\n\n#displayArea {\n	margin: 1em 17em 0em 14em;\n}\n\n\n.toolbar {\n	text-align: right;\n	font-size: .9em;\n	visibility: hidden;\n}\n\n.selected .toolbar {\n	visibility: visible;\n}\n\n.tiddler {\n	padding: 1em 1em 0em 1em;\n}\n\n.missing .viewer,.missing .title {\n	font-style: italic;\n}\n\n.title {\n	font-size: 1.6em;\n	font-weight: bold;\n}\n\n.missing .subtitle {\n display: none;\n}\n\n.subtitle {\n	font-size: 1.1em;\n}\n\n.tiddler .button {\n	padding: 0.2em 0.4em;\n}\n\n.tagging {\nmargin: 0.5em 0.5em 0.5em 0;\nfloat: left;\ndisplay: none;\n}\n\n.isTag .tagging {\ndisplay: block;\n}\n\n.tagged {\nmargin: 0.5em;\nfloat: right;\n}\n\n.tagging, .tagged {\nfont-size: 0.9em;\npadding: 0.25em;\n}\n\n.tagging ul, .tagged ul {\nlist-style: none;margin: 0.25em;\npadding: 0;\n}\n\n.tagClear {\nclear: both;\n}\n\n.footer {\n	font-size: .9em;\n}\n\n.footer li {\ndisplay: inline;\n}\n\n* html .viewer pre {\n	width: 99%;\n	padding: 0 0 1em 0;\n}\n\n.viewer {\n	line-height: 1.4em;\n	padding-top: 0.5em;\n}\n\n.viewer .button {\n	margin: 0em 0.25em;\n	padding: 0em 0.25em;\n}\n\n.viewer blockquote {\n	line-height: 1.5em;\n	padding-left: 0.8em;\n	margin-left: 2.5em;\n}\n\n.viewer ul, .viewer ol{\n	margin-left: 0.5em;\n	padding-left: 1.5em;\n}\n\n.viewer table {\n	border-collapse: collapse;\n	margin: 0.8em 1.0em;\n}\n\n.viewer th, .viewer td, .viewer tr,.viewer caption{\n	padding: 3px;\n}\n\n.viewer table.listView {\n	font-size: 0.85em;\n	margin: 0.8em 1.0em;\n}\n\n.viewer table.listView th, .viewer table.listView td, .viewer table.listView tr {\n	padding: 0px 3px 0px 3px;\n}\n\n.viewer pre {\n	padding: 0.5em;\n	margin-left: 0.5em;\n	font-size: 1.2em;\n	line-height: 1.4em;\n	overflow: auto;\n}\n\n.viewer code {\n	font-size: 1.2em;\n	line-height: 1.4em;\n}\n\n.editor {\nfont-size: 1.1em;\n}\n\n.editor input, .editor textarea {\n	display: block;\n	width: 100%;\n	font: inherit;\n}\n\n.editorFooter {\n	padding: 0.25em 0em;\n	font-size: .9em;\n}\n\n.editorFooter .button {\npadding-top: 0px; padding-bottom: 0px;}\n\n.fieldsetFix {border: 0;\npadding: 0;\nmargin: 1px 0px 1px 0px;\n}\n\n.sparkline {\n	line-height: 1em;\n}\n\n.sparktick {\n	outline: 0;\n}\n\n.zoomer {\n	font-size: 1.1em;\n	position: absolute;\n	padding: 1em;\n}\n\n.cascade {\n	font-size: 1.1em;\n	position: absolute;\n	overflow: hidden;\n}\n/*}}}*/</div>
<div tiddler="TabLectureAll" modifier="YourName" modified="200611100506" created="200611080439" tags="excludeLists">&lt;&lt;forEachTiddler\n where\n '!tiddler.tags.containsAny([&quot;Note&quot;,&quot;excludeLists&quot;,&quot;&quot;])'\nsortBy\n 'tiddler.title'\n ascending\n write\n '&quot;[[&quot;+tiddler.title+&quot;]]\sn&quot;'\n&gt;&gt;</div>
<div tiddler="TabLectureTimeline" modifier="YourName" modified="200611100416" created="200611080432" tags="excludeLists">&lt;&lt;timeline better:true excludeTag:Note excludeTag2:excludeLists&gt;&gt;</div>
<div tiddler="TabLectures" modifier="YourName" modified="200611091953" created="200611080429" tags="excludeLists">&lt;&lt;tabs txtMainTab Timeline 'Lecture notes by date last modified' TabLectureTimeline All 'Lecture notes by title' TabLectureAll&gt;&gt;</div>
<div tiddler="TabNotes" modifier="YourName" modified="200611091953" created="200611080441" tags="excludeLists">&lt;&lt;tabs txtMainTab Timeline 'My notes by date last modified' TabNotesTimeline All 'My notes by title' TabNotesAll&gt;&gt;</div>
<div tiddler="TabNotesAll" modifier="YourName" modified="200611091953" created="200611080442" tags="excludeLists">&lt;&lt;forEachTiddler\n where\n 'tiddler.tags.contains(&quot;Note&quot;,&quot;&quot;,&quot;&quot;)'\nsortBy\n 'tiddler.title'\n ascending\n write\n '&quot;[[&quot;+tiddler.title+&quot;]]\sn&quot;'\n&gt;&gt;</div>
<div tiddler="TabNotesTimeline" modifier="YourName" modified="200611091953" created="200611080443" tags="excludeLists">&lt;&lt;timeline better:true onlyTag:Note&gt;&gt;</div>
<div tiddler="TabSys" modifier="YourName" modified="200611091947" created="200608270424" tags="excludeLists">&lt;&lt;forEachTiddler \n where \n 'tiddler.tags.containsAny([&quot;excludeLists&quot;,&quot;systemConfig&quot;,&quot;&quot;])'\nsortBy\n 'tiddler.title'\n ascending\n&gt;&gt;</div>
<div tiddler="TabTags" modifier="YourName" modified="200611091948" created="200603300629" tags="excludeLists">&lt;&lt;allTagsExcept systemConfig   *systemConfig    formatting includeNew Plugin script styles stylesheets systemTiddlers hideTagged Tech template TiddlyWikiStuff stylesheets S1 S2 S3 S4 S5 S6 S7 S8 S9 S10&gt;&gt;</div>
<div tiddler="TagglyTaggingPlugin" modifier="YourName" modified="200611091955" created="200610200252" tags="systemConfig excludeSearch excludeLists">/***\n| Name:|TagglyTaggingPlugin|\n| Description:|tagglyTagging macro is a replacement for the builtin tagging macro in your ViewTemplate|\n| Version:|6.1.5|\n| Date:|05-Oct-2006|\n| Source:|http://mptw.tiddlyspot.com/#TagglyTaggingPlugin|\n| Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|\n| CoreVersion:|2.1.x|\n!Notes\nSee http://mptw.tiddlyspot.com/#TagglyTagging\n***/\n//{{{\nconfig.taggly = {\n\n	// for translations\n	lingo: {\n		labels: {\n			asc:      &quot;\su2191&quot;, // down arrow\n			desc:     &quot;\su2193&quot;, // up arrow\n			title:    &quot;title&quot;,\n			modified: &quot;modified&quot;,\n			created:  &quot;created&quot;,\n			show:     &quot;+&quot;,\n			hide:     &quot;-&quot;,\n			normal:   &quot;normal&quot;,\n			group:    &quot;group&quot;,\n			commas:   &quot;commas&quot;,\n			sitemap:  &quot;sitemap&quot;,\n			numCols:  &quot;cols\su00b1&quot;, // plus minus sign\n			label:    &quot;Tagged as '%0':&quot;\n		},\n\n		tooltips: {\n			title:    &quot;Click to sort by title&quot;,\n			modified: &quot;Click to sort by modified date&quot;,\n			created:  &quot;Click to sort by created date&quot;,\n			show:     &quot;Click to show tagging list&quot;,\n			hide:     &quot;Click to hide tagging list&quot;,\n			normal:   &quot;Click to show a normal ungrouped list&quot;,\n			group:    &quot;Click to show list grouped by tag&quot;,\n			sitemap:  &quot;Click to show a sitemap style list&quot;,\n			commas:   &quot;Click to show a comma separated list&quot;,\n			numCols:  &quot;Click to change number of columns&quot;\n		}\n	},\n\n	config: {\n		showTaggingCounts: true,\n		listOpts: {\n			// the first one will be the default\n			sortBy:     [&quot;title&quot;,&quot;modified&quot;,&quot;created&quot;],\n			sortOrder:  [&quot;asc&quot;,&quot;desc&quot;],\n			hideState:  [&quot;show&quot;,&quot;hide&quot;],\n			listMode:   [&quot;normal&quot;,&quot;group&quot;,&quot;sitemap&quot;,&quot;commas&quot;],\n			numCols:    [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6&quot;]\n		},\n		valuePrefix: &quot;taggly.&quot;\n	},\n\n	getTagglyOpt: function(title,opt) {\n		var val = store.getValue(title,this.config.valuePrefix+opt);\n		return val ? val : this.config.listOpts[opt][0];\n	},\n\n	setTagglyOpt: function(title,opt,value) {\n		if (!store.tiddlerExists(title))\n			// create it silently\n			store.saveTiddler(title,title,config.views.editor.defaultText.format([title]),config.options.txtUserName,new Date(),null);\n		// if value is default then remove it to save space\n		return store.setValue(title,\n			this.config.valuePrefix+opt,\n			value == this.config.listOpts[opt][0] ? null : value);\n	},\n\n	getNextValue: function(title,opt) {\n		var current = this.getTagglyOpt(title,opt);\n		var pos = this.config.listOpts[opt].indexOf(current);\n		// a little usability enhancement. actually it doesn't work right for grouped or sitemap\n		var limit = (opt == &quot;numCols&quot; ? store.getTaggedTiddlers(title).length : this.config.listOpts[opt].length);\n		var newPos = (pos + 1) % limit;\n		return this.config.listOpts[opt][newPos];\n	},\n\n	toggleTagglyOpt: function(title,opt) {\n		var newVal = this.getNextValue(title,opt);\n		this.setTagglyOpt(title,opt,newVal);\n	}, \n\n	createListControl: function(place,title,type) {\n		var lingo = config.taggly.lingo;\n		var label;\n		var tooltip;\n		var onclick;\n\n		if ((type == &quot;title&quot; || type == &quot;modified&quot; || type == &quot;created&quot;)) {\n			// &quot;special&quot; controls. a little tricky. derived from sortOrder and sortBy\n			label = lingo.labels[type];\n			tooltip = lingo.tooltips[type];\n\n			if (this.getTagglyOpt(title,&quot;sortBy&quot;) == type) {\n				label += lingo.labels[this.getTagglyOpt(title,&quot;sortOrder&quot;)];\n				onclick = function() {\n					config.taggly.toggleTagglyOpt(title,&quot;sortOrder&quot;);\n					return false;\n				}\n			}\n			else {\n				onclick = function() {\n					config.taggly.setTagglyOpt(title,&quot;sortBy&quot;,type);\n					config.taggly.setTagglyOpt(title,&quot;sortOrder&quot;,config.taggly.config.listOpts.sortOrder[0]);\n					return false;\n				}\n			}\n		}\n		else {\n			// &quot;regular&quot; controls, nice and simple\n			label = lingo.labels[type == &quot;numCols&quot; ? type : this.getNextValue(title,type)];\n			tooltip = lingo.tooltips[type == &quot;numCols&quot; ? type : this.getNextValue(title,type)];\n			onclick = function() {\n				config.taggly.toggleTagglyOpt(title,type);\n				return false;\n			}\n		}\n\n		// hide button because commas don't have columns\n		if (!(this.getTagglyOpt(title,&quot;listMode&quot;) == &quot;commas&quot; &amp;&amp; type == &quot;numCols&quot;))\n			createTiddlyButton(place,label,tooltip,onclick,type == &quot;hideState&quot; ? &quot;hidebutton&quot; : &quot;button&quot;);\n	},\n\n	makeColumns: function(orig,numCols) {\n		var listSize = orig.length;\n		var colSize = listSize/numCols;\n		var remainder = listSize % numCols;\n\n		var upperColsize = colSize;\n		var lowerColsize = colSize;\n\n		if (colSize != Math.floor(colSize)) {\n			// it's not an exact fit so..\n			upperColsize = Math.floor(colSize) + 1;\n			lowerColsize = Math.floor(colSize);\n		}\n\n		var output = [];\n		var c = 0;\n		for (var j=0;j&lt;numCols;j++) {\n			var singleCol = [];\n			var thisSize = j &lt; remainder ? upperColsize : lowerColsize;\n			for (var i=0;i&lt;thisSize;i++) \n				singleCol.push(orig[c++]);\n			output.push(singleCol);\n		}\n\n		return output;\n	},\n\n	drawTable: function(place,columns,theClass) {\n		var newTable = createTiddlyElement(place,&quot;table&quot;,null,theClass);\n		var newTbody = createTiddlyElement(newTable,&quot;tbody&quot;);\n		var newTr = createTiddlyElement(newTbody,&quot;tr&quot;);\n		for (var j=0;j&lt;columns.length;j++) {\n			var colOutput = &quot;&quot;;\n			for (var i=0;i&lt;columns[j].length;i++) \n				colOutput += columns[j][i];\n			var newTd = createTiddlyElement(newTr,&quot;td&quot;,null,&quot;tagglyTagging&quot;); // todo should not need this class\n			wikify(colOutput,newTd);\n		}\n		return newTable;\n	},\n\n	createTagglyList: function(place,title) {\n		switch(this.getTagglyOpt(title,&quot;listMode&quot;)) {\n			case &quot;group&quot;:  return this.createTagglyListGrouped(place,title); break;\n			case &quot;normal&quot;: return this.createTagglyListNormal(place,title,false); break;\n			case &quot;commas&quot;: return this.createTagglyListNormal(place,title,true); break;\n			case &quot;sitemap&quot;:return this.createTagglyListSiteMap(place,title); break;\n		}\n	},\n\n	getTaggingCount: function(title) {\n		// thanks to Doug Edmunds\n		if (this.config.showTaggingCounts) {\n			var tagCount = store.getTaggedTiddlers(title).length;\n			if (tagCount &gt; 0)\n				return &quot; (&quot;+tagCount+&quot;)&quot;;\n		}\n		return &quot;&quot;;\n	},\n\n	// this is for normal and commas mode\n	createTagglyListNormal: function(place,title,useCommas) {\n\n		var list = store.getTaggedTiddlers(title,this.getTagglyOpt(title,&quot;sortBy&quot;));\n\n		if (this.getTagglyOpt(title,&quot;sortOrder&quot;) == &quot;desc&quot;)\n			list = list.reverse();\n\n		var output = [];\n		for (var i=0;i&lt;list.length;i++) {\n			var countString = this.getTaggingCount(list[i].title);\n			if (useCommas)\n				output.push((i &gt; 0 ? &quot;, &quot; : &quot;&quot;) + &quot;[[&quot; + list[i].title + &quot;]]&quot; + countString);\n			else\n				output.push(&quot;*[[&quot; + list[i].title + &quot;]]&quot; + countString + &quot;\sn&quot;);\n		}\n\n		return this.drawTable(place,\n			this.makeColumns(output,useCommas ? 1 : parseInt(this.getTagglyOpt(title,&quot;numCols&quot;))),\n			useCommas ? &quot;commas&quot; : &quot;normal&quot;);\n	},\n\n	// this is for the &quot;grouped&quot; mode\n	createTagglyListGrouped: function(place,title) {\n		var sortBy = this.getTagglyOpt(title,&quot;sortBy&quot;);\n		var sortOrder = this.getTagglyOpt(title,&quot;sortOrder&quot;);\n\n		var list = store.getTaggedTiddlers(title,sortBy);\n\n		if (sortOrder == &quot;desc&quot;)\n			list = list.reverse();\n\n		var leftOvers = []\n		for (var i=0;i&lt;list.length;i++)\n			leftOvers.push(list[i].title);\n\n		var allTagsHolder = {};\n		for (var i=0;i&lt;list.length;i++) {\n			for (var j=0;j&lt;list[i].tags.length;j++) {\n\n				if (list[i].tags[j] != title) { // not this tiddler\n\n					if (!allTagsHolder[list[i].tags[j]])\n						allTagsHolder[list[i].tags[j]] = &quot;&quot;;\n\n					allTagsHolder[list[i].tags[j]] += &quot;**[[&quot;+list[i].title+&quot;]]&quot;\n									+ this.getTaggingCount(list[i].title) + &quot;\sn&quot;;\n					leftOvers.setItem(list[i].title,-1); // remove from leftovers. at the end it will contain the leftovers\n				}\n			}\n		}\n\n		var allTags = [];\n		for (var t in allTagsHolder)\n			allTags.push(t);\n\n		var sortHelper = function(a,b) {\n			if (a == b) return 0;\n			if (a &lt; b) return -1;\n			return 1;\n		};\n\n		allTags.sort(function(a,b) {\n			var tidA = store.getTiddler(a);\n			var tidB = store.getTiddler(b);\n			if (sortBy == &quot;title&quot;) return sortHelper(a,b);\n			else if (!tidA &amp;&amp; !tidB) return 0;\n			else if (!tidA) return -1;\n			else if (!tidB) return +1;\n			else return sortHelper(tidA[sortBy],tidB[sortBy]);\n		});\n\n		var leftOverOutput = &quot;&quot;;\n		for (var i=0;i&lt;leftOvers.length;i++)\n			leftOverOutput += &quot;*[[&quot;+leftOvers[i]+&quot;]]&quot; + this.getTaggingCount(leftOvers[i]) + &quot;\sn&quot;;\n\n		var output = [];\n\n		if (sortOrder == &quot;desc&quot;)\n			allTags.reverse();\n		else if (leftOverOutput != &quot;&quot;)\n			// leftovers first...\n			output.push(leftOverOutput);\n\n		for (var i=0;i&lt;allTags.length;i++)\n			output.push(&quot;*[[&quot;+allTags[i]+&quot;]]&quot; + this.getTaggingCount(leftOvers[i]) + &quot;\sn&quot; + allTagsHolder[allTags[i]]);\n\n		if (sortOrder == &quot;desc&quot; &amp;&amp; leftOverOutput != &quot;&quot;)\n			// leftovers last...\n			output.push(leftOverOutput);\n\n		return this.drawTable(place,\n				this.makeColumns(output,parseInt(this.getTagglyOpt(title,&quot;numCols&quot;))),\n				&quot;grouped&quot;);\n\n	},\n\n	// used to build site map\n	treeTraverse: function(title,depth,sortBy,sortOrder) {\n\n		var list = store.getTaggedTiddlers(title,sortBy);\n		if (sortOrder == &quot;desc&quot;)\n			list.reverse();\n\n		var indent = &quot;&quot;;\n		for (var j=0;j&lt;depth;j++)\n			indent += &quot;*&quot;\n\n		var childOutput = &quot;&quot;;\n		for (var i=0;i&lt;list.length;i++)\n			if (list[i].title != title)\n				childOutput += this.treeTraverse(list[i].title,depth+1,sortBy,sortOrder);\n\n		if (depth == 0)\n			return childOutput;\n		else\n			return indent + &quot;[[&quot;+title+&quot;]]&quot; + this.getTaggingCount(title) + &quot;\sn&quot;+childOutput;\n	},\n\n	// this if for the site map mode\n	createTagglyListSiteMap: function(place,title) {\n		var output = this.treeTraverse(title,0,this.getTagglyOpt(title,&quot;sortBy&quot;),this.getTagglyOpt(title,&quot;sortOrder&quot;));\n		return this.drawTable(place,\n				this.makeColumns(output.split(/(?=^\s*\s[)/m),parseInt(this.getTagglyOpt(title,&quot;numCols&quot;))), // regexp magic\n				&quot;sitemap&quot;\n				);\n	},\n\n	macros: {\n		tagglyTagging: {\n			handler: function (place,macroName,params,wikifier,paramString,tiddler) {\n				var refreshContainer = createTiddlyElement(place,&quot;div&quot;);\n				// do some refresh magic to make it keep the list fresh - thanks Saq\n				refreshContainer.setAttribute(&quot;refresh&quot;,&quot;macro&quot;);\n				refreshContainer.setAttribute(&quot;macroName&quot;,macroName);\n        			refreshContainer.setAttribute(&quot;title&quot;,tiddler.title);\n				this.refresh(refreshContainer);\n			},\n\n			refresh: function(place) {\n				var title = place.getAttribute(&quot;title&quot;);\n				removeChildren(place);\n				if (store.getTaggedTiddlers(title).length &gt; 0) {\n					var lingo = config.taggly.lingo;\n					config.taggly.createListControl(place,title,&quot;hideState&quot;);\n					if (config.taggly.getTagglyOpt(title,&quot;hideState&quot;) == &quot;show&quot;) {\n						createTiddlyElement(place,&quot;span&quot;,null,&quot;tagglyLabel&quot;,lingo.labels.label.format([title]));\n						config.taggly.createListControl(place,title,&quot;title&quot;);\n						config.taggly.createListControl(place,title,&quot;modified&quot;);\n						config.taggly.createListControl(place,title,&quot;created&quot;);\n						config.taggly.createListControl(place,title,&quot;listMode&quot;);\n						config.taggly.createListControl(place,title,&quot;numCols&quot;);\n						config.taggly.createTagglyList(place,title);\n					}\n				}\n			}\n		}\n	},\n\n	// todo fix these up a bit\n	styles: \n&quot;/*{{{*/\sn&quot;+\n&quot;/* created by TagglyTaggingPlugin */\sn&quot;+\n&quot;.tagglyTagging { padding-top:0.5em; }\sn&quot;+\n&quot;.tagglyTagging li.listTitle { display:none; }\sn&quot;+\n&quot;.tagglyTagging ul {\sn&quot;+\n&quot;	margin-top:0px; padding-top:0.5em; padding-left:2em;\sn&quot;+\n&quot;	margin-bottom:0px; padding-bottom:0px;\sn&quot;+\n&quot;}\sn&quot;+\n&quot;.tagglyTagging { vertical-align: top; margin:0px; padding:0px; }\sn&quot;+\n&quot;.tagglyTagging table { margin:0px; padding:0px; }\sn&quot;+\n&quot;.tagglyTagging .button { display:none; margin-left:3px; margin-right:3px; }\sn&quot;+\n&quot;.tagglyTagging .button, .tagglyTagging .hidebutton {\sn&quot;+\n&quot;	color:[[ColorPalette::TertiaryLight]]; font-size:90%;\sn&quot;+\n&quot;	border:0px; padding-left:0.3em;padding-right:0.3em;\sn&quot;+\n&quot;}\sn&quot;+\n&quot;.tagglyTagging .button:hover, .hidebutton:hover {\sn&quot;+\n&quot;	background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]];\sn&quot;+\n&quot;}\sn&quot;+\n&quot;.selected .tagglyTagging .button {\sn&quot;+\n&quot;	display:inline;\sn&quot;+\n&quot;}\sn&quot;+\n&quot;.tagglyTagging .hidebutton { color:[[ColorPalette::Background]]; }\sn&quot;+\n&quot;.selected .tagglyTagging .hidebutton { color:[[ColorPalette::TertiaryLight]] }\sn&quot;+\n&quot;.tagglyLabel { color:[[ColorPalette::TertiaryMid]]; font-size:90%; }\sn&quot;+\n&quot;.tagglyTagging ul {padding-top:0px; padding-bottom:0.5em; margin-left:1em; }\sn&quot;+\n&quot;.tagglyTagging ul ul {list-style-type:disc; margin-left:-1em;}\sn&quot;+\n&quot;.tagglyTagging ul ul li {margin-left:0.5em; }\sn&quot;+\n&quot;.editLabel { font-size:90%; padding-top:0.5em; }\sn&quot;+\n&quot;.tagglyTagging .commas { padding-left:1.8em; }\sn&quot;+\n&quot;/*}}}*/\sn&quot;+\n		&quot;&quot;,\n\n	init: function() {\n		merge(config.macros,this.macros);\n		config.shadowTiddlers[&quot;TagglyTaggingStyles&quot;] = this.styles;\n		if (store)\n			store.addNotification(&quot;TagglyTaggingStyles&quot;,refreshStyles);\n		else\n			config.notifyTiddlers.push({name:&quot;TagglyTaggingStyles&quot;, notify: refreshStyles});\n	}\n};\n\nconfig.taggly.init();\n\n//}}}\n\n</div>
<div tiddler="Teaching" modifier="ChrisJobling" modified="200705291046" created="200705291046" tags="">* [[EG-259: Web Applications Technology]]</div>
<div tiddler="TiddlerWithParams" modifier="YourName" modified="200611150525" created="200611150525" tags="systemConfig">/***\n|''Name:''|TiddlerWithParamsPlugin|\n|''Version:''|1.0.1 (2006-03-22)|\n|''Source:''|http://tiddlywiki.abego-software.de/#TiddlerWithParamsPlugin|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license]]|\n!Description\n\nThe TiddlerWithParamsPlugin extends the build-in {{{&lt;&lt;tiddler...&gt;&gt;}}} macro. It replaces placeholders ($1, $2, ...) in the given tiddler by values passed with the macro. Then it inserts the (replaced) text, just like the original {{{&lt;&lt;tiddler...&gt;&gt;}}} macro.\n\n''Syntax:'' \n|&gt;|{{{&lt;&lt;}}}''tiddler '' //tiddlerName// [//className//] [''asText''] [''with:'' //arguments// ] [''prefix:'' //prefixString//] {{{&gt;&gt;}}}|\n|//tiddlerName//|The name of the tiddler to be included. The tiddler may contain placeholders ($1, $2, ... $9) that will be replaced with the values passed with the macro|\n|//className//|The (CSS) class to be used around the embedded tiddler|\n|''asText''|When defined the (replaced) content of the tiddler is inserted as pure text, i.e. it is not &quot;wikified&quot;.|\n|//arguments//|up to 9 arguments may be passed to the macro, used as the values for the placeholders $1, $2, ... $9 in the referenced template|\n|//prefixString//|By default the placeholders $1, $2, $3,..., $9 are used. But you may change the &quot;prefix&quot; before the placeholder number (&quot;$&quot;) to some other text through the &quot;prefix:&quot; option. This may be necessary when you are using the $n in the tiddler you are referencing (e.g. when you are using regular expressions).|\n|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. ~~|\n\n!Example\n\nThe following ''//ProjectTemplate//'' tiddler defines an &quot;Overview&quot; page for a project, that gives access to various &quot;sub-tiddlers&quot; used in the project, that follow a static naming schema (e.g. all Notes for any project are stored in a tiddler called &quot;//projectName// Notes&quot;). $1 holds the name of the Project (e.g. &quot;ForEachTiddler&quot;), $2 holds the type of the published component (e.g. &quot;Plugin&quot;, &quot;Macro&quot;, &quot;Function&quot;).\n{{{\n![[$1Project]] Overview\n* [[$1$2]]\n* [[ToDo|$1 ToDos]]\n* [[Notes|$1 Notes]]\n* [[Examples|$1Examples]]\n* [[Tests|$1 Tests]]\n* [[Open Bugs/CRs|$1 Open Bugs and ChangeRequests]]\n}}}\n\nThis template is now used in the ''//ForEachTiddlerProject//'' tiddler:\n{{{\n&lt;&lt;tiddler ProjectTemplate with: ForEachTiddler Plugin&gt;&gt;\n}}}\n\nThis results in the following tiddler text for the ''//ForEachTiddlerProject//'' tiddler:\n{{{\n![[ForEachTiddlerProject]] Overview\n* [[ForEachTiddlerPlugin]]\n* [[ToDo|ForEachTiddler ToDos]]\n* [[Notes|ForEachTiddler Notes]]\n* [[Examples|ForEachTiddlerExamples]]\n* [[Tests|ForEachTiddler Tests]]\n* [[Open Bugs/CRs|ForEachTiddler Open Bugs and ChangeRequests]]\n}}}\n\n!Revision history\n* v1.0.0 (2006-01-20)\n** initial version\n* v1.0.1 (2006-03-22)\n** Added 'asText' option\n** Support Safari (Thanks to Elise Springer for reporting the problem)\n!Code\n***/\n//{{{\n//============================================================================\n// TiddlerWithParamsPlugin\n//============================================================================\n\n// Ensure that the Plugin is only installed once.\n//\nif (!version.extensions.TiddlerWithParamsPlugin) {\n\nversion.extensions.TiddlerWithParamsPlugin = {\n major: 1, minor: 0, revision: 1, \n date: new Date(2006,3,22), \n type: 'plugin',\n source: &quot;http://tiddlywiki.abego-software.de/#TiddlerWithParamsPlugin&quot;\n};\n\n// ---------------------------------------------------------------------------\n// Helpers\n// ---------------------------------------------------------------------------\n\nvar indexInArray = function(array, item) {\n for (var i = 0; i &lt; array.length; i++) {\n if (array[i] == item) {\n return i;\n }\n }\n return -1;\n}\n\nvar myEscapeRegExp = function(s)\n{\n // The original escapeRegExp function does not work with Safari (2.0.3) \n // since the $&amp; is not implemented.\nvar t = s.replace(/\s\s/g, &quot;\s\s\s\s&quot;);\n t = t.replace(/\s^/g, &quot;\s\s^&quot;);\n t = t.replace(/\s$/g, &quot;\s\s$&quot;);\n t = t.replace(/\s*/g, &quot;\s\s*&quot;);\n t = t.replace(/\s+/g, &quot;\s\s+&quot;);\n t = t.replace(/\s?/g, &quot;\s\s?&quot;);\n t = t.replace(/\s(/g, &quot;\s\s(&quot;);\n t = t.replace(/\s)/g, &quot;\s\s)&quot;);\n t = t.replace(/\s=/g, &quot;\s\s=&quot;);\n t = t.replace(/\s!/g, &quot;\s\s!&quot;);\n t = t.replace(/\s|/g, &quot;\s\s|&quot;);\n t = t.replace(/\s,/g, &quot;\s\s,&quot;);\n t = t.replace(/\s{/g, &quot;\s\s{&quot;);\n t = t.replace(/\s}/g, &quot;\s\s}&quot;);\n t = t.replace(/\s[/g, &quot;\s\s[&quot;);\n t = t.replace(/\s]/g, &quot;\s\s]&quot;);\n t = t.replace(/\s./g, &quot;\s\s.&quot;);\n\n return t;\n}\n\n// ---------------------------------------------------------------------------\n// The (hijacked) tiddler Macro Handler \n// ---------------------------------------------------------------------------\n\nconfig.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler) {\n \n var className = null;\n var argsStart = -1;\n var doWikify = true;\n\n var iParams = 1;\n if (params[iParams] != &quot;asText&quot; &amp;&amp; params[iParams] != &quot;with:&quot;) {\n className = params[iParams++];\n }\n if (params[iParams] == &quot;asText&quot;) {\n iParams++;\n doWikify = false;\n }\n if (params[iParams] == &quot;with:&quot;) {\n iParams++;\n argsStart = iParams;\n }\n \n var wrapper = createTiddlyElement(place,&quot;span&quot;,null,className ? className : null,null);\n var text = store.getTiddlerText(params[0]);\n if(text) {\n // Check for recursion\n var tiddlerName = params[0];\n var stack = config.macros.tiddler.tiddlerStack;\n if (stack.find(tiddlerName) !== null) return;\n\n if (argsStart &gt;= 0) {\n // The params between the &quot;with:&quot; and the &quot;prefix:&quot; (or the end) are the arguments,\n // The param behind the &quot;prefix:&quot; is the prefix before the placeholder numbers.\n var argsEnd = params.length;\n var prefix = &quot;$&quot;;\n var prefixIndex = indexInArray(params, &quot;prefix:&quot;);\n if (prefixIndex &gt;= argsStart) {\n argsEnd = prefixIndex;\n if (prefixIndex &lt; (params.length-1)) {\n prefix = params[prefixIndex+1];\n }\n }\n // to avoid any &quot;special RE chars&quot; problems with the prefix string escape all chars.\n prefix = myEscapeRegExp(prefix);\n \n var args = params.slice(argsStart, argsEnd);\n var n = Math.min(args.length, 9);\n for (var i = 0; i &lt; n; i++) {\n var value = args[i];\n \n var placeholderRE = new RegExp(prefix+(i+1),&quot;mg&quot;);\n text = text.replace(placeholderRE, value);\n }\n }\n stack.push(tiddlerName);\n try {\n if (doWikify) {\n wikify(text,wrapper,null,store.getTiddler(params[0]));\n } else {\n wrapper.appendChild(document.createTextNode(text));\n }\n } finally { \n stack.pop();\n }\n }\n}\nconfig.macros.tiddler.tiddlerStack = [];\n\n// End of &quot;install only once&quot;\n}\n\n//============================================================================\n// End of TiddlerWithParamsPlugin\n//============================================================================\n//}}}\n/***\n!Licence and Copyright\nCopyright (c) abego Software ~GmbH, 2006 ([[www.abego-software.de|http://www.abego-software.de]])\n\nRedistribution and use in source and binary forms, with or without modification,\nare permitted provided that the following conditions are met:\n\nRedistributions of source code must retain the above copyright notice, this\nlist of conditions and the following disclaimer.\n\nRedistributions in binary form must reproduce the above copyright notice, this\nlist of conditions and the following disclaimer in the documentation and/or other\nmaterials provided with the distribution.\n\nNeither the name of abego Software nor the names of its contributors may be\nused to endorse or promote products derived from this software without specific\nprior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY\nEXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\nOF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\nSHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\nINCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\nTO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\nBUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\nCONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\nANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\nDAMAGE.\n***/\n</div>
<div tiddler="ToDo" modifier="ChrisJobling" modified="200604281516" created="200604281516" tags="">* Put this TiddlyWiki on my DataStick\n* Learn the TiddlyWiki syntax\n </div>
<div tiddler="Tools" modifier="ChrisJobling" modified="200705291100" created="200705291057" tags="query tools xampp firefox fiirebug perl wordpress mediawiki drupal">To make this module a success Students will need access to a basic toolkit:\n* ''Base platform''\n** Web server: [[XAMPP-Lite|http://www.apachefriends.org/en/xampp-windows.html#646]] (Apache + CGI + PHP + MySQL) -- Does it support CGI?\n** Web browser: Firefox web browser\n** Client-side code inspector and ~JavaScript debugger: Firebug \n** CGI Programming: Perl (would Python or Ruby be better?)\n* ''Application Examples''\n** CMS: Drupal\n** Wiki: MediaWiki or DokuWiki\n** Blogger: WordPress\n\n\n</div>
<div tiddler="UploadOptions" modifier="YourName" modified="200611092000" created="200602122222" tags="Upload excludeLists">!Options used by UploadPlugin\nUsername: &lt;&lt;option txtUploadUserName&gt;&gt;\nPassword: &lt;&lt;option pasUploadPassword&gt;&gt;\n\nUrl of the UploadService script^^(1)^^: &lt;&lt;option txtUploadStoreUrl 50&gt;&gt;\nRelative Directory where to store the file^^(2)^^: &lt;&lt;option txtUploadDir 50&gt;&gt;\nFilename of the uploaded file^^(3)^^: &lt;&lt;option txtUploadFilename 40&gt;&gt;\nDirectory to backup file on webserver^^(4)^^: &lt;&lt;option txtUploadBackupDir&gt;&gt;\n\n^^(1)^^Mandatory either in UploadOptions or in macro parameter\n^^(2)^^If empty stores in the script directory\n^^(3)^^If empty takes the actual filename\n^^(4)^^If empty existing file with same name on webserver will be overwritten\n\n&lt;&lt;upload&gt;&gt; with these options.\n\n!Upload Macro parameters\n{{{\n&lt;&lt;upload [storeUrl [toFilename [backupDir [uploadDir [username]]]]]&gt;&gt;\n	Optional positional parameters can be passed to overwrite \n	UploadOptions. \n}}}\n\n</div>
<div tiddler="UploadPlugin" modifier="YourName" modified="200611091955" created="200603100902" tags="systemConfig Upload plugin excludeLists">/***\n|''Name:''|UploadPlugin|\n|''Description:''|Save to web a TiddlyWiki|\n|''Version:''|3.4.5|\n|''Date:''|Oct 15, 2006|\n|''Source:''|http://tiddlywiki.bidix.info/#UploadPlugin|\n|''Documentation:''|http://tiddlywiki.bidix.info/#UploadDoc|\n|''Author:''|BidiX (BidiX (at) bidix (dot) info)|\n|''License:''|[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D ]]|\n|''~CoreVersion:''|2.0.0|\n|''Browser:''|Firefox 1.5; InternetExplorer 6.0; Safari|\n|''Include:''|config.lib.file; config.lib.log; config.lib.options; PasswordTweak|\n|''Require:''|[[UploadService|http://tiddlywiki.bidix.info/#UploadService]]|\n***/\n//{{{\nversion.extensions.UploadPlugin = {\n	major: 3, minor: 4, revision: 5, \n	date: new Date(2006,9,15),\n	source: 'http://tiddlywiki.bidix.info/#UploadPlugin',\n	documentation: 'http://tiddlywiki.bidix.info/#UploadDoc',\n	author: 'BidiX (BidiX (at) bidix (dot) info',\n	license: '[[BSD open source license|http://tiddlywiki.bidix.info/#%5B%5BBSD%20open%20source%20license%5D%5D]]',\n	coreVersion: '2.0.0',\n	browser: 'Firefox 1.5; InternetExplorer 6.0; Safari'\n};\n//}}}\n\n////+++!![config.lib.file]\n\n//{{{\nif (!config.lib) config.lib = {};\nif (!config.lib.file) config.lib.file= {\n	author: 'BidiX',\n	version: {major: 0, minor: 1, revision: 0}, \n	date: new Date(2006,3,9)\n};\nconfig.lib.file.dirname = function (filePath) {\n	var lastpos;\n	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {\n		return filePath.substring(0, lastpos);\n	} else {\n		return filePath.substring(0, filePath.lastIndexOf(&quot;\s\s&quot;));\n	}\n};\nconfig.lib.file.basename = function (filePath) {\n	var lastpos;\n	if ((lastpos = filePath.lastIndexOf(&quot;#&quot;)) != -1) \n		filePath = filePath.substring(0, lastpos);\n	if ((lastpos = filePath.lastIndexOf(&quot;/&quot;)) != -1) {\n		return filePath.substring(lastpos + 1);\n	} else\n		return filePath.substring(filePath.lastIndexOf(&quot;\s\s&quot;)+1);\n};\nwindow.basename = function() {return &quot;@@deprecated@@&quot;;};\n//}}}\n////===\n\n////+++!![config.lib.log]\n\n//{{{\nif (!config.lib) config.lib = {};\nif (!config.lib.log) config.lib.log= {\n	author: 'BidiX',\n	version: {major: 0, minor: 1, revision: 1}, \n	date: new Date(2006,8,19)\n};\nconfig.lib.Log = function(tiddlerTitle, logHeader) {\n	if (version.major &lt; 2)\n		this.tiddler = store.tiddlers[tiddlerTitle];\n	else\n		this.tiddler = store.getTiddler(tiddlerTitle);\n	if (!this.tiddler) {\n		this.tiddler = new Tiddler();\n		this.tiddler.title = tiddlerTitle;\n		this.tiddler.text = &quot;| !date | !user | !location |&quot; + logHeader;\n		this.tiddler.created = new Date();\n		this.tiddler.modifier = config.options.txtUserName;\n		this.tiddler.modified = new Date();\n	if (version.major &lt; 2)\n		store.tiddlers[tiddlerTitle] = this.tiddler;\n	else\n		store.addTiddler(this.tiddler);\n	}\n	return this;\n};\n\nconfig.lib.Log.prototype.newLine = function (line) {\n	var now = new Date();\n	var newText = &quot;| &quot;;\n	newText += now.getDate()+&quot;/&quot;+(now.getMonth()+1)+&quot;/&quot;+now.getFullYear() + &quot; &quot;;\n	newText += now.getHours()+&quot;:&quot;+now.getMinutes()+&quot;:&quot;+now.getSeconds()+&quot; | &quot;;\n	newText += config.options.txtUserName + &quot; | &quot;;\n	var location = document.location.toString();\n	var filename = config.lib.file.basename(location);\n	if (!filename) filename = '/';\n	newText += &quot;[[&quot;+filename+&quot;|&quot;+location + &quot;]] |&quot;;\n	this.tiddler.text = this.tiddler.text + &quot;\sn&quot; + newText;\n	this.addToLine(line);\n};\n\nconfig.lib.Log.prototype.addToLine = function (text) {\n	this.tiddler.text = this.tiddler.text + text;\n	this.tiddler.modifier = config.options.txtUserName;\n	this.tiddler.modified = new Date();\n	if (version.major &lt; 2)\n	store.tiddlers[this.tiddler.tittle] = this.tiddler;\n	else {\n		store.addTiddler(this.tiddler);\n		story.refreshTiddler(this.tiddler.title);\n		store.notify(this.tiddler.title, true);\n	}\n	if (version.major &lt; 2)\n		store.notifyAll(); \n};\n//}}}\n////===\n\n////+++!![config.lib.options]\n\n//{{{\nif (!config.lib) config.lib = {};\nif (!config.lib.options) config.lib.options = {\n	author: 'BidiX',\n	version: {major: 0, minor: 1, revision: 0}, \n	date: new Date(2006,3,9)\n};\n\nconfig.lib.options.init = function (name, defaultValue) {\n	if (!config.options[name]) {\n		config.options[name] = defaultValue;\n		saveOptionCookie(name);\n	}\n};\n//}}}\n////===\n\n////+++!![PasswordTweak]\n\n//{{{\nversion.extensions.PasswordTweak = {\n	major: 1, minor: 0, revision: 3, date: new Date(2006,8,30),\n	type: 'tweak',\n	source: 'http://tiddlywiki.bidix.info/#PasswordTweak'\n};\n//}}}\n/***\n!!config.macros.option\n***/\n//{{{\nconfig.macros.option.passwordCheckboxLabel = &quot;Save this password on this computer&quot;;\nconfig.macros.option.passwordType = &quot;password&quot;; // password | text\n\nconfig.macros.option.onChangeOption = function(e)\n{\n	var opt = this.getAttribute(&quot;option&quot;);\n	var elementType,valueField;\n	if(opt) {\n		switch(opt.substr(0,3)) {\n			case &quot;txt&quot;:\n				elementType = &quot;input&quot;;\n				valueField = &quot;value&quot;;\n				break;\n			case &quot;pas&quot;:\n				elementType = &quot;input&quot;;\n				valueField = &quot;value&quot;;\n				break;\n			case &quot;chk&quot;:\n				elementType = &quot;input&quot;;\n				valueField = &quot;checked&quot;;\n				break;\n		}\n		config.options[opt] = this[valueField];\n		saveOptionCookie(opt);\n		var nodes = document.getElementsByTagName(elementType);\n		for(var t=0; t&lt;nodes.length; t++) \n			{\n			var optNode = nodes[t].getAttribute(&quot;option&quot;);\n			if (opt == optNode) \n				nodes[t][valueField] = this[valueField];\n			}\n		}\n	return(true);\n};\n\nconfig.macros.option.handler = function(place,macroName,params)\n{\n    var opt = params[0];\n    if(config.options[opt] === undefined) {\n        return;}\n    var c;\n    switch(opt.substr(0,3)) {\n		case &quot;txt&quot;:\n			c = document.createElement(&quot;input&quot;);\n			c.onkeyup = this.onChangeOption;\n			c.setAttribute (&quot;option&quot;,opt);\n			c.className = &quot;txtOptionInput &quot;+opt;\n			place.appendChild(c);\n			c.value = config.options[opt];\n			break;\n		case &quot;pas&quot;:\n			// input password\n			c = document.createElement (&quot;input&quot;);\n			c.setAttribute(&quot;type&quot;,config.macros.option.passwordType);\n			c.onkeyup = this.onChangeOption;\n			c.setAttribute(&quot;option&quot;,opt);\n			c.className = &quot;pasOptionInput &quot;+opt;\n			place.appendChild(c);\n			c.value = config.options[opt];\n			// checkbox link with this password &quot;save this password on this computer&quot;\n			c = document.createElement(&quot;input&quot;);\n			c.setAttribute(&quot;type&quot;,&quot;checkbox&quot;);\n			c.onclick = this.onChangeOption;\n			c.setAttribute(&quot;option&quot;,&quot;chk&quot;+opt);\n			c.className = &quot;chkOptionInput &quot;+opt;\n			place.appendChild(c);\n			c.checked = config.options[&quot;chk&quot;+opt];\n			// text savePasswordCheckboxLabel\n			place.appendChild(document.createTextNode(config.macros.option.passwordCheckboxLabel));\n			break;\n		case &quot;chk&quot;:\n			c = document.createElement(&quot;input&quot;);\n			c.setAttribute(&quot;type&quot;,&quot;checkbox&quot;);\n			c.onclick = this.onChangeOption;\n			c.setAttribute(&quot;option&quot;,opt);\n			c.className = &quot;chkOptionInput &quot;+opt;\n			place.appendChild(c);\n			c.checked = config.options[opt];\n			break;\n	}\n};\n//}}}\n/***\n!! Option cookie stuff\n***/\n//{{{\nwindow.loadOptionsCookie_orig_PasswordTweak = window.loadOptionsCookie;\nwindow.loadOptionsCookie = function()\n{\n	var cookies = document.cookie.split(&quot;;&quot;);\n	for(var c=0; c&lt;cookies.length; c++) {\n		var p = cookies[c].indexOf(&quot;=&quot;);\n		if(p != -1) {\n			var name = cookies[c].substr(0,p).trim();\n			var value = cookies[c].substr(p+1).trim();\n			switch(name.substr(0,3)) {\n				case &quot;txt&quot;:\n					config.options[name] = unescape(value);\n					break;\n				case &quot;pas&quot;:\n					config.options[name] = unescape(value);\n					break;\n				case &quot;chk&quot;:\n					config.options[name] = value == &quot;true&quot;;\n					break;\n			}\n		}\n	}\n};\n\nwindow.saveOptionCookie_orig_PasswordTweak = window.saveOptionCookie;\nwindow.saveOptionCookie = function(name)\n{\n	var c = name + &quot;=&quot;;\n	switch(name.substr(0,3)) {\n		case &quot;txt&quot;:\n			c += escape(config.options[name].toString());\n			break;\n		case &quot;chk&quot;:\n			c += config.options[name] ? &quot;true&quot; : &quot;false&quot;;\n			// is there an option link with this chk ?\n			if (config.options[name.substr(3)]) {\n				saveOptionCookie(name.substr(3));\n			}\n			break;\n		case &quot;pas&quot;:\n			if (config.options[&quot;chk&quot;+name]) {\n				c += escape(config.options[name].toString());\n			} else {\n				c += &quot;&quot;;\n			}\n			break;\n	}\n	c += &quot;; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/&quot;;\n	document.cookie = c;\n};\n//}}}\n/***\n!! Initializations\n***/\n//{{{\n// define config.options.pasPassword\nif (!config.options.pasPassword) {\n	config.options.pasPassword = 'defaultPassword';\n	window.saveOptionCookie('pasPassword');\n}\n// since loadCookies is first called befor password definition\n// we need to reload cookies\nwindow.loadOptionsCookie();\n//}}}\n////===\n\n////+++!![config.macros.upload]\n\n//{{{\nconfig.macros.upload = {\n	accessKey: &quot;U&quot;,\n	formName: &quot;UploadPlugin&quot;,\n	contentType: &quot;text/html;charset=UTF-8&quot;,\n	defaultStoreScript: &quot;store.php&quot;\n};\n\n// only this two configs need to be translated\nconfig.macros.upload.messages = {\n	aboutToUpload: &quot;About to upload TiddlyWiki to %0&quot;,\n	backupFileStored: &quot;Previous file backuped in %0&quot;,\n	crossDomain: &quot;Certainly a cross-domain isue: access to an other site isn't allowed&quot;,\n	errorDownloading: &quot;Error downloading&quot;,\n	errorUploadingContent: &quot;Error uploading content&quot;,\n	fileLocked: &quot;Files is locked: You are not allowed to Upload&quot;,\n	fileNotFound: &quot;file to upload not found&quot;,\n	fileNotUploaded: &quot;File %0 NOT uploaded&quot;,\n	mainFileUploaded: &quot;Main TiddlyWiki file uploaded to %0&quot;,\n	passwordEmpty: &quot;Unable to upload, your password is empty&quot;,\n	urlParamMissing: &quot;url param missing&quot;,\n	rssFileNotUploaded: &quot;RssFile %0 NOT uploaded&quot;,\n	rssFileUploaded: &quot;Rss File uploaded to %0&quot;\n};\n\nconfig.macros.upload.label = {\n	promptOption: &quot;Save and Upload this TiddlyWiki with UploadOptions&quot;,\n	promptParamMacro: &quot;Save and Upload this TiddlyWiki in %0&quot;,\n	saveLabel: &quot;save to web&quot;, \n	saveToDisk: &quot;save to disk&quot;,\n	uploadLabel: &quot;upload&quot;	\n};\n\nconfig.macros.upload.handler = function(place,macroName,params){\n	// parameters initialization\n	var storeUrl = params[0];\n	var toFilename = params[1];\n	var backupDir = params[2];\n	var uploadDir = params[3];\n	var username = params[4];\n	var password; // for security reason no password as macro parameter\n	var label;\n	if (document.location.toString().substr(0,4) == &quot;http&quot;)\n		label = this.label.saveLabel;\n	else\n		label = this.label.uploadLabel;\n	var prompt;\n	if (storeUrl) {\n		prompt = this.label.promptParamMacro.toString().format([this.toDirUrl(storeUrl, uploadDir, username)]);\n	}\n	else {\n		prompt = this.label.promptOption;\n	}\n	createTiddlyButton(place, label, prompt, \n						function () {\n							config.macros.upload.upload(storeUrl, toFilename, uploadDir, backupDir, username, password); \n							return false;}, \n						null, null, this.accessKey);\n};\nconfig.macros.upload.UploadLog = function() {\n	return new config.lib.Log('UploadLog', &quot; !storeUrl | !uploadDir | !toFilename | !backupdir | !origin |&quot; );\n};\nconfig.macros.upload.UploadLog.prototype = config.lib.Log.prototype;\nconfig.macros.upload.UploadLog.prototype.startUpload = function(storeUrl, toFilename, uploadDir,  backupDir) {\n	var line = &quot; [[&quot; + config.lib.file.basename(storeUrl) + &quot;|&quot; + storeUrl + &quot;]] | &quot;;\n	line += uploadDir + &quot; | &quot; + toFilename + &quot; | &quot; + backupDir + &quot; |&quot;;\n	this.newLine(line);\n};\nconfig.macros.upload.UploadLog.prototype.endUpload = function() {\n	this.addToLine(&quot; Ok |&quot;);\n};\nconfig.macros.upload.basename = config.lib.file.basename;\nconfig.macros.upload.dirname = config.lib.file.dirname;\nconfig.macros.upload.toRootUrl = function (storeUrl, username)\n{\n	return root = (this.dirname(storeUrl)?this.dirname(storeUrl):this.dirname(document.location.toString()));\n}\nconfig.macros.upload.toDirUrl = function (storeUrl,  uploadDir, username)\n{\n	var root = this.toRootUrl(storeUrl, username);\n	if (uploadDir &amp;&amp; uploadDir != '.')\n		root = root + '/' + uploadDir;\n	return root;\n}\nconfig.macros.upload.toFileUrl = function (storeUrl, toFilename,  uploadDir, username)\n{\n	return this.toDirUrl(storeUrl, uploadDir, username) + '/' + toFilename;\n}\nconfig.macros.upload.upload = function(storeUrl, toFilename, uploadDir, backupDir, username, password)\n{\n	// parameters initialization\n	storeUrl = (storeUrl ? storeUrl : config.options.txtUploadStoreUrl);\n	toFilename = (toFilename ? toFilename : config.options.txtUploadFilename);\n	backupDir = (backupDir ? backupDir : config.options.txtUploadBackupDir);\n	uploadDir = (uploadDir ? uploadDir : config.options.txtUploadDir);\n	username = (username ? username : config.options.txtUploadUserName);\n	password = config.options.pasUploadPassword; // for security reason no password as macro parameter\n	if (!password || password === '') {\n		alert(config.macros.upload.messages.passwordEmpty);\n		return;\n	}\n	if (storeUrl === '') {\n		storeUrl = config.macros.upload.defaultStoreScript;\n	}\n	if (config.lib.file.dirname(storeUrl) === '') {\n		storeUrl = config.lib.file.dirname(document.location.toString())+'/'+storeUrl;\n	}\n	if (toFilename === '') {\n		toFilename = config.lib.file.basename(document.location.toString());\n	}\n\n	clearMessage();\n	// only for forcing the message to display\n	 if (version.major &lt; 2)\n		store.notifyAll();\n	if (!storeUrl) {\n		alert(config.macros.upload.messages.urlParamMissing);\n		return;\n	}\n	// Check that file is not locked\n	if (window.BidiX &amp;&amp; BidiX.GroupAuthoring &amp;&amp; BidiX.GroupAuthoring.lock) {\n		if (BidiX.GroupAuthoring.lock.isLocked() &amp;&amp; !BidiX.GroupAuthoring.lock.isMyLock()) {\n			alert(config.macros.upload.messages.fileLocked);\n			return;\n		}\n	}\n	\n	var log = new this.UploadLog();\n	log.startUpload(storeUrl, toFilename, uploadDir,  backupDir);\n	if (document.location.toString().substr(0,5) == &quot;file:&quot;) {\n		saveChanges();\n	}\n	var toDir = config.macros.upload.toDirUrl(storeUrl, toFilename, uploadDir, username);\n	displayMessage(config.macros.upload.messages.aboutToUpload.format([toDir]), toDir);\n	this.uploadChanges(storeUrl, toFilename, uploadDir, backupDir, username, password);\n	if(config.options.chkGenerateAnRssFeed) {\n		//var rssContent = convertUnicodeToUTF8(generateRss());\n		var rssContent = generateRss();\n		var rssPath = toFilename.substr(0,toFilename.lastIndexOf(&quot;.&quot;)) + &quot;.xml&quot;;\n		this.uploadContent(rssContent, storeUrl, rssPath, uploadDir, '', username, password, \n			function (responseText) {\n				if (responseText.substring(0,1) != '0') {\n					displayMessage(config.macros.upload.messages.rssFileNotUploaded.format([rssPath]));\n				}\n				else {\n					var toFileUrl = config.macros.upload.toFileUrl(storeUrl, rssPath, uploadDir, username);\n					displayMessage(config.macros.upload.messages.rssFileUploaded.format(\n						[toFileUrl]), toFileUrl);\n				}\n				// for debugging store.php uncomment last line\n				//DEBUG alert(responseText);\n			});\n	}\n	return;\n};\n\nconfig.macros.upload.uploadChanges = function(storeUrl, toFilename, uploadDir, backupDir, \n		username, password) {\n	var original;\n	if (document.location.toString().substr(0,4) == &quot;http&quot;) {\n		original =  this.download(storeUrl, toFilename, uploadDir, backupDir, username, password);\n		return;\n	}\n	else {\n		// standard way : Local file\n		\n		original = loadFile(getLocalPath(document.location.toString()));\n		if(window.Components) {\n			// it's a mozilla browser\n			try {\n				netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);\n				var converter = Components.classes[&quot;@mozilla.org/intl/scriptableunicodeconverter&quot;]\n									.createInstance(Components.interfaces.nsIScriptableUnicodeConverter);\n				converter.charset = &quot;UTF-8&quot;;\n				original = converter.ConvertToUnicode(original);\n			}\n			catch(e) {\n			}\n		}\n	}\n	//DEBUG alert(original);\n	this.uploadChangesFrom(original, storeUrl, toFilename, uploadDir, backupDir, \n		username, password);\n};\n\nconfig.macros.upload.uploadChangesFrom = function(original, storeUrl, toFilename, uploadDir, backupDir, \n		username, password) {\n	var startSaveArea = '&lt;div id=&quot;' + 'storeArea&quot;&gt;'; // Split up into two so that indexOf() of this source doesn't find it\n	var endSaveArea = '&lt;/d' + 'iv&gt;';\n	// Locate the storeArea div's\n	var posOpeningDiv = original.indexOf(startSaveArea);\n	var posClosingDiv = original.lastIndexOf(endSaveArea);\n	if((posOpeningDiv == -1) || (posClosingDiv == -1))\n		{\n		alert(config.messages.invalidFileError.format([document.location.toString()]));\n		return;\n		}\n	var revised = original.substr(0,posOpeningDiv + startSaveArea.length) + \n				allTiddlersAsHtml() + &quot;\sn\st\st&quot; +\n				original.substr(posClosingDiv);\n	var newSiteTitle;\n	if(version.major &lt; 2){\n		newSiteTitle = (getElementText(&quot;siteTitle&quot;) + &quot; - &quot; + getElementText(&quot;siteSubtitle&quot;)).htmlEncode();\n	} else {\n		newSiteTitle = (wikifyPlain (&quot;SiteTitle&quot;) + &quot; - &quot; + wikifyPlain (&quot;SiteSubtitle&quot;)).htmlEncode();\n	}\n\n	revised = revised.replaceChunk(&quot;&lt;title&quot;+&quot;&gt;&quot;,&quot;&lt;/title&quot;+&quot;&gt;&quot;,&quot; &quot; + newSiteTitle + &quot; &quot;);\n	revised = revised.replaceChunk(&quot;&lt;!--PRE-HEAD-START--&quot;+&quot;&gt;&quot;,&quot;&lt;!--PRE-HEAD-END--&quot;+&quot;&gt;&quot;,&quot;\sn&quot; + store.getTiddlerText(&quot;MarkupPreHead&quot;,&quot;&quot;) + &quot;\sn&quot;);\n	revised = revised.replaceChunk(&quot;&lt;!--POST-HEAD-START--&quot;+&quot;&gt;&quot;,&quot;&lt;!--POST-HEAD-END--&quot;+&quot;&gt;&quot;,&quot;\sn&quot; + store.getTiddlerText(&quot;MarkupPostHead&quot;,&quot;&quot;) + &quot;\sn&quot;);\n	revised = revised.replaceChunk(&quot;&lt;!--PRE-BODY-START--&quot;+&quot;&gt;&quot;,&quot;&lt;!--PRE-BODY-END--&quot;+&quot;&gt;&quot;,&quot;\sn&quot; + store.getTiddlerText(&quot;MarkupPreBody&quot;,&quot;&quot;) + &quot;\sn&quot;);\n	revised = revised.replaceChunk(&quot;&lt;!--POST-BODY-START--&quot;+&quot;&gt;&quot;,&quot;&lt;!--POST-BODY-END--&quot;+&quot;&gt;&quot;,&quot;\sn&quot; + store.getTiddlerText(&quot;MarkupPostBody&quot;,&quot;&quot;) + &quot;\sn&quot;);\n\n	var response = this.uploadContent(revised, storeUrl, toFilename, uploadDir, backupDir, \n		username, password, function (responseText) {\n					if (responseText.substring(0,1) != '0') {\n						alert(responseText);\n						displayMessage(config.macros.upload.messages.fileNotUploaded.format([getLocalPath(document.location.toString())]));\n					}\n					else {\n						if (uploadDir !== '') {\n							toFilename = uploadDir + &quot;/&quot; + config.macros.upload.basename(toFilename);\n						} else {\n							toFilename = config.macros.upload.basename(toFilename);\n						}\n						var toFileUrl = config.macros.upload.toFileUrl(storeUrl, toFilename, uploadDir, username);\n						if (responseText.indexOf(&quot;destfile:&quot;) &gt; 0) {\n							var destfile = responseText.substring(responseText.indexOf(&quot;destfile:&quot;)+9, \n							responseText.indexOf(&quot;\sn&quot;, responseText.indexOf(&quot;destfile:&quot;)));\n							toFileUrl = config.macros.upload.toRootUrl(storeUrl, username) + '/' + destfile;\n						}\n						else {\n							toFileUrl = config.macros.upload.toFileUrl(storeUrl, toFilename, uploadDir, username);\n						}\n						displayMessage(config.macros.upload.messages.mainFileUploaded.format(\n							[toFileUrl]), toFileUrl);\n						if (backupDir &amp;&amp; responseText.indexOf(&quot;backupfile:&quot;) &gt; 0) {\n							var backupFile = responseText.substring(responseText.indexOf(&quot;backupfile:&quot;)+11, \n							responseText.indexOf(&quot;\sn&quot;, responseText.indexOf(&quot;backupfile:&quot;)));\n							toBackupUrl = config.macros.upload.toRootUrl(storeUrl, username) + '/' + backupFile;\n							displayMessage(config.macros.upload.messages.backupFileStored.format(\n								[toBackupUrl]), toBackupUrl);\n						}\n						var log = new config.macros.upload.UploadLog();\n						log.endUpload();\n						store.setDirty(false);\n						// erase local lock\n						if (window.BidiX &amp;&amp; BidiX.GroupAuthoring &amp;&amp; BidiX.GroupAuthoring.lock) {\n							BidiX.GroupAuthoring.lock.eraseLock();\n							// change mtime with new mtime after upload\n							var mtime = responseText.substr(responseText.indexOf(&quot;mtime:&quot;)+6);\n							BidiX.GroupAuthoring.lock.mtime = mtime;\n						}\n						\n						\n					}\n					// for debugging store.php uncomment last line\n					//DEBUG alert(responseText);\n				}\n			);\n};\n\nconfig.macros.upload.uploadContent = function(content, storeUrl, toFilename, uploadDir, backupDir, \n		username, password, callbackFn) {\n	var boundary = &quot;---------------------------&quot;+&quot;AaB03x&quot;;		\n	var request;\n	try {\n		request = new XMLHttpRequest();\n		} \n	catch (e) { \n		request = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;); \n		}\n	if (window.netscape){\n			try {\n				if (document.location.toString().substr(0,4) != &quot;http&quot;) {\n					netscape.security.PrivilegeManager.enablePrivilege('UniversalBrowserRead');}\n			}\n			catch (e) {}\n		}		\n	//DEBUG alert(&quot;user[&quot;+config.options.txtUploadUserName+&quot;] password[&quot; + config.options.pasUploadPassword + &quot;]&quot;);\n	// compose headers data\n	var sheader = &quot;&quot;;\n	sheader += &quot;--&quot; + boundary + &quot;\sr\snContent-disposition: form-data; name=\s&quot;&quot;;\n	sheader += config.macros.upload.formName +&quot;\s&quot;\sr\sn\sr\sn&quot;;\n	sheader += &quot;backupDir=&quot;+backupDir\n				+&quot;;user=&quot; + username \n				+&quot;;password=&quot; + password\n				+&quot;;uploaddir=&quot; + uploadDir;\n	// add lock attributes to sheader\n	if (window.BidiX &amp;&amp; BidiX.GroupAuthoring &amp;&amp; BidiX.GroupAuthoring.lock) {\n		var l = BidiX.GroupAuthoring.lock.myLock;\n		sheader += &quot;;lockuser=&quot; + l.user\n				+ &quot;;mtime=&quot; + l.mtime\n				+ &quot;;locktime=&quot; + l.locktime;\n	}\n	sheader += &quot;;;\sr\sn&quot;; \n	sheader += &quot;\sr\sn&quot; + &quot;--&quot; + boundary + &quot;\sr\sn&quot;;\n	sheader += &quot;Content-disposition: form-data; name=\s&quot;userfile\s&quot;; filename=\s&quot;&quot;+toFilename+&quot;\s&quot;\sr\sn&quot;;\n	sheader += &quot;Content-Type: &quot; + config.macros.upload.contentType + &quot;\sr\sn&quot;;\n	sheader += &quot;Content-Length: &quot; + content.length + &quot;\sr\sn\sr\sn&quot;;\n	// compose trailer data\n	var strailer = new String();\n	strailer = &quot;\sr\sn--&quot; + boundary + &quot;--\sr\sn&quot;;\n	//strailer = &quot;--&quot; + boundary + &quot;--\sr\sn&quot;;\n	var data;\n	data = sheader + content + strailer;\n	//request.open(&quot;POST&quot;, storeUrl, true, username, password);\n	try {\n		request.open(&quot;POST&quot;, storeUrl, true);		\n	}\n	catch(e) {\n		alert(config.macros.upload.messages.crossDomain + &quot;\snError:&quot; +e);\n		exit;\n	}\n	request.onreadystatechange = function () {\n				if (request.readyState == 4) {\n				     if (request.status == 200)\n						callbackFn(request.responseText);\n					else\n						alert(config.macros.upload.messages.errorUploadingContent + &quot;\snStatus: &quot;+request.status.statusText);\n				}\n		};\n	request.setRequestHeader(&quot;Content-Length&quot;,data.length);\n	request.setRequestHeader(&quot;Content-Type&quot;,&quot;multipart/form-data; boundary=&quot;+boundary);\n	request.send(data); \n};\n\n\nconfig.macros.upload.download = function(uploadUrl, uploadToFilename, uploadDir, uploadBackupDir, \n	username, password) {\n	var request;\n	try {\n		request = new XMLHttpRequest();\n	} \n	catch (e) { \n		request = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;); \n	}\n	try {\n		if (uploadUrl.substr(0,4) == &quot;http&quot;) {\n			netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;);\n			}\n		else {\n			netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);\n		}\n	} catch (e) { }\n	//request.open(&quot;GET&quot;, document.location.toString(), true, username, password);\n	try {\n		request.open(&quot;GET&quot;, document.location.toString(), true);\n	}\n	catch(e) {\n		alert(config.macros.upload.messages.crossDomain + &quot;\snError:&quot; +e);\n		exit;\n	}\n	\n	request.onreadystatechange = function () {\n		if (request.readyState == 4) {\n			if(request.status == 200) {\n				config.macros.upload.uploadChangesFrom(request.responseText, uploadUrl, \n					uploadToFilename, uploadDir, uploadBackupDir, username, password);\n			}\n			else\n				alert(config.macros.upload.messages.errorDownloading.format(\n					[document.location.toString()]) + &quot;\snStatus: &quot;+request.status.statusText);\n		}\n	};\n	request.send(null);\n};\n\n//}}}\n////===\n\n////+++!![Initializations]\n\n//{{{\nconfig.lib.options.init('txtUploadStoreUrl','store.php');\nconfig.lib.options.init('txtUploadFilename','');\nconfig.lib.options.init('txtUploadDir','');\nconfig.lib.options.init('txtUploadBackupDir','');\nconfig.lib.options.init('txtUploadUserName',config.options.txtUserName);\nconfig.lib.options.init('pasUploadPassword','');\nsetStylesheet(\n	&quot;.pasOptionInput {width: 11em;}\sn&quot;+\n	&quot;.txtOptionInput.txtUploadStoreUrl {width: 25em;}\sn&quot;+\n	&quot;.txtOptionInput.txtUploadFilename {width: 25em;}\sn&quot;+\n	&quot;.txtOptionInput.txtUploadDir {width: 25em;}\sn&quot;+\n	&quot;.txtOptionInput.txtUploadBackupDir {width: 25em;}\sn&quot;+\n	&quot;&quot;,\n	&quot;UploadOptionsStyles&quot;);\nif (document.location.toString().substr(0,4) == &quot;http&quot;) {\n	config.options.chkAutoSave = false; \n	saveOptionCookie('chkAutoSave');\n}\nconfig.shadowTiddlers.UploadDoc = &quot;[[Full Documentation|http://tiddlywiki.bidix.info/l#UploadDoc ]]\sn&quot;; \n\n//}}}\n////===\n\n////+++!![Core Hijacking]\n\n//{{{\nconfig.macros.saveChanges.label_orig_UploadPlugin = config.macros.saveChanges.label;\nconfig.macros.saveChanges.label = config.macros.upload.label.saveToDisk;\n\nconfig.macros.saveChanges.handler_orig_UploadPlugin = config.macros.saveChanges.handler;\n\nconfig.macros.saveChanges.handler = function(place)\n{\n	if ((!readOnly) &amp;&amp; (document.location.toString().substr(0,4) != &quot;http&quot;))\n		createTiddlyButton(place,this.label,this.prompt,this.onClick,null,null,this.accessKey);\n};\n\n//}}}\n////===\n</div>
<div tiddler="UploadPluginTweak" modifier="YourName" modified="200611091952" created="200611090451" tags="systemConfig excludeLists">// null logger : no more UploadLog and no upload logging\n// BidiX - 2006/11/8\n//{{{\nconfig.macros.upload.UploadLog = function() {return this;};\nconfig.macros.upload.UploadLog.prototype.startUpload = function(storeUrl, toFilename, uploadDir,  backupDir) {};\nconfig.macros.upload.UploadLog.prototype.endUpload = function() {};\n//}}}\n</div>
<div tiddler="ViewTemplate" modifier="YourName" modified="200611110706" created="200611090628" tags="excludeLists">&lt;!--{{{--&gt;\n&lt;div class='toolbar' macro='toolbar closeTiddler closeOthers permalink references jump'&gt;&lt;/div&gt;\n&lt;div class=&quot;tagglyTagged&quot; macro=&quot;tags&quot;&gt;&lt;/div&gt;\n&lt;div class='titleContainer'&gt;\n	&lt;span class='title' macro='view title'&gt;&lt;/span&gt;\n	&lt;span macro=&quot;miniTag&quot;&gt;&lt;/span&gt;\n&lt;/div&gt;\n&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date [[DD MMM YYYY]]'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date [[DD MMM YYYY]]'&gt;&lt;/span&gt;)&lt;/div&gt;\n&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n&lt;div class='tagClear'&gt;&lt;/div&gt;\n&lt;!--}}}--&gt;</div>
<div tiddler="WhatPluginsItUses" modifier="YourName" modified="200611150400" created="200611150400" tags="">The central plugins the site uses are:\n* ImportTiddlersPlugin (for updating student notes)\n* SelectStylesheetPlugin (for switching templates and stylesheets between the default web view for students, the author view for the teacher, and the student view when taking notes locally)\n* UploadPlugin (for editing your TW online)\n* SlideShowPlugin (for attractive slides with pop-up navigation menus and animated bullets)\n\nbut you also need:\n* ForEachTiddlerPlugin (for generating special lists of tiddlers and tags in the various r.h.s. tabs for the different styles)\n* SinglePageModePlugin (for the slides)\n* NestedSlidersPlugin (for... well, just because you always need nested sliders)\n* AllTagsExceptMacro (to exclude system tags from the list of tags for the default TabTags)\n* A variant on the NewHerePlugin which I called &quot;NewerHereMacro&quot;, also due to Simon Baird, which provides a toolbar macro that generates a new tiddler tagged with the name of the tiddler you're on AND the tag &quot;note&quot;\n\nYou don't need the [[TagglyTagging|TagglyTaggingPlugin]] stuff, but I'm basing it on a TT version of TW because that's what I generally use.  I'm made some modifications, such as putting the Shadowed taggly styles and templates into ordinary tiddlers.  I think this was necessary to make it work with SelectStylesheet.</div>
<div tiddler="WhatsNew" modifier="ChrisJobling" modified="200708241157" created="200704301852" tags="news">* [[Linux Tips]]\n* [[EG-259: Web Applications Technology]]\n* [[Drupal tips]]\n* [[Wiki Trials]]\n* [[Rsync tips]]\n* [[School Review 2007]]\n</div>
<div tiddler="Wiki Trials" modifier="ChrisJobling" modified="200705131547" created="200705131451" tags="wiki trials">I have a number of trial wikis installed on this system.\n\n* [[MoinMoin Wiki|http://localhost/crispywiki]]\n* [[XWiki|http://localhost:11080/http://localhost:11080/xwiki/bin/view/Main/WebHome]] (may need to be started!)\n* [[DokuWiki|http://localhost/dokuwiki/doku.php]]\n* [[TiddlyWiki|file:///F:/dev/wikis/TRUNK/crispy.html]] (this file!)</div>
<div tiddler="YourSearchPlugin" modifier="YourName" modified="200611091956" created="200601161427" tags="Plugin UdoBorkowski YourSearchProject systemConfig excludeLists">/***\n|''Name:''|YourSearchPlugin|\n|''Version:''|2.1.0 (2006-10-12)|\n|''Source:''|http://tiddlywiki.abego-software.de/#YourSearchPlugin ([[del.icio.us|http://del.icio.us/post?url=http://tiddlywiki.abego-software.de/index.html%23YourSearchPlugin]])|\n|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|\n|''Licence:''|[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]|\n|''Copyright:''|&amp;copy; 2005-2006 [[abego Software|http://www.abego-software.de]]|\n|''~CoreVersion:''|2.1.0|\n|''Browser:''|Firefox 1.0.4+; Firefox 1.5; ~InternetExplorer 6.0|\n!About YourSearch\nYourSearch gives you a bunch of new features to simplify and speed up your daily searches in TiddlyWiki. It seamlessly integrates into the standard TiddlyWiki search: just start typing into the 'search' field and explore!\n\nFor more information see [[Help|YourSearch Help]].\n!Compatibility\nThis plugin requires TiddlyWiki 2.1. \nCheck the [[archive|http://tiddlywiki.abego-software.de/archive]] for ~YourSearchPlugins supporting older versions of TiddlyWiki.\n!Source Code\n***/\n/***\nThis plugin's source code is compressed (and hidden). Use this [[link|http://tiddlywiki.abego-software.de/archive/YourSearchPlugin/Plugin-YourSearch-src.2.1.0.js]] to get the readable source code.\n***/\n///%\nif(!version.extensions.YourSearchPlugin){version.extensions.YourSearchPlugin={major:2,minor:1,revision:0,source:&quot;http://tiddlywiki.abego-software.de/#YourSearchPlugin&quot;,licence:&quot;[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]&quot;,copyright:&quot;Copyright (c) abego Software GmbH, 2005-2006 (www.abego-software.de)&quot;};if(!window.abego){window.abego={};}if(!Array.forEach){Array.forEach=function(_1,_2,_3){for(var i=0,len=_1.length;i&lt;len;i++){_2.call(_3,_1[i],i,_1);}};Array.prototype.forEach=function(_5,_6){for(var i=0,len=this.length;i&lt;len;i++){_5.call(_6,this[i],i,this);}};}abego.toInt=function(s,_9){if(!s){return _9;}var n=parseInt(s);return (n==NaN)?_9:n;};abego.createEllipsis=function(_b){var e=createTiddlyElement(_b,&quot;span&quot;);e.innerHTML=&quot;&amp;hellip;&quot;;};abego.shallowCopy=function(_d){if(!_d){return _d;}var _e={};for(var n in _d){_e[n]=_d[n];}return _e;};abego.copyOptions=function(_10){return !_10?{}:abego.shallowCopy(_10);};abego.countStrings=function(_11,s){if(!s){return 0;}var len=s.length;var n=0;var _15=0;while(1){var i=_11.indexOf(s,_15);if(i&lt;0){return n;}n++;_15=i+len;}return n;};abego.getBracedText=function(_17,_18,_19){if(!_18){_18=0;}var re=/\s{([^\s}]*)\s}/gm;re.lastIndex=_18;var m=re.exec(_17);if(m){var s=m[1];var _1d=abego.countStrings(s,&quot;{&quot;);if(!_1d){if(_19){_19.lastIndex=re.lastIndex;}return s;}var len=_17.length;for(var i=re.lastIndex;i&lt;len&amp;&amp;_1d;i++){var c=_17.charAt(i);if(c==&quot;{&quot;){_1d++;}else{if(c==&quot;}&quot;){_1d--;}}}if(!_1d){if(_19){_19.lastIndex=i-1;}return _17.substring(m.index+1,i-1);}}};abego.select=function(_21,_22,_23,_24){if(!_24){_24=[];}_21.forEach(function(t){if(_22.call(_23,t)){_24.push(t);}});return _24;};abego.TiddlerFilterTerm=function(_26,_27){if(!_27){_27={};}var _28=_26;if(!_27.textIsRegExp){_28=_26.escapeRegExp();if(_27.fullWordMatch){_28=&quot;\s\sb&quot;+_28+&quot;\s\sb&quot;;}}var _29=new RegExp(_28,&quot;m&quot;+(_27.caseSensitive?&quot;&quot;:&quot;i&quot;));this.tester=new abego.MultiFieldRegExpTester(_29,_27.fields,_27.withExtendedFields);};abego.TiddlerFilterTerm.prototype.test=function(_2a){return this.tester.test(_2a);};abego.parseNewTiddlerCommandLine=function(s){var m=/(.*?)\s.(?:\ss+|$)([^#]*)(#.*)?/.exec(s);if(!m){m=/([^#]*)()(#.*)?/.exec(s);}if(m){var r;if(m[3]){var s2=m[3].replace(/#/g,&quot;&quot;);r=s2.parseParams(&quot;tag&quot;);}else{r=[[]];}var _2f=m[2]?m[2].trim():&quot;&quot;;r.push({name:&quot;text&quot;,value:_2f});r[0].text=[_2f];return {title:m[1].trim(),params:r};}else{return {title:s.trim(),params:[[]]};}};abego.parseTiddlerFilterTerm=function(_30,_31,_32){var re=/\ss*(?:(?:\s{([^\s}]*)\s})|(?:(=)|([#%!])|(?:(\sw+)\ss*\s:(?!\s/\s/))|(?:(?:(&quot;(?:(?:\s\s&quot;)|[^&quot;])+&quot;)|(?:\s/((?:(?:\s\s\s/)|[^\s/])+)\s/)|(\sw+\s:\s/\s/[^\ss]+)|([^\ss\s)\s-\s&quot;]+)))))/mg;var _34={&quot;!&quot;:&quot;title&quot;,&quot;%&quot;:&quot;text&quot;,&quot;#&quot;:&quot;tags&quot;};var _35={};var _36;re.lastIndex=_31;while(1){var i=re.lastIndex;var m=re.exec(_30);if(!m||m.index!=i){throw &quot;Word or String literal expected&quot;;}if(m[1]){var _39={};var _3a=abego.getBracedText(_30,0,_39);if(!_3a){throw &quot;Invalid {...} syntax&quot;;}var f=Function(&quot;tiddler&quot;,&quot;return (&quot;+_3a+&quot;);&quot;);return {func:f,lastIndex:_39.lastIndex,markRE:null};}if(m[2]){_36=true;}else{if(m[3]){_35[_34[m[3]]]=1;}else{if(m[4]){_35[m[4]]=1;}else{var _3c=m[6];var _3d=m[5]?window.eval(m[5]):m[6]?m[6]:m[7]?m[7]:m[8];var _32=abego.copyOptions(_32);_32.fullWordMatch=_36;_32.textIsRegExp=_3c;var _3e=[];for(var n in _35){_3e.push(n);}if(_3e.length==0){_32.fields=_32.defaultFields;}else{_32.fields=_3e;_32.withExtendedFields=false;}var _40=new abego.TiddlerFilterTerm(_3d,_32);var _41=_3c?_3d:_3d.escapeRegExp();if(_41&amp;&amp;_36){_41=&quot;\s\sb&quot;+_41+&quot;\s\sb&quot;;}return {func:function(_42){return _40.test(_42);},lastIndex:re.lastIndex,markRE:_41?&quot;(?:&quot;+_41+&quot;)&quot;:null};}}}}};abego.BoolExp=function(s,_44,_45){this.s=s;var _46=_45&amp;&amp;_45.defaultOperationIs_OR;var _47=/\ss*(?:(\s-|not)|(\s())/gi;var _48=/\ss*\s)/g;var _49=/\ss*(?:(and|\s&amp;\s&amp;)|(or|\s|\s|))/gi;var _4a=/\ss*[^\s)\ss]/g;var _4b=/\ss*(\s-|not)?(\ss*\s()?/gi;var _4c=function(_4d){_4b.lastIndex=_4d;var m=_4b.exec(s);var _4f;var _50;if(m&amp;&amp;m.index==_4d){_4d=_4b.lastIndex;_4f=m[1];if(m[2]){var e=parseBoolExpression(_4d);_48.lastIndex=e.lastIndex;if(!_48.exec(s)){throw &quot;Missing ')'&quot;;}_50={func:e.func,lastIndex:_48.lastIndex};}}if(!_50){_50=_44(s,_4d,_45);}if(_4f){_50.func=(function(f){return function(_53){return !f(_53);};})(_50.func);_50.markRE=null;}return _50;};var _54=function(_55){var _56=_4c(_55);while(1){var l=_56.lastIndex;_49.lastIndex=l;var m=_49.exec(s);var _59;var _5a;if(m&amp;&amp;m.index==l){_59=!m[1];_5a=_4c(_49.lastIndex);}else{try{_5a=_4c(l);}catch(e){return _56;}_59=_46;}_56.func=(function(_5b,_5c,_5d){return _5d?function(_5e){return _5b(_5e)||_5c(_5e);}:function(_5f){return _5b(_5f)&amp;&amp;_5c(_5f);};})(_56.func,_5a.func,_59);_56.lastIndex=_5a.lastIndex;if(!_56.markRE){_56.markRE=_5a.markRE;}else{if(_5a.markRE){_56.markRE=_56.markRE+&quot;|&quot;+_5a.markRE;}}}};var _60=_54(0);this.evalFunc=_60.func;if(_60.markRE){this.markRegExp=new RegExp(_60.markRE,_45.caseSensitive?&quot;mg&quot;:&quot;img&quot;);}};abego.BoolExp.prototype.exec=function(){return this.evalFunc.apply(this,arguments);};abego.BoolExp.prototype.getMarkRegExp=function(){return this.markRegExp;};abego.BoolExp.prototype.toString=function(){return this.s;};abego.MultiFieldRegExpTester=function(re,_62,_63){this.re=re;this.fields=_62?_62:[&quot;title&quot;,&quot;text&quot;,&quot;tags&quot;];this.withExtendedFields=_63;};abego.MultiFieldRegExpTester.prototype.test=function(_64){var re=this.re;for(var i=0;i&lt;this.fields.length;i++){var s=store.getValue(_64,this.fields[i]);if(typeof s==&quot;string&quot;&amp;&amp;re.test(s)){return this.fields[i];}}if(this.withExtendedFields){return store.forEachField(_64,function(_68,_69,_6a){return typeof _6a==&quot;string&quot;&amp;&amp;re.test(_6a)?_69:null;},true);}return null;};abego.TiddlerQuery=function(_6b,_6c,_6d,_6e,_6f){if(_6d){this.regExp=new RegExp(_6b,_6c?&quot;mg&quot;:&quot;img&quot;);this.tester=new abego.MultiFieldRegExpTester(this.regExp,_6e,_6f);}else{this.expr=new abego.BoolExp(_6b,abego.parseTiddlerFilterTerm,{defaultFields:_6e,caseSensitive:_6c,withExtendedFields:_6f});}this.getQueryText=function(){return _6b;};this.getUseRegExp=function(){return _6d;};this.getCaseSensitive=function(){return _6c;};this.getDefaultFields=function(){return _6e;};this.getWithExtendedFields=function(){return _6f;};};abego.TiddlerQuery.prototype.test=function(_70){if(!_70){return false;}if(this.regExp){return this.tester.test(_70);}return this.expr.exec(_70);};abego.TiddlerQuery.prototype.filter=function(_71){return abego.select(_71,this.test,this);};abego.TiddlerQuery.prototype.getMarkRegExp=function(){if(this.regExp){return &quot;&quot;.search(this.regExp)&gt;=0?null:this.regExp;}return this.expr.getMarkRegExp();};abego.TiddlerQuery.prototype.toString=function(){return (this.regExp?this.regExp:this.expr).toString();};abego.PageWiseRenderer=function(){this.firstIndexOnPage=0;};merge(abego.PageWiseRenderer.prototype,{setItems:function(_72){this.items=_72;this.setFirstIndexOnPage(0);},getMaxPagesInNavigation:function(){return 10;},getItemsCount:function(_73){return this.items?this.items.length:0;},getCurrentPageIndex:function(){return Math.floor(this.firstIndexOnPage/this.getItemsPerPage());},getLastPageIndex:function(){return Math.floor((this.getItemsCount()-1)/this.getItemsPerPage());},setFirstIndexOnPage:function(_74){this.firstIndexOnPage=Math.min(Math.max(0,_74),this.getItemsCount()-1);},getFirstIndexOnPage:function(){this.firstIndexOnPage=Math.floor(this.firstIndexOnPage/this.getItemsPerPage())*this.getItemsPerPage();return this.firstIndexOnPage;},getLastIndexOnPage:function(){return Math.min(this.getFirstIndexOnPage()+this.getItemsPerPage()-1,this.getItemsCount()-1);},onPageChanged:function(_75,_76){},renderPage:function(_77){if(_77.beginRendering){_77.beginRendering(this);}try{if(this.getItemsCount()){var _78=this.getLastIndexOnPage();var _79=-1;for(var i=this.getFirstIndexOnPage();i&lt;=_78;i++){_79++;_77.render(this,this.items[i],i,_79);}}}finally{if(_77.endRendering){_77.endRendering(this);}}},addPageNavigation:function(_7b){if(!this.getItemsCount()){return;}var _7c=this;var _7d=function(e){if(!e){var e=window.event;}var _7f=abego.toInt(this.getAttribute(&quot;page&quot;),0);var _80=_7c.getCurrentPageIndex();if(_7f==_80){return;}var _81=_7f*_7c.getItemsPerPage();_7c.setFirstIndexOnPage(_81);_7c.onPageChanged(_7f,_80);};var _82;var _83=this.getCurrentPageIndex();var _84=this.getLastPageIndex();if(_83&gt;0){_82=createTiddlyButton(_7b,&quot;Previous&quot;,&quot;Go to previous page (Shortcut: Alt-'&lt;')&quot;,_7d,&quot;prev&quot;);_82.setAttribute(&quot;page&quot;,(_83-1).toString());_82.setAttribute(&quot;accessKey&quot;,&quot;&lt;&quot;);}for(var i=-this.getMaxPagesInNavigation();i&lt;this.getMaxPagesInNavigation();i++){var _86=_83+i;if(_86&lt;0){continue;}if(_86&gt;_84){break;}var _87=(i+_83+1).toString();var _88=_86==_83?&quot;currentPage&quot;:&quot;otherPage&quot;;_82=createTiddlyButton(_7b,_87,&quot;Go to page %0&quot;.format([_87]),_7d,_88);_82.setAttribute(&quot;page&quot;,(_86).toString());}if(_83&lt;_84){_82=createTiddlyButton(_7b,&quot;Next&quot;,&quot;Go to next page (Shortcut: Alt-'&gt;')&quot;,_7d,&quot;next&quot;);_82.setAttribute(&quot;page&quot;,(_83+1).toString());_82.setAttribute(&quot;accessKey&quot;,&quot;&gt;&quot;);}}});abego.LimitedTextRenderer=function(){var _89=40;var _8a=4;var _8b=function(_8c,_8d,_8e){var n=_8c.length;if(n==0){_8c.push({start:_8d,end:_8e});return;}var i=0;for(;i&lt;n;i++){var _91=_8c[i];if(_91.start&lt;=_8e&amp;&amp;_8d&lt;=_91.end){var r;var _93=i+1;for(;_93&lt;n;_93++){r=_8c[_93];if(r.start&gt;_8e||_8d&gt;_91.end){break;}}var _94=_8d;var _95=_8e;for(var j=i;j&lt;_93;j++){r=_8c[j];_94=Math.min(_94,r.start);_95=Math.max(_95,r.end);}_8c.splice(i,_93-i,{start:_94,end:_95});return;}if(_91.start&gt;_8e){break;}}_8c.splice(i,0,{start:_8d,end:_8e});};var _97=function(_98){var _99=0;for(var i=0;i&lt;_98.length;i++){var _9b=_98[i];_99+=_9b.end-_9b.start;}return _99;};var _9c=function(c){return (c&gt;=&quot;a&quot;&amp;&amp;c&lt;=&quot;z&quot;)||(c&gt;=&quot;A&quot;&amp;&amp;c&lt;=&quot;Z&quot;)||c==&quot;_&quot;;};var _9e=function(s,_a0){if(!_9c(s[_a0])){return null;}for(var i=_a0-1;i&gt;=0&amp;&amp;_9c(s[i]);i--){}var _a2=i+1;var n=s.length;for(i=_a0+1;i&lt;n&amp;&amp;_9c(s[i]);i++){}return {start:_a2,end:i};};var _a4=function(s,_a6,_a7){var _a8;if(_a7){_a8=_9e(s,_a6);}else{if(_a6&lt;=0){return _a6;}_a8=_9e(s,_a6-1);}if(!_a8){return _a6;}if(_a7){if(_a8.start&gt;=_a6-_8a){return _a8.start;}if(_a8.end&lt;=_a6+_8a){return _a8.end;}}else{if(_a8.end&lt;=_a6+_8a){return _a8.end;}if(_a8.start&gt;=_a6-_8a){return _a8.start;}}return _a6;};var _a9=function(s,_ab){var _ac=[];if(_ab){var _ad=0;var n=s.length;var _af=0;do{_ab.lastIndex=_ad;var _b0=_ab.exec(s);if(_b0){if(_ad&lt;_b0.index){var t=s.substring(_ad,_b0.index);_ac.push({text:t});}_ac.push({text:_b0[0],isMatch:true});_ad=_b0.index+_b0[0].length;}else{_ac.push({text:s.substr(_ad)});break;}}while(true);}else{_ac.push({text:s});}return _ac;};var _b2=function(_b3){var _b4=0;for(var i=0;i&lt;_b3.length;i++){if(_b3[i].isMatch){_b4++;}}return _b4;};var _b6=function(s,_b8,_b9,_ba,_bb){var _bc=Math.max(Math.floor(_bb/(_ba+1)),_89);var _bd=Math.max(_bc-(_b9-_b8),0);var _be=Math.min(Math.floor(_b9+_bd/3),s.length);var _bf=Math.max(_be-_bc,0);_bf=_a4(s,_bf,true);_be=_a4(s,_be,false);return {start:_bf,end:_be};};var _c0=function(_c1,s,_c3){var _c4=[];var _c5=_b2(_c1);var pos=0;for(var i=0;i&lt;_c1.length;i++){var t=_c1[i];var _c9=t.text;if(t.isMatch){var _ca=_b6(s,pos,pos+_c9.length,_c5,_c3);_8b(_c4,_ca.start,_ca.end);}pos+=_c9.length;}return _c4;};var _cb=function(s,_cd,_ce){var _cf=_ce-_97(_cd);while(_cf&gt;0){if(_cd.length==0){_8b(_cd,0,_a4(s,_ce,false));return;}else{var _d0=_cd[0];var _d1;var _d2;if(_d0.start==0){_d1=_d0.end;if(_cd.length&gt;1){_d2=_cd[1].start;}else{_8b(_cd,_d1,_a4(s,_d1+_cf,false));return;}}else{_d1=0;_d2=_d0.start;}var _d3=Math.min(_d2,_d1+_cf);_8b(_cd,_d1,_d3);_cf-=(_d3-_d1);}}};var _d4=function(_d5,s,_d7,_d8,_d9){if(_d8.length==0){return;}var _da=function(_db,s,_dd,_de,_df){var t;var _e1;var pos=0;var i=0;var _e4=0;for(;i&lt;_dd.length;i++){t=_dd[i];_e1=t.text;if(_de&lt;pos+_e1.length){_e4=_de-pos;break;}pos+=_e1.length;}var _e5=_df-_de;for(;i&lt;_dd.length&amp;&amp;_e5&gt;0;i++){t=_dd[i];_e1=t.text.substr(_e4);_e4=0;if(_e1.length&gt;_e5){_e1=_e1.substr(0,_e5);}if(t.isMatch){createTiddlyElement(_db,&quot;span&quot;,null,&quot;marked&quot;,_e1);}else{createTiddlyText(_db,_e1);}_e5-=_e1.length;}if(_df&lt;s.length){abego.createEllipsis(_db);}};if(_d8[0].start&gt;0){abego.createEllipsis(_d5);}var _e6=_d9;for(var i=0;i&lt;_d8.length&amp;&amp;_e6&gt;0;i++){var _e8=_d8[i];var len=Math.min(_e8.end-_e8.start,_e6);_da(_d5,s,_d7,_e8.start,_e8.start+len);_e6-=len;}};this.render=function(_ea,s,_ec,_ed){if(s.length&lt;_ec){_ec=s.length;}var _ee=_a9(s,_ed);var _ef=_c0(_ee,s,_ec);_cb(s,_ef,_ec);_d4(_ea,s,_ee,_ef,_ec);};};(function(){function alertAndThrow(msg){alert(msg);throw msg;}if(version.major&lt;2||(version.major==2&amp;&amp;version.minor&lt;1)){alertAndThrow(&quot;YourSearchPlugin requires TiddlyWiki 2.1 or newer.\sn\snCheck the archive for YourSearch plugins\snsupporting older versions of TiddlyWiki.\sn\snArchive: http://tiddlywiki.abego-software.de/archive&quot;);}abego.YourSearch={};var _f1;var _f2;var _f3=function(_f4){_f1=_f4;};var _f5=function(){return _f1?_f1:[];};var _f6=function(){return _f1?_f1.length:0;};var _f7=4;var _f8=10;var _f9=2;var _fa=function(s,re){var m=s.match(re);return m?m.length:0;};var _fe=function(_ff,_100){var _101=_100.getMarkRegExp();if(!_101){return 1;}var _102=_ff.title.match(_101);var _103=_102?_102.length:0;var _104=_fa(_ff.getTags(),_101);var _105=_102?_102.join(&quot;&quot;).length:0;var _106=_ff.title.length&gt;0?_105/_ff.title.length:0;var rank=_103*_f7+_104*_f9+_106*_f8+1;return rank;};var _108=function(_109,_10a,_10b,_10c,_10d,_10e){_f2=null;var _10f=_109.reverseLookup(&quot;tags&quot;,_10e,false);try{var _110=[];if(config.options.chkSearchInTitle){_110.push(&quot;title&quot;);}if(config.options.chkSearchInText){_110.push(&quot;text&quot;);}if(config.options.chkSearchInTags){_110.push(&quot;tags&quot;);}_f2=new abego.TiddlerQuery(_10a,_10b,_10c,_110,config.options.chkSearchExtendedFields);}catch(e){return [];}var _111=_f2.filter(_10f);var _112=abego.YourSearch.getRankFunction();for(var i=0;i&lt;_111.length;i++){var _114=_111[i];var rank=_112(_114,_f2);_114.searchRank=rank;}if(!_10d){_10d=&quot;title&quot;;}var _116=function(a,b){var _119=a.searchRank-b.searchRank;if(_119==0){if(a[_10d]==b[_10d]){return (0);}else{return (a[_10d]&lt;b[_10d])?-1:+1;}}else{return (_119&gt;0)?-1:+1;}};_111.sort(_116);return _111;};var _11a=80;var _11b=50;var _11c=250;var _11d=50;var _11e=25;var _11f=10;var _120=&quot;yourSearchResult&quot;;var _121=&quot;yourSearchResultItems&quot;;var _122;var _123;var _124;var _125;var _126;var _127=function(){if(version.extensions.YourSearchPlugin.styleSheetInited){return;}version.extensions.YourSearchPlugin.styleSheetInited=true;setStylesheet(store.getTiddlerText(&quot;YourSearchStyleSheet&quot;),&quot;yourSearch&quot;);};var _128=function(){return _123!=null&amp;&amp;_123.parentNode==document.body;};var _129=function(){if(_128()){document.body.removeChild(_123);}};var _12a=function(e){_129();var _12c=this.getAttribute(&quot;tiddlyLink&quot;);if(_12c){var _12d=this.getAttribute(&quot;withHilite&quot;);var _12e=highlightHack;if(_12d&amp;&amp;_12d==&quot;true&quot;&amp;&amp;_f2){highlightHack=_f2.getMarkRegExp();}story.displayTiddler(this,_12c);highlightHack=_12e;}return (false);};var _12f=function(){if(!_124){return;}var root=_124;var _131=findPosX(root);var _132=findPosY(root);var _133=root.offsetHeight;var _134=_131;var _135=_132+_133;var _136=findWindowWidth();if(_136&lt;_123.offsetWidth){_123.style.width=(_136-100)+&quot;px&quot;;_136=findWindowWidth();}var _137=_123.offsetWidth;if(_134+_137&gt;_136){_134=_136-_137-30;}if(_134&lt;0){_134=0;}_123.style.left=_134+&quot;px&quot;;_123.style.top=_135+&quot;px&quot;;_123.style.display=&quot;block&quot;;};var _138=function(){if(_123){window.scrollTo(0,ensureVisible(_123));}if(_124){window.scrollTo(0,ensureVisible(_124));}};var _139=function(){_12f();_138();};var _13a;var _13b;var _13c=new abego.PageWiseRenderer();var _13d=function(_13e){this.itemHtml=store.getTiddlerText(&quot;YourSearchItemTemplate&quot;);if(!this.itemHtml){alertAndThrow(&quot;YourSearchItemTemplate not found&quot;);}this.place=document.getElementById(_121);if(!this.place){this.place=createTiddlyElement(_13e,&quot;div&quot;,_121);}};merge(_13d.prototype,{render:function(_13f,_140,_141,_142){_13a=_142;_13b=_140;var item=createTiddlyElement(this.place,&quot;div&quot;,null,&quot;yourSearchItem&quot;);item.innerHTML=this.itemHtml;applyHtmlMacros(item,null);refreshElements(item,null);},endRendering:function(_144){_13b=null;}});var _145=function(){if(!_123||!_124){return;}var html=store.getTiddlerText(&quot;YourSearchResultTemplate&quot;);if(!html){html=&quot;&lt;b&gt;Tiddler YourSearchResultTemplate not found&lt;/b&gt;&quot;;}_123.innerHTML=html;applyHtmlMacros(_123,null);refreshElements(_123,null);var _147=new _13d(_123);_13c.renderPage(_147);_139();};_13c.getItemsPerPage=function(){var n=(config.options.chkPreviewText)?abego.toInt(config.options.txtItemsPerPageWithPreview,_11f):abego.toInt(config.options.txtItemsPerPage,_11e);return (n&gt;0)?n:1;};_13c.onPageChanged=function(){_145();};var _149=function(){if(!_123){_123=createTiddlyElement(document.body,&quot;div&quot;,_120,&quot;yourSearchResult&quot;);}else{if(_123.parentNode!=document.body){document.body.appendChild(_123);}}_145();};var _14a=function(){if(_124==null||!config.options.chkUseYourSearch){return;}if((_124.value==_122)&amp;&amp;_122&amp;&amp;!_128()){if(_123&amp;&amp;(_123.parentNode!=document.body)){document.body.appendChild(_123);_139();}else{_149();}}};var _14b=function(){_129();_123=null;_122=null;};var _14c=function(self,e){while(e!=null){if(self==e){return true;}e=e.parentNode;}return false;};var _14f=function(e){if(e.target==_124){return;}if(e.target==_125){return;}if(_123&amp;&amp;_14c(_123,e.target)){return;}_129();};var _151=function(e){if(e.keyCode==27){_129();}};addEvent(document,&quot;click&quot;,_14f);addEvent(document,&quot;keyup&quot;,_151);var _153=function(text,_155,_156){_122=text;_f3(_108(store,text,_155,_156,&quot;title&quot;,&quot;excludeSearch&quot;));highlightHack=_f2?_f2.getMarkRegExp():null;_13c.setItems(_f5());_149();highlightHack=null;};var _157=function(_158,_159,_15a,_15b,_15c,_15d){_127();_122=&quot;&quot;;var _15e=null;var _15f=function(txt){if(config.options.chkUseYourSearch){_153(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);}else{story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);}_122=txt.value;};var _161=function(e){_15f(_124);return false;};var _163=function(e){if(!e){var e=window.event;}_124=this;switch(e.keyCode){case 13:if(e.ctrlKey&amp;&amp;_126&amp;&amp;_128()){_126.onclick.apply(_126,[e]);}else{_15f(this);}break;case 27:if(_128()){_129();}else{this.value=&quot;&quot;;clearMessage();}break;}if(String.fromCharCode(e.keyCode)==this.accessKey||e.altKey){_14a();}if(this.value.length&lt;3&amp;&amp;_15e){clearTimeout(_15e);}if(this.value.length&gt;2){if(this.value!=_122){if(!config.options.chkUseYourSearch||config.options.chkSearchAsYouType){if(_15e){clearTimeout(_15e);}var txt=this;_15e=setTimeout(function(){_15f(txt);},500);}}else{if(_15e){clearTimeout(_15e);}}}if(this.value.length==0){_129();}};var _166=function(e){this.select();clearMessage();_14a();};var args=_15c.parseParams(&quot;list&quot;,null,true);var _169=getFlag(args,&quot;buttonAtRight&quot;);var _16a=getParam(args,&quot;sizeTextbox&quot;,this.sizeTextbox);var btn;if(!_169){btn=createTiddlyButton(_158,this.label,this.prompt,_161);}var txt=createTiddlyElement(_158,&quot;input&quot;,null,null,null);if(_15a[0]){txt.value=_15a[0];}txt.onkeyup=_163;txt.onfocus=_166;txt.setAttribute(&quot;size&quot;,_16a);txt.setAttribute(&quot;accessKey&quot;,this.accessKey);txt.setAttribute(&quot;autocomplete&quot;,&quot;off&quot;);if(config.browser.isSafari){txt.setAttribute(&quot;type&quot;,&quot;search&quot;);txt.setAttribute(&quot;results&quot;,&quot;5&quot;);}else{txt.setAttribute(&quot;type&quot;,&quot;text&quot;);}if(_169){btn=createTiddlyButton(_158,this.label,this.prompt,_161);}_124=txt;_125=btn;};var _16d=function(){_129();var _16e=_f5();var n=_16e.length;if(n){var _170=[];for(var i=0;i&lt;n;i++){_170.push(_16e[i].title);}story.displayTiddlers(null,_170);}};var _172=function(_173,_174,_175,_176){invokeMacro(_173,&quot;option&quot;,_174,_175,_176);var elem=_173.lastChild;var _178=elem.onclick;elem.onclick=function(e){var _17a=_178.apply(this,arguments);_145();return _17a;};return elem;};var _17b=function(s){var _17d=[&quot;''&quot;,&quot;{{{&quot;,&quot;}}}&quot;,&quot;//&quot;,&quot;&lt;&lt;&lt;&quot;,&quot;/***&quot;,&quot;***/&quot;];var _17e=&quot;&quot;;for(var i=0;i&lt;_17d.length;i++){if(i!=0){_17e+=&quot;|&quot;;}_17e+=&quot;(&quot;+_17d[i].escapeRegExp()+&quot;)&quot;;}return s.replace(new RegExp(_17e,&quot;mg&quot;),&quot;&quot;).trim();};var _180=function(){var i=_13a;return (i&gt;=0&amp;&amp;i&lt;=9)?(i&lt;9?(i+1):0):-1;};var _182=new abego.LimitedTextRenderer();var _183=function(_184,s,_186){_182.render(_184,s,_186,_f2.getMarkRegExp());};var _187=TiddlyWiki.prototype.saveTiddler;TiddlyWiki.prototype.saveTiddler=function(_188,_189,_18a,_18b,_18c,tags,_18e){_187.apply(this,arguments);_14b();};var _18f=TiddlyWiki.prototype.removeTiddler;TiddlyWiki.prototype.removeTiddler=function(_190){_18f.apply(this,arguments);_14b();};config.macros.yourSearch={label:&quot;yourSearch&quot;,prompt:&quot;Gives access to the current/last YourSearch result&quot;,handler:function(_191,_192,_193,_194,_195,_196){if(_193.length==0){return;}var name=_193[0];var func=config.macros.yourSearch.funcs[name];if(func){func(_191,_192,_193,_194,_195,_196);}},tests:{&quot;true&quot;:function(){return true;},&quot;false&quot;:function(){return false;},&quot;found&quot;:function(){return _f6()&gt;0;},&quot;previewText&quot;:function(){return config.options.chkPreviewText;}},funcs:{itemRange:function(_199){if(_f6()){var _19a=_13c.getLastIndexOnPage();var s=&quot;%0 - %1&quot;.format([_13c.getFirstIndexOnPage()+1,_19a+1]);createTiddlyText(_199,s);}},count:function(_19c){createTiddlyText(_19c,_f6().toString());},query:function(_19d){if(_f2){createTiddlyText(_19d,_f2.toString());}},version:function(_19e){var t=&quot;YourSearch %0.%1.%2&quot;.format([version.extensions.YourSearchPlugin.major,version.extensions.YourSearchPlugin.minor,version.extensions.YourSearchPlugin.revision]);var e=createTiddlyElement(_19e,&quot;a&quot;);e.setAttribute(&quot;href&quot;,&quot;http://tiddlywiki.abego-software.de/#YourSearchPlugin&quot;);e.innerHTML=&quot;&lt;font color=\s&quot;black\s&quot; face=\s&quot;Arial, Helvetica, sans-serif\s&quot;&gt;&quot;+t+&quot;&lt;font&gt;&quot;;},copyright:function(_1a1){var e=createTiddlyElement(_1a1,&quot;a&quot;);e.setAttribute(&quot;href&quot;,&quot;http://www.abego-software.de&quot;);e.innerHTML=&quot;&lt;font color=\s&quot;black\s&quot; face=\s&quot;Arial, Helvetica, sans-serif\s&quot;&gt;&amp;copy; 2005-2006 &lt;b&gt;&lt;font color=\s&quot;red\s&quot;&gt;abego&lt;/font&gt;&lt;/b&gt; Software&lt;font&gt;&quot;;},newTiddlerButton:function(_1a3){if(_f2){var r=abego.parseNewTiddlerCommandLine(_f2.getQueryText());var btn=config.macros.newTiddler.createNewTiddlerButton(_1a3,r.title,r.params,&quot;new tiddler&quot;,&quot;Create a new tiddler based on search text. (Shortcut: Ctrl-Enter; Separators: '.', '#')&quot;,null,&quot;text&quot;);var _1a6=btn.onclick;btn.onclick=function(){_129();_1a6.apply(this,arguments);};_126=btn;}},linkButton:function(_1a7,_1a8,_1a9,_1aa,_1ab,_1ac){if(_1a9&lt;2){return;}var _1ad=_1a9[1];var text=_1a9&lt;3?_1ad:_1a9[2];var _1af=_1a9&lt;4?text:_1a9[3];var _1b0=_1a9&lt;5?null:_1a9[4];var btn=createTiddlyButton(_1a7,text,_1af,_12a,null,null,_1b0);btn.setAttribute(&quot;tiddlyLink&quot;,_1ad);},closeButton:function(_1b2,_1b3,_1b4,_1b5,_1b6,_1b7){var _1b8=createTiddlyButton(_1b2,&quot;close&quot;,&quot;Close the Search Results (Shortcut: ESC)&quot;,_129);},openAllButton:function(_1b9,_1ba,_1bb,_1bc,_1bd,_1be){var n=_f6();if(n==0){return;}var _1c0=n==1?&quot;open tiddler&quot;:&quot;open all %0 tiddlers&quot;.format([n]);var _1c1=createTiddlyButton(_1b9,_1c0,&quot;Open all found tiddlers (Shortcut: Alt-O)&quot;,_16d);_1c1.setAttribute(&quot;accessKey&quot;,&quot;O&quot;);},naviBar:function(_1c2,_1c3,_1c4,_1c5,_1c6,_1c7){_13c.addPageNavigation(_1c2);},&quot;if&quot;:function(_1c8,_1c9,_1ca,_1cb,_1cc,_1cd){if(_1ca.length&lt;2){return;}var _1ce=_1ca[1];var _1cf=(_1ce==&quot;not&quot;);if(_1cf){if(_1ca.length&lt;3){return;}_1ce=_1ca[2];}var test=config.macros.yourSearch.tests[_1ce];var _1d1=false;try{if(test){_1d1=test(_1c8,_1c9,_1ca,_1cb,_1cc,_1cd)!=_1cf;}else{_1d1=(!eval(_1ce))==_1cf;}}catch(ex){}if(!_1d1){_1c8.style.display=&quot;none&quot;;}},chkPreviewText:function(_1d2,_1d3,_1d4,_1d5,_1d6,_1d7){var _1d8=_1d4.slice(1).join(&quot; &quot;);var elem=_172(_1d2,&quot;chkPreviewText&quot;,_1d5,_1d7);elem.setAttribute(&quot;accessKey&quot;,&quot;P&quot;);elem.title=&quot;Show text preview of found tiddlers (Shortcut: Alt-P)&quot;;return elem;}}};config.macros.foundTiddler={label:&quot;foundTiddler&quot;,prompt:&quot;Provides information on the tiddler currently processed on the YourSearch result page&quot;,handler:function(_1da,_1db,_1dc,_1dd,_1de,_1df){var name=_1dc[0];var func=config.macros.foundTiddler.funcs[name];if(func){func(_1da,_1db,_1dc,_1dd,_1de,_1df);}},funcs:{title:function(_1e2,_1e3,_1e4,_1e5,_1e6,_1e7){if(!_13b){return;}var _1e8=_180();var _1e9=_1e8&gt;=0?&quot;Open tiddler (Shortcut: Alt-%0)&quot;.format([_1e8.toString()]):&quot;Open tiddler&quot;;var btn=createTiddlyButton(_1e2,null,_1e9,_12a,null);btn.setAttribute(&quot;tiddlyLink&quot;,_13b.title);btn.setAttribute(&quot;withHilite&quot;,&quot;true&quot;);_183(btn,_13b.title,_11a);if(_1e8&gt;=0){btn.setAttribute(&quot;accessKey&quot;,_1e8.toString());}},tags:function(_1eb,_1ec,_1ed,_1ee,_1ef,_1f0){if(!_13b){return;}_183(_1eb,_13b.getTags(),_11b);},text:function(_1f1,_1f2,_1f3,_1f4,_1f5,_1f6){if(!_13b){return;}_183(_1f1,_17b(_13b.text),_11c);},field:function(_1f7,_1f8,_1f9,_1fa,_1fb,_1fc){if(!_13b){return;}var name=_1f9[1];var len=_1f9.length&gt;2?abego.toInt(_1f9[2],_11d):_11d;var v=store.getValue(_13b,name);if(v){_183(_1f7,_17b(v),len);}},number:function(_200,_201,_202,_203,_204,_205){var _206=_180();if(_206&gt;=0){var text=&quot;%0)&quot;.format([_206.toString()]);createTiddlyElement(_200,&quot;span&quot;,null,&quot;shortcutNumber&quot;,text);}}}};var opts={chkUseYourSearch:true,chkPreviewText:true,chkSearchAsYouType:true,chkSearchInTitle:true,chkSearchInText:true,chkSearchInTags:true,chkSearchExtendedFields:true,txtItemsPerPage:_11e,txtItemsPerPageWithPreview:_11f};for(var n in opts){if(config.options[n]==undefined){config.options[n]=opts[n];}}config.shadowTiddlers.AdvancedOptions+=&quot;\sn&lt;&lt;option chkUseYourSearch&gt;&gt; Use 'Your Search' //([[more options|YourSearch Options]]) ([[help|YourSearch Help]])// &quot;;config.shadowTiddlers[&quot;YourSearch Help&quot;]=&quot;!Field Search\snWith the Field Search you can restrict your search to certain fields of a tiddler, e.g&quot;+&quot; only search the tags or only the titles. The general form is //fieldname//'':''//textToSearch// (e.&quot;+&quot;g. {{{title:intro}}}). In addition one-character shortcuts are also supported for the standard field&quot;+&quot;s {{{title}}}, {{{text}}} and {{{tags}}}:\sn|!What you want|!What you type|!Example|\sn|Search ''titles &quot;+&quot;only''|start word with ''!''|{{{!jonny}}} (shortcut for {{{title:jonny}}})|\sn|Search ''contents/text &quot;+&quot;only''|start word with ''%''|{{{%football}}} (shortcut for {{{text:football}}})|\sn|Search ''tags only&quot;+&quot;''|start word with ''#''|{{{#Plugin}}} (shortcut for {{{tags:Plugin}}})|\sn\snUsing this feature you may&quot;+&quot; also search the extended fields (\s&quot;Metadata\s&quot;) introduced with TiddlyWiki 2.1, e.g. use {{{priority:1&quot;+&quot;}}} to find all tiddlers with the priority field set to \s&quot;1\s&quot;.\sn\snYou may search a word in more than one&quot;+&quot; field. E.g. {{{!#Plugin}}} (or {{{title:tags:Plugin}}} in the \s&quot;long form\s&quot;) finds tiddlers containin&quot;+&quot;g \s&quot;Plugin\s&quot; either in the title or in the tags (but does not look for \s&quot;Plugin\s&quot; in the text). \sn\sn!Boole&quot;+&quot;an Search\snThe Boolean Search is useful when searching for multiple words.\sn|!What you want|!What you &quot;+&quot;type|!Example|\sn|''All words'' must exist|List of words|{{{jonny jeremy}}} (or {{{jonny and jeremy}}}&quot;+&quot;)|\sn|''At least one word'' must exist|Separate words by ''or''|{{{jonny or jeremy}}}|\sn|A word ''must &quot;+&quot;not exist''|Start word with ''-''|{{{-jonny}}} (or {{{not jonny}}})|\sn\sn''Note:'' When you specify two&quot;+&quot; words, separated with a space, YourSearch finds all tiddlers that contain both words, but not neces&quot;+&quot;sarily next to each other. If you want to find a sequence of word, e.g. '{{{John Brown}}}', you need&quot;+&quot; to put the words into quotes. I.e. you type: {{{\s&quot;john brown\s&quot;}}}.\sn\snUsing parenthesis you may change &quot;+&quot;the default \s&quot;left to right\s&quot; evaluation of the boolean search. E.g. {{{not (jonny or jeremy)}}} finds&quot;+&quot; all tiddlers that contain neither \s&quot;jonny\s&quot; nor \s&quot;jeremy. In contrast to this {{{not jonny or jeremy}}&quot;+&quot;} (i.e. without parenthesis) finds all tiddlers that either don't contain \s&quot;jonny\s&quot; or that contain \s&quot;j&quot;+&quot;eremy\s&quot;.\sn\sn!'Exact Word' Search\snBy default a search result all matches that 'contain' the searched tex&quot;+&quot;t. E.g. if you search for {{{Task}}} you will get all tiddlers containing 'Task', but also '~Complet&quot;+&quot;edTask', '~TaskForce' etc.\sn\snIf you only want to get the tiddlers that contain 'exactly the word' you&quot;+&quot; need to prefix it with a '='. E.g. typing '=Task' will find the tiddlers that contain the word 'Tas&quot;+&quot;k', ignoring words that just contain 'Task' as a substring.\sn\sn!~CaseSensitiveSearch and ~RegExpSearch&quot;+&quot;\snThe standard search options ~CaseSensitiveSearch and ~RegExpSearch are fully supported by YourSearc&quot;+&quot;h. However when ''~RegExpSearch'' is on Filtered and Boolean Search are disabled.\sn\snIn addition you m&quot;+&quot;ay do a \s&quot;regular expression\s&quot; search even with the ''~RegExpSearch'' set to false by directly enterin&quot;+&quot;g the regular expression into the search field, framed with {{{/.../}}}. \sn\snExample: {{{/m[ae][iy]er/&quot;+&quot;}}} will find all tiddlers that contain either \s&quot;maier\s&quot;, \s&quot;mayer\s&quot;, \s&quot;meier\s&quot; or \s&quot;meyer\s&quot;.\sn\sn!~JavaScript E&quot;+&quot;xpression Filtering\snIf you are familiar with JavaScript programming and know some TiddlyWiki interna&quot;+&quot;ls you may also use JavaScript expression for the search. Just enter a JavaScript boolean expression&quot;+&quot; into the search field, framed with {{{ { ... } }}}. In the code refer to the variable tiddler and e&quot;+&quot;valuate to {{{true}}} when the given tiddler should be included in the result. \sn\snExample: {{{ { tidd&quot;+&quot;ler.modified &gt; new Date(\s&quot;Jul 4, 2005\s&quot;)} }}} returns all tiddler modified after July 4th, 2005.\sn\sn!Com&quot;+&quot;bined Search\snYou are free to combine the various search options. \sn\sn''Examples''\sn|!What you type|!Res&quot;+&quot;ult|\sn|{{{!jonny !jeremy -%football}}}|all tiddlers with both {{{jonny}}} and {{{jeremy}}} in its tit&quot;+&quot;les, but no {{{football}}} in content.|\sn|{{{#=Task}}}|All tiddlers tagged with 'Task' (the exact wor&quot;+&quot;d). Tags named '~CompletedTask', '~TaskForce' etc. are not considered.|\sn\sn!Access Keys\snYou are encour&quot;+&quot;aged to use the access keys (also called \s&quot;shortcut\s&quot; keys) for the most frequently used operations. F&quot;+&quot;or quick reference these shortcuts are also mentioned in the tooltip for the various buttons etc.\sn\sn|&quot;+&quot;!Key|!Operation|\sn|{{{Alt-F}}}|''The most important keystroke'': It moves the cursor to the search in&quot;+&quot;put field so you can directly start typing your query. Pressing {{{Alt-F}}} will also display the pr&quot;+&quot;evious search result. This way you can quickly display multiple tiddlers using \s&quot;Press {{{Alt-F}}}. S&quot;+&quot;elect tiddler.\s&quot; sequences.|\sn|{{{ESC}}}|Closes the [[YourSearch Result]]. When the [[YourSearch Resul&quot;+&quot;t]] is already closed and the cursor is in the search input field the field's content is cleared so &quot;+&quot;you start a new query.|\sn|{{{Alt-1}}}, {{{Alt-2}}},... |Pressing these keys opens the first, second e&quot;+&quot;tc. tiddler from the result list.|\sn|{{{Alt-O}}}|Opens all found tiddlers.|\sn|{{{Alt-P}}}|Toggles the &quot;+&quot;'Preview Text' mode.|\sn|{{{Alt-'&lt;'}}}, {{{Alt-'&gt;'}}}|Displays the previous or next page in the [[Your&quot;+&quot;Search Result]].|\sn|{{{Return}}}|When you have turned off the 'as you type' search mode pressing the &quot;+&quot;{{{Return}}} key actually starts the search (as does pressing the 'search' button).|\sn\sn//If some of t&quot;+&quot;hese shortcuts don't work for you check your browser if you have other extensions installed that alr&quot;+&quot;eady \s&quot;use\s&quot; these shortcuts.//&quot;;config.shadowTiddlers[&quot;YourSearch Options&quot;]=&quot;|&gt;|!YourSearch Options|\sn|&gt;|&lt;&lt;option chkUseYourSearch&gt;&gt; Use 'Your Search'|\sn|!|&lt;&lt;option chkPreviewText&quot;+&quot;&gt;&gt; Show Text Preview|\sn|!|&lt;&lt;option chkSearchAsYouType&gt;&gt; 'Search As You Type' Mode (No RETURN required&quot;+&quot; to start search)|\sn|!|Default Search Filter:&lt;&lt;option chkSearchInTitle&gt;&gt;Title ('!')     &lt;&lt;option chk&quot;+&quot;SearchInText&gt;&gt;Text ('%')     &lt;&lt;option chkSearchInTags&gt;&gt;Tags ('#')    &lt;&lt;option chkSearchExtendedFiel&quot;+&quot;ds&gt;&gt;Extended Fields&lt;html&gt;&lt;br&gt;&lt;font size=\s&quot;-2\s&quot;&gt;The fields of a tiddlers that are searched when you don&quot;+&quot;'t explicitly specify a filter in the search text &lt;br&gt;(Explictly specify fields using one or more '!&quot;+&quot;', '%', '#' or 'fieldname:' prefix before the word/text to find).&lt;/font&gt;&lt;/html&gt;|\sn|!|Number of items &quot;+&quot;on search result page: &lt;&lt;option txtItemsPerPage&gt;&gt;|\sn|!|Number of items on search result page with pre&quot;+&quot;view text: &lt;&lt;option txtItemsPerPageWithPreview&gt;&gt;|\sn&quot;;config.shadowTiddlers[&quot;YourSearchStyleSheet&quot;]=&quot;/***\sn!~YourSearchResult Stylesheet\sn***/\sn/*{{{*/\sn.yourSearchResult {\sn\stposition: absolute;\sn\stwidth: 800&quot;+&quot;px;\sn\sn\stpadding: 0.2em;\sn\stlist-style: none;\sn\stmargin: 0;\sn\sn\stbackground: #ffd;\sn\stborder: 1px solid DarkGra&quot;+&quot;y;\sn}\sn\sn/*}}}*/\sn/***\sn!!Summary Section\sn***/\sn/*{{{*/\sn.yourSearchResult .summary {\sn\stborder-bottom-width:&quot;+&quot; thin;\sn\stborder-bottom-style: solid;\sn\stborder-bottom-color: #999999;\sn\stpadding-bottom: 4px;\sn}\sn\sn.yourSea&quot;+&quot;rchRange, .yourSearchCount, .yourSearchQuery   {\sn\stfont-weight: bold;\sn}\sn\sn.yourSearchResult .summary .&quot;+&quot;button {\sn\stfont-size: 10px;\sn\sn\stpadding-left: 0.3em;\sn\stpadding-right: 0.3em;\sn}\sn\sn.yourSearchResult .summa&quot;+&quot;ry .chkBoxLabel {\sn\stfont-size: 10px;\sn\sn\stpadding-right: 0.3em;\sn}\sn\sn/*}}}*/\sn/***\sn!!Items Area\sn***/\sn/*{{{*&quot;+&quot;/\sn.yourSearchResult .marked {\sn\stbackground: none;\sn\stfont-weight: bold;\sn}\sn\sn.yourSearchItem {\sn\stmargin-to&quot;+&quot;p: 2px;\sn}\sn\sn.yourSearchNumber {\sn\stcolor: #808080;\sn}\sn\sn\sn.yourSearchTags {\sn\stcolor: #008000;\sn}\sn\sn.yourSearc&quot;+&quot;hText {\sn\stcolor: #808080;\sn\stmargin-bottom: 6px;\sn}\sn\sn/*}}}*/\sn/***\sn!!Footer\sn***/\sn/*{{{*/\sn.yourSearchFoote&quot;+&quot;r {\sn\stmargin-top: 8px;\sn\stborder-top-width: thin;\sn\stborder-top-style: solid;\sn\stborder-top-color: #999999;&quot;+&quot;\sn}\sn\sn.yourSearchFooter a:hover{\sn\stbackground: none;\sn\stcolor: none;\sn}\sn/*}}}*/\sn/***\sn!!Navigation Bar\sn***/&quot;+&quot;\sn/*{{{*/\sn.yourSearchNaviBar a {\sn\stfont-size: 16px;\sn\stmargin-left: 4px;\sn\stmargin-right: 4px;\sn\stcolor: bla&quot;+&quot;ck;\sn\sttext-decoration: underline;\sn}\sn\sn.yourSearchNaviBar a:hover {\sn\stbackground-color: none;\sn}\sn\sn.yourSe&quot;+&quot;archNaviBar .prev {\sn\stfont-weight: bold;\sn\stcolor: blue;\sn}\sn\sn.yourSearchNaviBar .currentPage {\sn\stcolor: #&quot;+&quot;FF0000;\sn\stfont-weight: bold;\sn\sttext-decoration: none;\sn}\sn\sn.yourSearchNaviBar .next {\sn\stfont-weight: bold&quot;+&quot;;\sn\stcolor: blue;\sn}\sn/*}}}*/\sn&quot;;config.shadowTiddlers[&quot;YourSearchResultTemplate&quot;]=&quot;&lt;!--\sn{{{\sn--&gt;\sn&lt;span macro=\s&quot;yourSearch if found\s&quot;&gt;\sn&lt;!-- The Summary Header ============================&quot;+&quot;================ --&gt;\sn&lt;table class=\s&quot;summary\s&quot; border=\s&quot;0\s&quot; width=\s&quot;100%\s&quot; cellspacing=\s&quot;0\s&quot; cellpadding=\s&quot;0\s&quot;&gt;&quot;+&quot;&lt;tbody&gt;\sn  &lt;tr&gt;\sn\st&lt;td align=\s&quot;left\s&quot;&gt;\sn\st\stYourSearch Result &lt;span class=\s&quot;yourSearchRange\s&quot; macro=\s&quot;yourSearc&quot;+&quot;h itemRange\s&quot;&gt;&lt;/span&gt;\sn\st\st&amp;nbsp;of&amp;nbsp;&lt;span class=\s&quot;yourSearchCount\s&quot; macro=\s&quot;yourSearch count\s&quot;&gt;&lt;/span&gt;\sn&quot;+&quot;\st\stfor&amp;nbsp;&lt;span class=\s&quot;yourSearchQuery\s&quot; macro=\s&quot;yourSearch query\s&quot;&gt;&lt;/span&gt;\sn\st&lt;/td&gt;\sn\st&lt;td class=\s&quot;yourSea&quot;+&quot;rchButtons\s&quot; align=\s&quot;right\s&quot;&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch chkPreviewText\s&quot;&gt;&lt;/span&gt;&lt;span class=\s&quot;chkBoxLabel&quot;+&quot;\s&quot;&gt;preview text&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch newTiddlerButton\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch openAllButton\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch lin&quot;+&quot;kButton 'YourSearch Options' options 'Configure YourSearch'\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch linkB&quot;+&quot;utton 'YourSearch Help' help 'Get help how to use YourSearch'\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch clo&quot;+&quot;seButton\s&quot;&gt;&lt;/span&gt;\sn\st&lt;/td&gt;\sn  &lt;/tr&gt;\sn&lt;/tbody&gt;&lt;/table&gt;\sn\sn&lt;!-- The List of Found Tiddlers =================&quot;+&quot;=========================== --&gt;\sn&lt;div id=\s&quot;yourSearchResultItems\s&quot; itemsPerPage=\s&quot;25\s&quot; itemsPerPageWithPr&quot;+&quot;eview=\s&quot;10\s&quot;&gt;&lt;/div&gt;\sn\sn&lt;!-- The Footer (with the Navigation) ===========================================&quot;+&quot;= --&gt;\sn&lt;table class=\s&quot;yourSearchFooter\s&quot; border=\s&quot;0\s&quot; width=\s&quot;100%\s&quot; cellspacing=\s&quot;0\s&quot; cellpadding=\s&quot;0\s&quot;&gt;&lt;tbody&quot;+&quot;&gt;\sn  &lt;tr&gt;\sn\st&lt;td align=\s&quot;left\s&quot;&gt;\sn\st\stResult page: &lt;span class=\s&quot;yourSearchNaviBar\s&quot; macro=\s&quot;yourSearch naviBar&quot;+&quot;\s&quot;&gt;&lt;/span&gt;\sn\st&lt;/td&gt;\sn\st&lt;td align=\s&quot;right\s&quot;&gt;&lt;span macro=\s&quot;yourSearch version\s&quot;&gt;&lt;/span&gt;, &lt;span macro=\s&quot;yourSearc&quot;+&quot;h copyright\s&quot;&gt;&lt;/span&gt;\sn\st&lt;/td&gt;\sn  &lt;/tr&gt;\sn&lt;/tbody&gt;&lt;/table&gt;\sn&lt;!-- end of the 'tiddlers found' case =========&quot;+&quot;================================== --&gt;\sn&lt;/span&gt;\sn\sn\sn&lt;!-- The \s&quot;No tiddlers found\s&quot; case =================&quot;+&quot;========================== --&gt;\sn&lt;span macro=\s&quot;yourSearch if not found\s&quot;&gt;\sn&lt;table class=\s&quot;summary\s&quot; border=&quot;+&quot;\s&quot;0\s&quot; width=\s&quot;100%\s&quot; cellspacing=\s&quot;0\s&quot; cellpadding=\s&quot;0\s&quot;&gt;&lt;tbody&gt;\sn  &lt;tr&gt;\sn\st&lt;td align=\s&quot;left\s&quot;&gt;\sn\st\stYourSearch Resu&quot;+&quot;lt: No tiddlers found for &lt;span class=\s&quot;yourSearchQuery\s&quot; macro=\s&quot;yourSearch query\s&quot;&gt;&lt;/span&gt;.\sn\st&lt;/td&gt;\sn\st&lt;t&quot;+&quot;d class=\s&quot;yourSearchButtons\s&quot; align=\s&quot;right\s&quot;&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch newTiddlerButton\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch linkButton 'YourSearch Options'&quot;+&quot; options 'Configure YourSearch'\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch linkButton 'YourSearch Help' help&quot;+&quot; 'Get help how to use YourSearch'\s&quot;&gt;&lt;/span&gt;\sn\st\st&lt;span macro=\s&quot;yourSearch closeButton\s&quot;&gt;&lt;/span&gt;\sn\st&lt;/td&gt;\sn  &lt;&quot;+&quot;/tr&gt;\sn&lt;/tbody&gt;&lt;/table&gt;\sn&lt;/span&gt;\sn\sn\sn&lt;!--\sn}}}\sn--&gt;\sn&quot;;config.shadowTiddlers[&quot;YourSearchItemTemplate&quot;]=&quot;&lt;!--\sn{{{\sn--&gt;\sn&lt;span class='yourSearchNumber' macro='foundTiddler number'&gt;&lt;/span&gt;\sn&lt;span class='yourSea&quot;+&quot;rchTitle' macro='foundTiddler title'/&gt;&lt;/span&gt;&amp;nbsp;-&amp;nbsp;\sn&lt;span class='yourSearchTags' macro='found&quot;+&quot;Tiddler field tags 50'/&gt;&lt;/span&gt;\sn&lt;span macro=\s&quot;yourSearch if previewText\s&quot;&gt;&lt;div class='yourSearchText' macro='fo&quot;+&quot;undTiddler field text 250'/&gt;&lt;/div&gt;&lt;/span&gt;\sn&lt;!--\sn}}}\sn--&gt;&quot;;config.shadowTiddlers[&quot;YourSearch&quot;]=&quot;&lt;&lt;tiddler [[YourSearch Help]]&gt;&gt;&quot;;config.shadowTiddlers[&quot;YourSearch Result&quot;]=&quot;The popup-like window displaying the result of a YourSearch query.&quot;;config.macros.search.handler=_157;var _20a=function(){if(config.macros.search.handler!=_157){alert(&quot;Message from YourSearchPlugin:\sn\sn\snAnother plugin has disabled the 'Your Search' features.\sn\sn\snYou may &quot;+&quot;disable the other plugin or change the load order of \snthe plugins (by changing the names of the tidd&quot;+&quot;lers)\snto enable the 'Your Search' features.&quot;);}};setTimeout(_20a,5000);abego.YourSearch.getStandardRankFunction=function(){return _fe;};abego.YourSearch.getRankFunction=function(){return abego.YourSearch.getStandardRankFunction();};abego.YourSearch.getCurrentTiddler=function(){return _13b;};abego.YourSearch.closeResult=function(){_129();};})();}\n//%/</div>
<div tiddler="excludeLists" modifier="YourName" modified="200611091947" created="200611091942" tags="systemTag excludeLists"></div>
<div tiddler="excludeSearch" modifier="YourName" modified="200611091947" created="200611091942" tags="systemTag excludeLists"></div>
<div tiddler="systemConfig" modifier="YourName" modified="200611091947" created="200611091942" tags="systemTag excludeLists"></div>
</div>
<!--POST-BODY-START-->

<!--POST-BODY-END-->
	</body>
</html>
